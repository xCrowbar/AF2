{"ast":null,"code":"var self = self || {}; // File:src/Three.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nvar THREE = {\n  REVISION: '72'\n}; //\n\nif (typeof define === 'function' && define.amd) {\n  define('three', THREE);\n} else if ('undefined' !== typeof exports && 'undefined' !== typeof module) {\n  module.exports = THREE;\n} // polyfills\n\n\nif (self.requestAnimationFrame === undefined || self.cancelAnimationFrame === undefined) {\n  // Missing in Android stock browser.\n  (function () {\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n\n    for (var x = 0; x < vendors.length && !self.requestAnimationFrame; ++x) {\n      self.requestAnimationFrame = self[vendors[x] + 'RequestAnimationFrame'];\n      self.cancelAnimationFrame = self[vendors[x] + 'CancelAnimationFrame'] || self[vendors[x] + 'CancelRequestAnimationFrame'];\n    }\n\n    if (self.requestAnimationFrame === undefined && self.setTimeout !== undefined) {\n      self.requestAnimationFrame = function (callback) {\n        var currTime = Date.now(),\n            timeToCall = Math.max(0, 16 - (currTime - lastTime));\n        var id = self.setTimeout(function () {\n          callback(currTime + timeToCall);\n        }, timeToCall);\n        lastTime = currTime + timeToCall;\n        return id;\n      };\n    }\n\n    if (self.cancelAnimationFrame === undefined && self.clearTimeout !== undefined) {\n      self.cancelAnimationFrame = function (id) {\n        self.clearTimeout(id);\n      };\n    }\n  })();\n}\n\nif (Math.sign === undefined) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\n  Math.sign = function (x) {\n    return x < 0 ? -1 : x > 0 ? 1 : +x;\n  };\n}\n\nif (Function.prototype.name === undefined && Object.defineProperty !== undefined) {\n  // Missing in IE9-11.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name\n  Object.defineProperty(Function.prototype, 'name', {\n    get: function () {\n      return this.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1];\n    }\n  });\n} // https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\n\n\nTHREE.MOUSE = {\n  LEFT: 0,\n  MIDDLE: 1,\n  RIGHT: 2\n}; // GL STATE CONSTANTS\n\nTHREE.CullFaceNone = 0;\nTHREE.CullFaceBack = 1;\nTHREE.CullFaceFront = 2;\nTHREE.CullFaceFrontBack = 3;\nTHREE.FrontFaceDirectionCW = 0;\nTHREE.FrontFaceDirectionCCW = 1; // SHADOWING TYPES\n\nTHREE.BasicShadowMap = 0;\nTHREE.PCFShadowMap = 1;\nTHREE.PCFSoftShadowMap = 2; // MATERIAL CONSTANTS\n// side\n\nTHREE.FrontSide = 0;\nTHREE.BackSide = 1;\nTHREE.DoubleSide = 2; // shading\n\nTHREE.FlatShading = 1;\nTHREE.SmoothShading = 2; // colors\n\nTHREE.NoColors = 0;\nTHREE.FaceColors = 1;\nTHREE.VertexColors = 2; // blending modes\n\nTHREE.NoBlending = 0;\nTHREE.NormalBlending = 1;\nTHREE.AdditiveBlending = 2;\nTHREE.SubtractiveBlending = 3;\nTHREE.MultiplyBlending = 4;\nTHREE.CustomBlending = 5; // custom blending equations\n// (numbers start from 100 not to clash with other\n// mappings to OpenGL constants defined in Texture.js)\n\nTHREE.AddEquation = 100;\nTHREE.SubtractEquation = 101;\nTHREE.ReverseSubtractEquation = 102;\nTHREE.MinEquation = 103;\nTHREE.MaxEquation = 104; // custom blending destination factors\n\nTHREE.ZeroFactor = 200;\nTHREE.OneFactor = 201;\nTHREE.SrcColorFactor = 202;\nTHREE.OneMinusSrcColorFactor = 203;\nTHREE.SrcAlphaFactor = 204;\nTHREE.OneMinusSrcAlphaFactor = 205;\nTHREE.DstAlphaFactor = 206;\nTHREE.OneMinusDstAlphaFactor = 207; // custom blending source factors\n//THREE.ZeroFactor = 200;\n//THREE.OneFactor = 201;\n//THREE.SrcAlphaFactor = 204;\n//THREE.OneMinusSrcAlphaFactor = 205;\n//THREE.DstAlphaFactor = 206;\n//THREE.OneMinusDstAlphaFactor = 207;\n\nTHREE.DstColorFactor = 208;\nTHREE.OneMinusDstColorFactor = 209;\nTHREE.SrcAlphaSaturateFactor = 210; // depth modes\n\nTHREE.NeverDepth = 0;\nTHREE.AlwaysDepth = 1;\nTHREE.LessDepth = 2;\nTHREE.LessEqualDepth = 3;\nTHREE.EqualDepth = 4;\nTHREE.GreaterEqualDepth = 5;\nTHREE.GreaterDepth = 6;\nTHREE.NotEqualDepth = 7; // TEXTURE CONSTANTS\n\nTHREE.MultiplyOperation = 0;\nTHREE.MixOperation = 1;\nTHREE.AddOperation = 2; // Mapping modes\n\nTHREE.UVMapping = 300;\nTHREE.CubeReflectionMapping = 301;\nTHREE.CubeRefractionMapping = 302;\nTHREE.EquirectangularReflectionMapping = 303;\nTHREE.EquirectangularRefractionMapping = 304;\nTHREE.SphericalReflectionMapping = 305; // Wrapping modes\n\nTHREE.RepeatWrapping = 1000;\nTHREE.ClampToEdgeWrapping = 1001;\nTHREE.MirroredRepeatWrapping = 1002; // Filters\n\nTHREE.NearestFilter = 1003;\nTHREE.NearestMipMapNearestFilter = 1004;\nTHREE.NearestMipMapLinearFilter = 1005;\nTHREE.LinearFilter = 1006;\nTHREE.LinearMipMapNearestFilter = 1007;\nTHREE.LinearMipMapLinearFilter = 1008; // Data types\n\nTHREE.UnsignedByteType = 1009;\nTHREE.ByteType = 1010;\nTHREE.ShortType = 1011;\nTHREE.UnsignedShortType = 1012;\nTHREE.IntType = 1013;\nTHREE.UnsignedIntType = 1014;\nTHREE.FloatType = 1015;\nTHREE.HalfFloatType = 1025; // Pixel types\n//THREE.UnsignedByteType = 1009;\n\nTHREE.UnsignedShort4444Type = 1016;\nTHREE.UnsignedShort5551Type = 1017;\nTHREE.UnsignedShort565Type = 1018; // Pixel formats\n\nTHREE.AlphaFormat = 1019;\nTHREE.RGBFormat = 1020;\nTHREE.RGBAFormat = 1021;\nTHREE.LuminanceFormat = 1022;\nTHREE.LuminanceAlphaFormat = 1023; // THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\n\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\n// DDS / ST3C Compressed texture formats\n\nTHREE.RGB_S3TC_DXT1_Format = 2001;\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\nTHREE.RGBA_S3TC_DXT5_Format = 2004; // PVRTC compressed texture formats\n\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103; // DEPRECATED\n\nTHREE.Projector = function () {\n  console.error('THREE.Projector has been moved to /examples/js/renderers/Projector.js.');\n\n  this.projectVector = function (vector, camera) {\n    console.warn('THREE.Projector: .projectVector() is now vector.project().');\n    vector.project(camera);\n  };\n\n  this.unprojectVector = function (vector, camera) {\n    console.warn('THREE.Projector: .unprojectVector() is now vector.unproject().');\n    vector.unproject(camera);\n  };\n\n  this.pickingRay = function (vector, camera) {\n    console.error('THREE.Projector: .pickingRay() is now raycaster.setFromCamera().');\n  };\n};\n\nTHREE.CanvasRenderer = function () {\n  console.error('THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js');\n  this.domElement = document.createElement('canvas');\n\n  this.clear = function () {};\n\n  this.render = function () {};\n\n  this.setClearColor = function () {};\n\n  this.setSize = function () {};\n}; // File:src/math/Color.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.Color = function (color) {\n  if (arguments.length === 3) {\n    return this.setRGB(arguments[0], arguments[1], arguments[2]);\n  }\n\n  return this.set(color);\n};\n\nTHREE.Color.prototype = {\n  constructor: THREE.Color,\n  r: 1,\n  g: 1,\n  b: 1,\n  set: function (value) {\n    if (value instanceof THREE.Color) {\n      this.copy(value);\n    } else if (typeof value === 'number') {\n      this.setHex(value);\n    } else if (typeof value === 'string') {\n      this.setStyle(value);\n    }\n\n    return this;\n  },\n  setHex: function (hex) {\n    hex = Math.floor(hex);\n    this.r = (hex >> 16 & 255) / 255;\n    this.g = (hex >> 8 & 255) / 255;\n    this.b = (hex & 255) / 255;\n    return this;\n  },\n  setRGB: function (r, g, b) {\n    this.r = r;\n    this.g = g;\n    this.b = b;\n    return this;\n  },\n  setHSL: function () {\n    function hue2rgb(p, q, t) {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\n      return p;\n    }\n\n    return function (h, s, l) {\n      // h,s,l ranges are in 0.0 - 1.0\n      h = THREE.Math.euclideanModulo(h, 1);\n      s = THREE.Math.clamp(s, 0, 1);\n      l = THREE.Math.clamp(l, 0, 1);\n\n      if (s === 0) {\n        this.r = this.g = this.b = l;\n      } else {\n        var p = l <= 0.5 ? l * (1 + s) : l + s - l * s;\n        var q = 2 * l - p;\n        this.r = hue2rgb(q, p, h + 1 / 3);\n        this.g = hue2rgb(q, p, h);\n        this.b = hue2rgb(q, p, h - 1 / 3);\n      }\n\n      return this;\n    };\n  }(),\n  setStyle: function (style) {\n    var parseAlpha = function (strAlpha) {\n      var alpha = parseFloat(strAlpha);\n\n      if (alpha < 1) {\n        console.warn('THREE.Color: Alpha component of color ' + style + ' will be ignored.');\n      }\n\n      return alpha;\n    };\n\n    var m;\n\n    if (m = /^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(style)) {\n      // rgb / hsl\n      var color;\n      var name = m[1];\n      var components = m[2];\n\n      switch (name) {\n        case 'rgb':\n          if (color = /^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*$/.exec(components)) {\n            // rgb(255,0,0)\n            this.r = Math.min(255, parseInt(color[1], 10)) / 255;\n            this.g = Math.min(255, parseInt(color[2], 10)) / 255;\n            this.b = Math.min(255, parseInt(color[3], 10)) / 255;\n            return this;\n          }\n\n          if (color = /^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*$/.exec(components)) {\n            // rgb(100%,0%,0%)\n            this.r = Math.min(100, parseInt(color[1], 10)) / 100;\n            this.g = Math.min(100, parseInt(color[2], 10)) / 100;\n            this.b = Math.min(100, parseInt(color[3], 10)) / 100;\n            return this;\n          }\n\n          break;\n\n        case 'rgba':\n          if (color = /^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec(components)) {\n            // rgba(255,0,0,0.5)\n            this.r = Math.min(255, parseInt(color[1], 10)) / 255;\n            this.g = Math.min(255, parseInt(color[2], 10)) / 255;\n            this.b = Math.min(255, parseInt(color[3], 10)) / 255;\n            parseAlpha(color[4]);\n            return this;\n          }\n\n          if (color = /^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec(components)) {\n            // rgba(100%,0%,0%,0.5)\n            this.r = Math.min(100, parseInt(color[1], 10)) / 100;\n            this.g = Math.min(100, parseInt(color[2], 10)) / 100;\n            this.b = Math.min(100, parseInt(color[3], 10)) / 100;\n            parseAlpha(color[4]);\n            return this;\n          }\n\n          break;\n\n        case 'hsl':\n          if (color = /^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*$/.exec(components)) {\n            // hsl(120,50%,50%)\n            var h = parseFloat(color[1]);\n            var s = parseInt(color[2], 10) / 100;\n            var l = parseInt(color[3], 10) / 100;\n            return this.setHSL(h, s, l);\n          }\n\n          break;\n\n        case 'hsla':\n          if (color = /^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec(components)) {\n            // hsla(120,50%,50%,0.5)\n            var h = parseFloat(color[1]);\n            var s = parseInt(color[2], 10) / 100;\n            var l = parseInt(color[3], 10) / 100;\n            parseAlpha(color[4]);\n            return this.setHSL(h, s, l);\n          }\n\n          break;\n      }\n    } else if (m = /^\\#([A-Fa-f0-9]+)$/.exec(style)) {\n      // hex color\n      var hex = m[1];\n      var size = hex.length;\n\n      if (size === 3) {\n        // #ff0\n        this.r = parseInt(hex.charAt(0) + hex.charAt(0), 16) / 255;\n        this.g = parseInt(hex.charAt(1) + hex.charAt(1), 16) / 255;\n        this.b = parseInt(hex.charAt(2) + hex.charAt(2), 16) / 255;\n        return this;\n      } else if (size === 6) {\n        // #ff0000\n        this.r = parseInt(hex.charAt(0) + hex.charAt(1), 16) / 255;\n        this.g = parseInt(hex.charAt(2) + hex.charAt(3), 16) / 255;\n        this.b = parseInt(hex.charAt(4) + hex.charAt(5), 16) / 255;\n        return this;\n      }\n    }\n\n    if (style && style.length > 0) {\n      // color keywords\n      var hex = THREE.ColorKeywords[style];\n\n      if (hex !== undefined) {\n        // red\n        this.setHex(hex);\n      } else {\n        // unknown color\n        console.warn('THREE.Color: Unknown color ' + style);\n      }\n    }\n\n    return this;\n  },\n  clone: function () {\n    return new this.constructor(this.r, this.g, this.b);\n  },\n  copy: function (color) {\n    this.r = color.r;\n    this.g = color.g;\n    this.b = color.b;\n    return this;\n  },\n  copyGammaToLinear: function (color, gammaFactor) {\n    if (gammaFactor === undefined) gammaFactor = 2.0;\n    this.r = Math.pow(color.r, gammaFactor);\n    this.g = Math.pow(color.g, gammaFactor);\n    this.b = Math.pow(color.b, gammaFactor);\n    return this;\n  },\n  copyLinearToGamma: function (color, gammaFactor) {\n    if (gammaFactor === undefined) gammaFactor = 2.0;\n    var safeInverse = gammaFactor > 0 ? 1.0 / gammaFactor : 1.0;\n    this.r = Math.pow(color.r, safeInverse);\n    this.g = Math.pow(color.g, safeInverse);\n    this.b = Math.pow(color.b, safeInverse);\n    return this;\n  },\n  convertGammaToLinear: function () {\n    var r = this.r,\n        g = this.g,\n        b = this.b;\n    this.r = r * r;\n    this.g = g * g;\n    this.b = b * b;\n    return this;\n  },\n  convertLinearToGamma: function () {\n    this.r = Math.sqrt(this.r);\n    this.g = Math.sqrt(this.g);\n    this.b = Math.sqrt(this.b);\n    return this;\n  },\n  getHex: function () {\n    return this.r * 255 << 16 ^ this.g * 255 << 8 ^ this.b * 255 << 0;\n  },\n  getHexString: function () {\n    return ('000000' + this.getHex().toString(16)).slice(-6);\n  },\n  getHSL: function (optionalTarget) {\n    // h,s,l ranges are in 0.0 - 1.0\n    var hsl = optionalTarget || {\n      h: 0,\n      s: 0,\n      l: 0\n    };\n    var r = this.r,\n        g = this.g,\n        b = this.b;\n    var max = Math.max(r, g, b);\n    var min = Math.min(r, g, b);\n    var hue, saturation;\n    var lightness = (min + max) / 2.0;\n\n    if (min === max) {\n      hue = 0;\n      saturation = 0;\n    } else {\n      var delta = max - min;\n      saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\n\n      switch (max) {\n        case r:\n          hue = (g - b) / delta + (g < b ? 6 : 0);\n          break;\n\n        case g:\n          hue = (b - r) / delta + 2;\n          break;\n\n        case b:\n          hue = (r - g) / delta + 4;\n          break;\n      }\n\n      hue /= 6;\n    }\n\n    hsl.h = hue;\n    hsl.s = saturation;\n    hsl.l = lightness;\n    return hsl;\n  },\n  getStyle: function () {\n    return 'rgb(' + (this.r * 255 | 0) + ',' + (this.g * 255 | 0) + ',' + (this.b * 255 | 0) + ')';\n  },\n  offsetHSL: function (h, s, l) {\n    var hsl = this.getHSL();\n    hsl.h += h;\n    hsl.s += s;\n    hsl.l += l;\n    this.setHSL(hsl.h, hsl.s, hsl.l);\n    return this;\n  },\n  add: function (color) {\n    this.r += color.r;\n    this.g += color.g;\n    this.b += color.b;\n    return this;\n  },\n  addColors: function (color1, color2) {\n    this.r = color1.r + color2.r;\n    this.g = color1.g + color2.g;\n    this.b = color1.b + color2.b;\n    return this;\n  },\n  addScalar: function (s) {\n    this.r += s;\n    this.g += s;\n    this.b += s;\n    return this;\n  },\n  multiply: function (color) {\n    this.r *= color.r;\n    this.g *= color.g;\n    this.b *= color.b;\n    return this;\n  },\n  multiplyScalar: function (s) {\n    this.r *= s;\n    this.g *= s;\n    this.b *= s;\n    return this;\n  },\n  lerp: function (color, alpha) {\n    this.r += (color.r - this.r) * alpha;\n    this.g += (color.g - this.g) * alpha;\n    this.b += (color.b - this.b) * alpha;\n    return this;\n  },\n  equals: function (c) {\n    return c.r === this.r && c.g === this.g && c.b === this.b;\n  },\n  fromArray: function (array) {\n    this.r = array[0];\n    this.g = array[1];\n    this.b = array[2];\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this.r;\n    array[offset + 1] = this.g;\n    array[offset + 2] = this.b;\n    return array;\n  }\n};\nTHREE.ColorKeywords = {\n  'aliceblue': 0xF0F8FF,\n  'antiquewhite': 0xFAEBD7,\n  'aqua': 0x00FFFF,\n  'aquamarine': 0x7FFFD4,\n  'azure': 0xF0FFFF,\n  'beige': 0xF5F5DC,\n  'bisque': 0xFFE4C4,\n  'black': 0x000000,\n  'blanchedalmond': 0xFFEBCD,\n  'blue': 0x0000FF,\n  'blueviolet': 0x8A2BE2,\n  'brown': 0xA52A2A,\n  'burlywood': 0xDEB887,\n  'cadetblue': 0x5F9EA0,\n  'chartreuse': 0x7FFF00,\n  'chocolate': 0xD2691E,\n  'coral': 0xFF7F50,\n  'cornflowerblue': 0x6495ED,\n  'cornsilk': 0xFFF8DC,\n  'crimson': 0xDC143C,\n  'cyan': 0x00FFFF,\n  'darkblue': 0x00008B,\n  'darkcyan': 0x008B8B,\n  'darkgoldenrod': 0xB8860B,\n  'darkgray': 0xA9A9A9,\n  'darkgreen': 0x006400,\n  'darkgrey': 0xA9A9A9,\n  'darkkhaki': 0xBDB76B,\n  'darkmagenta': 0x8B008B,\n  'darkolivegreen': 0x556B2F,\n  'darkorange': 0xFF8C00,\n  'darkorchid': 0x9932CC,\n  'darkred': 0x8B0000,\n  'darksalmon': 0xE9967A,\n  'darkseagreen': 0x8FBC8F,\n  'darkslateblue': 0x483D8B,\n  'darkslategray': 0x2F4F4F,\n  'darkslategrey': 0x2F4F4F,\n  'darkturquoise': 0x00CED1,\n  'darkviolet': 0x9400D3,\n  'deeppink': 0xFF1493,\n  'deepskyblue': 0x00BFFF,\n  'dimgray': 0x696969,\n  'dimgrey': 0x696969,\n  'dodgerblue': 0x1E90FF,\n  'firebrick': 0xB22222,\n  'floralwhite': 0xFFFAF0,\n  'forestgreen': 0x228B22,\n  'fuchsia': 0xFF00FF,\n  'gainsboro': 0xDCDCDC,\n  'ghostwhite': 0xF8F8FF,\n  'gold': 0xFFD700,\n  'goldenrod': 0xDAA520,\n  'gray': 0x808080,\n  'green': 0x008000,\n  'greenyellow': 0xADFF2F,\n  'grey': 0x808080,\n  'honeydew': 0xF0FFF0,\n  'hotpink': 0xFF69B4,\n  'indianred': 0xCD5C5C,\n  'indigo': 0x4B0082,\n  'ivory': 0xFFFFF0,\n  'khaki': 0xF0E68C,\n  'lavender': 0xE6E6FA,\n  'lavenderblush': 0xFFF0F5,\n  'lawngreen': 0x7CFC00,\n  'lemonchiffon': 0xFFFACD,\n  'lightblue': 0xADD8E6,\n  'lightcoral': 0xF08080,\n  'lightcyan': 0xE0FFFF,\n  'lightgoldenrodyellow': 0xFAFAD2,\n  'lightgray': 0xD3D3D3,\n  'lightgreen': 0x90EE90,\n  'lightgrey': 0xD3D3D3,\n  'lightpink': 0xFFB6C1,\n  'lightsalmon': 0xFFA07A,\n  'lightseagreen': 0x20B2AA,\n  'lightskyblue': 0x87CEFA,\n  'lightslategray': 0x778899,\n  'lightslategrey': 0x778899,\n  'lightsteelblue': 0xB0C4DE,\n  'lightyellow': 0xFFFFE0,\n  'lime': 0x00FF00,\n  'limegreen': 0x32CD32,\n  'linen': 0xFAF0E6,\n  'magenta': 0xFF00FF,\n  'maroon': 0x800000,\n  'mediumaquamarine': 0x66CDAA,\n  'mediumblue': 0x0000CD,\n  'mediumorchid': 0xBA55D3,\n  'mediumpurple': 0x9370DB,\n  'mediumseagreen': 0x3CB371,\n  'mediumslateblue': 0x7B68EE,\n  'mediumspringgreen': 0x00FA9A,\n  'mediumturquoise': 0x48D1CC,\n  'mediumvioletred': 0xC71585,\n  'midnightblue': 0x191970,\n  'mintcream': 0xF5FFFA,\n  'mistyrose': 0xFFE4E1,\n  'moccasin': 0xFFE4B5,\n  'navajowhite': 0xFFDEAD,\n  'navy': 0x000080,\n  'oldlace': 0xFDF5E6,\n  'olive': 0x808000,\n  'olivedrab': 0x6B8E23,\n  'orange': 0xFFA500,\n  'orangered': 0xFF4500,\n  'orchid': 0xDA70D6,\n  'palegoldenrod': 0xEEE8AA,\n  'palegreen': 0x98FB98,\n  'paleturquoise': 0xAFEEEE,\n  'palevioletred': 0xDB7093,\n  'papayawhip': 0xFFEFD5,\n  'peachpuff': 0xFFDAB9,\n  'peru': 0xCD853F,\n  'pink': 0xFFC0CB,\n  'plum': 0xDDA0DD,\n  'powderblue': 0xB0E0E6,\n  'purple': 0x800080,\n  'red': 0xFF0000,\n  'rosybrown': 0xBC8F8F,\n  'royalblue': 0x4169E1,\n  'saddlebrown': 0x8B4513,\n  'salmon': 0xFA8072,\n  'sandybrown': 0xF4A460,\n  'seagreen': 0x2E8B57,\n  'seashell': 0xFFF5EE,\n  'sienna': 0xA0522D,\n  'silver': 0xC0C0C0,\n  'skyblue': 0x87CEEB,\n  'slateblue': 0x6A5ACD,\n  'slategray': 0x708090,\n  'slategrey': 0x708090,\n  'snow': 0xFFFAFA,\n  'springgreen': 0x00FF7F,\n  'steelblue': 0x4682B4,\n  'tan': 0xD2B48C,\n  'teal': 0x008080,\n  'thistle': 0xD8BFD8,\n  'tomato': 0xFF6347,\n  'turquoise': 0x40E0D0,\n  'violet': 0xEE82EE,\n  'wheat': 0xF5DEB3,\n  'white': 0xFFFFFF,\n  'whitesmoke': 0xF5F5F5,\n  'yellow': 0xFFFF00,\n  'yellowgreen': 0x9ACD32\n}; // File:src/math/Quaternion.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Quaternion = function (x, y, z, w) {\n  this._x = x || 0;\n  this._y = y || 0;\n  this._z = z || 0;\n  this._w = w !== undefined ? w : 1;\n};\n\nTHREE.Quaternion.prototype = {\n  constructor: THREE.Quaternion,\n\n  get x() {\n    return this._x;\n  },\n\n  set x(value) {\n    this._x = value;\n    this.onChangeCallback();\n  },\n\n  get y() {\n    return this._y;\n  },\n\n  set y(value) {\n    this._y = value;\n    this.onChangeCallback();\n  },\n\n  get z() {\n    return this._z;\n  },\n\n  set z(value) {\n    this._z = value;\n    this.onChangeCallback();\n  },\n\n  get w() {\n    return this._w;\n  },\n\n  set w(value) {\n    this._w = value;\n    this.onChangeCallback();\n  },\n\n  set: function (x, y, z, w) {\n    this._x = x;\n    this._y = y;\n    this._z = z;\n    this._w = w;\n    this.onChangeCallback();\n    return this;\n  },\n  clone: function () {\n    return new this.constructor(this._x, this._y, this._z, this._w);\n  },\n  copy: function (quaternion) {\n    this._x = quaternion.x;\n    this._y = quaternion.y;\n    this._z = quaternion.z;\n    this._w = quaternion.w;\n    this.onChangeCallback();\n    return this;\n  },\n  setFromEuler: function (euler, update) {\n    if (euler instanceof THREE.Euler === false) {\n      throw new Error('THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\n    } // http://www.mathworks.com/matlabcentral/fileexchange/\n    // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\n    //\tcontent/SpinCalc.m\n\n\n    var c1 = Math.cos(euler._x / 2);\n    var c2 = Math.cos(euler._y / 2);\n    var c3 = Math.cos(euler._z / 2);\n    var s1 = Math.sin(euler._x / 2);\n    var s2 = Math.sin(euler._y / 2);\n    var s3 = Math.sin(euler._z / 2);\n    var order = euler.order;\n\n    if (order === 'XYZ') {\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\n    } else if (order === 'YXZ') {\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\n    } else if (order === 'ZXY') {\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\n    } else if (order === 'ZYX') {\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\n    } else if (order === 'YZX') {\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\n    } else if (order === 'XZY') {\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\n    }\n\n    if (update !== false) this.onChangeCallback();\n    return this;\n  },\n  setFromAxisAngle: function (axis, angle) {\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\n    // assumes axis is normalized\n    var halfAngle = angle / 2,\n        s = Math.sin(halfAngle);\n    this._x = axis.x * s;\n    this._y = axis.y * s;\n    this._z = axis.z * s;\n    this._w = Math.cos(halfAngle);\n    this.onChangeCallback();\n    return this;\n  },\n  setFromRotationMatrix: function (m) {\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n    var te = m.elements,\n        m11 = te[0],\n        m12 = te[4],\n        m13 = te[8],\n        m21 = te[1],\n        m22 = te[5],\n        m23 = te[9],\n        m31 = te[2],\n        m32 = te[6],\n        m33 = te[10],\n        trace = m11 + m22 + m33,\n        s;\n\n    if (trace > 0) {\n      s = 0.5 / Math.sqrt(trace + 1.0);\n      this._w = 0.25 / s;\n      this._x = (m32 - m23) * s;\n      this._y = (m13 - m31) * s;\n      this._z = (m21 - m12) * s;\n    } else if (m11 > m22 && m11 > m33) {\n      s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\n      this._w = (m32 - m23) / s;\n      this._x = 0.25 * s;\n      this._y = (m12 + m21) / s;\n      this._z = (m13 + m31) / s;\n    } else if (m22 > m33) {\n      s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\n      this._w = (m13 - m31) / s;\n      this._x = (m12 + m21) / s;\n      this._y = 0.25 * s;\n      this._z = (m23 + m32) / s;\n    } else {\n      s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\n      this._w = (m21 - m12) / s;\n      this._x = (m13 + m31) / s;\n      this._y = (m23 + m32) / s;\n      this._z = 0.25 * s;\n    }\n\n    this.onChangeCallback();\n    return this;\n  },\n  setFromUnitVectors: function () {\n    // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\n    // assumes direction vectors vFrom and vTo are normalized\n    var v1, r;\n    var EPS = 0.000001;\n    return function (vFrom, vTo) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      r = vFrom.dot(vTo) + 1;\n\n      if (r < EPS) {\n        r = 0;\n\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\n          v1.set(-vFrom.y, vFrom.x, 0);\n        } else {\n          v1.set(0, -vFrom.z, vFrom.y);\n        }\n      } else {\n        v1.crossVectors(vFrom, vTo);\n      }\n\n      this._x = v1.x;\n      this._y = v1.y;\n      this._z = v1.z;\n      this._w = r;\n      this.normalize();\n      return this;\n    };\n  }(),\n  inverse: function () {\n    this.conjugate().normalize();\n    return this;\n  },\n  conjugate: function () {\n    this._x *= -1;\n    this._y *= -1;\n    this._z *= -1;\n    this.onChangeCallback();\n    return this;\n  },\n  dot: function (v) {\n    return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\n  },\n  lengthSq: function () {\n    return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\n  },\n  length: function () {\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\n  },\n  normalize: function () {\n    var l = this.length();\n\n    if (l === 0) {\n      this._x = 0;\n      this._y = 0;\n      this._z = 0;\n      this._w = 1;\n    } else {\n      l = 1 / l;\n      this._x = this._x * l;\n      this._y = this._y * l;\n      this._z = this._z * l;\n      this._w = this._w * l;\n    }\n\n    this.onChangeCallback();\n    return this;\n  },\n  multiply: function (q, p) {\n    if (p !== undefined) {\n      console.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\n      return this.multiplyQuaternions(q, p);\n    }\n\n    return this.multiplyQuaternions(this, q);\n  },\n  multiplyQuaternions: function (a, b) {\n    // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\n    var qax = a._x,\n        qay = a._y,\n        qaz = a._z,\n        qaw = a._w;\n    var qbx = b._x,\n        qby = b._y,\n        qbz = b._z,\n        qbw = b._w;\n    this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\n    this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\n    this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\n    this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\n    this.onChangeCallback();\n    return this;\n  },\n  multiplyVector3: function (vector) {\n    console.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');\n    return vector.applyQuaternion(this);\n  },\n  slerp: function (qb, t) {\n    if (t === 0) return this;\n    if (t === 1) return this.copy(qb);\n    var x = this._x,\n        y = this._y,\n        z = this._z,\n        w = this._w; // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\n\n    var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\n\n    if (cosHalfTheta < 0) {\n      this._w = -qb._w;\n      this._x = -qb._x;\n      this._y = -qb._y;\n      this._z = -qb._z;\n      cosHalfTheta = -cosHalfTheta;\n    } else {\n      this.copy(qb);\n    }\n\n    if (cosHalfTheta >= 1.0) {\n      this._w = w;\n      this._x = x;\n      this._y = y;\n      this._z = z;\n      return this;\n    }\n\n    var halfTheta = Math.acos(cosHalfTheta);\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\n\n    if (Math.abs(sinHalfTheta) < 0.001) {\n      this._w = 0.5 * (w + this._w);\n      this._x = 0.5 * (x + this._x);\n      this._y = 0.5 * (y + this._y);\n      this._z = 0.5 * (z + this._z);\n      return this;\n    }\n\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\n        ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\n    this._w = w * ratioA + this._w * ratioB;\n    this._x = x * ratioA + this._x * ratioB;\n    this._y = y * ratioA + this._y * ratioB;\n    this._z = z * ratioA + this._z * ratioB;\n    this.onChangeCallback();\n    return this;\n  },\n  equals: function (quaternion) {\n    return quaternion._x === this._x && quaternion._y === this._y && quaternion._z === this._z && quaternion._w === this._w;\n  },\n  fromArray: function (array, offset) {\n    if (offset === undefined) offset = 0;\n    this._x = array[offset];\n    this._y = array[offset + 1];\n    this._z = array[offset + 2];\n    this._w = array[offset + 3];\n    this.onChangeCallback();\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this._x;\n    array[offset + 1] = this._y;\n    array[offset + 2] = this._z;\n    array[offset + 3] = this._w;\n    return array;\n  },\n  onChange: function (callback) {\n    this.onChangeCallback = callback;\n    return this;\n  },\n  onChangeCallback: function () {}\n};\n\nTHREE.Quaternion.slerp = function (qa, qb, qm, t) {\n  return qm.copy(qa).slerp(qb, t);\n}; // File:src/math/Vector2.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\n\n\nTHREE.Vector2 = function (x, y) {\n  this.x = x || 0;\n  this.y = y || 0;\n};\n\nTHREE.Vector2.prototype = {\n  constructor: THREE.Vector2,\n  set: function (x, y) {\n    this.x = x;\n    this.y = y;\n    return this;\n  },\n  setX: function (x) {\n    this.x = x;\n    return this;\n  },\n  setY: function (y) {\n    this.y = y;\n    return this;\n  },\n  setComponent: function (index, value) {\n    switch (index) {\n      case 0:\n        this.x = value;\n        break;\n\n      case 1:\n        this.y = value;\n        break;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  getComponent: function (index) {\n    switch (index) {\n      case 0:\n        return this.x;\n\n      case 1:\n        return this.y;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  clone: function () {\n    return new this.constructor(this.x, this.y);\n  },\n  copy: function (v) {\n    this.x = v.x;\n    this.y = v.y;\n    return this;\n  },\n  add: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\n      return this.addVectors(v, w);\n    }\n\n    this.x += v.x;\n    this.y += v.y;\n    return this;\n  },\n  addScalar: function (s) {\n    this.x += s;\n    this.y += s;\n    return this;\n  },\n  addVectors: function (a, b) {\n    this.x = a.x + b.x;\n    this.y = a.y + b.y;\n    return this;\n  },\n  addScaledVector: function (v, s) {\n    this.x += v.x * s;\n    this.y += v.y * s;\n    return this;\n  },\n  sub: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\n      return this.subVectors(v, w);\n    }\n\n    this.x -= v.x;\n    this.y -= v.y;\n    return this;\n  },\n  subScalar: function (s) {\n    this.x -= s;\n    this.y -= s;\n    return this;\n  },\n  subVectors: function (a, b) {\n    this.x = a.x - b.x;\n    this.y = a.y - b.y;\n    return this;\n  },\n  multiply: function (v) {\n    this.x *= v.x;\n    this.y *= v.y;\n    return this;\n  },\n  multiplyScalar: function (s) {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  },\n  divide: function (v) {\n    this.x /= v.x;\n    this.y /= v.y;\n    return this;\n  },\n  divideScalar: function (scalar) {\n    if (scalar !== 0) {\n      var invScalar = 1 / scalar;\n      this.x *= invScalar;\n      this.y *= invScalar;\n    } else {\n      this.x = 0;\n      this.y = 0;\n    }\n\n    return this;\n  },\n  min: function (v) {\n    if (this.x > v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y > v.y) {\n      this.y = v.y;\n    }\n\n    return this;\n  },\n  max: function (v) {\n    if (this.x < v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y < v.y) {\n      this.y = v.y;\n    }\n\n    return this;\n  },\n  clamp: function (min, max) {\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\n    if (this.x < min.x) {\n      this.x = min.x;\n    } else if (this.x > max.x) {\n      this.x = max.x;\n    }\n\n    if (this.y < min.y) {\n      this.y = min.y;\n    } else if (this.y > max.y) {\n      this.y = max.y;\n    }\n\n    return this;\n  },\n  clampScalar: function () {\n    var min, max;\n    return function clampScalar(minVal, maxVal) {\n      if (min === undefined) {\n        min = new THREE.Vector2();\n        max = new THREE.Vector2();\n      }\n\n      min.set(minVal, minVal);\n      max.set(maxVal, maxVal);\n      return this.clamp(min, max);\n    };\n  }(),\n  floor: function () {\n    this.x = Math.floor(this.x);\n    this.y = Math.floor(this.y);\n    return this;\n  },\n  ceil: function () {\n    this.x = Math.ceil(this.x);\n    this.y = Math.ceil(this.y);\n    return this;\n  },\n  round: function () {\n    this.x = Math.round(this.x);\n    this.y = Math.round(this.y);\n    return this;\n  },\n  roundToZero: function () {\n    this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x);\n    this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y);\n    return this;\n  },\n  negate: function () {\n    this.x = -this.x;\n    this.y = -this.y;\n    return this;\n  },\n  dot: function (v) {\n    return this.x * v.x + this.y * v.y;\n  },\n  lengthSq: function () {\n    return this.x * this.x + this.y * this.y;\n  },\n  length: function () {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  },\n  lengthManhattan: function () {\n    return Math.abs(this.x) + Math.abs(this.y);\n  },\n  normalize: function () {\n    return this.divideScalar(this.length());\n  },\n  distanceTo: function (v) {\n    return Math.sqrt(this.distanceToSquared(v));\n  },\n  distanceToSquared: function (v) {\n    var dx = this.x - v.x,\n        dy = this.y - v.y;\n    return dx * dx + dy * dy;\n  },\n  setLength: function (l) {\n    var oldLength = this.length();\n\n    if (oldLength !== 0 && l !== oldLength) {\n      this.multiplyScalar(l / oldLength);\n    }\n\n    return this;\n  },\n  lerp: function (v, alpha) {\n    this.x += (v.x - this.x) * alpha;\n    this.y += (v.y - this.y) * alpha;\n    return this;\n  },\n  lerpVectors: function (v1, v2, alpha) {\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\n    return this;\n  },\n  equals: function (v) {\n    return v.x === this.x && v.y === this.y;\n  },\n  fromArray: function (array, offset) {\n    if (offset === undefined) offset = 0;\n    this.x = array[offset];\n    this.y = array[offset + 1];\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this.x;\n    array[offset + 1] = this.y;\n    return array;\n  },\n  fromAttribute: function (attribute, index, offset) {\n    if (offset === undefined) offset = 0;\n    index = index * attribute.itemSize + offset;\n    this.x = attribute.array[index];\n    this.y = attribute.array[index + 1];\n    return this;\n  }\n}; // File:src/math/Vector3.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\nTHREE.Vector3 = function (x, y, z) {\n  this.x = x || 0;\n  this.y = y || 0;\n  this.z = z || 0;\n};\n\nTHREE.Vector3.prototype = {\n  constructor: THREE.Vector3,\n  set: function (x, y, z) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    return this;\n  },\n  setX: function (x) {\n    this.x = x;\n    return this;\n  },\n  setY: function (y) {\n    this.y = y;\n    return this;\n  },\n  setZ: function (z) {\n    this.z = z;\n    return this;\n  },\n  setComponent: function (index, value) {\n    switch (index) {\n      case 0:\n        this.x = value;\n        break;\n\n      case 1:\n        this.y = value;\n        break;\n\n      case 2:\n        this.z = value;\n        break;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  getComponent: function (index) {\n    switch (index) {\n      case 0:\n        return this.x;\n\n      case 1:\n        return this.y;\n\n      case 2:\n        return this.z;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  clone: function () {\n    return new this.constructor(this.x, this.y, this.z);\n  },\n  copy: function (v) {\n    this.x = v.x;\n    this.y = v.y;\n    this.z = v.z;\n    return this;\n  },\n  add: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\n      return this.addVectors(v, w);\n    }\n\n    this.x += v.x;\n    this.y += v.y;\n    this.z += v.z;\n    return this;\n  },\n  addScalar: function (s) {\n    this.x += s;\n    this.y += s;\n    this.z += s;\n    return this;\n  },\n  addVectors: function (a, b) {\n    this.x = a.x + b.x;\n    this.y = a.y + b.y;\n    this.z = a.z + b.z;\n    return this;\n  },\n  addScaledVector: function (v, s) {\n    this.x += v.x * s;\n    this.y += v.y * s;\n    this.z += v.z * s;\n    return this;\n  },\n  sub: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\n      return this.subVectors(v, w);\n    }\n\n    this.x -= v.x;\n    this.y -= v.y;\n    this.z -= v.z;\n    return this;\n  },\n  subScalar: function (s) {\n    this.x -= s;\n    this.y -= s;\n    this.z -= s;\n    return this;\n  },\n  subVectors: function (a, b) {\n    this.x = a.x - b.x;\n    this.y = a.y - b.y;\n    this.z = a.z - b.z;\n    return this;\n  },\n  multiply: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\n      return this.multiplyVectors(v, w);\n    }\n\n    this.x *= v.x;\n    this.y *= v.y;\n    this.z *= v.z;\n    return this;\n  },\n  multiplyScalar: function (scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n    this.z *= scalar;\n    return this;\n  },\n  multiplyVectors: function (a, b) {\n    this.x = a.x * b.x;\n    this.y = a.y * b.y;\n    this.z = a.z * b.z;\n    return this;\n  },\n  applyEuler: function () {\n    var quaternion;\n    return function applyEuler(euler) {\n      if (euler instanceof THREE.Euler === false) {\n        console.error('THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.');\n      }\n\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\n      this.applyQuaternion(quaternion.setFromEuler(euler));\n      return this;\n    };\n  }(),\n  applyAxisAngle: function () {\n    var quaternion;\n    return function applyAxisAngle(axis, angle) {\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\n      this.applyQuaternion(quaternion.setFromAxisAngle(axis, angle));\n      return this;\n    };\n  }(),\n  applyMatrix3: function (m) {\n    var x = this.x;\n    var y = this.y;\n    var z = this.z;\n    var e = m.elements;\n    this.x = e[0] * x + e[3] * y + e[6] * z;\n    this.y = e[1] * x + e[4] * y + e[7] * z;\n    this.z = e[2] * x + e[5] * y + e[8] * z;\n    return this;\n  },\n  applyMatrix4: function (m) {\n    // input: THREE.Matrix4 affine matrix\n    var x = this.x,\n        y = this.y,\n        z = this.z;\n    var e = m.elements;\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12];\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13];\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\n    return this;\n  },\n  applyProjection: function (m) {\n    // input: THREE.Matrix4 projection matrix\n    var x = this.x,\n        y = this.y,\n        z = this.z;\n    var e = m.elements;\n    var d = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]); // perspective divide\n\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * d;\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * d;\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * d;\n    return this;\n  },\n  applyQuaternion: function (q) {\n    var x = this.x;\n    var y = this.y;\n    var z = this.z;\n    var qx = q.x;\n    var qy = q.y;\n    var qz = q.z;\n    var qw = q.w; // calculate quat * vector\n\n    var ix = qw * x + qy * z - qz * y;\n    var iy = qw * y + qz * x - qx * z;\n    var iz = qw * z + qx * y - qy * x;\n    var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n    return this;\n  },\n  project: function () {\n    var matrix;\n    return function project(camera) {\n      if (matrix === undefined) matrix = new THREE.Matrix4();\n      matrix.multiplyMatrices(camera.projectionMatrix, matrix.getInverse(camera.matrixWorld));\n      return this.applyProjection(matrix);\n    };\n  }(),\n  unproject: function () {\n    var matrix;\n    return function unproject(camera) {\n      if (matrix === undefined) matrix = new THREE.Matrix4();\n      matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\n      return this.applyProjection(matrix);\n    };\n  }(),\n  transformDirection: function (m) {\n    // input: THREE.Matrix4 affine matrix\n    // vector interpreted as a direction\n    var x = this.x,\n        y = this.y,\n        z = this.z;\n    var e = m.elements;\n    this.x = e[0] * x + e[4] * y + e[8] * z;\n    this.y = e[1] * x + e[5] * y + e[9] * z;\n    this.z = e[2] * x + e[6] * y + e[10] * z;\n    this.normalize();\n    return this;\n  },\n  divide: function (v) {\n    this.x /= v.x;\n    this.y /= v.y;\n    this.z /= v.z;\n    return this;\n  },\n  divideScalar: function (scalar) {\n    if (scalar !== 0) {\n      var invScalar = 1 / scalar;\n      this.x *= invScalar;\n      this.y *= invScalar;\n      this.z *= invScalar;\n    } else {\n      this.x = 0;\n      this.y = 0;\n      this.z = 0;\n    }\n\n    return this;\n  },\n  min: function (v) {\n    if (this.x > v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y > v.y) {\n      this.y = v.y;\n    }\n\n    if (this.z > v.z) {\n      this.z = v.z;\n    }\n\n    return this;\n  },\n  max: function (v) {\n    if (this.x < v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y < v.y) {\n      this.y = v.y;\n    }\n\n    if (this.z < v.z) {\n      this.z = v.z;\n    }\n\n    return this;\n  },\n  clamp: function (min, max) {\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\n    if (this.x < min.x) {\n      this.x = min.x;\n    } else if (this.x > max.x) {\n      this.x = max.x;\n    }\n\n    if (this.y < min.y) {\n      this.y = min.y;\n    } else if (this.y > max.y) {\n      this.y = max.y;\n    }\n\n    if (this.z < min.z) {\n      this.z = min.z;\n    } else if (this.z > max.z) {\n      this.z = max.z;\n    }\n\n    return this;\n  },\n  clampScalar: function () {\n    var min, max;\n    return function clampScalar(minVal, maxVal) {\n      if (min === undefined) {\n        min = new THREE.Vector3();\n        max = new THREE.Vector3();\n      }\n\n      min.set(minVal, minVal, minVal);\n      max.set(maxVal, maxVal, maxVal);\n      return this.clamp(min, max);\n    };\n  }(),\n  floor: function () {\n    this.x = Math.floor(this.x);\n    this.y = Math.floor(this.y);\n    this.z = Math.floor(this.z);\n    return this;\n  },\n  ceil: function () {\n    this.x = Math.ceil(this.x);\n    this.y = Math.ceil(this.y);\n    this.z = Math.ceil(this.z);\n    return this;\n  },\n  round: function () {\n    this.x = Math.round(this.x);\n    this.y = Math.round(this.y);\n    this.z = Math.round(this.z);\n    return this;\n  },\n  roundToZero: function () {\n    this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x);\n    this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y);\n    this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z);\n    return this;\n  },\n  negate: function () {\n    this.x = -this.x;\n    this.y = -this.y;\n    this.z = -this.z;\n    return this;\n  },\n  dot: function (v) {\n    return this.x * v.x + this.y * v.y + this.z * v.z;\n  },\n  lengthSq: function () {\n    return this.x * this.x + this.y * this.y + this.z * this.z;\n  },\n  length: function () {\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n  },\n  lengthManhattan: function () {\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\n  },\n  normalize: function () {\n    return this.divideScalar(this.length());\n  },\n  setLength: function (l) {\n    var oldLength = this.length();\n\n    if (oldLength !== 0 && l !== oldLength) {\n      this.multiplyScalar(l / oldLength);\n    }\n\n    return this;\n  },\n  lerp: function (v, alpha) {\n    this.x += (v.x - this.x) * alpha;\n    this.y += (v.y - this.y) * alpha;\n    this.z += (v.z - this.z) * alpha;\n    return this;\n  },\n  lerpVectors: function (v1, v2, alpha) {\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\n    return this;\n  },\n  cross: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\n      return this.crossVectors(v, w);\n    }\n\n    var x = this.x,\n        y = this.y,\n        z = this.z;\n    this.x = y * v.z - z * v.y;\n    this.y = z * v.x - x * v.z;\n    this.z = x * v.y - y * v.x;\n    return this;\n  },\n  crossVectors: function (a, b) {\n    var ax = a.x,\n        ay = a.y,\n        az = a.z;\n    var bx = b.x,\n        by = b.y,\n        bz = b.z;\n    this.x = ay * bz - az * by;\n    this.y = az * bx - ax * bz;\n    this.z = ax * by - ay * bx;\n    return this;\n  },\n  projectOnVector: function () {\n    var v1, dot;\n    return function projectOnVector(vector) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      v1.copy(vector).normalize();\n      dot = this.dot(v1);\n      return this.copy(v1).multiplyScalar(dot);\n    };\n  }(),\n  projectOnPlane: function () {\n    var v1;\n    return function projectOnPlane(planeNormal) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      v1.copy(this).projectOnVector(planeNormal);\n      return this.sub(v1);\n    };\n  }(),\n  reflect: function () {\n    // reflect incident vector off plane orthogonal to normal\n    // normal is assumed to have unit length\n    var v1;\n    return function reflect(normal) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      return this.sub(v1.copy(normal).multiplyScalar(2 * this.dot(normal)));\n    };\n  }(),\n  angleTo: function (v) {\n    var theta = this.dot(v) / (this.length() * v.length()); // clamp, to handle numerical problems\n\n    return Math.acos(THREE.Math.clamp(theta, -1, 1));\n  },\n  distanceTo: function (v) {\n    return Math.sqrt(this.distanceToSquared(v));\n  },\n  distanceToSquared: function (v) {\n    var dx = this.x - v.x;\n    var dy = this.y - v.y;\n    var dz = this.z - v.z;\n    return dx * dx + dy * dy + dz * dz;\n  },\n  setEulerFromRotationMatrix: function (m, order) {\n    console.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');\n  },\n  setEulerFromQuaternion: function (q, order) {\n    console.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');\n  },\n  getPositionFromMatrix: function (m) {\n    console.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');\n    return this.setFromMatrixPosition(m);\n  },\n  getScaleFromMatrix: function (m) {\n    console.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');\n    return this.setFromMatrixScale(m);\n  },\n  getColumnFromMatrix: function (index, matrix) {\n    console.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');\n    return this.setFromMatrixColumn(index, matrix);\n  },\n  setFromMatrixPosition: function (m) {\n    this.x = m.elements[12];\n    this.y = m.elements[13];\n    this.z = m.elements[14];\n    return this;\n  },\n  setFromMatrixScale: function (m) {\n    var sx = this.set(m.elements[0], m.elements[1], m.elements[2]).length();\n    var sy = this.set(m.elements[4], m.elements[5], m.elements[6]).length();\n    var sz = this.set(m.elements[8], m.elements[9], m.elements[10]).length();\n    this.x = sx;\n    this.y = sy;\n    this.z = sz;\n    return this;\n  },\n  setFromMatrixColumn: function (index, matrix) {\n    var offset = index * 4;\n    var me = matrix.elements;\n    this.x = me[offset];\n    this.y = me[offset + 1];\n    this.z = me[offset + 2];\n    return this;\n  },\n  equals: function (v) {\n    return v.x === this.x && v.y === this.y && v.z === this.z;\n  },\n  fromArray: function (array, offset) {\n    if (offset === undefined) offset = 0;\n    this.x = array[offset];\n    this.y = array[offset + 1];\n    this.z = array[offset + 2];\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this.x;\n    array[offset + 1] = this.y;\n    array[offset + 2] = this.z;\n    return array;\n  },\n  fromAttribute: function (attribute, index, offset) {\n    if (offset === undefined) offset = 0;\n    index = index * attribute.itemSize + offset;\n    this.x = attribute.array[index];\n    this.y = attribute.array[index + 1];\n    this.z = attribute.array[index + 2];\n    return this;\n  }\n}; // File:src/math/Vector4.js\n\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\nTHREE.Vector4 = function (x, y, z, w) {\n  this.x = x || 0;\n  this.y = y || 0;\n  this.z = z || 0;\n  this.w = w !== undefined ? w : 1;\n};\n\nTHREE.Vector4.prototype = {\n  constructor: THREE.Vector4,\n  set: function (x, y, z, w) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.w = w;\n    return this;\n  },\n  setX: function (x) {\n    this.x = x;\n    return this;\n  },\n  setY: function (y) {\n    this.y = y;\n    return this;\n  },\n  setZ: function (z) {\n    this.z = z;\n    return this;\n  },\n  setW: function (w) {\n    this.w = w;\n    return this;\n  },\n  setComponent: function (index, value) {\n    switch (index) {\n      case 0:\n        this.x = value;\n        break;\n\n      case 1:\n        this.y = value;\n        break;\n\n      case 2:\n        this.z = value;\n        break;\n\n      case 3:\n        this.w = value;\n        break;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  getComponent: function (index) {\n    switch (index) {\n      case 0:\n        return this.x;\n\n      case 1:\n        return this.y;\n\n      case 2:\n        return this.z;\n\n      case 3:\n        return this.w;\n\n      default:\n        throw new Error('index is out of range: ' + index);\n    }\n  },\n  clone: function () {\n    return new this.constructor(this.x, this.y, this.z, this.w);\n  },\n  copy: function (v) {\n    this.x = v.x;\n    this.y = v.y;\n    this.z = v.z;\n    this.w = v.w !== undefined ? v.w : 1;\n    return this;\n  },\n  add: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\n      return this.addVectors(v, w);\n    }\n\n    this.x += v.x;\n    this.y += v.y;\n    this.z += v.z;\n    this.w += v.w;\n    return this;\n  },\n  addScalar: function (s) {\n    this.x += s;\n    this.y += s;\n    this.z += s;\n    this.w += s;\n    return this;\n  },\n  addVectors: function (a, b) {\n    this.x = a.x + b.x;\n    this.y = a.y + b.y;\n    this.z = a.z + b.z;\n    this.w = a.w + b.w;\n    return this;\n  },\n  addScaledVector: function (v, s) {\n    this.x += v.x * s;\n    this.y += v.y * s;\n    this.z += v.z * s;\n    this.w += v.w * s;\n    return this;\n  },\n  sub: function (v, w) {\n    if (w !== undefined) {\n      console.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\n      return this.subVectors(v, w);\n    }\n\n    this.x -= v.x;\n    this.y -= v.y;\n    this.z -= v.z;\n    this.w -= v.w;\n    return this;\n  },\n  subScalar: function (s) {\n    this.x -= s;\n    this.y -= s;\n    this.z -= s;\n    this.w -= s;\n    return this;\n  },\n  subVectors: function (a, b) {\n    this.x = a.x - b.x;\n    this.y = a.y - b.y;\n    this.z = a.z - b.z;\n    this.w = a.w - b.w;\n    return this;\n  },\n  multiplyScalar: function (scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n    this.z *= scalar;\n    this.w *= scalar;\n    return this;\n  },\n  applyMatrix4: function (m) {\n    var x = this.x;\n    var y = this.y;\n    var z = this.z;\n    var w = this.w;\n    var e = m.elements;\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12] * w;\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13] * w;\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14] * w;\n    this.w = e[3] * x + e[7] * y + e[11] * z + e[15] * w;\n    return this;\n  },\n  divideScalar: function (scalar) {\n    if (scalar !== 0) {\n      var invScalar = 1 / scalar;\n      this.x *= invScalar;\n      this.y *= invScalar;\n      this.z *= invScalar;\n      this.w *= invScalar;\n    } else {\n      this.x = 0;\n      this.y = 0;\n      this.z = 0;\n      this.w = 1;\n    }\n\n    return this;\n  },\n  setAxisAngleFromQuaternion: function (q) {\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n    // q is assumed to be normalized\n    this.w = 2 * Math.acos(q.w);\n    var s = Math.sqrt(1 - q.w * q.w);\n\n    if (s < 0.0001) {\n      this.x = 1;\n      this.y = 0;\n      this.z = 0;\n    } else {\n      this.x = q.x / s;\n      this.y = q.y / s;\n      this.z = q.z / s;\n    }\n\n    return this;\n  },\n  setAxisAngleFromRotationMatrix: function (m) {\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n    var angle,\n        x,\n        y,\n        z,\n        // variables for result\n    epsilon = 0.01,\n        // margin to allow for rounding errors\n    epsilon2 = 0.1,\n        // margin to distinguish between 0 and 180 degrees\n    te = m.elements,\n        m11 = te[0],\n        m12 = te[4],\n        m13 = te[8],\n        m21 = te[1],\n        m22 = te[5],\n        m23 = te[9],\n        m31 = te[2],\n        m32 = te[6],\n        m33 = te[10];\n\n    if (Math.abs(m12 - m21) < epsilon && Math.abs(m13 - m31) < epsilon && Math.abs(m23 - m32) < epsilon) {\n      // singularity found\n      // first check for identity matrix which must have +1 for all terms\n      // in leading diagonal and zero in other terms\n      if (Math.abs(m12 + m21) < epsilon2 && Math.abs(m13 + m31) < epsilon2 && Math.abs(m23 + m32) < epsilon2 && Math.abs(m11 + m22 + m33 - 3) < epsilon2) {\n        // this singularity is identity matrix so angle = 0\n        this.set(1, 0, 0, 0);\n        return this; // zero angle, arbitrary axis\n      } // otherwise this singularity is angle = 180\n\n\n      angle = Math.PI;\n      var xx = (m11 + 1) / 2;\n      var yy = (m22 + 1) / 2;\n      var zz = (m33 + 1) / 2;\n      var xy = (m12 + m21) / 4;\n      var xz = (m13 + m31) / 4;\n      var yz = (m23 + m32) / 4;\n\n      if (xx > yy && xx > zz) {\n        // m11 is the largest diagonal term\n        if (xx < epsilon) {\n          x = 0;\n          y = 0.707106781;\n          z = 0.707106781;\n        } else {\n          x = Math.sqrt(xx);\n          y = xy / x;\n          z = xz / x;\n        }\n      } else if (yy > zz) {\n        // m22 is the largest diagonal term\n        if (yy < epsilon) {\n          x = 0.707106781;\n          y = 0;\n          z = 0.707106781;\n        } else {\n          y = Math.sqrt(yy);\n          x = xy / y;\n          z = yz / y;\n        }\n      } else {\n        // m33 is the largest diagonal term so base result on this\n        if (zz < epsilon) {\n          x = 0.707106781;\n          y = 0.707106781;\n          z = 0;\n        } else {\n          z = Math.sqrt(zz);\n          x = xz / z;\n          y = yz / z;\n        }\n      }\n\n      this.set(x, y, z, angle);\n      return this; // return 180 deg rotation\n    } // as we have reached here there are no singularities so we can handle normally\n\n\n    var s = Math.sqrt((m32 - m23) * (m32 - m23) + (m13 - m31) * (m13 - m31) + (m21 - m12) * (m21 - m12)); // used to normalize\n\n    if (Math.abs(s) < 0.001) s = 1; // prevent divide by zero, should not happen if matrix is orthogonal and should be\n    // caught by singularity test above, but I've left it in just in case\n\n    this.x = (m32 - m23) / s;\n    this.y = (m13 - m31) / s;\n    this.z = (m21 - m12) / s;\n    this.w = Math.acos((m11 + m22 + m33 - 1) / 2);\n    return this;\n  },\n  min: function (v) {\n    if (this.x > v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y > v.y) {\n      this.y = v.y;\n    }\n\n    if (this.z > v.z) {\n      this.z = v.z;\n    }\n\n    if (this.w > v.w) {\n      this.w = v.w;\n    }\n\n    return this;\n  },\n  max: function (v) {\n    if (this.x < v.x) {\n      this.x = v.x;\n    }\n\n    if (this.y < v.y) {\n      this.y = v.y;\n    }\n\n    if (this.z < v.z) {\n      this.z = v.z;\n    }\n\n    if (this.w < v.w) {\n      this.w = v.w;\n    }\n\n    return this;\n  },\n  clamp: function (min, max) {\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\n    if (this.x < min.x) {\n      this.x = min.x;\n    } else if (this.x > max.x) {\n      this.x = max.x;\n    }\n\n    if (this.y < min.y) {\n      this.y = min.y;\n    } else if (this.y > max.y) {\n      this.y = max.y;\n    }\n\n    if (this.z < min.z) {\n      this.z = min.z;\n    } else if (this.z > max.z) {\n      this.z = max.z;\n    }\n\n    if (this.w < min.w) {\n      this.w = min.w;\n    } else if (this.w > max.w) {\n      this.w = max.w;\n    }\n\n    return this;\n  },\n  clampScalar: function () {\n    var min, max;\n    return function clampScalar(minVal, maxVal) {\n      if (min === undefined) {\n        min = new THREE.Vector4();\n        max = new THREE.Vector4();\n      }\n\n      min.set(minVal, minVal, minVal, minVal);\n      max.set(maxVal, maxVal, maxVal, maxVal);\n      return this.clamp(min, max);\n    };\n  }(),\n  floor: function () {\n    this.x = Math.floor(this.x);\n    this.y = Math.floor(this.y);\n    this.z = Math.floor(this.z);\n    this.w = Math.floor(this.w);\n    return this;\n  },\n  ceil: function () {\n    this.x = Math.ceil(this.x);\n    this.y = Math.ceil(this.y);\n    this.z = Math.ceil(this.z);\n    this.w = Math.ceil(this.w);\n    return this;\n  },\n  round: function () {\n    this.x = Math.round(this.x);\n    this.y = Math.round(this.y);\n    this.z = Math.round(this.z);\n    this.w = Math.round(this.w);\n    return this;\n  },\n  roundToZero: function () {\n    this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x);\n    this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y);\n    this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z);\n    this.w = this.w < 0 ? Math.ceil(this.w) : Math.floor(this.w);\n    return this;\n  },\n  negate: function () {\n    this.x = -this.x;\n    this.y = -this.y;\n    this.z = -this.z;\n    this.w = -this.w;\n    return this;\n  },\n  dot: function (v) {\n    return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\n  },\n  lengthSq: function () {\n    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n  },\n  length: function () {\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\n  },\n  lengthManhattan: function () {\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);\n  },\n  normalize: function () {\n    return this.divideScalar(this.length());\n  },\n  setLength: function (l) {\n    var oldLength = this.length();\n\n    if (oldLength !== 0 && l !== oldLength) {\n      this.multiplyScalar(l / oldLength);\n    }\n\n    return this;\n  },\n  lerp: function (v, alpha) {\n    this.x += (v.x - this.x) * alpha;\n    this.y += (v.y - this.y) * alpha;\n    this.z += (v.z - this.z) * alpha;\n    this.w += (v.w - this.w) * alpha;\n    return this;\n  },\n  lerpVectors: function (v1, v2, alpha) {\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\n    return this;\n  },\n  equals: function (v) {\n    return v.x === this.x && v.y === this.y && v.z === this.z && v.w === this.w;\n  },\n  fromArray: function (array, offset) {\n    if (offset === undefined) offset = 0;\n    this.x = array[offset];\n    this.y = array[offset + 1];\n    this.z = array[offset + 2];\n    this.w = array[offset + 3];\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this.x;\n    array[offset + 1] = this.y;\n    array[offset + 2] = this.z;\n    array[offset + 3] = this.w;\n    return array;\n  },\n  fromAttribute: function (attribute, index, offset) {\n    if (offset === undefined) offset = 0;\n    index = index * attribute.itemSize + offset;\n    this.x = attribute.array[index];\n    this.y = attribute.array[index + 1];\n    this.z = attribute.array[index + 2];\n    this.w = attribute.array[index + 3];\n    return this;\n  }\n}; // File:src/math/Euler.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Euler = function (x, y, z, order) {\n  this._x = x || 0;\n  this._y = y || 0;\n  this._z = z || 0;\n  this._order = order || THREE.Euler.DefaultOrder;\n};\n\nTHREE.Euler.RotationOrders = ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX'];\nTHREE.Euler.DefaultOrder = 'XYZ';\nTHREE.Euler.prototype = {\n  constructor: THREE.Euler,\n\n  get x() {\n    return this._x;\n  },\n\n  set x(value) {\n    this._x = value;\n    this.onChangeCallback();\n  },\n\n  get y() {\n    return this._y;\n  },\n\n  set y(value) {\n    this._y = value;\n    this.onChangeCallback();\n  },\n\n  get z() {\n    return this._z;\n  },\n\n  set z(value) {\n    this._z = value;\n    this.onChangeCallback();\n  },\n\n  get order() {\n    return this._order;\n  },\n\n  set order(value) {\n    this._order = value;\n    this.onChangeCallback();\n  },\n\n  set: function (x, y, z, order) {\n    this._x = x;\n    this._y = y;\n    this._z = z;\n    this._order = order || this._order;\n    this.onChangeCallback();\n    return this;\n  },\n  clone: function () {\n    return new this.constructor(this._x, this._y, this._z, this._order);\n  },\n  copy: function (euler) {\n    this._x = euler._x;\n    this._y = euler._y;\n    this._z = euler._z;\n    this._order = euler._order;\n    this.onChangeCallback();\n    return this;\n  },\n  setFromRotationMatrix: function (m, order, update) {\n    var clamp = THREE.Math.clamp; // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n    var te = m.elements;\n    var m11 = te[0],\n        m12 = te[4],\n        m13 = te[8];\n    var m21 = te[1],\n        m22 = te[5],\n        m23 = te[9];\n    var m31 = te[2],\n        m32 = te[6],\n        m33 = te[10];\n    order = order || this._order;\n\n    if (order === 'XYZ') {\n      this._y = Math.asin(clamp(m13, -1, 1));\n\n      if (Math.abs(m13) < 0.99999) {\n        this._x = Math.atan2(-m23, m33);\n        this._z = Math.atan2(-m12, m11);\n      } else {\n        this._x = Math.atan2(m32, m22);\n        this._z = 0;\n      }\n    } else if (order === 'YXZ') {\n      this._x = Math.asin(-clamp(m23, -1, 1));\n\n      if (Math.abs(m23) < 0.99999) {\n        this._y = Math.atan2(m13, m33);\n        this._z = Math.atan2(m21, m22);\n      } else {\n        this._y = Math.atan2(-m31, m11);\n        this._z = 0;\n      }\n    } else if (order === 'ZXY') {\n      this._x = Math.asin(clamp(m32, -1, 1));\n\n      if (Math.abs(m32) < 0.99999) {\n        this._y = Math.atan2(-m31, m33);\n        this._z = Math.atan2(-m12, m22);\n      } else {\n        this._y = 0;\n        this._z = Math.atan2(m21, m11);\n      }\n    } else if (order === 'ZYX') {\n      this._y = Math.asin(-clamp(m31, -1, 1));\n\n      if (Math.abs(m31) < 0.99999) {\n        this._x = Math.atan2(m32, m33);\n        this._z = Math.atan2(m21, m11);\n      } else {\n        this._x = 0;\n        this._z = Math.atan2(-m12, m22);\n      }\n    } else if (order === 'YZX') {\n      this._z = Math.asin(clamp(m21, -1, 1));\n\n      if (Math.abs(m21) < 0.99999) {\n        this._x = Math.atan2(-m23, m22);\n        this._y = Math.atan2(-m31, m11);\n      } else {\n        this._x = 0;\n        this._y = Math.atan2(m13, m33);\n      }\n    } else if (order === 'XZY') {\n      this._z = Math.asin(-clamp(m12, -1, 1));\n\n      if (Math.abs(m12) < 0.99999) {\n        this._x = Math.atan2(m32, m22);\n        this._y = Math.atan2(m13, m11);\n      } else {\n        this._x = Math.atan2(-m23, m33);\n        this._y = 0;\n      }\n    } else {\n      console.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order);\n    }\n\n    this._order = order;\n    if (update !== false) this.onChangeCallback();\n    return this;\n  },\n  setFromQuaternion: function () {\n    var matrix;\n    return function (q, order, update) {\n      if (matrix === undefined) matrix = new THREE.Matrix4();\n      matrix.makeRotationFromQuaternion(q);\n      this.setFromRotationMatrix(matrix, order, update);\n      return this;\n    };\n  }(),\n  setFromVector3: function (v, order) {\n    return this.set(v.x, v.y, v.z, order || this._order);\n  },\n  reorder: function () {\n    // WARNING: this discards revolution information -bhouston\n    var q = new THREE.Quaternion();\n    return function (newOrder) {\n      q.setFromEuler(this);\n      this.setFromQuaternion(q, newOrder);\n    };\n  }(),\n  equals: function (euler) {\n    return euler._x === this._x && euler._y === this._y && euler._z === this._z && euler._order === this._order;\n  },\n  fromArray: function (array) {\n    this._x = array[0];\n    this._y = array[1];\n    this._z = array[2];\n    if (array[3] !== undefined) this._order = array[3];\n    this.onChangeCallback();\n    return this;\n  },\n  toArray: function (array, offset) {\n    if (array === undefined) array = [];\n    if (offset === undefined) offset = 0;\n    array[offset] = this._x;\n    array[offset + 1] = this._y;\n    array[offset + 2] = this._z;\n    array[offset + 3] = this._order;\n    return array;\n  },\n  toVector3: function (optionalResult) {\n    if (optionalResult) {\n      return optionalResult.set(this._x, this._y, this._z);\n    } else {\n      return new THREE.Vector3(this._x, this._y, this._z);\n    }\n  },\n  onChange: function (callback) {\n    this.onChangeCallback = callback;\n    return this;\n  },\n  onChangeCallback: function () {}\n}; // File:src/math/Line3.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Line3 = function (start, end) {\n  this.start = start !== undefined ? start : new THREE.Vector3();\n  this.end = end !== undefined ? end : new THREE.Vector3();\n};\n\nTHREE.Line3.prototype = {\n  constructor: THREE.Line3,\n  set: function (start, end) {\n    this.start.copy(start);\n    this.end.copy(end);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (line) {\n    this.start.copy(line.start);\n    this.end.copy(line.end);\n    return this;\n  },\n  center: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.addVectors(this.start, this.end).multiplyScalar(0.5);\n  },\n  delta: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.subVectors(this.end, this.start);\n  },\n  distanceSq: function () {\n    return this.start.distanceToSquared(this.end);\n  },\n  distance: function () {\n    return this.start.distanceTo(this.end);\n  },\n  at: function (t, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return this.delta(result).multiplyScalar(t).add(this.start);\n  },\n  closestPointToPointParameter: function () {\n    var startP = new THREE.Vector3();\n    var startEnd = new THREE.Vector3();\n    return function (point, clampToLine) {\n      startP.subVectors(point, this.start);\n      startEnd.subVectors(this.end, this.start);\n      var startEnd2 = startEnd.dot(startEnd);\n      var startEnd_startP = startEnd.dot(startP);\n      var t = startEnd_startP / startEnd2;\n\n      if (clampToLine) {\n        t = THREE.Math.clamp(t, 0, 1);\n      }\n\n      return t;\n    };\n  }(),\n  closestPointToPoint: function (point, clampToLine, optionalTarget) {\n    var t = this.closestPointToPointParameter(point, clampToLine);\n    var result = optionalTarget || new THREE.Vector3();\n    return this.delta(result).multiplyScalar(t).add(this.start);\n  },\n  applyMatrix4: function (matrix) {\n    this.start.applyMatrix4(matrix);\n    this.end.applyMatrix4(matrix);\n    return this;\n  },\n  equals: function (line) {\n    return line.start.equals(this.start) && line.end.equals(this.end);\n  }\n}; // File:src/math/Box2.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Box2 = function (min, max) {\n  this.min = min !== undefined ? min : new THREE.Vector2(Infinity, Infinity);\n  this.max = max !== undefined ? max : new THREE.Vector2(-Infinity, -Infinity);\n};\n\nTHREE.Box2.prototype = {\n  constructor: THREE.Box2,\n  set: function (min, max) {\n    this.min.copy(min);\n    this.max.copy(max);\n    return this;\n  },\n  setFromPoints: function (points) {\n    this.makeEmpty();\n\n    for (var i = 0, il = points.length; i < il; i++) {\n      this.expandByPoint(points[i]);\n    }\n\n    return this;\n  },\n  setFromCenterAndSize: function () {\n    var v1 = new THREE.Vector2();\n    return function (center, size) {\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\n      this.min.copy(center).sub(halfSize);\n      this.max.copy(center).add(halfSize);\n      return this;\n    };\n  }(),\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (box) {\n    this.min.copy(box.min);\n    this.max.copy(box.max);\n    return this;\n  },\n  makeEmpty: function () {\n    this.min.x = this.min.y = Infinity;\n    this.max.x = this.max.y = -Infinity;\n    return this;\n  },\n  empty: function () {\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\n    return this.max.x < this.min.x || this.max.y < this.min.y;\n  },\n  center: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector2();\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\n  },\n  size: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector2();\n    return result.subVectors(this.max, this.min);\n  },\n  expandByPoint: function (point) {\n    this.min.min(point);\n    this.max.max(point);\n    return this;\n  },\n  expandByVector: function (vector) {\n    this.min.sub(vector);\n    this.max.add(vector);\n    return this;\n  },\n  expandByScalar: function (scalar) {\n    this.min.addScalar(-scalar);\n    this.max.addScalar(scalar);\n    return this;\n  },\n  containsPoint: function (point) {\n    if (point.x < this.min.x || point.x > this.max.x || point.y < this.min.y || point.y > this.max.y) {\n      return false;\n    }\n\n    return true;\n  },\n  containsBox: function (box) {\n    if (this.min.x <= box.min.x && box.max.x <= this.max.x && this.min.y <= box.min.y && box.max.y <= this.max.y) {\n      return true;\n    }\n\n    return false;\n  },\n  getParameter: function (point, optionalTarget) {\n    // This can potentially have a divide by zero if the box\n    // has a size dimension of 0.\n    var result = optionalTarget || new THREE.Vector2();\n    return result.set((point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y));\n  },\n  isIntersectionBox: function (box) {\n    // using 6 splitting planes to rule out intersections.\n    if (box.max.x < this.min.x || box.min.x > this.max.x || box.max.y < this.min.y || box.min.y > this.max.y) {\n      return false;\n    }\n\n    return true;\n  },\n  clampPoint: function (point, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector2();\n    return result.copy(point).clamp(this.min, this.max);\n  },\n  distanceToPoint: function () {\n    var v1 = new THREE.Vector2();\n    return function (point) {\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\n      return clampedPoint.sub(point).length();\n    };\n  }(),\n  intersect: function (box) {\n    this.min.max(box.min);\n    this.max.min(box.max);\n    return this;\n  },\n  union: function (box) {\n    this.min.min(box.min);\n    this.max.max(box.max);\n    return this;\n  },\n  translate: function (offset) {\n    this.min.add(offset);\n    this.max.add(offset);\n    return this;\n  },\n  equals: function (box) {\n    return box.min.equals(this.min) && box.max.equals(this.max);\n  }\n}; // File:src/math/Box3.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\nTHREE.Box3 = function (min, max) {\n  this.min = min !== undefined ? min : new THREE.Vector3(Infinity, Infinity, Infinity);\n  this.max = max !== undefined ? max : new THREE.Vector3(-Infinity, -Infinity, -Infinity);\n};\n\nTHREE.Box3.prototype = {\n  constructor: THREE.Box3,\n  set: function (min, max) {\n    this.min.copy(min);\n    this.max.copy(max);\n    return this;\n  },\n  setFromPoints: function (points) {\n    this.makeEmpty();\n\n    for (var i = 0, il = points.length; i < il; i++) {\n      this.expandByPoint(points[i]);\n    }\n\n    return this;\n  },\n  setFromCenterAndSize: function () {\n    var v1 = new THREE.Vector3();\n    return function (center, size) {\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\n      this.min.copy(center).sub(halfSize);\n      this.max.copy(center).add(halfSize);\n      return this;\n    };\n  }(),\n  setFromObject: function () {\n    // Computes the world-axis-aligned bounding box of an object (including its children),\n    // accounting for both the object's, and children's, world transforms\n    var v1 = new THREE.Vector3();\n    return function (object) {\n      var scope = this;\n      object.updateMatrixWorld(true);\n      this.makeEmpty();\n      object.traverse(function (node) {\n        var geometry = node.geometry;\n\n        if (geometry !== undefined) {\n          if (geometry instanceof THREE.Geometry) {\n            var vertices = geometry.vertices;\n\n            for (var i = 0, il = vertices.length; i < il; i++) {\n              v1.copy(vertices[i]);\n              v1.applyMatrix4(node.matrixWorld);\n              scope.expandByPoint(v1);\n            }\n          } else if (geometry instanceof THREE.BufferGeometry && geometry.attributes['position'] !== undefined) {\n            var positions = geometry.attributes['position'].array;\n\n            for (var i = 0, il = positions.length; i < il; i += 3) {\n              v1.set(positions[i], positions[i + 1], positions[i + 2]);\n              v1.applyMatrix4(node.matrixWorld);\n              scope.expandByPoint(v1);\n            }\n          }\n        }\n      });\n      return this;\n    };\n  }(),\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (box) {\n    this.min.copy(box.min);\n    this.max.copy(box.max);\n    return this;\n  },\n  makeEmpty: function () {\n    this.min.x = this.min.y = this.min.z = Infinity;\n    this.max.x = this.max.y = this.max.z = -Infinity;\n    return this;\n  },\n  empty: function () {\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\n    return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z;\n  },\n  center: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\n  },\n  size: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.subVectors(this.max, this.min);\n  },\n  expandByPoint: function (point) {\n    this.min.min(point);\n    this.max.max(point);\n    return this;\n  },\n  expandByVector: function (vector) {\n    this.min.sub(vector);\n    this.max.add(vector);\n    return this;\n  },\n  expandByScalar: function (scalar) {\n    this.min.addScalar(-scalar);\n    this.max.addScalar(scalar);\n    return this;\n  },\n  containsPoint: function (point) {\n    if (point.x < this.min.x || point.x > this.max.x || point.y < this.min.y || point.y > this.max.y || point.z < this.min.z || point.z > this.max.z) {\n      return false;\n    }\n\n    return true;\n  },\n  containsBox: function (box) {\n    if (this.min.x <= box.min.x && box.max.x <= this.max.x && this.min.y <= box.min.y && box.max.y <= this.max.y && this.min.z <= box.min.z && box.max.z <= this.max.z) {\n      return true;\n    }\n\n    return false;\n  },\n  getParameter: function (point, optionalTarget) {\n    // This can potentially have a divide by zero if the box\n    // has a size dimension of 0.\n    var result = optionalTarget || new THREE.Vector3();\n    return result.set((point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y), (point.z - this.min.z) / (this.max.z - this.min.z));\n  },\n  isIntersectionBox: function (box) {\n    // using 6 splitting planes to rule out intersections.\n    if (box.max.x < this.min.x || box.min.x > this.max.x || box.max.y < this.min.y || box.min.y > this.max.y || box.max.z < this.min.z || box.min.z > this.max.z) {\n      return false;\n    }\n\n    return true;\n  },\n  clampPoint: function (point, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.copy(point).clamp(this.min, this.max);\n  },\n  distanceToPoint: function () {\n    var v1 = new THREE.Vector3();\n    return function (point) {\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\n      return clampedPoint.sub(point).length();\n    };\n  }(),\n  getBoundingSphere: function () {\n    var v1 = new THREE.Vector3();\n    return function (optionalTarget) {\n      var result = optionalTarget || new THREE.Sphere();\n      result.center = this.center();\n      result.radius = this.size(v1).length() * 0.5;\n      return result;\n    };\n  }(),\n  intersect: function (box) {\n    this.min.max(box.min);\n    this.max.min(box.max);\n    return this;\n  },\n  union: function (box) {\n    this.min.min(box.min);\n    this.max.max(box.max);\n    return this;\n  },\n  applyMatrix4: function () {\n    var points = [new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3()];\n    return function (matrix) {\n      // NOTE: I am using a binary pattern to specify all 2^3 combinations below\n      points[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(matrix); // 000\n\n      points[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(matrix); // 001\n\n      points[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(matrix); // 010\n\n      points[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(matrix); // 011\n\n      points[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(matrix); // 100\n\n      points[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(matrix); // 101\n\n      points[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(matrix); // 110\n\n      points[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(matrix); // 111\n\n      this.makeEmpty();\n      this.setFromPoints(points);\n      return this;\n    };\n  }(),\n  translate: function (offset) {\n    this.min.add(offset);\n    this.max.add(offset);\n    return this;\n  },\n  equals: function (box) {\n    return box.min.equals(this.min) && box.max.equals(this.max);\n  }\n}; // File:src/math/Matrix3.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Matrix3 = function () {\n  this.elements = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n\n  if (arguments.length > 0) {\n    console.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\n  }\n};\n\nTHREE.Matrix3.prototype = {\n  constructor: THREE.Matrix3,\n  set: function (n11, n12, n13, n21, n22, n23, n31, n32, n33) {\n    var te = this.elements;\n    te[0] = n11;\n    te[3] = n12;\n    te[6] = n13;\n    te[1] = n21;\n    te[4] = n22;\n    te[7] = n23;\n    te[2] = n31;\n    te[5] = n32;\n    te[8] = n33;\n    return this;\n  },\n  identity: function () {\n    this.set(1, 0, 0, 0, 1, 0, 0, 0, 1);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().fromArray(this.elements);\n  },\n  copy: function (m) {\n    var me = m.elements;\n    this.set(me[0], me[3], me[6], me[1], me[4], me[7], me[2], me[5], me[8]);\n    return this;\n  },\n  multiplyVector3: function (vector) {\n    console.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');\n    return vector.applyMatrix3(this);\n  },\n  multiplyVector3Array: function (a) {\n    console.warn('THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\n    return this.applyToVector3Array(a);\n  },\n  applyToVector3Array: function () {\n    var v1;\n    return function (array, offset, length) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      if (offset === undefined) offset = 0;\n      if (length === undefined) length = array.length;\n\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\n        v1.fromArray(array, j);\n        v1.applyMatrix3(this);\n        v1.toArray(array, j);\n      }\n\n      return array;\n    };\n  }(),\n  applyToBuffer: function () {\n    var v1;\n    return function applyToBuffer(buffer, offset, length) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      if (offset === undefined) offset = 0;\n      if (length === undefined) length = buffer.length / buffer.itemSize;\n\n      for (var i = 0, j = offset; i < length; i++, j++) {\n        v1.x = buffer.getX(j);\n        v1.y = buffer.getY(j);\n        v1.z = buffer.getZ(j);\n        v1.applyMatrix3(this);\n        buffer.setXYZ(v1.x, v1.y, v1.z);\n      }\n\n      return buffer;\n    };\n  }(),\n  multiplyScalar: function (s) {\n    var te = this.elements;\n    te[0] *= s;\n    te[3] *= s;\n    te[6] *= s;\n    te[1] *= s;\n    te[4] *= s;\n    te[7] *= s;\n    te[2] *= s;\n    te[5] *= s;\n    te[8] *= s;\n    return this;\n  },\n  determinant: function () {\n    var te = this.elements;\n    var a = te[0],\n        b = te[1],\n        c = te[2],\n        d = te[3],\n        e = te[4],\n        f = te[5],\n        g = te[6],\n        h = te[7],\n        i = te[8];\n    return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n  },\n  getInverse: function (matrix, throwOnInvertible) {\n    // input: THREE.Matrix4\n    // ( based on http://code.google.com/p/webgl-mjs/ )\n    var me = matrix.elements;\n    var te = this.elements;\n    te[0] = me[10] * me[5] - me[6] * me[9];\n    te[1] = -me[10] * me[1] + me[2] * me[9];\n    te[2] = me[6] * me[1] - me[2] * me[5];\n    te[3] = -me[10] * me[4] + me[6] * me[8];\n    te[4] = me[10] * me[0] - me[2] * me[8];\n    te[5] = -me[6] * me[0] + me[2] * me[4];\n    te[6] = me[9] * me[4] - me[5] * me[8];\n    te[7] = -me[9] * me[0] + me[1] * me[8];\n    te[8] = me[5] * me[0] - me[1] * me[4];\n    var det = me[0] * te[0] + me[1] * te[3] + me[2] * te[6]; // no inverse\n\n    if (det === 0) {\n      var msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\n\n      if (throwOnInvertible || false) {\n        throw new Error(msg);\n      } else {\n        console.warn(msg);\n      }\n\n      this.identity();\n      return this;\n    }\n\n    this.multiplyScalar(1.0 / det);\n    return this;\n  },\n  transpose: function () {\n    var tmp,\n        m = this.elements;\n    tmp = m[1];\n    m[1] = m[3];\n    m[3] = tmp;\n    tmp = m[2];\n    m[2] = m[6];\n    m[6] = tmp;\n    tmp = m[5];\n    m[5] = m[7];\n    m[7] = tmp;\n    return this;\n  },\n  flattenToArrayOffset: function (array, offset) {\n    var te = this.elements;\n    array[offset] = te[0];\n    array[offset + 1] = te[1];\n    array[offset + 2] = te[2];\n    array[offset + 3] = te[3];\n    array[offset + 4] = te[4];\n    array[offset + 5] = te[5];\n    array[offset + 6] = te[6];\n    array[offset + 7] = te[7];\n    array[offset + 8] = te[8];\n    return array;\n  },\n  getNormalMatrix: function (m) {\n    // input: THREE.Matrix4\n    this.getInverse(m).transpose();\n    return this;\n  },\n  transposeIntoArray: function (r) {\n    var m = this.elements;\n    r[0] = m[0];\n    r[1] = m[3];\n    r[2] = m[6];\n    r[3] = m[1];\n    r[4] = m[4];\n    r[5] = m[7];\n    r[6] = m[2];\n    r[7] = m[5];\n    r[8] = m[8];\n    return this;\n  },\n  fromArray: function (array) {\n    this.elements.set(array);\n    return this;\n  },\n  toArray: function () {\n    var te = this.elements;\n    return [te[0], te[1], te[2], te[3], te[4], te[5], te[6], te[7], te[8]];\n  }\n}; // File:src/math/Matrix4.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\nTHREE.Matrix4 = function () {\n  this.elements = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);\n\n  if (arguments.length > 0) {\n    console.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\n  }\n};\n\nTHREE.Matrix4.prototype = {\n  constructor: THREE.Matrix4,\n  set: function (n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\n    var te = this.elements;\n    te[0] = n11;\n    te[4] = n12;\n    te[8] = n13;\n    te[12] = n14;\n    te[1] = n21;\n    te[5] = n22;\n    te[9] = n23;\n    te[13] = n24;\n    te[2] = n31;\n    te[6] = n32;\n    te[10] = n33;\n    te[14] = n34;\n    te[3] = n41;\n    te[7] = n42;\n    te[11] = n43;\n    te[15] = n44;\n    return this;\n  },\n  identity: function () {\n    this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\n    return this;\n  },\n  clone: function () {\n    return new THREE.Matrix4().fromArray(this.elements);\n  },\n  copy: function (m) {\n    this.elements.set(m.elements);\n    return this;\n  },\n  extractPosition: function (m) {\n    console.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');\n    return this.copyPosition(m);\n  },\n  copyPosition: function (m) {\n    var te = this.elements;\n    var me = m.elements;\n    te[12] = me[12];\n    te[13] = me[13];\n    te[14] = me[14];\n    return this;\n  },\n  extractBasis: function (xAxis, yAxis, zAxis) {\n    var te = this.elements;\n    xAxis.set(te[0], te[1], te[2]);\n    yAxis.set(te[4], te[5], te[6]);\n    zAxis.set(te[8], te[9], te[10]);\n    return this;\n  },\n  makeBasis: function (xAxis, yAxis, zAxis) {\n    this.set(xAxis.x, yAxis.x, zAxis.x, 0, xAxis.y, yAxis.y, zAxis.y, 0, xAxis.z, yAxis.z, zAxis.z, 0, 0, 0, 0, 1);\n    return this;\n  },\n  extractRotation: function () {\n    var v1;\n    return function (m) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      var te = this.elements;\n      var me = m.elements;\n      var scaleX = 1 / v1.set(me[0], me[1], me[2]).length();\n      var scaleY = 1 / v1.set(me[4], me[5], me[6]).length();\n      var scaleZ = 1 / v1.set(me[8], me[9], me[10]).length();\n      te[0] = me[0] * scaleX;\n      te[1] = me[1] * scaleX;\n      te[2] = me[2] * scaleX;\n      te[4] = me[4] * scaleY;\n      te[5] = me[5] * scaleY;\n      te[6] = me[6] * scaleY;\n      te[8] = me[8] * scaleZ;\n      te[9] = me[9] * scaleZ;\n      te[10] = me[10] * scaleZ;\n      return this;\n    };\n  }(),\n  makeRotationFromEuler: function (euler) {\n    if (euler instanceof THREE.Euler === false) {\n      console.error('THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\n    }\n\n    var te = this.elements;\n    var x = euler.x,\n        y = euler.y,\n        z = euler.z;\n    var a = Math.cos(x),\n        b = Math.sin(x);\n    var c = Math.cos(y),\n        d = Math.sin(y);\n    var e = Math.cos(z),\n        f = Math.sin(z);\n\n    if (euler.order === 'XYZ') {\n      var ae = a * e,\n          af = a * f,\n          be = b * e,\n          bf = b * f;\n      te[0] = c * e;\n      te[4] = -c * f;\n      te[8] = d;\n      te[1] = af + be * d;\n      te[5] = ae - bf * d;\n      te[9] = -b * c;\n      te[2] = bf - ae * d;\n      te[6] = be + af * d;\n      te[10] = a * c;\n    } else if (euler.order === 'YXZ') {\n      var ce = c * e,\n          cf = c * f,\n          de = d * e,\n          df = d * f;\n      te[0] = ce + df * b;\n      te[4] = de * b - cf;\n      te[8] = a * d;\n      te[1] = a * f;\n      te[5] = a * e;\n      te[9] = -b;\n      te[2] = cf * b - de;\n      te[6] = df + ce * b;\n      te[10] = a * c;\n    } else if (euler.order === 'ZXY') {\n      var ce = c * e,\n          cf = c * f,\n          de = d * e,\n          df = d * f;\n      te[0] = ce - df * b;\n      te[4] = -a * f;\n      te[8] = de + cf * b;\n      te[1] = cf + de * b;\n      te[5] = a * e;\n      te[9] = df - ce * b;\n      te[2] = -a * d;\n      te[6] = b;\n      te[10] = a * c;\n    } else if (euler.order === 'ZYX') {\n      var ae = a * e,\n          af = a * f,\n          be = b * e,\n          bf = b * f;\n      te[0] = c * e;\n      te[4] = be * d - af;\n      te[8] = ae * d + bf;\n      te[1] = c * f;\n      te[5] = bf * d + ae;\n      te[9] = af * d - be;\n      te[2] = -d;\n      te[6] = b * c;\n      te[10] = a * c;\n    } else if (euler.order === 'YZX') {\n      var ac = a * c,\n          ad = a * d,\n          bc = b * c,\n          bd = b * d;\n      te[0] = c * e;\n      te[4] = bd - ac * f;\n      te[8] = bc * f + ad;\n      te[1] = f;\n      te[5] = a * e;\n      te[9] = -b * e;\n      te[2] = -d * e;\n      te[6] = ad * f + bc;\n      te[10] = ac - bd * f;\n    } else if (euler.order === 'XZY') {\n      var ac = a * c,\n          ad = a * d,\n          bc = b * c,\n          bd = b * d;\n      te[0] = c * e;\n      te[4] = -f;\n      te[8] = d * e;\n      te[1] = ac * f + bd;\n      te[5] = a * e;\n      te[9] = ad * f - bc;\n      te[2] = bc * f - ad;\n      te[6] = b * e;\n      te[10] = bd * f + ac;\n    } // last column\n\n\n    te[3] = 0;\n    te[7] = 0;\n    te[11] = 0; // bottom row\n\n    te[12] = 0;\n    te[13] = 0;\n    te[14] = 0;\n    te[15] = 1;\n    return this;\n  },\n  setRotationFromQuaternion: function (q) {\n    console.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');\n    return this.makeRotationFromQuaternion(q);\n  },\n  makeRotationFromQuaternion: function (q) {\n    var te = this.elements;\n    var x = q.x,\n        y = q.y,\n        z = q.z,\n        w = q.w;\n    var x2 = x + x,\n        y2 = y + y,\n        z2 = z + z;\n    var xx = x * x2,\n        xy = x * y2,\n        xz = x * z2;\n    var yy = y * y2,\n        yz = y * z2,\n        zz = z * z2;\n    var wx = w * x2,\n        wy = w * y2,\n        wz = w * z2;\n    te[0] = 1 - (yy + zz);\n    te[4] = xy - wz;\n    te[8] = xz + wy;\n    te[1] = xy + wz;\n    te[5] = 1 - (xx + zz);\n    te[9] = yz - wx;\n    te[2] = xz - wy;\n    te[6] = yz + wx;\n    te[10] = 1 - (xx + yy); // last column\n\n    te[3] = 0;\n    te[7] = 0;\n    te[11] = 0; // bottom row\n\n    te[12] = 0;\n    te[13] = 0;\n    te[14] = 0;\n    te[15] = 1;\n    return this;\n  },\n  lookAt: function () {\n    var x, y, z;\n    return function (eye, target, up) {\n      if (x === undefined) x = new THREE.Vector3();\n      if (y === undefined) y = new THREE.Vector3();\n      if (z === undefined) z = new THREE.Vector3();\n      var te = this.elements;\n      z.subVectors(eye, target).normalize();\n\n      if (z.length() === 0) {\n        z.z = 1;\n      }\n\n      x.crossVectors(up, z).normalize();\n\n      if (x.length() === 0) {\n        z.x += 0.0001;\n        x.crossVectors(up, z).normalize();\n      }\n\n      y.crossVectors(z, x);\n      te[0] = x.x;\n      te[4] = y.x;\n      te[8] = z.x;\n      te[1] = x.y;\n      te[5] = y.y;\n      te[9] = z.y;\n      te[2] = x.z;\n      te[6] = y.z;\n      te[10] = z.z;\n      return this;\n    };\n  }(),\n  multiply: function (m, n) {\n    if (n !== undefined) {\n      console.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\n      return this.multiplyMatrices(m, n);\n    }\n\n    return this.multiplyMatrices(this, m);\n  },\n  multiplyMatrices: function (a, b) {\n    var ae = a.elements;\n    var be = b.elements;\n    var te = this.elements;\n    var a11 = ae[0],\n        a12 = ae[4],\n        a13 = ae[8],\n        a14 = ae[12];\n    var a21 = ae[1],\n        a22 = ae[5],\n        a23 = ae[9],\n        a24 = ae[13];\n    var a31 = ae[2],\n        a32 = ae[6],\n        a33 = ae[10],\n        a34 = ae[14];\n    var a41 = ae[3],\n        a42 = ae[7],\n        a43 = ae[11],\n        a44 = ae[15];\n    var b11 = be[0],\n        b12 = be[4],\n        b13 = be[8],\n        b14 = be[12];\n    var b21 = be[1],\n        b22 = be[5],\n        b23 = be[9],\n        b24 = be[13];\n    var b31 = be[2],\n        b32 = be[6],\n        b33 = be[10],\n        b34 = be[14];\n    var b41 = be[3],\n        b42 = be[7],\n        b43 = be[11],\n        b44 = be[15];\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n    return this;\n  },\n  multiplyToArray: function (a, b, r) {\n    var te = this.elements;\n    this.multiplyMatrices(a, b);\n    r[0] = te[0];\n    r[1] = te[1];\n    r[2] = te[2];\n    r[3] = te[3];\n    r[4] = te[4];\n    r[5] = te[5];\n    r[6] = te[6];\n    r[7] = te[7];\n    r[8] = te[8];\n    r[9] = te[9];\n    r[10] = te[10];\n    r[11] = te[11];\n    r[12] = te[12];\n    r[13] = te[13];\n    r[14] = te[14];\n    r[15] = te[15];\n    return this;\n  },\n  multiplyScalar: function (s) {\n    var te = this.elements;\n    te[0] *= s;\n    te[4] *= s;\n    te[8] *= s;\n    te[12] *= s;\n    te[1] *= s;\n    te[5] *= s;\n    te[9] *= s;\n    te[13] *= s;\n    te[2] *= s;\n    te[6] *= s;\n    te[10] *= s;\n    te[14] *= s;\n    te[3] *= s;\n    te[7] *= s;\n    te[11] *= s;\n    te[15] *= s;\n    return this;\n  },\n  multiplyVector3: function (vector) {\n    console.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');\n    return vector.applyProjection(this);\n  },\n  multiplyVector4: function (vector) {\n    console.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');\n    return vector.applyMatrix4(this);\n  },\n  multiplyVector3Array: function (a) {\n    console.warn('THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\n    return this.applyToVector3Array(a);\n  },\n  applyToVector3Array: function () {\n    var v1;\n    return function (array, offset, length) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      if (offset === undefined) offset = 0;\n      if (length === undefined) length = array.length;\n\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\n        v1.fromArray(array, j);\n        v1.applyMatrix4(this);\n        v1.toArray(array, j);\n      }\n\n      return array;\n    };\n  }(),\n  applyToBuffer: function () {\n    var v1;\n    return function applyToBuffer(buffer, offset, length) {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      if (offset === undefined) offset = 0;\n      if (length === undefined) length = buffer.length / buffer.itemSize;\n\n      for (var i = 0, j = offset; i < length; i++, j++) {\n        v1.x = buffer.getX(j);\n        v1.y = buffer.getY(j);\n        v1.z = buffer.getZ(j);\n        v1.applyMatrix4(this);\n        buffer.setXYZ(v1.x, v1.y, v1.z);\n      }\n\n      return buffer;\n    };\n  }(),\n  rotateAxis: function (v) {\n    console.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');\n    v.transformDirection(this);\n  },\n  crossVector: function (vector) {\n    console.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');\n    return vector.applyMatrix4(this);\n  },\n  determinant: function () {\n    var te = this.elements;\n    var n11 = te[0],\n        n12 = te[4],\n        n13 = te[8],\n        n14 = te[12];\n    var n21 = te[1],\n        n22 = te[5],\n        n23 = te[9],\n        n24 = te[13];\n    var n31 = te[2],\n        n32 = te[6],\n        n33 = te[10],\n        n34 = te[14];\n    var n41 = te[3],\n        n42 = te[7],\n        n43 = te[11],\n        n44 = te[15]; //TODO: make this more efficient\n    //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\n\n    return n41 * (+n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34) + n42 * (+n11 * n23 * n34 - n11 * n24 * n33 + n14 * n21 * n33 - n13 * n21 * n34 + n13 * n24 * n31 - n14 * n23 * n31) + n43 * (+n11 * n24 * n32 - n11 * n22 * n34 - n14 * n21 * n32 + n12 * n21 * n34 + n14 * n22 * n31 - n12 * n24 * n31) + n44 * (-n13 * n22 * n31 - n11 * n23 * n32 + n11 * n22 * n33 + n13 * n21 * n32 - n12 * n21 * n33 + n12 * n23 * n31);\n  },\n  transpose: function () {\n    var te = this.elements;\n    var tmp;\n    tmp = te[1];\n    te[1] = te[4];\n    te[4] = tmp;\n    tmp = te[2];\n    te[2] = te[8];\n    te[8] = tmp;\n    tmp = te[6];\n    te[6] = te[9];\n    te[9] = tmp;\n    tmp = te[3];\n    te[3] = te[12];\n    te[12] = tmp;\n    tmp = te[7];\n    te[7] = te[13];\n    te[13] = tmp;\n    tmp = te[11];\n    te[11] = te[14];\n    te[14] = tmp;\n    return this;\n  },\n  flattenToArrayOffset: function (array, offset) {\n    var te = this.elements;\n    array[offset] = te[0];\n    array[offset + 1] = te[1];\n    array[offset + 2] = te[2];\n    array[offset + 3] = te[3];\n    array[offset + 4] = te[4];\n    array[offset + 5] = te[5];\n    array[offset + 6] = te[6];\n    array[offset + 7] = te[7];\n    array[offset + 8] = te[8];\n    array[offset + 9] = te[9];\n    array[offset + 10] = te[10];\n    array[offset + 11] = te[11];\n    array[offset + 12] = te[12];\n    array[offset + 13] = te[13];\n    array[offset + 14] = te[14];\n    array[offset + 15] = te[15];\n    return array;\n  },\n  getPosition: function () {\n    var v1;\n    return function () {\n      if (v1 === undefined) v1 = new THREE.Vector3();\n      console.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');\n      var te = this.elements;\n      return v1.set(te[12], te[13], te[14]);\n    };\n  }(),\n  setPosition: function (v) {\n    var te = this.elements;\n    te[12] = v.x;\n    te[13] = v.y;\n    te[14] = v.z;\n    return this;\n  },\n  getInverse: function (m, throwOnInvertible) {\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\n    var te = this.elements;\n    var me = m.elements;\n    var n11 = me[0],\n        n12 = me[4],\n        n13 = me[8],\n        n14 = me[12];\n    var n21 = me[1],\n        n22 = me[5],\n        n23 = me[9],\n        n24 = me[13];\n    var n31 = me[2],\n        n32 = me[6],\n        n33 = me[10],\n        n34 = me[14];\n    var n41 = me[3],\n        n42 = me[7],\n        n43 = me[11],\n        n44 = me[15];\n    te[0] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\n    te[4] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\n    te[8] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\n    te[12] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\n    te[1] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\n    te[5] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\n    te[9] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\n    te[13] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\n    te[2] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\n    te[6] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\n    te[10] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\n    te[14] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\n    te[3] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\n    te[7] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\n    te[11] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\n    te[15] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\n    var det = n11 * te[0] + n21 * te[4] + n31 * te[8] + n41 * te[12];\n\n    if (det === 0) {\n      var msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\n\n      if (throwOnInvertible || false) {\n        throw new Error(msg);\n      } else {\n        console.warn(msg);\n      }\n\n      this.identity();\n      return this;\n    }\n\n    this.multiplyScalar(1 / det);\n    return this;\n  },\n  translate: function (v) {\n    console.error('THREE.Matrix4: .translate() has been removed.');\n  },\n  rotateX: function (angle) {\n    console.error('THREE.Matrix4: .rotateX() has been removed.');\n  },\n  rotateY: function (angle) {\n    console.error('THREE.Matrix4: .rotateY() has been removed.');\n  },\n  rotateZ: function (angle) {\n    console.error('THREE.Matrix4: .rotateZ() has been removed.');\n  },\n  rotateByAxis: function (axis, angle) {\n    console.error('THREE.Matrix4: .rotateByAxis() has been removed.');\n  },\n  scale: function (v) {\n    var te = this.elements;\n    var x = v.x,\n        y = v.y,\n        z = v.z;\n    te[0] *= x;\n    te[4] *= y;\n    te[8] *= z;\n    te[1] *= x;\n    te[5] *= y;\n    te[9] *= z;\n    te[2] *= x;\n    te[6] *= y;\n    te[10] *= z;\n    te[3] *= x;\n    te[7] *= y;\n    te[11] *= z;\n    return this;\n  },\n  getMaxScaleOnAxis: function () {\n    var te = this.elements;\n    var scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\n    var scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\n    var scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\n    return Math.sqrt(Math.max(scaleXSq, Math.max(scaleYSq, scaleZSq)));\n  },\n  makeTranslation: function (x, y, z) {\n    this.set(1, 0, 0, x, 0, 1, 0, y, 0, 0, 1, z, 0, 0, 0, 1);\n    return this;\n  },\n  makeRotationX: function (theta) {\n    var c = Math.cos(theta),\n        s = Math.sin(theta);\n    this.set(1, 0, 0, 0, 0, c, -s, 0, 0, s, c, 0, 0, 0, 0, 1);\n    return this;\n  },\n  makeRotationY: function (theta) {\n    var c = Math.cos(theta),\n        s = Math.sin(theta);\n    this.set(c, 0, s, 0, 0, 1, 0, 0, -s, 0, c, 0, 0, 0, 0, 1);\n    return this;\n  },\n  makeRotationZ: function (theta) {\n    var c = Math.cos(theta),\n        s = Math.sin(theta);\n    this.set(c, -s, 0, 0, s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\n    return this;\n  },\n  makeRotationAxis: function (axis, angle) {\n    // Based on http://www.gamedev.net/reference/articles/article1199.asp\n    var c = Math.cos(angle);\n    var s = Math.sin(angle);\n    var t = 1 - c;\n    var x = axis.x,\n        y = axis.y,\n        z = axis.z;\n    var tx = t * x,\n        ty = t * y;\n    this.set(tx * x + c, tx * y - s * z, tx * z + s * y, 0, tx * y + s * z, ty * y + c, ty * z - s * x, 0, tx * z - s * y, ty * z + s * x, t * z * z + c, 0, 0, 0, 0, 1);\n    return this;\n  },\n  makeScale: function (x, y, z) {\n    this.set(x, 0, 0, 0, 0, y, 0, 0, 0, 0, z, 0, 0, 0, 0, 1);\n    return this;\n  },\n  compose: function (position, quaternion, scale) {\n    this.makeRotationFromQuaternion(quaternion);\n    this.scale(scale);\n    this.setPosition(position);\n    return this;\n  },\n  decompose: function () {\n    var vector, matrix;\n    return function (position, quaternion, scale) {\n      if (vector === undefined) vector = new THREE.Vector3();\n      if (matrix === undefined) matrix = new THREE.Matrix4();\n      var te = this.elements;\n      var sx = vector.set(te[0], te[1], te[2]).length();\n      var sy = vector.set(te[4], te[5], te[6]).length();\n      var sz = vector.set(te[8], te[9], te[10]).length(); // if determine is negative, we need to invert one scale\n\n      var det = this.determinant();\n\n      if (det < 0) {\n        sx = -sx;\n      }\n\n      position.x = te[12];\n      position.y = te[13];\n      position.z = te[14]; // scale the rotation part\n\n      matrix.elements.set(this.elements); // at this point matrix is incomplete so we can't use .copy()\n\n      var invSX = 1 / sx;\n      var invSY = 1 / sy;\n      var invSZ = 1 / sz;\n      matrix.elements[0] *= invSX;\n      matrix.elements[1] *= invSX;\n      matrix.elements[2] *= invSX;\n      matrix.elements[4] *= invSY;\n      matrix.elements[5] *= invSY;\n      matrix.elements[6] *= invSY;\n      matrix.elements[8] *= invSZ;\n      matrix.elements[9] *= invSZ;\n      matrix.elements[10] *= invSZ;\n      quaternion.setFromRotationMatrix(matrix);\n      scale.x = sx;\n      scale.y = sy;\n      scale.z = sz;\n      return this;\n    };\n  }(),\n  makeFrustum: function (left, right, bottom, top, near, far) {\n    var te = this.elements;\n    var x = 2 * near / (right - left);\n    var y = 2 * near / (top - bottom);\n    var a = (right + left) / (right - left);\n    var b = (top + bottom) / (top - bottom);\n    var c = -(far + near) / (far - near);\n    var d = -2 * far * near / (far - near);\n    te[0] = x;\n    te[4] = 0;\n    te[8] = a;\n    te[12] = 0;\n    te[1] = 0;\n    te[5] = y;\n    te[9] = b;\n    te[13] = 0;\n    te[2] = 0;\n    te[6] = 0;\n    te[10] = c;\n    te[14] = d;\n    te[3] = 0;\n    te[7] = 0;\n    te[11] = -1;\n    te[15] = 0;\n    return this;\n  },\n  makePerspective: function (fov, aspect, near, far) {\n    var ymax = near * Math.tan(THREE.Math.degToRad(fov * 0.5));\n    var ymin = -ymax;\n    var xmin = ymin * aspect;\n    var xmax = ymax * aspect;\n    return this.makeFrustum(xmin, xmax, ymin, ymax, near, far);\n  },\n  makeOrthographic: function (left, right, top, bottom, near, far) {\n    var te = this.elements;\n    var w = right - left;\n    var h = top - bottom;\n    var p = far - near;\n    var x = (right + left) / w;\n    var y = (top + bottom) / h;\n    var z = (far + near) / p;\n    te[0] = 2 / w;\n    te[4] = 0;\n    te[8] = 0;\n    te[12] = -x;\n    te[1] = 0;\n    te[5] = 2 / h;\n    te[9] = 0;\n    te[13] = -y;\n    te[2] = 0;\n    te[6] = 0;\n    te[10] = -2 / p;\n    te[14] = -z;\n    te[3] = 0;\n    te[7] = 0;\n    te[11] = 0;\n    te[15] = 1;\n    return this;\n  },\n  equals: function (matrix) {\n    var te = this.elements;\n    var me = matrix.elements;\n\n    for (var i = 0; i < 16; i++) {\n      if (te[i] !== me[i]) return false;\n    }\n\n    return true;\n  },\n  fromArray: function (array) {\n    this.elements.set(array);\n    return this;\n  },\n  toArray: function () {\n    var te = this.elements;\n    return [te[0], te[1], te[2], te[3], te[4], te[5], te[6], te[7], te[8], te[9], te[10], te[11], te[12], te[13], te[14], te[15]];\n  }\n}; // File:src/math/Ray.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Ray = function (origin, direction) {\n  this.origin = origin !== undefined ? origin : new THREE.Vector3();\n  this.direction = direction !== undefined ? direction : new THREE.Vector3();\n};\n\nTHREE.Ray.prototype = {\n  constructor: THREE.Ray,\n  set: function (origin, direction) {\n    this.origin.copy(origin);\n    this.direction.copy(direction);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (ray) {\n    this.origin.copy(ray.origin);\n    this.direction.copy(ray.direction);\n    return this;\n  },\n  at: function (t, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.copy(this.direction).multiplyScalar(t).add(this.origin);\n  },\n  recast: function () {\n    var v1 = new THREE.Vector3();\n    return function (t) {\n      this.origin.copy(this.at(t, v1));\n      return this;\n    };\n  }(),\n  closestPointToPoint: function (point, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    result.subVectors(point, this.origin);\n    var directionDistance = result.dot(this.direction);\n\n    if (directionDistance < 0) {\n      return result.copy(this.origin);\n    }\n\n    return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\n  },\n  distanceToPoint: function (point) {\n    return Math.sqrt(this.distanceSqToPoint(point));\n  },\n  distanceSqToPoint: function () {\n    var v1 = new THREE.Vector3();\n    return function (point) {\n      var directionDistance = v1.subVectors(point, this.origin).dot(this.direction); // point behind the ray\n\n      if (directionDistance < 0) {\n        return this.origin.distanceToSquared(point);\n      }\n\n      v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\n      return v1.distanceToSquared(point);\n    };\n  }(),\n  distanceSqToSegment: function () {\n    var segCenter = new THREE.Vector3();\n    var segDir = new THREE.Vector3();\n    var diff = new THREE.Vector3();\n    return function (v0, v1, optionalPointOnRay, optionalPointOnSegment) {\n      // from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\n      // It returns the min distance between the ray and the segment\n      // defined by v0 and v1\n      // It can also set two optional targets :\n      // - The closest point on the ray\n      // - The closest point on the segment\n      segCenter.copy(v0).add(v1).multiplyScalar(0.5);\n      segDir.copy(v1).sub(v0).normalize();\n      diff.copy(this.origin).sub(segCenter);\n      var segExtent = v0.distanceTo(v1) * 0.5;\n      var a01 = -this.direction.dot(segDir);\n      var b0 = diff.dot(this.direction);\n      var b1 = -diff.dot(segDir);\n      var c = diff.lengthSq();\n      var det = Math.abs(1 - a01 * a01);\n      var s0, s1, sqrDist, extDet;\n\n      if (det > 0) {\n        // The ray and segment are not parallel.\n        s0 = a01 * b1 - b0;\n        s1 = a01 * b0 - b1;\n        extDet = segExtent * det;\n\n        if (s0 >= 0) {\n          if (s1 >= -extDet) {\n            if (s1 <= extDet) {\n              // region 0\n              // Minimum at interior points of ray and segment.\n              var invDet = 1 / det;\n              s0 *= invDet;\n              s1 *= invDet;\n              sqrDist = s0 * (s0 + a01 * s1 + 2 * b0) + s1 * (a01 * s0 + s1 + 2 * b1) + c;\n            } else {\n              // region 1\n              s1 = segExtent;\n              s0 = Math.max(0, -(a01 * s1 + b0));\n              sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\n            }\n          } else {\n            // region 5\n            s1 = -segExtent;\n            s0 = Math.max(0, -(a01 * s1 + b0));\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\n          }\n        } else {\n          if (s1 <= -extDet) {\n            // region 4\n            s0 = Math.max(0, -(-a01 * segExtent + b0));\n            s1 = s0 > 0 ? -segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\n          } else if (s1 <= extDet) {\n            // region 3\n            s0 = 0;\n            s1 = Math.min(Math.max(-segExtent, -b1), segExtent);\n            sqrDist = s1 * (s1 + 2 * b1) + c;\n          } else {\n            // region 2\n            s0 = Math.max(0, -(a01 * segExtent + b0));\n            s1 = s0 > 0 ? segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\n          }\n        }\n      } else {\n        // Ray and segment are parallel.\n        s1 = a01 > 0 ? -segExtent : segExtent;\n        s0 = Math.max(0, -(a01 * s1 + b0));\n        sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\n      }\n\n      if (optionalPointOnRay) {\n        optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\n      }\n\n      if (optionalPointOnSegment) {\n        optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);\n      }\n\n      return sqrDist;\n    };\n  }(),\n  isIntersectionSphere: function (sphere) {\n    return this.distanceToPoint(sphere.center) <= sphere.radius;\n  },\n  intersectSphere: function () {\n    // from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\n    var v1 = new THREE.Vector3();\n    return function (sphere, optionalTarget) {\n      v1.subVectors(sphere.center, this.origin);\n      var tca = v1.dot(this.direction);\n      var d2 = v1.dot(v1) - tca * tca;\n      var radius2 = sphere.radius * sphere.radius;\n      if (d2 > radius2) return null;\n      var thc = Math.sqrt(radius2 - d2); // t0 = first intersect point - entrance on front of sphere\n\n      var t0 = tca - thc; // t1 = second intersect point - exit point on back of sphere\n\n      var t1 = tca + thc; // test to see if both t0 and t1 are behind the ray - if so, return null\n\n      if (t0 < 0 && t1 < 0) return null; // test to see if t0 is behind the ray:\n      // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\n      // in order to always return an intersect point that is in front of the ray.\n\n      if (t0 < 0) return this.at(t1, optionalTarget); // else t0 is in front of the ray, so return the first collision point scaled by t0\n\n      return this.at(t0, optionalTarget);\n    };\n  }(),\n  isIntersectionPlane: function (plane) {\n    // check if the ray lies on the plane first\n    var distToPoint = plane.distanceToPoint(this.origin);\n\n    if (distToPoint === 0) {\n      return true;\n    }\n\n    var denominator = plane.normal.dot(this.direction);\n\n    if (denominator * distToPoint < 0) {\n      return true;\n    } // ray origin is behind the plane (and is pointing behind it)\n\n\n    return false;\n  },\n  distanceToPlane: function (plane) {\n    var denominator = plane.normal.dot(this.direction);\n\n    if (denominator === 0) {\n      // line is coplanar, return origin\n      if (plane.distanceToPoint(this.origin) === 0) {\n        return 0;\n      } // Null is preferable to undefined since undefined means.... it is undefined\n\n\n      return null;\n    }\n\n    var t = -(this.origin.dot(plane.normal) + plane.constant) / denominator; // Return if the ray never intersects the plane\n\n    return t >= 0 ? t : null;\n  },\n  intersectPlane: function (plane, optionalTarget) {\n    var t = this.distanceToPlane(plane);\n\n    if (t === null) {\n      return null;\n    }\n\n    return this.at(t, optionalTarget);\n  },\n  isIntersectionBox: function () {\n    var v = new THREE.Vector3();\n    return function (box) {\n      return this.intersectBox(box, v) !== null;\n    };\n  }(),\n  intersectBox: function (box, optionalTarget) {\n    // http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\n    var tmin, tmax, tymin, tymax, tzmin, tzmax;\n    var invdirx = 1 / this.direction.x,\n        invdiry = 1 / this.direction.y,\n        invdirz = 1 / this.direction.z;\n    var origin = this.origin;\n\n    if (invdirx >= 0) {\n      tmin = (box.min.x - origin.x) * invdirx;\n      tmax = (box.max.x - origin.x) * invdirx;\n    } else {\n      tmin = (box.max.x - origin.x) * invdirx;\n      tmax = (box.min.x - origin.x) * invdirx;\n    }\n\n    if (invdiry >= 0) {\n      tymin = (box.min.y - origin.y) * invdiry;\n      tymax = (box.max.y - origin.y) * invdiry;\n    } else {\n      tymin = (box.max.y - origin.y) * invdiry;\n      tymax = (box.min.y - origin.y) * invdiry;\n    }\n\n    if (tmin > tymax || tymin > tmax) return null; // These lines also handle the case where tmin or tmax is NaN\n    // (result of 0 * Infinity). x !== x returns true if x is NaN\n\n    if (tymin > tmin || tmin !== tmin) tmin = tymin;\n    if (tymax < tmax || tmax !== tmax) tmax = tymax;\n\n    if (invdirz >= 0) {\n      tzmin = (box.min.z - origin.z) * invdirz;\n      tzmax = (box.max.z - origin.z) * invdirz;\n    } else {\n      tzmin = (box.max.z - origin.z) * invdirz;\n      tzmax = (box.min.z - origin.z) * invdirz;\n    }\n\n    if (tmin > tzmax || tzmin > tmax) return null;\n    if (tzmin > tmin || tmin !== tmin) tmin = tzmin;\n    if (tzmax < tmax || tmax !== tmax) tmax = tzmax; //return point closest to the ray (positive side)\n\n    if (tmax < 0) return null;\n    return this.at(tmin >= 0 ? tmin : tmax, optionalTarget);\n  },\n  intersectTriangle: function () {\n    // Compute the offset origin, edges, and normal.\n    var diff = new THREE.Vector3();\n    var edge1 = new THREE.Vector3();\n    var edge2 = new THREE.Vector3();\n    var normal = new THREE.Vector3();\n    return function (a, b, c, backfaceCulling, optionalTarget) {\n      // from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\n      edge1.subVectors(b, a);\n      edge2.subVectors(c, a);\n      normal.crossVectors(edge1, edge2); // Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\n      // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\n      //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\n      //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\n      //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\n\n      var DdN = this.direction.dot(normal);\n      var sign;\n\n      if (DdN > 0) {\n        if (backfaceCulling) return null;\n        sign = 1;\n      } else if (DdN < 0) {\n        sign = -1;\n        DdN = -DdN;\n      } else {\n        return null;\n      }\n\n      diff.subVectors(this.origin, a);\n      var DdQxE2 = sign * this.direction.dot(edge2.crossVectors(diff, edge2)); // b1 < 0, no intersection\n\n      if (DdQxE2 < 0) {\n        return null;\n      }\n\n      var DdE1xQ = sign * this.direction.dot(edge1.cross(diff)); // b2 < 0, no intersection\n\n      if (DdE1xQ < 0) {\n        return null;\n      } // b1+b2 > 1, no intersection\n\n\n      if (DdQxE2 + DdE1xQ > DdN) {\n        return null;\n      } // Line intersects triangle, check if ray does.\n\n\n      var QdN = -sign * diff.dot(normal); // t < 0, no intersection\n\n      if (QdN < 0) {\n        return null;\n      } // Ray intersects triangle.\n\n\n      return this.at(QdN / DdN, optionalTarget);\n    };\n  }(),\n  applyMatrix4: function (matrix4) {\n    this.direction.add(this.origin).applyMatrix4(matrix4);\n    this.origin.applyMatrix4(matrix4);\n    this.direction.sub(this.origin);\n    this.direction.normalize();\n    return this;\n  },\n  equals: function (ray) {\n    return ray.origin.equals(this.origin) && ray.direction.equals(this.direction);\n  }\n}; // File:src/math/Sphere.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.Sphere = function (center, radius) {\n  this.center = center !== undefined ? center : new THREE.Vector3();\n  this.radius = radius !== undefined ? radius : 0;\n};\n\nTHREE.Sphere.prototype = {\n  constructor: THREE.Sphere,\n  set: function (center, radius) {\n    this.center.copy(center);\n    this.radius = radius;\n    return this;\n  },\n  setFromPoints: function () {\n    var box = new THREE.Box3();\n    return function (points, optionalCenter) {\n      var center = this.center;\n\n      if (optionalCenter !== undefined) {\n        center.copy(optionalCenter);\n      } else {\n        box.setFromPoints(points).center(center);\n      }\n\n      var maxRadiusSq = 0;\n\n      for (var i = 0, il = points.length; i < il; i++) {\n        maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(points[i]));\n      }\n\n      this.radius = Math.sqrt(maxRadiusSq);\n      return this;\n    };\n  }(),\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (sphere) {\n    this.center.copy(sphere.center);\n    this.radius = sphere.radius;\n    return this;\n  },\n  empty: function () {\n    return this.radius <= 0;\n  },\n  containsPoint: function (point) {\n    return point.distanceToSquared(this.center) <= this.radius * this.radius;\n  },\n  distanceToPoint: function (point) {\n    return point.distanceTo(this.center) - this.radius;\n  },\n  intersectsSphere: function (sphere) {\n    var radiusSum = this.radius + sphere.radius;\n    return sphere.center.distanceToSquared(this.center) <= radiusSum * radiusSum;\n  },\n  clampPoint: function (point, optionalTarget) {\n    var deltaLengthSq = this.center.distanceToSquared(point);\n    var result = optionalTarget || new THREE.Vector3();\n    result.copy(point);\n\n    if (deltaLengthSq > this.radius * this.radius) {\n      result.sub(this.center).normalize();\n      result.multiplyScalar(this.radius).add(this.center);\n    }\n\n    return result;\n  },\n  getBoundingBox: function (optionalTarget) {\n    var box = optionalTarget || new THREE.Box3();\n    box.set(this.center, this.center);\n    box.expandByScalar(this.radius);\n    return box;\n  },\n  applyMatrix4: function (matrix) {\n    this.center.applyMatrix4(matrix);\n    this.radius = this.radius * matrix.getMaxScaleOnAxis();\n    return this;\n  },\n  translate: function (offset) {\n    this.center.add(offset);\n    return this;\n  },\n  equals: function (sphere) {\n    return sphere.center.equals(this.center) && sphere.radius === this.radius;\n  }\n}; // File:src/math/Frustum.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Frustum = function (p0, p1, p2, p3, p4, p5) {\n  this.planes = [p0 !== undefined ? p0 : new THREE.Plane(), p1 !== undefined ? p1 : new THREE.Plane(), p2 !== undefined ? p2 : new THREE.Plane(), p3 !== undefined ? p3 : new THREE.Plane(), p4 !== undefined ? p4 : new THREE.Plane(), p5 !== undefined ? p5 : new THREE.Plane()];\n};\n\nTHREE.Frustum.prototype = {\n  constructor: THREE.Frustum,\n  set: function (p0, p1, p2, p3, p4, p5) {\n    var planes = this.planes;\n    planes[0].copy(p0);\n    planes[1].copy(p1);\n    planes[2].copy(p2);\n    planes[3].copy(p3);\n    planes[4].copy(p4);\n    planes[5].copy(p5);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (frustum) {\n    var planes = this.planes;\n\n    for (var i = 0; i < 6; i++) {\n      planes[i].copy(frustum.planes[i]);\n    }\n\n    return this;\n  },\n  setFromMatrix: function (m) {\n    var planes = this.planes;\n    var me = m.elements;\n    var me0 = me[0],\n        me1 = me[1],\n        me2 = me[2],\n        me3 = me[3];\n    var me4 = me[4],\n        me5 = me[5],\n        me6 = me[6],\n        me7 = me[7];\n    var me8 = me[8],\n        me9 = me[9],\n        me10 = me[10],\n        me11 = me[11];\n    var me12 = me[12],\n        me13 = me[13],\n        me14 = me[14],\n        me15 = me[15];\n    planes[0].setComponents(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\n    planes[1].setComponents(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\n    planes[2].setComponents(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\n    planes[3].setComponents(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\n    planes[4].setComponents(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\n    planes[5].setComponents(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\n    return this;\n  },\n  intersectsObject: function () {\n    var sphere = new THREE.Sphere();\n    return function (object) {\n      var geometry = object.geometry;\n      if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\n      sphere.copy(geometry.boundingSphere);\n      sphere.applyMatrix4(object.matrixWorld);\n      return this.intersectsSphere(sphere);\n    };\n  }(),\n  intersectsSphere: function (sphere) {\n    var planes = this.planes;\n    var center = sphere.center;\n    var negRadius = -sphere.radius;\n\n    for (var i = 0; i < 6; i++) {\n      var distance = planes[i].distanceToPoint(center);\n\n      if (distance < negRadius) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  intersectsBox: function () {\n    var p1 = new THREE.Vector3(),\n        p2 = new THREE.Vector3();\n    return function (box) {\n      var planes = this.planes;\n\n      for (var i = 0; i < 6; i++) {\n        var plane = planes[i];\n        p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\n        p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\n        p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\n        p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\n        p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\n        p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\n        var d1 = plane.distanceToPoint(p1);\n        var d2 = plane.distanceToPoint(p2); // if both outside plane, no intersection\n\n        if (d1 < 0 && d2 < 0) {\n          return false;\n        }\n      }\n\n      return true;\n    };\n  }(),\n  containsPoint: function (point) {\n    var planes = this.planes;\n\n    for (var i = 0; i < 6; i++) {\n      if (planes[i].distanceToPoint(point) < 0) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n}; // File:src/math/Plane.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Plane = function (normal, constant) {\n  this.normal = normal !== undefined ? normal : new THREE.Vector3(1, 0, 0);\n  this.constant = constant !== undefined ? constant : 0;\n};\n\nTHREE.Plane.prototype = {\n  constructor: THREE.Plane,\n  set: function (normal, constant) {\n    this.normal.copy(normal);\n    this.constant = constant;\n    return this;\n  },\n  setComponents: function (x, y, z, w) {\n    this.normal.set(x, y, z);\n    this.constant = w;\n    return this;\n  },\n  setFromNormalAndCoplanarPoint: function (normal, point) {\n    this.normal.copy(normal);\n    this.constant = -point.dot(this.normal); // must be this.normal, not normal, as this.normal is normalized\n\n    return this;\n  },\n  setFromCoplanarPoints: function () {\n    var v1 = new THREE.Vector3();\n    var v2 = new THREE.Vector3();\n    return function (a, b, c) {\n      var normal = v1.subVectors(c, b).cross(v2.subVectors(a, b)).normalize(); // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\n\n      this.setFromNormalAndCoplanarPoint(normal, a);\n      return this;\n    };\n  }(),\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (plane) {\n    this.normal.copy(plane.normal);\n    this.constant = plane.constant;\n    return this;\n  },\n  normalize: function () {\n    // Note: will lead to a divide by zero if the plane is invalid.\n    var inverseNormalLength = 1.0 / this.normal.length();\n    this.normal.multiplyScalar(inverseNormalLength);\n    this.constant *= inverseNormalLength;\n    return this;\n  },\n  negate: function () {\n    this.constant *= -1;\n    this.normal.negate();\n    return this;\n  },\n  distanceToPoint: function (point) {\n    return this.normal.dot(point) + this.constant;\n  },\n  distanceToSphere: function (sphere) {\n    return this.distanceToPoint(sphere.center) - sphere.radius;\n  },\n  projectPoint: function (point, optionalTarget) {\n    return this.orthoPoint(point, optionalTarget).sub(point).negate();\n  },\n  orthoPoint: function (point, optionalTarget) {\n    var perpendicularMagnitude = this.distanceToPoint(point);\n    var result = optionalTarget || new THREE.Vector3();\n    return result.copy(this.normal).multiplyScalar(perpendicularMagnitude);\n  },\n  isIntersectionLine: function (line) {\n    // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\n    var startSign = this.distanceToPoint(line.start);\n    var endSign = this.distanceToPoint(line.end);\n    return startSign < 0 && endSign > 0 || endSign < 0 && startSign > 0;\n  },\n  intersectLine: function () {\n    var v1 = new THREE.Vector3();\n    return function (line, optionalTarget) {\n      var result = optionalTarget || new THREE.Vector3();\n      var direction = line.delta(v1);\n      var denominator = this.normal.dot(direction);\n\n      if (denominator === 0) {\n        // line is coplanar, return origin\n        if (this.distanceToPoint(line.start) === 0) {\n          return result.copy(line.start);\n        } // Unsure if this is the correct method to handle this case.\n\n\n        return undefined;\n      }\n\n      var t = -(line.start.dot(this.normal) + this.constant) / denominator;\n\n      if (t < 0 || t > 1) {\n        return undefined;\n      }\n\n      return result.copy(direction).multiplyScalar(t).add(line.start);\n    };\n  }(),\n  coplanarPoint: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.copy(this.normal).multiplyScalar(-this.constant);\n  },\n  applyMatrix4: function () {\n    var v1 = new THREE.Vector3();\n    var v2 = new THREE.Vector3();\n    var m1 = new THREE.Matrix3();\n    return function (matrix, optionalNormalMatrix) {\n      // compute new normal based on theory here:\n      // http://www.songho.ca/opengl/gl_normaltransform.html\n      var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix(matrix);\n      var newNormal = v1.copy(this.normal).applyMatrix3(normalMatrix);\n      var newCoplanarPoint = this.coplanarPoint(v2);\n      newCoplanarPoint.applyMatrix4(matrix);\n      this.setFromNormalAndCoplanarPoint(newNormal, newCoplanarPoint);\n      return this;\n    };\n  }(),\n  translate: function (offset) {\n    this.constant = this.constant - offset.dot(this.normal);\n    return this;\n  },\n  equals: function (plane) {\n    return plane.normal.equals(this.normal) && plane.constant === this.constant;\n  }\n}; // File:src/math/Math.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.Math = {\n  generateUUID: function () {\n    // http://www.broofa.com/Tools/Math.uuid.htm\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\n    var uuid = new Array(36);\n    var rnd = 0,\n        r;\n    return function () {\n      for (var i = 0; i < 36; i++) {\n        if (i === 8 || i === 13 || i === 18 || i === 23) {\n          uuid[i] = '-';\n        } else if (i === 14) {\n          uuid[i] = '4';\n        } else {\n          if (rnd <= 0x02) rnd = 0x2000000 + Math.random() * 0x1000000 | 0;\n          r = rnd & 0xf;\n          rnd = rnd >> 4;\n          uuid[i] = chars[i === 19 ? r & 0x3 | 0x8 : r];\n        }\n      }\n\n      return uuid.join('');\n    };\n  }(),\n  // Clamp value to range <a, b>\n  clamp: function (x, a, b) {\n    return x < a ? a : x > b ? b : x;\n  },\n  // Clamp value to range <a, inf)\n  clampBottom: function (x, a) {\n    return x < a ? a : x;\n  },\n  // compute euclidian modulo of m % n\n  // https://en.wikipedia.org/wiki/Modulo_operation\n  euclideanModulo: function (n, m) {\n    return (n % m + m) % m;\n  },\n  // Linear mapping from range <a1, a2> to range <b1, b2>\n  mapLinear: function (x, a1, a2, b1, b2) {\n    return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\n  },\n  // http://en.wikipedia.org/wiki/Smoothstep\n  smoothstep: function (x, min, max) {\n    if (x <= min) return 0;\n    if (x >= max) return 1;\n    x = (x - min) / (max - min);\n    return x * x * (3 - 2 * x);\n  },\n  smootherstep: function (x, min, max) {\n    if (x <= min) return 0;\n    if (x >= max) return 1;\n    x = (x - min) / (max - min);\n    return x * x * x * (x * (x * 6 - 15) + 10);\n  },\n  // Random float from <0, 1> with 16 bits of randomness\n  // (standard Math.random() creates repetitive patterns when applied over larger space)\n  random16: function () {\n    return (65280 * Math.random() + 255 * Math.random()) / 65535;\n  },\n  // Random integer from <low, high> interval\n  randInt: function (low, high) {\n    return low + Math.floor(Math.random() * (high - low + 1));\n  },\n  // Random float from <low, high> interval\n  randFloat: function (low, high) {\n    return low + Math.random() * (high - low);\n  },\n  // Random float from <-range/2, range/2> interval\n  randFloatSpread: function (range) {\n    return range * (0.5 - Math.random());\n  },\n  degToRad: function () {\n    var degreeToRadiansFactor = Math.PI / 180;\n    return function (degrees) {\n      return degrees * degreeToRadiansFactor;\n    };\n  }(),\n  radToDeg: function () {\n    var radianToDegreesFactor = 180 / Math.PI;\n    return function (radians) {\n      return radians * radianToDegreesFactor;\n    };\n  }(),\n  isPowerOfTwo: function (value) {\n    return (value & value - 1) === 0 && value !== 0;\n  },\n  nextPowerOfTwo: function (value) {\n    value--;\n    value |= value >> 1;\n    value |= value >> 2;\n    value |= value >> 4;\n    value |= value >> 8;\n    value |= value >> 16;\n    value++;\n    return value;\n  }\n}; // File:src/math/Spline.js\n\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Spline = function (points) {\n  this.points = points;\n  var c = [],\n      v3 = {\n    x: 0,\n    y: 0,\n    z: 0\n  },\n      point,\n      intPoint,\n      weight,\n      w2,\n      w3,\n      pa,\n      pb,\n      pc,\n      pd;\n\n  this.initFromArray = function (a) {\n    this.points = [];\n\n    for (var i = 0; i < a.length; i++) {\n      this.points[i] = {\n        x: a[i][0],\n        y: a[i][1],\n        z: a[i][2]\n      };\n    }\n  };\n\n  this.getPoint = function (k) {\n    point = (this.points.length - 1) * k;\n    intPoint = Math.floor(point);\n    weight = point - intPoint;\n    c[0] = intPoint === 0 ? intPoint : intPoint - 1;\n    c[1] = intPoint;\n    c[2] = intPoint > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\n    c[3] = intPoint > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\n    pa = this.points[c[0]];\n    pb = this.points[c[1]];\n    pc = this.points[c[2]];\n    pd = this.points[c[3]];\n    w2 = weight * weight;\n    w3 = weight * w2;\n    v3.x = interpolate(pa.x, pb.x, pc.x, pd.x, weight, w2, w3);\n    v3.y = interpolate(pa.y, pb.y, pc.y, pd.y, weight, w2, w3);\n    v3.z = interpolate(pa.z, pb.z, pc.z, pd.z, weight, w2, w3);\n    return v3;\n  };\n\n  this.getControlPointsArray = function () {\n    var i,\n        p,\n        l = this.points.length,\n        coords = [];\n\n    for (i = 0; i < l; i++) {\n      p = this.points[i];\n      coords[i] = [p.x, p.y, p.z];\n    }\n\n    return coords;\n  }; // approximate length by summing linear segments\n\n\n  this.getLength = function (nSubDivisions) {\n    var i,\n        index,\n        nSamples,\n        position,\n        point = 0,\n        intPoint = 0,\n        oldIntPoint = 0,\n        oldPosition = new THREE.Vector3(),\n        tmpVec = new THREE.Vector3(),\n        chunkLengths = [],\n        totalLength = 0; // first point has 0 length\n\n    chunkLengths[0] = 0;\n    if (!nSubDivisions) nSubDivisions = 100;\n    nSamples = this.points.length * nSubDivisions;\n    oldPosition.copy(this.points[0]);\n\n    for (i = 1; i < nSamples; i++) {\n      index = i / nSamples;\n      position = this.getPoint(index);\n      tmpVec.copy(position);\n      totalLength += tmpVec.distanceTo(oldPosition);\n      oldPosition.copy(position);\n      point = (this.points.length - 1) * index;\n      intPoint = Math.floor(point);\n\n      if (intPoint !== oldIntPoint) {\n        chunkLengths[intPoint] = totalLength;\n        oldIntPoint = intPoint;\n      }\n    } // last point ends with total length\n\n\n    chunkLengths[chunkLengths.length] = totalLength;\n    return {\n      chunks: chunkLengths,\n      total: totalLength\n    };\n  };\n\n  this.reparametrizeByArcLength = function (samplingCoef) {\n    var i,\n        j,\n        index,\n        indexCurrent,\n        indexNext,\n        realDistance,\n        sampling,\n        position,\n        newpoints = [],\n        tmpVec = new THREE.Vector3(),\n        sl = this.getLength();\n    newpoints.push(tmpVec.copy(this.points[0]).clone());\n\n    for (i = 1; i < this.points.length; i++) {\n      //tmpVec.copy( this.points[ i - 1 ] );\n      //linearDistance = tmpVec.distanceTo( this.points[ i ] );\n      realDistance = sl.chunks[i] - sl.chunks[i - 1];\n      sampling = Math.ceil(samplingCoef * realDistance / sl.total);\n      indexCurrent = (i - 1) / (this.points.length - 1);\n      indexNext = i / (this.points.length - 1);\n\n      for (j = 1; j < sampling - 1; j++) {\n        index = indexCurrent + j * (1 / sampling) * (indexNext - indexCurrent);\n        position = this.getPoint(index);\n        newpoints.push(tmpVec.copy(position).clone());\n      }\n\n      newpoints.push(tmpVec.copy(this.points[i]).clone());\n    }\n\n    this.points = newpoints;\n  }; // Catmull-Rom\n\n\n  function interpolate(p0, p1, p2, p3, t, t2, t3) {\n    var v0 = (p2 - p0) * 0.5,\n        v1 = (p3 - p1) * 0.5;\n    return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\n  }\n}; // File:src/math/Triangle.js\n\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.Triangle = function (a, b, c) {\n  this.a = a !== undefined ? a : new THREE.Vector3();\n  this.b = b !== undefined ? b : new THREE.Vector3();\n  this.c = c !== undefined ? c : new THREE.Vector3();\n};\n\nTHREE.Triangle.normal = function () {\n  var v0 = new THREE.Vector3();\n  return function (a, b, c, optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    result.subVectors(c, b);\n    v0.subVectors(a, b);\n    result.cross(v0);\n    var resultLengthSq = result.lengthSq();\n\n    if (resultLengthSq > 0) {\n      return result.multiplyScalar(1 / Math.sqrt(resultLengthSq));\n    }\n\n    return result.set(0, 0, 0);\n  };\n}(); // static/instance method to calculate barycentric coordinates\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\n\n\nTHREE.Triangle.barycoordFromPoint = function () {\n  var v0 = new THREE.Vector3();\n  var v1 = new THREE.Vector3();\n  var v2 = new THREE.Vector3();\n  return function (point, a, b, c, optionalTarget) {\n    v0.subVectors(c, a);\n    v1.subVectors(b, a);\n    v2.subVectors(point, a);\n    var dot00 = v0.dot(v0);\n    var dot01 = v0.dot(v1);\n    var dot02 = v0.dot(v2);\n    var dot11 = v1.dot(v1);\n    var dot12 = v1.dot(v2);\n    var denom = dot00 * dot11 - dot01 * dot01;\n    var result = optionalTarget || new THREE.Vector3(); // collinear or singular triangle\n\n    if (denom === 0) {\n      // arbitrary location outside of triangle?\n      // not sure if this is the best idea, maybe should be returning undefined\n      return result.set(-2, -1, -1);\n    }\n\n    var invDenom = 1 / denom;\n    var u = (dot11 * dot02 - dot01 * dot12) * invDenom;\n    var v = (dot00 * dot12 - dot01 * dot02) * invDenom; // barycentric coordinates must always sum to 1\n\n    return result.set(1 - u - v, v, u);\n  };\n}();\n\nTHREE.Triangle.containsPoint = function () {\n  var v1 = new THREE.Vector3();\n  return function (point, a, b, c) {\n    var result = THREE.Triangle.barycoordFromPoint(point, a, b, c, v1);\n    return result.x >= 0 && result.y >= 0 && result.x + result.y <= 1;\n  };\n}();\n\nTHREE.Triangle.prototype = {\n  constructor: THREE.Triangle,\n  set: function (a, b, c) {\n    this.a.copy(a);\n    this.b.copy(b);\n    this.c.copy(c);\n    return this;\n  },\n  setFromPointsAndIndices: function (points, i0, i1, i2) {\n    this.a.copy(points[i0]);\n    this.b.copy(points[i1]);\n    this.c.copy(points[i2]);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (triangle) {\n    this.a.copy(triangle.a);\n    this.b.copy(triangle.b);\n    this.c.copy(triangle.c);\n    return this;\n  },\n  area: function () {\n    var v0 = new THREE.Vector3();\n    var v1 = new THREE.Vector3();\n    return function () {\n      v0.subVectors(this.c, this.b);\n      v1.subVectors(this.a, this.b);\n      return v0.cross(v1).length() * 0.5;\n    };\n  }(),\n  midpoint: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    return result.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);\n  },\n  normal: function (optionalTarget) {\n    return THREE.Triangle.normal(this.a, this.b, this.c, optionalTarget);\n  },\n  plane: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Plane();\n    return result.setFromCoplanarPoints(this.a, this.b, this.c);\n  },\n  barycoordFromPoint: function (point, optionalTarget) {\n    return THREE.Triangle.barycoordFromPoint(point, this.a, this.b, this.c, optionalTarget);\n  },\n  containsPoint: function (point) {\n    return THREE.Triangle.containsPoint(point, this.a, this.b, this.c);\n  },\n  equals: function (triangle) {\n    return triangle.a.equals(this.a) && triangle.b.equals(this.b) && triangle.c.equals(this.c);\n  }\n}; // File:src/core/Clock.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Clock = function (autoStart) {\n  this.autoStart = autoStart !== undefined ? autoStart : true;\n  this.startTime = 0;\n  this.oldTime = 0;\n  this.elapsedTime = 0;\n  this.running = false;\n};\n\nTHREE.Clock.prototype = {\n  constructor: THREE.Clock,\n  start: function () {\n    this.startTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\n    this.oldTime = this.startTime;\n    this.running = true;\n  },\n  stop: function () {\n    this.getElapsedTime();\n    this.running = false;\n  },\n  getElapsedTime: function () {\n    this.getDelta();\n    return this.elapsedTime;\n  },\n  getDelta: function () {\n    var diff = 0;\n\n    if (this.autoStart && !this.running) {\n      this.start();\n    }\n\n    if (this.running) {\n      var newTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\n      diff = 0.001 * (newTime - this.oldTime);\n      this.oldTime = newTime;\n      this.elapsedTime += diff;\n    }\n\n    return diff;\n  }\n}; // File:src/core/EventDispatcher.js\n\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\n\nTHREE.EventDispatcher = function () {};\n\nTHREE.EventDispatcher.prototype = {\n  constructor: THREE.EventDispatcher,\n  apply: function (object) {\n    object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\n    object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\n    object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\n    object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\n  },\n  addEventListener: function (type, listener) {\n    if (this._listeners === undefined) this._listeners = {};\n    var listeners = this._listeners;\n\n    if (listeners[type] === undefined) {\n      listeners[type] = [];\n    }\n\n    if (listeners[type].indexOf(listener) === -1) {\n      listeners[type].push(listener);\n    }\n  },\n  hasEventListener: function (type, listener) {\n    if (this._listeners === undefined) return false;\n    var listeners = this._listeners;\n\n    if (listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1) {\n      return true;\n    }\n\n    return false;\n  },\n  removeEventListener: function (type, listener) {\n    if (this._listeners === undefined) return;\n    var listeners = this._listeners;\n    var listenerArray = listeners[type];\n\n    if (listenerArray !== undefined) {\n      var index = listenerArray.indexOf(listener);\n\n      if (index !== -1) {\n        listenerArray.splice(index, 1);\n      }\n    }\n  },\n  dispatchEvent: function (event) {\n    if (this._listeners === undefined) return;\n    var listeners = this._listeners;\n    var listenerArray = listeners[event.type];\n\n    if (listenerArray !== undefined) {\n      event.target = this;\n      var array = [];\n      var length = listenerArray.length;\n\n      for (var i = 0; i < length; i++) {\n        array[i] = listenerArray[i];\n      }\n\n      for (var i = 0; i < length; i++) {\n        array[i].call(this, event);\n      }\n    }\n  }\n}; // File:src/core/Raycaster.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\n\n(function (THREE) {\n  THREE.Raycaster = function (origin, direction, near, far) {\n    this.ray = new THREE.Ray(origin, direction); // direction is assumed to be normalized (for accurate distance calculations)\n\n    this.near = near || 0;\n    this.far = far || Infinity;\n    this.params = {\n      Mesh: {},\n      Line: {},\n      LOD: {},\n      Points: {\n        threshold: 1\n      },\n      Sprite: {}\n    };\n    Object.defineProperties(this.params, {\n      PointCloud: {\n        get: function () {\n          console.warn('THREE.Raycaster: params.PointCloud has been renamed to params.Points.');\n          return this.Points;\n        }\n      }\n    });\n  };\n\n  function descSort(a, b) {\n    return a.distance - b.distance;\n  }\n\n  var intersectObject = function (object, raycaster, intersects, recursive) {\n    if (object.visible === false) return;\n    object.raycast(raycaster, intersects);\n\n    if (recursive === true) {\n      var children = object.children;\n\n      for (var i = 0, l = children.length; i < l; i++) {\n        intersectObject(children[i], raycaster, intersects, true);\n      }\n    }\n  }; //\n\n\n  THREE.Raycaster.prototype = {\n    constructor: THREE.Raycaster,\n    linePrecision: 1,\n    set: function (origin, direction) {\n      // direction is assumed to be normalized (for accurate distance calculations)\n      this.ray.set(origin, direction);\n    },\n    setFromCamera: function (coords, camera) {\n      if (camera instanceof THREE.PerspectiveCamera) {\n        this.ray.origin.setFromMatrixPosition(camera.matrixWorld);\n        this.ray.direction.set(coords.x, coords.y, 0.5).unproject(camera).sub(this.ray.origin).normalize();\n      } else if (camera instanceof THREE.OrthographicCamera) {\n        this.ray.origin.set(coords.x, coords.y, -1).unproject(camera);\n        this.ray.direction.set(0, 0, -1).transformDirection(camera.matrixWorld);\n      } else {\n        console.error('THREE.Raycaster: Unsupported camera type.');\n      }\n    },\n    intersectObject: function (object, recursive) {\n      var intersects = [];\n      intersectObject(object, this, intersects, recursive);\n      intersects.sort(descSort);\n      return intersects;\n    },\n    intersectObjects: function (objects, recursive) {\n      var intersects = [];\n\n      if (Array.isArray(objects) === false) {\n        console.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');\n        return intersects;\n      }\n\n      for (var i = 0, l = objects.length; i < l; i++) {\n        intersectObject(objects[i], this, intersects, recursive);\n      }\n\n      intersects.sort(descSort);\n      return intersects;\n    }\n  };\n})(THREE); // File:src/core/Object3D.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author elephantatwork / www.elephantatwork.ch\r\n */\n\n\nTHREE.Object3D = function () {\n  Object.defineProperty(this, 'id', {\n    value: THREE.Object3DIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.type = 'Object3D';\n  this.parent = null;\n  this.children = [];\n  this.up = THREE.Object3D.DefaultUp.clone();\n  var position = new THREE.Vector3();\n  var rotation = new THREE.Euler();\n  var quaternion = new THREE.Quaternion();\n  var scale = new THREE.Vector3(1, 1, 1);\n\n  var onRotationChange = function () {\n    quaternion.setFromEuler(rotation, false);\n  };\n\n  var onQuaternionChange = function () {\n    rotation.setFromQuaternion(quaternion, undefined, false);\n  };\n\n  rotation.onChange(onRotationChange);\n  quaternion.onChange(onQuaternionChange);\n  Object.defineProperties(this, {\n    position: {\n      enumerable: true,\n      value: position\n    },\n    rotation: {\n      enumerable: true,\n      value: rotation\n    },\n    quaternion: {\n      enumerable: true,\n      value: quaternion\n    },\n    scale: {\n      enumerable: true,\n      value: scale\n    },\n    modelViewMatrix: {\n      value: new THREE.Matrix4()\n    },\n    normalMatrix: {\n      value: new THREE.Matrix3()\n    }\n  });\n  this.rotationAutoUpdate = true;\n  this.matrix = new THREE.Matrix4();\n  this.matrixWorld = new THREE.Matrix4();\n  this.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\n  this.matrixWorldNeedsUpdate = false;\n  this.visible = true;\n  this.castShadow = false;\n  this.receiveShadow = false;\n  this.frustumCulled = true;\n  this.renderOrder = 0;\n  this.userData = {};\n};\n\nTHREE.Object3D.DefaultUp = new THREE.Vector3(0, 1, 0);\nTHREE.Object3D.DefaultMatrixAutoUpdate = true;\nTHREE.Object3D.prototype = {\n  constructor: THREE.Object3D,\n\n  get eulerOrder() {\n    console.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\n    return this.rotation.order;\n  },\n\n  set eulerOrder(value) {\n    console.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\n    this.rotation.order = value;\n  },\n\n  get useQuaternion() {\n    console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\n  },\n\n  set useQuaternion(value) {\n    console.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\n  },\n\n  set renderDepth(value) {\n    console.warn('THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.');\n  },\n\n  applyMatrix: function (matrix) {\n    this.matrix.multiplyMatrices(matrix, this.matrix);\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\n  },\n  setRotationFromAxisAngle: function (axis, angle) {\n    // assumes axis is normalized\n    this.quaternion.setFromAxisAngle(axis, angle);\n  },\n  setRotationFromEuler: function (euler) {\n    this.quaternion.setFromEuler(euler, true);\n  },\n  setRotationFromMatrix: function (m) {\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n    this.quaternion.setFromRotationMatrix(m);\n  },\n  setRotationFromQuaternion: function (q) {\n    // assumes q is normalized\n    this.quaternion.copy(q);\n  },\n  rotateOnAxis: function () {\n    // rotate object on axis in object space\n    // axis is assumed to be normalized\n    var q1 = new THREE.Quaternion();\n    return function (axis, angle) {\n      q1.setFromAxisAngle(axis, angle);\n      this.quaternion.multiply(q1);\n      return this;\n    };\n  }(),\n  rotateX: function () {\n    var v1 = new THREE.Vector3(1, 0, 0);\n    return function (angle) {\n      return this.rotateOnAxis(v1, angle);\n    };\n  }(),\n  rotateY: function () {\n    var v1 = new THREE.Vector3(0, 1, 0);\n    return function (angle) {\n      return this.rotateOnAxis(v1, angle);\n    };\n  }(),\n  rotateZ: function () {\n    var v1 = new THREE.Vector3(0, 0, 1);\n    return function (angle) {\n      return this.rotateOnAxis(v1, angle);\n    };\n  }(),\n  translateOnAxis: function () {\n    // translate object by distance along axis in object space\n    // axis is assumed to be normalized\n    var v1 = new THREE.Vector3();\n    return function (axis, distance) {\n      v1.copy(axis).applyQuaternion(this.quaternion);\n      this.position.add(v1.multiplyScalar(distance));\n      return this;\n    };\n  }(),\n  translate: function (distance, axis) {\n    console.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');\n    return this.translateOnAxis(axis, distance);\n  },\n  translateX: function () {\n    var v1 = new THREE.Vector3(1, 0, 0);\n    return function (distance) {\n      return this.translateOnAxis(v1, distance);\n    };\n  }(),\n  translateY: function () {\n    var v1 = new THREE.Vector3(0, 1, 0);\n    return function (distance) {\n      return this.translateOnAxis(v1, distance);\n    };\n  }(),\n  translateZ: function () {\n    var v1 = new THREE.Vector3(0, 0, 1);\n    return function (distance) {\n      return this.translateOnAxis(v1, distance);\n    };\n  }(),\n  localToWorld: function (vector) {\n    return vector.applyMatrix4(this.matrixWorld);\n  },\n  worldToLocal: function () {\n    var m1 = new THREE.Matrix4();\n    return function (vector) {\n      return vector.applyMatrix4(m1.getInverse(this.matrixWorld));\n    };\n  }(),\n  lookAt: function () {\n    // This routine does not support objects with rotated and/or translated parent(s)\n    var m1 = new THREE.Matrix4();\n    return function (vector) {\n      m1.lookAt(vector, this.position, this.up);\n      this.quaternion.setFromRotationMatrix(m1);\n    };\n  }(),\n  add: function (object) {\n    if (arguments.length > 1) {\n      for (var i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n\n      return this;\n    }\n\n    if (object === this) {\n      console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\", object);\n      return this;\n    }\n\n    if (object instanceof THREE.Object3D) {\n      if (object.parent !== null) {\n        object.parent.remove(object);\n      }\n\n      object.parent = this;\n      object.dispatchEvent({\n        type: 'added'\n      });\n      this.children.push(object);\n    } else {\n      console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object);\n    }\n\n    return this;\n  },\n  remove: function (object) {\n    if (arguments.length > 1) {\n      for (var i = 0; i < arguments.length; i++) {\n        this.remove(arguments[i]);\n      }\n    }\n\n    var index = this.children.indexOf(object);\n\n    if (index !== -1) {\n      object.parent = null;\n      object.dispatchEvent({\n        type: 'removed'\n      });\n      this.children.splice(index, 1);\n    }\n  },\n  getChildByName: function (name) {\n    console.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');\n    return this.getObjectByName(name);\n  },\n  getObjectById: function (id) {\n    return this.getObjectByProperty('id', id);\n  },\n  getObjectByName: function (name) {\n    return this.getObjectByProperty('name', name);\n  },\n  getObjectByProperty: function (name, value) {\n    if (this[name] === value) return this;\n\n    for (var i = 0, l = this.children.length; i < l; i++) {\n      var child = this.children[i];\n      var object = child.getObjectByProperty(name, value);\n\n      if (object !== undefined) {\n        return object;\n      }\n    }\n\n    return undefined;\n  },\n  getWorldPosition: function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    this.updateMatrixWorld(true);\n    return result.setFromMatrixPosition(this.matrixWorld);\n  },\n  getWorldQuaternion: function () {\n    var position = new THREE.Vector3();\n    var scale = new THREE.Vector3();\n    return function (optionalTarget) {\n      var result = optionalTarget || new THREE.Quaternion();\n      this.updateMatrixWorld(true);\n      this.matrixWorld.decompose(position, result, scale);\n      return result;\n    };\n  }(),\n  getWorldRotation: function () {\n    var quaternion = new THREE.Quaternion();\n    return function (optionalTarget) {\n      var result = optionalTarget || new THREE.Euler();\n      this.getWorldQuaternion(quaternion);\n      return result.setFromQuaternion(quaternion, this.rotation.order, false);\n    };\n  }(),\n  getWorldScale: function () {\n    var position = new THREE.Vector3();\n    var quaternion = new THREE.Quaternion();\n    return function (optionalTarget) {\n      var result = optionalTarget || new THREE.Vector3();\n      this.updateMatrixWorld(true);\n      this.matrixWorld.decompose(position, quaternion, result);\n      return result;\n    };\n  }(),\n  getWorldDirection: function () {\n    var quaternion = new THREE.Quaternion();\n    return function (optionalTarget) {\n      var result = optionalTarget || new THREE.Vector3();\n      this.getWorldQuaternion(quaternion);\n      return result.set(0, 0, 1).applyQuaternion(quaternion);\n    };\n  }(),\n  raycast: function () {},\n  traverse: function (callback) {\n    callback(this);\n    var children = this.children;\n\n    for (var i = 0, l = children.length; i < l; i++) {\n      children[i].traverse(callback);\n    }\n  },\n  traverseVisible: function (callback) {\n    if (this.visible === false) return;\n    callback(this);\n    var children = this.children;\n\n    for (var i = 0, l = children.length; i < l; i++) {\n      children[i].traverseVisible(callback);\n    }\n  },\n  traverseAncestors: function (callback) {\n    var parent = this.parent;\n\n    if (parent !== null) {\n      callback(parent);\n      parent.traverseAncestors(callback);\n    }\n  },\n  updateMatrix: function () {\n    this.matrix.compose(this.position, this.quaternion, this.scale);\n    this.matrixWorldNeedsUpdate = true;\n  },\n  updateMatrixWorld: function (force) {\n    if (this.matrixAutoUpdate === true) this.updateMatrix();\n\n    if (this.matrixWorldNeedsUpdate === true || force === true) {\n      if (this.parent === null) {\n        this.matrixWorld.copy(this.matrix);\n      } else {\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\n      }\n\n      this.matrixWorldNeedsUpdate = false;\n      force = true;\n    } // update children\n\n\n    for (var i = 0, l = this.children.length; i < l; i++) {\n      this.children[i].updateMatrixWorld(force);\n    }\n  },\n  toJSON: function (meta) {\n    var isRootObject = meta === undefined;\n    var data = {}; // meta is a hash used to collect geometries, materials.\n    // not providing it implies that this is the root object\n    // being serialized.\n\n    if (isRootObject) {\n      // initialize meta obj\n      meta = {\n        geometries: {},\n        materials: {},\n        textures: {},\n        images: {}\n      };\n      data.metadata = {\n        version: 4.4,\n        type: 'Object',\n        generator: 'Object3D.toJSON'\n      };\n    } // standard Object3D serialization\n\n\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') data.name = this.name;\n    if (JSON.stringify(this.userData) !== '{}') data.userData = this.userData;\n    if (this.visible !== true) data.visible = this.visible;\n    data.matrix = this.matrix.toArray();\n\n    if (this.children.length > 0) {\n      data.children = [];\n\n      for (var i = 0; i < this.children.length; i++) {\n        data.children.push(this.children[i].toJSON(meta).object);\n      }\n    }\n\n    var output = {};\n\n    if (isRootObject) {\n      var geometries = extractFromCache(meta.geometries);\n      var materials = extractFromCache(meta.materials);\n      var textures = extractFromCache(meta.textures);\n      var images = extractFromCache(meta.images);\n      if (geometries.length > 0) output.geometries = geometries;\n      if (materials.length > 0) output.materials = materials;\n      if (textures.length > 0) output.textures = textures;\n      if (images.length > 0) output.images = images;\n    }\n\n    output.object = data;\n    return output; // extract data from the cache hash\n    // remove metadata on each item\n    // and return as array\n\n    function extractFromCache(cache) {\n      var values = [];\n\n      for (var key in cache) {\n        var data = cache[key];\n        delete data.metadata;\n        values.push(data);\n      }\n\n      return values;\n    }\n  },\n  clone: function (recursive) {\n    return new this.constructor().copy(this, recursive);\n  },\n  copy: function (source, recursive) {\n    if (recursive === undefined) recursive = true;\n    this.name = source.name;\n    this.up.copy(source.up);\n    this.position.copy(source.position);\n    this.quaternion.copy(source.quaternion);\n    this.scale.copy(source.scale);\n    this.rotationAutoUpdate = source.rotationAutoUpdate;\n    this.matrix.copy(source.matrix);\n    this.matrixWorld.copy(source.matrixWorld);\n    this.matrixAutoUpdate = source.matrixAutoUpdate;\n    this.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\n    this.visible = source.visible;\n    this.castShadow = source.castShadow;\n    this.receiveShadow = source.receiveShadow;\n    this.frustumCulled = source.frustumCulled;\n    this.renderOrder = source.renderOrder;\n    this.userData = JSON.parse(JSON.stringify(source.userData));\n\n    if (recursive === true) {\n      for (var i = 0; i < source.children.length; i++) {\n        var child = source.children[i];\n        this.add(child.clone());\n      }\n    }\n\n    return this;\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);\nTHREE.Object3DIdCount = 0; // File:src/core/Face3.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Face3 = function (a, b, c, normal, color, materialIndex) {\n  this.a = a;\n  this.b = b;\n  this.c = c;\n  this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\n  this.vertexNormals = Array.isArray(normal) ? normal : [];\n  this.color = color instanceof THREE.Color ? color : new THREE.Color();\n  this.vertexColors = Array.isArray(color) ? color : [];\n  this.materialIndex = materialIndex !== undefined ? materialIndex : 0;\n};\n\nTHREE.Face3.prototype = {\n  constructor: THREE.Face3,\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    this.a = source.a;\n    this.b = source.b;\n    this.c = source.c;\n    this.normal.copy(source.normal);\n    this.color.copy(source.color);\n    this.materialIndex = source.materialIndex;\n\n    for (var i = 0, il = source.vertexNormals.length; i < il; i++) {\n      this.vertexNormals[i] = source.vertexNormals[i].clone();\n    }\n\n    for (var i = 0, il = source.vertexColors.length; i < il; i++) {\n      this.vertexColors[i] = source.vertexColors[i].clone();\n    }\n\n    return this;\n  }\n}; // File:src/core/Face4.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.Face4 = function (a, b, c, d, normal, color, materialIndex) {\n  console.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.');\n  return new THREE.Face3(a, b, c, normal, color, materialIndex);\n}; // File:src/core/BufferAttribute.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.BufferAttribute = function (array, itemSize) {\n  this.uuid = THREE.Math.generateUUID();\n  this.array = array;\n  this.itemSize = itemSize;\n  this.dynamic = false;\n  this.updateRange = {\n    offset: 0,\n    count: -1\n  };\n  this.version = 0;\n};\n\nTHREE.BufferAttribute.prototype = {\n  constructor: THREE.BufferAttribute,\n\n  get length() {\n    console.warn('THREE.BufferAttribute: .length has been deprecated. Please use .count.');\n    return this.array.length;\n  },\n\n  get count() {\n    return this.array.length / this.itemSize;\n  },\n\n  set needsUpdate(value) {\n    if (value === true) this.version++;\n  },\n\n  setDynamic: function (value) {\n    this.dynamic = value;\n    return this;\n  },\n  copy: function (source) {\n    this.array = new source.array.constructor(source.array);\n    this.itemSize = source.itemSize;\n    this.dynamic = source.dynamic;\n    return this;\n  },\n  copyAt: function (index1, attribute, index2) {\n    index1 *= this.itemSize;\n    index2 *= attribute.itemSize;\n\n    for (var i = 0, l = this.itemSize; i < l; i++) {\n      this.array[index1 + i] = attribute.array[index2 + i];\n    }\n\n    return this;\n  },\n  copyArray: function (array) {\n    this.array.set(array);\n    return this;\n  },\n  copyColorsArray: function (colors) {\n    var array = this.array,\n        offset = 0;\n\n    for (var i = 0, l = colors.length; i < l; i++) {\n      var color = colors[i];\n\n      if (color === undefined) {\n        console.warn('THREE.BufferAttribute.copyColorsArray(): color is undefined', i);\n        color = new THREE.Color();\n      }\n\n      array[offset++] = color.r;\n      array[offset++] = color.g;\n      array[offset++] = color.b;\n    }\n\n    return this;\n  },\n  copyIndicesArray: function (indices) {\n    var array = this.array,\n        offset = 0;\n\n    for (var i = 0, l = indices.length; i < l; i++) {\n      var index = indices[i];\n      array[offset++] = index.a;\n      array[offset++] = index.b;\n      array[offset++] = index.c;\n    }\n\n    return this;\n  },\n  copyVector2sArray: function (vectors) {\n    var array = this.array,\n        offset = 0;\n\n    for (var i = 0, l = vectors.length; i < l; i++) {\n      var vector = vectors[i];\n\n      if (vector === undefined) {\n        console.warn('THREE.BufferAttribute.copyVector2sArray(): vector is undefined', i);\n        vector = new THREE.Vector2();\n      }\n\n      array[offset++] = vector.x;\n      array[offset++] = vector.y;\n    }\n\n    return this;\n  },\n  copyVector3sArray: function (vectors) {\n    var array = this.array,\n        offset = 0;\n\n    for (var i = 0, l = vectors.length; i < l; i++) {\n      var vector = vectors[i];\n\n      if (vector === undefined) {\n        console.warn('THREE.BufferAttribute.copyVector3sArray(): vector is undefined', i);\n        vector = new THREE.Vector3();\n      }\n\n      array[offset++] = vector.x;\n      array[offset++] = vector.y;\n      array[offset++] = vector.z;\n    }\n\n    return this;\n  },\n  copyVector4sArray: function (vectors) {\n    var array = this.array,\n        offset = 0;\n\n    for (var i = 0, l = vectors.length; i < l; i++) {\n      var vector = vectors[i];\n\n      if (vector === undefined) {\n        console.warn('THREE.BufferAttribute.copyVector4sArray(): vector is undefined', i);\n        vector = new THREE.Vector4();\n      }\n\n      array[offset++] = vector.x;\n      array[offset++] = vector.y;\n      array[offset++] = vector.z;\n      array[offset++] = vector.w;\n    }\n\n    return this;\n  },\n  set: function (value, offset) {\n    if (offset === undefined) offset = 0;\n    this.array.set(value, offset);\n    return this;\n  },\n  getX: function (index) {\n    return this.array[index * this.itemSize];\n  },\n  setX: function (index, x) {\n    this.array[index * this.itemSize] = x;\n    return this;\n  },\n  getY: function (index) {\n    return this.array[index * this.itemSize + 1];\n  },\n  setY: function (index, y) {\n    this.array[index * this.itemSize + 1] = y;\n    return this;\n  },\n  getZ: function (index) {\n    return this.array[index * this.itemSize + 2];\n  },\n  setZ: function (index, z) {\n    this.array[index * this.itemSize + 2] = z;\n    return this;\n  },\n  getW: function (index) {\n    return this.array[index * this.itemSize + 3];\n  },\n  setW: function (index, w) {\n    this.array[index * this.itemSize + 3] = w;\n    return this;\n  },\n  setXY: function (index, x, y) {\n    index *= this.itemSize;\n    this.array[index + 0] = x;\n    this.array[index + 1] = y;\n    return this;\n  },\n  setXYZ: function (index, x, y, z) {\n    index *= this.itemSize;\n    this.array[index + 0] = x;\n    this.array[index + 1] = y;\n    this.array[index + 2] = z;\n    return this;\n  },\n  setXYZW: function (index, x, y, z, w) {\n    index *= this.itemSize;\n    this.array[index + 0] = x;\n    this.array[index + 1] = y;\n    this.array[index + 2] = z;\n    this.array[index + 3] = w;\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  }\n}; //\n\nTHREE.Int8Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Int8Array(array), itemSize);\n};\n\nTHREE.Uint8Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Uint8Array(array), itemSize);\n};\n\nTHREE.Uint8ClampedAttribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Uint8ClampedArray(array), itemSize);\n};\n\nTHREE.Int16Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Int16Array(array), itemSize);\n};\n\nTHREE.Uint16Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Uint16Array(array), itemSize);\n};\n\nTHREE.Int32Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Int32Array(array), itemSize);\n};\n\nTHREE.Uint32Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Uint32Array(array), itemSize);\n};\n\nTHREE.Float32Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Float32Array(array), itemSize);\n};\n\nTHREE.Float64Attribute = function (array, itemSize) {\n  return new THREE.BufferAttribute(new Float64Array(array), itemSize);\n}; // Deprecated\n\n\nTHREE.DynamicBufferAttribute = function (array, itemSize) {\n  console.warn('THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.');\n  return new THREE.BufferAttribute(array, itemSize).setDynamic(true);\n}; // File:src/core/InstancedBufferAttribute.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\n\nTHREE.InstancedBufferAttribute = function (array, itemSize, meshPerAttribute) {\n  THREE.BufferAttribute.call(this, array, itemSize);\n  this.meshPerAttribute = meshPerAttribute || 1;\n};\n\nTHREE.InstancedBufferAttribute.prototype = Object.create(THREE.BufferAttribute.prototype);\nTHREE.InstancedBufferAttribute.prototype.constructor = THREE.InstancedBufferAttribute;\n\nTHREE.InstancedBufferAttribute.prototype.copy = function (source) {\n  THREE.BufferAttribute.prototype.copy.call(this, source);\n  this.meshPerAttribute = source.meshPerAttribute;\n  return this;\n}; // File:src/core/InterleavedBuffer.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\n\nTHREE.InterleavedBuffer = function (array, stride) {\n  this.uuid = THREE.Math.generateUUID();\n  this.array = array;\n  this.stride = stride;\n  this.dynamic = false;\n  this.updateRange = {\n    offset: 0,\n    count: -1\n  };\n  this.version = 0;\n};\n\nTHREE.InterleavedBuffer.prototype = {\n  constructor: THREE.InterleavedBuffer,\n\n  get length() {\n    return this.array.length;\n  },\n\n  get count() {\n    return this.array.length / this.stride;\n  },\n\n  set needsUpdate(value) {\n    if (value === true) this.version++;\n  },\n\n  setDynamic: function (value) {\n    this.dynamic = value;\n    return this;\n  },\n  copy: function (source) {\n    this.array = new source.array.constructor(source.array);\n    this.stride = source.stride;\n    this.dynamic = source.dynamic;\n  },\n  copyAt: function (index1, attribute, index2) {\n    index1 *= this.stride;\n    index2 *= attribute.stride;\n\n    for (var i = 0, l = this.stride; i < l; i++) {\n      this.array[index1 + i] = attribute.array[index2 + i];\n    }\n\n    return this;\n  },\n  set: function (value, offset) {\n    if (offset === undefined) offset = 0;\n    this.array.set(value, offset);\n    return this;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  }\n}; // File:src/core/InstancedInterleavedBuffer.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\nTHREE.InstancedInterleavedBuffer = function (array, stride, meshPerAttribute) {\n  THREE.InterleavedBuffer.call(this, array, stride);\n  this.meshPerAttribute = meshPerAttribute || 1;\n};\n\nTHREE.InstancedInterleavedBuffer.prototype = Object.create(THREE.InterleavedBuffer.prototype);\nTHREE.InstancedInterleavedBuffer.prototype.constructor = THREE.InstancedInterleavedBuffer;\n\nTHREE.InstancedInterleavedBuffer.prototype.copy = function (source) {\n  THREE.InterleavedBuffer.prototype.copy.call(this, source);\n  this.meshPerAttribute = source.meshPerAttribute;\n  return this;\n}; // File:src/core/InterleavedBufferAttribute.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\n\nTHREE.InterleavedBufferAttribute = function (interleavedBuffer, itemSize, offset) {\n  this.uuid = THREE.Math.generateUUID();\n  this.data = interleavedBuffer;\n  this.itemSize = itemSize;\n  this.offset = offset;\n};\n\nTHREE.InterleavedBufferAttribute.prototype = {\n  constructor: THREE.InterleavedBufferAttribute,\n\n  get length() {\n    console.warn('THREE.BufferAttribute: .length has been deprecated. Please use .count.');\n    return this.array.length;\n  },\n\n  get count() {\n    return this.data.array.length / this.data.stride;\n  },\n\n  setX: function (index, x) {\n    this.data.array[index * this.data.stride + this.offset] = x;\n    return this;\n  },\n  setY: function (index, y) {\n    this.data.array[index * this.data.stride + this.offset + 1] = y;\n    return this;\n  },\n  setZ: function (index, z) {\n    this.data.array[index * this.data.stride + this.offset + 2] = z;\n    return this;\n  },\n  setW: function (index, w) {\n    this.data.array[index * this.data.stride + this.offset + 3] = w;\n    return this;\n  },\n  getX: function (index) {\n    return this.data.array[index * this.data.stride + this.offset];\n  },\n  getY: function (index) {\n    return this.data.array[index * this.data.stride + this.offset + 1];\n  },\n  getZ: function (index) {\n    return this.data.array[index * this.data.stride + this.offset + 2];\n  },\n  getW: function (index) {\n    return this.data.array[index * this.data.stride + this.offset + 3];\n  },\n  setXY: function (index, x, y) {\n    index = index * this.data.stride + this.offset;\n    this.data.array[index + 0] = x;\n    this.data.array[index + 1] = y;\n    return this;\n  },\n  setXYZ: function (index, x, y, z) {\n    index = index * this.data.stride + this.offset;\n    this.data.array[index + 0] = x;\n    this.data.array[index + 1] = y;\n    this.data.array[index + 2] = z;\n    return this;\n  },\n  setXYZW: function (index, x, y, z, w) {\n    index = index * this.data.stride + this.offset;\n    this.data.array[index + 0] = x;\n    this.data.array[index + 1] = y;\n    this.data.array[index + 2] = z;\n    this.data.array[index + 3] = w;\n    return this;\n  }\n}; // File:src/core/Geometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\n\nTHREE.Geometry = function () {\n  Object.defineProperty(this, 'id', {\n    value: THREE.GeometryIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.type = 'Geometry';\n  this.vertices = [];\n  this.colors = [];\n  this.faces = [];\n  this.faceVertexUvs = [[]];\n  this.morphTargets = [];\n  this.morphColors = [];\n  this.morphNormals = [];\n  this.skinWeights = [];\n  this.skinIndices = [];\n  this.lineDistances = [];\n  this.boundingBox = null;\n  this.boundingSphere = null; // update flags\n\n  this.verticesNeedUpdate = false;\n  this.elementsNeedUpdate = false;\n  this.uvsNeedUpdate = false;\n  this.normalsNeedUpdate = false;\n  this.colorsNeedUpdate = false;\n  this.lineDistancesNeedUpdate = false;\n  this.groupsNeedUpdate = false;\n};\n\nTHREE.Geometry.prototype = {\n  constructor: THREE.Geometry,\n  applyMatrix: function (matrix) {\n    var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\n\n    for (var i = 0, il = this.vertices.length; i < il; i++) {\n      var vertex = this.vertices[i];\n      vertex.applyMatrix4(matrix);\n    }\n\n    for (var i = 0, il = this.faces.length; i < il; i++) {\n      var face = this.faces[i];\n      face.normal.applyMatrix3(normalMatrix).normalize();\n\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\n        face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();\n      }\n    }\n\n    if (this.boundingBox !== null) {\n      this.computeBoundingBox();\n    }\n\n    if (this.boundingSphere !== null) {\n      this.computeBoundingSphere();\n    }\n\n    this.verticesNeedUpdate = true;\n    this.normalsNeedUpdate = true;\n  },\n  rotateX: function () {\n    // rotate geometry around world x-axis\n    var m1;\n    return function rotateX(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationX(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  rotateY: function () {\n    // rotate geometry around world y-axis\n    var m1;\n    return function rotateY(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationY(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  rotateZ: function () {\n    // rotate geometry around world z-axis\n    var m1;\n    return function rotateZ(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationZ(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  translate: function () {\n    // translate geometry\n    var m1;\n    return function translate(x, y, z) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeTranslation(x, y, z);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  scale: function () {\n    // scale geometry\n    var m1;\n    return function scale(x, y, z) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeScale(x, y, z);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  lookAt: function () {\n    var obj;\n    return function lookAt(vector) {\n      if (obj === undefined) obj = new THREE.Object3D();\n      obj.lookAt(vector);\n      obj.updateMatrix();\n      this.applyMatrix(obj.matrix);\n    };\n  }(),\n  fromBufferGeometry: function (geometry) {\n    var scope = this;\n    var indices = geometry.index !== null ? geometry.index.array : undefined;\n    var attributes = geometry.attributes;\n    var vertices = attributes.position.array;\n    var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\n    var colors = attributes.color !== undefined ? attributes.color.array : undefined;\n    var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\n    var uvs2 = attributes.uv2 !== undefined ? attributes.uv2.array : undefined;\n    if (uvs2 !== undefined) this.faceVertexUvs[1] = [];\n    var tempNormals = [];\n    var tempUVs = [];\n    var tempUVs2 = [];\n\n    for (var i = 0, j = 0, k = 0; i < vertices.length; i += 3, j += 2, k += 4) {\n      scope.vertices.push(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\n\n      if (normals !== undefined) {\n        tempNormals.push(new THREE.Vector3(normals[i], normals[i + 1], normals[i + 2]));\n      }\n\n      if (colors !== undefined) {\n        scope.colors.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\n      }\n\n      if (uvs !== undefined) {\n        tempUVs.push(new THREE.Vector2(uvs[j], uvs[j + 1]));\n      }\n\n      if (uvs2 !== undefined) {\n        tempUVs2.push(new THREE.Vector2(uvs2[j], uvs2[j + 1]));\n      }\n    }\n\n    var addFace = function (a, b, c) {\n      var vertexNormals = normals !== undefined ? [tempNormals[a].clone(), tempNormals[b].clone(), tempNormals[c].clone()] : [];\n      var vertexColors = colors !== undefined ? [scope.colors[a].clone(), scope.colors[b].clone(), scope.colors[c].clone()] : [];\n      var face = new THREE.Face3(a, b, c, vertexNormals, vertexColors);\n      scope.faces.push(face);\n\n      if (uvs !== undefined) {\n        scope.faceVertexUvs[0].push([tempUVs[a].clone(), tempUVs[b].clone(), tempUVs[c].clone()]);\n      }\n\n      if (uvs2 !== undefined) {\n        scope.faceVertexUvs[1].push([tempUVs2[a].clone(), tempUVs2[b].clone(), tempUVs2[c].clone()]);\n      }\n    };\n\n    if (indices !== undefined) {\n      var groups = geometry.groups;\n\n      if (groups.length > 0) {\n        for (var i = 0; i < groups.length; i++) {\n          var group = groups[i];\n          var start = group.start;\n          var count = group.count;\n\n          for (var j = start, jl = start + count; j < jl; j += 3) {\n            addFace(indices[j], indices[j + 1], indices[j + 2]);\n          }\n        }\n      } else {\n        for (var i = 0; i < indices.length; i += 3) {\n          addFace(indices[i], indices[i + 1], indices[i + 2]);\n        }\n      }\n    } else {\n      for (var i = 0; i < vertices.length / 3; i += 3) {\n        addFace(i, i + 1, i + 2);\n      }\n    }\n\n    this.computeFaceNormals();\n\n    if (geometry.boundingBox !== null) {\n      this.boundingBox = geometry.boundingBox.clone();\n    }\n\n    if (geometry.boundingSphere !== null) {\n      this.boundingSphere = geometry.boundingSphere.clone();\n    }\n\n    return this;\n  },\n  center: function () {\n    this.computeBoundingBox();\n    var offset = this.boundingBox.center().negate();\n    this.translate(offset.x, offset.y, offset.z);\n    return offset;\n  },\n  normalize: function () {\n    this.computeBoundingSphere();\n    var center = this.boundingSphere.center;\n    var radius = this.boundingSphere.radius;\n    var s = radius === 0 ? 1 : 1.0 / radius;\n    var matrix = new THREE.Matrix4();\n    matrix.set(s, 0, 0, -s * center.x, 0, s, 0, -s * center.y, 0, 0, s, -s * center.z, 0, 0, 0, 1);\n    this.applyMatrix(matrix);\n    return this;\n  },\n  computeFaceNormals: function () {\n    var cb = new THREE.Vector3(),\n        ab = new THREE.Vector3();\n\n    for (var f = 0, fl = this.faces.length; f < fl; f++) {\n      var face = this.faces[f];\n      var vA = this.vertices[face.a];\n      var vB = this.vertices[face.b];\n      var vC = this.vertices[face.c];\n      cb.subVectors(vC, vB);\n      ab.subVectors(vA, vB);\n      cb.cross(ab);\n      cb.normalize();\n      face.normal.copy(cb);\n    }\n  },\n  computeVertexNormals: function (areaWeighted) {\n    var v, vl, f, fl, face, vertices;\n    vertices = new Array(this.vertices.length);\n\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\n      vertices[v] = new THREE.Vector3();\n    }\n\n    if (areaWeighted) {\n      // vertex normals weighted by triangle areas\n      // http://www.iquilezles.org/www/articles/normals/normals.htm\n      var vA, vB, vC;\n      var cb = new THREE.Vector3(),\n          ab = new THREE.Vector3();\n\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\n        face = this.faces[f];\n        vA = this.vertices[face.a];\n        vB = this.vertices[face.b];\n        vC = this.vertices[face.c];\n        cb.subVectors(vC, vB);\n        ab.subVectors(vA, vB);\n        cb.cross(ab);\n        vertices[face.a].add(cb);\n        vertices[face.b].add(cb);\n        vertices[face.c].add(cb);\n      }\n    } else {\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\n        face = this.faces[f];\n        vertices[face.a].add(face.normal);\n        vertices[face.b].add(face.normal);\n        vertices[face.c].add(face.normal);\n      }\n    }\n\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\n      vertices[v].normalize();\n    }\n\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\n      face = this.faces[f];\n      var vertexNormals = face.vertexNormals;\n\n      if (vertexNormals.length === 3) {\n        vertexNormals[0].copy(vertices[face.a]);\n        vertexNormals[1].copy(vertices[face.b]);\n        vertexNormals[2].copy(vertices[face.c]);\n      } else {\n        vertexNormals[0] = vertices[face.a].clone();\n        vertexNormals[1] = vertices[face.b].clone();\n        vertexNormals[2] = vertices[face.c].clone();\n      }\n    }\n  },\n  computeMorphNormals: function () {\n    var i, il, f, fl, face; // save original normals\n    // - create temp variables on first access\n    //   otherwise just copy (for faster repeated calls)\n\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\n      face = this.faces[f];\n\n      if (!face.__originalFaceNormal) {\n        face.__originalFaceNormal = face.normal.clone();\n      } else {\n        face.__originalFaceNormal.copy(face.normal);\n      }\n\n      if (!face.__originalVertexNormals) face.__originalVertexNormals = [];\n\n      for (i = 0, il = face.vertexNormals.length; i < il; i++) {\n        if (!face.__originalVertexNormals[i]) {\n          face.__originalVertexNormals[i] = face.vertexNormals[i].clone();\n        } else {\n          face.__originalVertexNormals[i].copy(face.vertexNormals[i]);\n        }\n      }\n    } // use temp geometry to compute face and vertex normals for each morph\n\n\n    var tmpGeo = new THREE.Geometry();\n    tmpGeo.faces = this.faces;\n\n    for (i = 0, il = this.morphTargets.length; i < il; i++) {\n      // create on first access\n      if (!this.morphNormals[i]) {\n        this.morphNormals[i] = {};\n        this.morphNormals[i].faceNormals = [];\n        this.morphNormals[i].vertexNormals = [];\n        var dstNormalsFace = this.morphNormals[i].faceNormals;\n        var dstNormalsVertex = this.morphNormals[i].vertexNormals;\n        var faceNormal, vertexNormals;\n\n        for (f = 0, fl = this.faces.length; f < fl; f++) {\n          faceNormal = new THREE.Vector3();\n          vertexNormals = {\n            a: new THREE.Vector3(),\n            b: new THREE.Vector3(),\n            c: new THREE.Vector3()\n          };\n          dstNormalsFace.push(faceNormal);\n          dstNormalsVertex.push(vertexNormals);\n        }\n      }\n\n      var morphNormals = this.morphNormals[i]; // set vertices to morph target\n\n      tmpGeo.vertices = this.morphTargets[i].vertices; // compute morph normals\n\n      tmpGeo.computeFaceNormals();\n      tmpGeo.computeVertexNormals(); // store morph normals\n\n      var faceNormal, vertexNormals;\n\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\n        face = this.faces[f];\n        faceNormal = morphNormals.faceNormals[f];\n        vertexNormals = morphNormals.vertexNormals[f];\n        faceNormal.copy(face.normal);\n        vertexNormals.a.copy(face.vertexNormals[0]);\n        vertexNormals.b.copy(face.vertexNormals[1]);\n        vertexNormals.c.copy(face.vertexNormals[2]);\n      }\n    } // restore original normals\n\n\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\n      face = this.faces[f];\n      face.normal = face.__originalFaceNormal;\n      face.vertexNormals = face.__originalVertexNormals;\n    }\n  },\n  computeTangents: function () {\n    console.warn('THREE.Geometry: .computeTangents() has been removed.');\n  },\n  computeLineDistances: function () {\n    var d = 0;\n    var vertices = this.vertices;\n\n    for (var i = 0, il = vertices.length; i < il; i++) {\n      if (i > 0) {\n        d += vertices[i].distanceTo(vertices[i - 1]);\n      }\n\n      this.lineDistances[i] = d;\n    }\n  },\n  computeBoundingBox: function () {\n    if (this.boundingBox === null) {\n      this.boundingBox = new THREE.Box3();\n    }\n\n    this.boundingBox.setFromPoints(this.vertices);\n  },\n  computeBoundingSphere: function () {\n    if (this.boundingSphere === null) {\n      this.boundingSphere = new THREE.Sphere();\n    }\n\n    this.boundingSphere.setFromPoints(this.vertices);\n  },\n  merge: function (geometry, matrix, materialIndexOffset) {\n    if (geometry instanceof THREE.Geometry === false) {\n      console.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry);\n      return;\n    }\n\n    var normalMatrix,\n        vertexOffset = this.vertices.length,\n        vertices1 = this.vertices,\n        vertices2 = geometry.vertices,\n        faces1 = this.faces,\n        faces2 = geometry.faces,\n        uvs1 = this.faceVertexUvs[0],\n        uvs2 = geometry.faceVertexUvs[0];\n    if (materialIndexOffset === undefined) materialIndexOffset = 0;\n\n    if (matrix !== undefined) {\n      normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\n    } // vertices\n\n\n    for (var i = 0, il = vertices2.length; i < il; i++) {\n      var vertex = vertices2[i];\n      var vertexCopy = vertex.clone();\n      if (matrix !== undefined) vertexCopy.applyMatrix4(matrix);\n      vertices1.push(vertexCopy);\n    } // faces\n\n\n    for (i = 0, il = faces2.length; i < il; i++) {\n      var face = faces2[i],\n          faceCopy,\n          normal,\n          color,\n          faceVertexNormals = face.vertexNormals,\n          faceVertexColors = face.vertexColors;\n      faceCopy = new THREE.Face3(face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset);\n      faceCopy.normal.copy(face.normal);\n\n      if (normalMatrix !== undefined) {\n        faceCopy.normal.applyMatrix3(normalMatrix).normalize();\n      }\n\n      for (var j = 0, jl = faceVertexNormals.length; j < jl; j++) {\n        normal = faceVertexNormals[j].clone();\n\n        if (normalMatrix !== undefined) {\n          normal.applyMatrix3(normalMatrix).normalize();\n        }\n\n        faceCopy.vertexNormals.push(normal);\n      }\n\n      faceCopy.color.copy(face.color);\n\n      for (var j = 0, jl = faceVertexColors.length; j < jl; j++) {\n        color = faceVertexColors[j];\n        faceCopy.vertexColors.push(color.clone());\n      }\n\n      faceCopy.materialIndex = face.materialIndex + materialIndexOffset;\n      faces1.push(faceCopy);\n    } // uvs\n\n\n    for (i = 0, il = uvs2.length; i < il; i++) {\n      var uv = uvs2[i],\n          uvCopy = [];\n\n      if (uv === undefined) {\n        continue;\n      }\n\n      for (var j = 0, jl = uv.length; j < jl; j++) {\n        uvCopy.push(uv[j].clone());\n      }\n\n      uvs1.push(uvCopy);\n    }\n  },\n  mergeMesh: function (mesh) {\n    if (mesh instanceof THREE.Mesh === false) {\n      console.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh);\n      return;\n    }\n\n    mesh.matrixAutoUpdate && mesh.updateMatrix();\n    this.merge(mesh.geometry, mesh.matrix);\n  },\n\n  /*\r\n   * Checks for duplicate vertices with hashmap.\r\n   * Duplicated vertices are removed\r\n   * and faces' vertices are updated.\r\n   */\n  mergeVertices: function () {\n    var verticesMap = {}; // Hashmap for looking up vertices by position coordinates (and making sure they are unique)\n\n    var unique = [],\n        changes = [];\n    var v, key;\n    var precisionPoints = 4; // number of decimal points, e.g. 4 for epsilon of 0.0001\n\n    var precision = Math.pow(10, precisionPoints);\n    var i, il, face;\n    var indices, j, jl;\n\n    for (i = 0, il = this.vertices.length; i < il; i++) {\n      v = this.vertices[i];\n      key = Math.round(v.x * precision) + '_' + Math.round(v.y * precision) + '_' + Math.round(v.z * precision);\n\n      if (verticesMap[key] === undefined) {\n        verticesMap[key] = i;\n        unique.push(this.vertices[i]);\n        changes[i] = unique.length - 1;\n      } else {\n        //console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\n        changes[i] = changes[verticesMap[key]];\n      }\n    } // if faces are completely degenerate after merging vertices, we\n    // have to remove them from the geometry.\n\n\n    var faceIndicesToRemove = [];\n\n    for (i = 0, il = this.faces.length; i < il; i++) {\n      face = this.faces[i];\n      face.a = changes[face.a];\n      face.b = changes[face.b];\n      face.c = changes[face.c];\n      indices = [face.a, face.b, face.c];\n      var dupIndex = -1; // if any duplicate vertices are found in a Face3\n      // we have to remove the face as nothing can be saved\n\n      for (var n = 0; n < 3; n++) {\n        if (indices[n] === indices[(n + 1) % 3]) {\n          dupIndex = n;\n          faceIndicesToRemove.push(i);\n          break;\n        }\n      }\n    }\n\n    for (i = faceIndicesToRemove.length - 1; i >= 0; i--) {\n      var idx = faceIndicesToRemove[i];\n      this.faces.splice(idx, 1);\n\n      for (j = 0, jl = this.faceVertexUvs.length; j < jl; j++) {\n        this.faceVertexUvs[j].splice(idx, 1);\n      }\n    } // Use unique set of vertices\n\n\n    var diff = this.vertices.length - unique.length;\n    this.vertices = unique;\n    return diff;\n  },\n  toJSON: function () {\n    var data = {\n      metadata: {\n        version: 4.4,\n        type: 'Geometry',\n        generator: 'Geometry.toJSON'\n      }\n    }; // standard Geometry serialization\n\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') data.name = this.name;\n\n    if (this.parameters !== undefined) {\n      var parameters = this.parameters;\n\n      for (var key in parameters) {\n        if (parameters[key] !== undefined) data[key] = parameters[key];\n      }\n\n      return data;\n    }\n\n    var vertices = [];\n\n    for (var i = 0; i < this.vertices.length; i++) {\n      var vertex = this.vertices[i];\n      vertices.push(vertex.x, vertex.y, vertex.z);\n    }\n\n    var faces = [];\n    var normals = [];\n    var normalsHash = {};\n    var colors = [];\n    var colorsHash = {};\n    var uvs = [];\n    var uvsHash = {};\n\n    for (var i = 0; i < this.faces.length; i++) {\n      var face = this.faces[i];\n      var hasMaterial = false; // face.materialIndex !== undefined;\n\n      var hasFaceUv = false; // deprecated\n\n      var hasFaceVertexUv = this.faceVertexUvs[0][i] !== undefined;\n      var hasFaceNormal = face.normal.length() > 0;\n      var hasFaceVertexNormal = face.vertexNormals.length > 0;\n      var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\n      var hasFaceVertexColor = face.vertexColors.length > 0;\n      var faceType = 0;\n      faceType = setBit(faceType, 0, 0);\n      faceType = setBit(faceType, 1, hasMaterial);\n      faceType = setBit(faceType, 2, hasFaceUv);\n      faceType = setBit(faceType, 3, hasFaceVertexUv);\n      faceType = setBit(faceType, 4, hasFaceNormal);\n      faceType = setBit(faceType, 5, hasFaceVertexNormal);\n      faceType = setBit(faceType, 6, hasFaceColor);\n      faceType = setBit(faceType, 7, hasFaceVertexColor);\n      faces.push(faceType);\n      faces.push(face.a, face.b, face.c);\n\n      if (hasFaceVertexUv) {\n        var faceVertexUvs = this.faceVertexUvs[0][i];\n        faces.push(getUvIndex(faceVertexUvs[0]), getUvIndex(faceVertexUvs[1]), getUvIndex(faceVertexUvs[2]));\n      }\n\n      if (hasFaceNormal) {\n        faces.push(getNormalIndex(face.normal));\n      }\n\n      if (hasFaceVertexNormal) {\n        var vertexNormals = face.vertexNormals;\n        faces.push(getNormalIndex(vertexNormals[0]), getNormalIndex(vertexNormals[1]), getNormalIndex(vertexNormals[2]));\n      }\n\n      if (hasFaceColor) {\n        faces.push(getColorIndex(face.color));\n      }\n\n      if (hasFaceVertexColor) {\n        var vertexColors = face.vertexColors;\n        faces.push(getColorIndex(vertexColors[0]), getColorIndex(vertexColors[1]), getColorIndex(vertexColors[2]));\n      }\n    }\n\n    function setBit(value, position, enabled) {\n      return enabled ? value | 1 << position : value & ~(1 << position);\n    }\n\n    function getNormalIndex(normal) {\n      var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\n\n      if (normalsHash[hash] !== undefined) {\n        return normalsHash[hash];\n      }\n\n      normalsHash[hash] = normals.length / 3;\n      normals.push(normal.x, normal.y, normal.z);\n      return normalsHash[hash];\n    }\n\n    function getColorIndex(color) {\n      var hash = color.r.toString() + color.g.toString() + color.b.toString();\n\n      if (colorsHash[hash] !== undefined) {\n        return colorsHash[hash];\n      }\n\n      colorsHash[hash] = colors.length;\n      colors.push(color.getHex());\n      return colorsHash[hash];\n    }\n\n    function getUvIndex(uv) {\n      var hash = uv.x.toString() + uv.y.toString();\n\n      if (uvsHash[hash] !== undefined) {\n        return uvsHash[hash];\n      }\n\n      uvsHash[hash] = uvs.length / 2;\n      uvs.push(uv.x, uv.y);\n      return uvsHash[hash];\n    }\n\n    data.data = {};\n    data.data.vertices = vertices;\n    data.data.normals = normals;\n    if (colors.length > 0) data.data.colors = colors;\n    if (uvs.length > 0) data.data.uvs = [uvs]; // temporal backward compatibility\n\n    data.data.faces = faces;\n    return data;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    this.vertices = [];\n    this.faces = [];\n    this.faceVertexUvs = [[]];\n    var vertices = source.vertices;\n\n    for (var i = 0, il = vertices.length; i < il; i++) {\n      this.vertices.push(vertices[i].clone());\n    }\n\n    var faces = source.faces;\n\n    for (var i = 0, il = faces.length; i < il; i++) {\n      this.faces.push(faces[i].clone());\n    }\n\n    for (var i = 0, il = source.faceVertexUvs.length; i < il; i++) {\n      var faceVertexUvs = source.faceVertexUvs[i];\n\n      if (this.faceVertexUvs[i] === undefined) {\n        this.faceVertexUvs[i] = [];\n      }\n\n      for (var j = 0, jl = faceVertexUvs.length; j < jl; j++) {\n        var uvs = faceVertexUvs[j],\n            uvsCopy = [];\n\n        for (var k = 0, kl = uvs.length; k < kl; k++) {\n          var uv = uvs[k];\n          uvsCopy.push(uv.clone());\n        }\n\n        this.faceVertexUvs[i].push(uvsCopy);\n      }\n    }\n\n    return this;\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);\nTHREE.GeometryIdCount = 0; // File:src/core/DirectGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.DirectGeometry = function () {\n  Object.defineProperty(this, 'id', {\n    value: THREE.GeometryIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.type = 'DirectGeometry';\n  this.indices = [];\n  this.vertices = [];\n  this.normals = [];\n  this.colors = [];\n  this.uvs = [];\n  this.uvs2 = [];\n  this.groups = [];\n  this.morphTargets = {};\n  this.skinWeights = [];\n  this.skinIndices = []; // this.lineDistances = [];\n\n  this.boundingBox = null;\n  this.boundingSphere = null; // update flags\n\n  this.verticesNeedUpdate = false;\n  this.normalsNeedUpdate = false;\n  this.colorsNeedUpdate = false;\n  this.uvsNeedUpdate = false;\n  this.groupsNeedUpdate = false;\n};\n\nTHREE.DirectGeometry.prototype = {\n  constructor: THREE.DirectGeometry,\n  computeBoundingBox: THREE.Geometry.prototype.computeBoundingBox,\n  computeBoundingSphere: THREE.Geometry.prototype.computeBoundingSphere,\n  computeFaceNormals: function () {\n    console.warn('THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.');\n  },\n  computeVertexNormals: function () {\n    console.warn('THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.');\n  },\n  computeGroups: function (geometry) {\n    var group;\n    var groups = [];\n    var materialIndex;\n    var faces = geometry.faces;\n\n    for (var i = 0; i < faces.length; i++) {\n      var face = faces[i]; // materials\n\n      if (face.materialIndex !== materialIndex) {\n        materialIndex = face.materialIndex;\n\n        if (group !== undefined) {\n          group.count = i * 3 - group.start;\n          groups.push(group);\n        }\n\n        group = {\n          start: i * 3,\n          materialIndex: materialIndex\n        };\n      }\n    }\n\n    if (group !== undefined) {\n      group.count = i * 3 - group.start;\n      groups.push(group);\n    }\n\n    this.groups = groups;\n  },\n  fromGeometry: function (geometry) {\n    var faces = geometry.faces;\n    var vertices = geometry.vertices;\n    var faceVertexUvs = geometry.faceVertexUvs;\n    var hasFaceVertexUv = faceVertexUvs[0] && faceVertexUvs[0].length > 0;\n    var hasFaceVertexUv2 = faceVertexUvs[1] && faceVertexUvs[1].length > 0; // morphs\n\n    var morphTargets = geometry.morphTargets;\n    var morphTargetsLength = morphTargets.length;\n\n    if (morphTargetsLength > 0) {\n      var morphTargetsPosition = [];\n\n      for (var i = 0; i < morphTargetsLength; i++) {\n        morphTargetsPosition[i] = [];\n      }\n\n      this.morphTargets.position = morphTargetsPosition;\n    }\n\n    var morphNormals = geometry.morphNormals;\n    var morphNormalsLength = morphNormals.length;\n\n    if (morphNormalsLength > 0) {\n      var morphTargetsNormal = [];\n\n      for (var i = 0; i < morphNormalsLength; i++) {\n        morphTargetsNormal[i] = [];\n      }\n\n      this.morphTargets.normal = morphTargetsNormal;\n    } // skins\n\n\n    var skinIndices = geometry.skinIndices;\n    var skinWeights = geometry.skinWeights;\n    var hasSkinIndices = skinIndices.length === vertices.length;\n    var hasSkinWeights = skinWeights.length === vertices.length; //\n\n    for (var i = 0; i < faces.length; i++) {\n      var face = faces[i];\n      this.vertices.push(vertices[face.a], vertices[face.b], vertices[face.c]);\n      var vertexNormals = face.vertexNormals;\n\n      if (vertexNormals.length === 3) {\n        this.normals.push(vertexNormals[0], vertexNormals[1], vertexNormals[2]);\n      } else {\n        var normal = face.normal;\n        this.normals.push(normal, normal, normal);\n      }\n\n      var vertexColors = face.vertexColors;\n\n      if (vertexColors.length === 3) {\n        this.colors.push(vertexColors[0], vertexColors[1], vertexColors[2]);\n      } else {\n        var color = face.color;\n        this.colors.push(color, color, color);\n      }\n\n      if (hasFaceVertexUv === true) {\n        var vertexUvs = faceVertexUvs[0][i];\n\n        if (vertexUvs !== undefined) {\n          this.uvs.push(vertexUvs[0], vertexUvs[1], vertexUvs[2]);\n        } else {\n          console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ', i);\n          this.uvs.push(new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2());\n        }\n      }\n\n      if (hasFaceVertexUv2 === true) {\n        var vertexUvs = faceVertexUvs[1][i];\n\n        if (vertexUvs !== undefined) {\n          this.uvs2.push(vertexUvs[0], vertexUvs[1], vertexUvs[2]);\n        } else {\n          console.warn('THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ', i);\n          this.uvs2.push(new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2());\n        }\n      } // morphs\n\n\n      for (var j = 0; j < morphTargetsLength; j++) {\n        var morphTarget = morphTargets[j].vertices;\n        morphTargetsPosition[j].push(morphTarget[face.a], morphTarget[face.b], morphTarget[face.c]);\n      }\n\n      for (var j = 0; j < morphNormalsLength; j++) {\n        var morphNormal = morphNormals[j].vertexNormals[i];\n        morphTargetsNormal[j].push(morphNormal.a, morphNormal.b, morphNormal.c);\n      } // skins\n\n\n      if (hasSkinIndices) {\n        this.skinIndices.push(skinIndices[face.a], skinIndices[face.b], skinIndices[face.c]);\n      }\n\n      if (hasSkinWeights) {\n        this.skinWeights.push(skinWeights[face.a], skinWeights[face.b], skinWeights[face.c]);\n      }\n    }\n\n    this.computeGroups(geometry);\n    this.verticesNeedUpdate = geometry.verticesNeedUpdate;\n    this.normalsNeedUpdate = geometry.normalsNeedUpdate;\n    this.colorsNeedUpdate = geometry.colorsNeedUpdate;\n    this.uvsNeedUpdate = geometry.uvsNeedUpdate;\n    this.groupsNeedUpdate = geometry.groupsNeedUpdate;\n    return this;\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype); // File:src/core/BufferGeometry.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.BufferGeometry = function () {\n  Object.defineProperty(this, 'id', {\n    value: THREE.GeometryIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.type = 'BufferGeometry';\n  this.index = null;\n  this.attributes = {};\n  this.morphAttributes = {};\n  this.groups = [];\n  this.boundingBox = null;\n  this.boundingSphere = null;\n  this.drawRange = {\n    start: 0,\n    count: Infinity\n  };\n};\n\nTHREE.BufferGeometry.prototype = {\n  constructor: THREE.BufferGeometry,\n  addIndex: function (index) {\n    console.warn('THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().');\n    this.setIndex(index);\n  },\n  getIndex: function () {\n    return this.index;\n  },\n  setIndex: function (index) {\n    this.index = index;\n  },\n  addAttribute: function (name, attribute) {\n    if (attribute instanceof THREE.BufferAttribute === false && attribute instanceof THREE.InterleavedBufferAttribute === false) {\n      console.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');\n      this.addAttribute(name, new THREE.BufferAttribute(arguments[1], arguments[2]));\n      return;\n    }\n\n    if (name === 'index') {\n      console.warn('THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.');\n      this.setIndex(attribute);\n    }\n\n    this.attributes[name] = attribute;\n  },\n  getAttribute: function (name) {\n    return this.attributes[name];\n  },\n  removeAttribute: function (name) {\n    delete this.attributes[name];\n  },\n\n  get drawcalls() {\n    console.error('THREE.BufferGeometry: .drawcalls has been renamed to .groups.');\n    return this.groups;\n  },\n\n  get offsets() {\n    console.warn('THREE.BufferGeometry: .offsets has been renamed to .groups.');\n    return this.groups;\n  },\n\n  addDrawCall: function (start, count, indexOffset) {\n    if (indexOffset !== undefined) {\n      console.warn('THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.');\n    }\n\n    console.warn('THREE.BufferGeometry: .addDrawCall() is now .addGroup().');\n    this.addGroup(start, count);\n  },\n  clearDrawCalls: function () {\n    console.warn('THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().');\n    this.clearGroups();\n  },\n  addGroup: function (start, count, materialIndex) {\n    this.groups.push({\n      start: start,\n      count: count,\n      materialIndex: materialIndex !== undefined ? materialIndex : 0\n    });\n  },\n  clearGroups: function () {\n    this.groups = [];\n  },\n  setDrawRange: function (start, count) {\n    this.drawRange.start = start;\n    this.drawRange.count = count;\n  },\n  applyMatrix: function (matrix) {\n    var position = this.attributes.position;\n\n    if (position !== undefined) {\n      matrix.applyToVector3Array(position.array);\n      position.needsUpdate = true;\n    }\n\n    var normal = this.attributes.normal;\n\n    if (normal !== undefined) {\n      var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\n      normalMatrix.applyToVector3Array(normal.array);\n      normal.needsUpdate = true;\n    }\n\n    if (this.boundingBox !== null) {\n      this.computeBoundingBox();\n    }\n\n    if (this.boundingSphere !== null) {\n      this.computeBoundingSphere();\n    }\n  },\n  rotateX: function () {\n    // rotate geometry around world x-axis\n    var m1;\n    return function rotateX(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationX(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  rotateY: function () {\n    // rotate geometry around world y-axis\n    var m1;\n    return function rotateY(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationY(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  rotateZ: function () {\n    // rotate geometry around world z-axis\n    var m1;\n    return function rotateZ(angle) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeRotationZ(angle);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  translate: function () {\n    // translate geometry\n    var m1;\n    return function translate(x, y, z) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeTranslation(x, y, z);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  scale: function () {\n    // scale geometry\n    var m1;\n    return function scale(x, y, z) {\n      if (m1 === undefined) m1 = new THREE.Matrix4();\n      m1.makeScale(x, y, z);\n      this.applyMatrix(m1);\n      return this;\n    };\n  }(),\n  lookAt: function () {\n    var obj;\n    return function lookAt(vector) {\n      if (obj === undefined) obj = new THREE.Object3D();\n      obj.lookAt(vector);\n      obj.updateMatrix();\n      this.applyMatrix(obj.matrix);\n    };\n  }(),\n  center: function () {\n    this.computeBoundingBox();\n    var offset = this.boundingBox.center().negate();\n    this.translate(offset.x, offset.y, offset.z);\n    return offset;\n  },\n  setFromObject: function (object) {\n    // console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );\n    var geometry = object.geometry;\n\n    if (object instanceof THREE.Points || object instanceof THREE.Line) {\n      var positions = new THREE.Float32Attribute(geometry.vertices.length * 3, 3);\n      var colors = new THREE.Float32Attribute(geometry.colors.length * 3, 3);\n      this.addAttribute('position', positions.copyVector3sArray(geometry.vertices));\n      this.addAttribute('color', colors.copyColorsArray(geometry.colors));\n\n      if (geometry.lineDistances && geometry.lineDistances.length === geometry.vertices.length) {\n        var lineDistances = new THREE.Float32Attribute(geometry.lineDistances.length, 1);\n        this.addAttribute('lineDistance', lineDistances.copyArray(geometry.lineDistances));\n      }\n\n      if (geometry.boundingSphere !== null) {\n        this.boundingSphere = geometry.boundingSphere.clone();\n      }\n\n      if (geometry.boundingBox !== null) {\n        this.boundingBox = geometry.boundingBox.clone();\n      }\n    } else if (object instanceof THREE.Mesh) {\n      if (geometry instanceof THREE.Geometry) {\n        this.fromGeometry(geometry);\n      }\n    }\n\n    return this;\n  },\n  updateFromObject: function (object) {\n    var geometry = object.geometry;\n\n    if (object instanceof THREE.Mesh) {\n      var direct = geometry.__directGeometry;\n\n      if (direct === undefined) {\n        return this.fromGeometry(geometry);\n      }\n\n      direct.verticesNeedUpdate = geometry.verticesNeedUpdate;\n      direct.normalsNeedUpdate = geometry.normalsNeedUpdate;\n      direct.colorsNeedUpdate = geometry.colorsNeedUpdate;\n      direct.uvsNeedUpdate = geometry.uvsNeedUpdate;\n      direct.groupsNeedUpdate = geometry.groupsNeedUpdate;\n      geometry.verticesNeedUpdate = false;\n      geometry.normalsNeedUpdate = false;\n      geometry.colorsNeedUpdate = false;\n      geometry.uvsNeedUpdate = false;\n      geometry.groupsNeedUpdate = false;\n      geometry = direct;\n    }\n\n    if (geometry.verticesNeedUpdate === true) {\n      var attribute = this.attributes.position;\n\n      if (attribute !== undefined) {\n        attribute.copyVector3sArray(geometry.vertices);\n        attribute.needsUpdate = true;\n      }\n\n      geometry.verticesNeedUpdate = false;\n    }\n\n    if (geometry.normalsNeedUpdate === true) {\n      var attribute = this.attributes.normal;\n\n      if (attribute !== undefined) {\n        attribute.copyVector3sArray(geometry.normals);\n        attribute.needsUpdate = true;\n      }\n\n      geometry.normalsNeedUpdate = false;\n    }\n\n    if (geometry.colorsNeedUpdate === true) {\n      var attribute = this.attributes.color;\n\n      if (attribute !== undefined) {\n        attribute.copyColorsArray(geometry.colors);\n        attribute.needsUpdate = true;\n      }\n\n      geometry.colorsNeedUpdate = false;\n    }\n\n    if (geometry.lineDistancesNeedUpdate) {\n      var attribute = this.attributes.lineDistance;\n\n      if (attribute !== undefined) {\n        attribute.copyArray(geometry.lineDistances);\n        attribute.needsUpdate = true;\n      }\n\n      geometry.lineDistancesNeedUpdate = false;\n    }\n\n    if (geometry.groupsNeedUpdate) {\n      geometry.computeGroups(object.geometry);\n      this.groups = geometry.groups;\n      geometry.groupsNeedUpdate = false;\n    }\n\n    return this;\n  },\n  fromGeometry: function (geometry) {\n    geometry.__directGeometry = new THREE.DirectGeometry().fromGeometry(geometry);\n    return this.fromDirectGeometry(geometry.__directGeometry);\n  },\n  fromDirectGeometry: function (geometry) {\n    var positions = new Float32Array(geometry.vertices.length * 3);\n    this.addAttribute('position', new THREE.BufferAttribute(positions, 3).copyVector3sArray(geometry.vertices));\n\n    if (geometry.normals.length > 0) {\n      var normals = new Float32Array(geometry.normals.length * 3);\n      this.addAttribute('normal', new THREE.BufferAttribute(normals, 3).copyVector3sArray(geometry.normals));\n    }\n\n    if (geometry.colors.length > 0) {\n      var colors = new Float32Array(geometry.colors.length * 3);\n      this.addAttribute('color', new THREE.BufferAttribute(colors, 3).copyColorsArray(geometry.colors));\n    }\n\n    if (geometry.uvs.length > 0) {\n      var uvs = new Float32Array(geometry.uvs.length * 2);\n      this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2).copyVector2sArray(geometry.uvs));\n    }\n\n    if (geometry.uvs2.length > 0) {\n      var uvs2 = new Float32Array(geometry.uvs2.length * 2);\n      this.addAttribute('uv2', new THREE.BufferAttribute(uvs2, 2).copyVector2sArray(geometry.uvs2));\n    }\n\n    if (geometry.indices.length > 0) {\n      var TypeArray = geometry.vertices.length > 65535 ? Uint32Array : Uint16Array;\n      var indices = new TypeArray(geometry.indices.length * 3);\n      this.setIndex(new THREE.BufferAttribute(indices, 1).copyIndicesArray(geometry.indices));\n    } // groups\n\n\n    this.groups = geometry.groups; // morphs\n\n    for (var name in geometry.morphTargets) {\n      var array = [];\n      var morphTargets = geometry.morphTargets[name];\n\n      for (var i = 0, l = morphTargets.length; i < l; i++) {\n        var morphTarget = morphTargets[i];\n        var attribute = new THREE.Float32Attribute(morphTarget.length * 3, 3);\n        array.push(attribute.copyVector3sArray(morphTarget));\n      }\n\n      this.morphAttributes[name] = array;\n    } // skinning\n\n\n    if (geometry.skinIndices.length > 0) {\n      var skinIndices = new THREE.Float32Attribute(geometry.skinIndices.length * 4, 4);\n      this.addAttribute('skinIndex', skinIndices.copyVector4sArray(geometry.skinIndices));\n    }\n\n    if (geometry.skinWeights.length > 0) {\n      var skinWeights = new THREE.Float32Attribute(geometry.skinWeights.length * 4, 4);\n      this.addAttribute('skinWeight', skinWeights.copyVector4sArray(geometry.skinWeights));\n    } //\n\n\n    if (geometry.boundingSphere !== null) {\n      this.boundingSphere = geometry.boundingSphere.clone();\n    }\n\n    if (geometry.boundingBox !== null) {\n      this.boundingBox = geometry.boundingBox.clone();\n    }\n\n    return this;\n  },\n  computeBoundingBox: function () {\n    var vector = new THREE.Vector3();\n    return function () {\n      if (this.boundingBox === null) {\n        this.boundingBox = new THREE.Box3();\n      }\n\n      var positions = this.attributes.position.array;\n\n      if (positions) {\n        var bb = this.boundingBox;\n        bb.makeEmpty();\n\n        for (var i = 0, il = positions.length; i < il; i += 3) {\n          vector.fromArray(positions, i);\n          bb.expandByPoint(vector);\n        }\n      }\n\n      if (positions === undefined || positions.length === 0) {\n        this.boundingBox.min.set(0, 0, 0);\n        this.boundingBox.max.set(0, 0, 0);\n      }\n\n      if (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) {\n        console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.', this);\n      }\n    };\n  }(),\n  computeBoundingSphere: function () {\n    var box = new THREE.Box3();\n    var vector = new THREE.Vector3();\n    return function () {\n      if (this.boundingSphere === null) {\n        this.boundingSphere = new THREE.Sphere();\n      }\n\n      var positions = this.attributes.position.array;\n\n      if (positions) {\n        box.makeEmpty();\n        var center = this.boundingSphere.center;\n\n        for (var i = 0, il = positions.length; i < il; i += 3) {\n          vector.fromArray(positions, i);\n          box.expandByPoint(vector);\n        }\n\n        box.center(center); // hoping to find a boundingSphere with a radius smaller than the\n        // boundingSphere of the boundingBox: sqrt(3) smaller in the best case\n\n        var maxRadiusSq = 0;\n\n        for (var i = 0, il = positions.length; i < il; i += 3) {\n          vector.fromArray(positions, i);\n          maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(vector));\n        }\n\n        this.boundingSphere.radius = Math.sqrt(maxRadiusSq);\n\n        if (isNaN(this.boundingSphere.radius)) {\n          console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.', this);\n        }\n      }\n    };\n  }(),\n  computeFaceNormals: function () {// backwards compatibility\n  },\n  computeVertexNormals: function () {\n    var index = this.index;\n    var attributes = this.attributes;\n    var groups = this.groups;\n\n    if (attributes.position) {\n      var positions = attributes.position.array;\n\n      if (attributes.normal === undefined) {\n        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));\n      } else {\n        // reset existing normals to zero\n        var normals = attributes.normal.array;\n\n        for (var i = 0, il = normals.length; i < il; i++) {\n          normals[i] = 0;\n        }\n      }\n\n      var normals = attributes.normal.array;\n      var vA,\n          vB,\n          vC,\n          pA = new THREE.Vector3(),\n          pB = new THREE.Vector3(),\n          pC = new THREE.Vector3(),\n          cb = new THREE.Vector3(),\n          ab = new THREE.Vector3(); // indexed elements\n\n      if (index) {\n        var indices = index.array;\n\n        if (groups.length === 0) {\n          this.addGroup(0, indices.length);\n        }\n\n        for (var j = 0, jl = groups.length; j < jl; ++j) {\n          var group = groups[j];\n          var start = group.start;\n          var count = group.count;\n\n          for (var i = start, il = start + count; i < il; i += 3) {\n            vA = indices[i + 0] * 3;\n            vB = indices[i + 1] * 3;\n            vC = indices[i + 2] * 3;\n            pA.fromArray(positions, vA);\n            pB.fromArray(positions, vB);\n            pC.fromArray(positions, vC);\n            cb.subVectors(pC, pB);\n            ab.subVectors(pA, pB);\n            cb.cross(ab);\n            normals[vA] += cb.x;\n            normals[vA + 1] += cb.y;\n            normals[vA + 2] += cb.z;\n            normals[vB] += cb.x;\n            normals[vB + 1] += cb.y;\n            normals[vB + 2] += cb.z;\n            normals[vC] += cb.x;\n            normals[vC + 1] += cb.y;\n            normals[vC + 2] += cb.z;\n          }\n        }\n      } else {\n        // non-indexed elements (unconnected triangle soup)\n        for (var i = 0, il = positions.length; i < il; i += 9) {\n          pA.fromArray(positions, i);\n          pB.fromArray(positions, i + 3);\n          pC.fromArray(positions, i + 6);\n          cb.subVectors(pC, pB);\n          ab.subVectors(pA, pB);\n          cb.cross(ab);\n          normals[i] = cb.x;\n          normals[i + 1] = cb.y;\n          normals[i + 2] = cb.z;\n          normals[i + 3] = cb.x;\n          normals[i + 4] = cb.y;\n          normals[i + 5] = cb.z;\n          normals[i + 6] = cb.x;\n          normals[i + 7] = cb.y;\n          normals[i + 8] = cb.z;\n        }\n      }\n\n      this.normalizeNormals();\n      attributes.normal.needsUpdate = true;\n    }\n  },\n  computeTangents: function () {\n    console.warn('THREE.BufferGeometry: .computeTangents() has been removed.');\n  },\n  computeOffsets: function (size) {\n    console.warn('THREE.BufferGeometry: .computeOffsets() has been removed.');\n  },\n  merge: function (geometry, offset) {\n    if (geometry instanceof THREE.BufferGeometry === false) {\n      console.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry);\n      return;\n    }\n\n    if (offset === undefined) offset = 0;\n    var attributes = this.attributes;\n\n    for (var key in attributes) {\n      if (geometry.attributes[key] === undefined) continue;\n      var attribute1 = attributes[key];\n      var attributeArray1 = attribute1.array;\n      var attribute2 = geometry.attributes[key];\n      var attributeArray2 = attribute2.array;\n      var attributeSize = attribute2.itemSize;\n\n      for (var i = 0, j = attributeSize * offset; i < attributeArray2.length; i++, j++) {\n        attributeArray1[j] = attributeArray2[i];\n      }\n    }\n\n    return this;\n  },\n  normalizeNormals: function () {\n    var normals = this.attributes.normal.array;\n    var x, y, z, n;\n\n    for (var i = 0, il = normals.length; i < il; i += 3) {\n      x = normals[i];\n      y = normals[i + 1];\n      z = normals[i + 2];\n      n = 1.0 / Math.sqrt(x * x + y * y + z * z);\n      normals[i] *= n;\n      normals[i + 1] *= n;\n      normals[i + 2] *= n;\n    }\n  },\n  toJSON: function () {\n    var data = {\n      metadata: {\n        version: 4.4,\n        type: 'BufferGeometry',\n        generator: 'BufferGeometry.toJSON'\n      }\n    }; // standard BufferGeometry serialization\n\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') data.name = this.name;\n\n    if (this.parameters !== undefined) {\n      var parameters = this.parameters;\n\n      for (var key in parameters) {\n        if (parameters[key] !== undefined) data[key] = parameters[key];\n      }\n\n      return data;\n    }\n\n    data.data = {\n      attributes: {}\n    };\n    var index = this.index;\n\n    if (index !== null) {\n      var array = Array.prototype.slice.call(index.array);\n      data.data.index = {\n        type: index.array.constructor.name,\n        array: array\n      };\n    }\n\n    var attributes = this.attributes;\n\n    for (var key in attributes) {\n      var attribute = attributes[key];\n      var array = Array.prototype.slice.call(attribute.array);\n      data.data.attributes[key] = {\n        itemSize: attribute.itemSize,\n        type: attribute.array.constructor.name,\n        array: array\n      };\n    }\n\n    var groups = this.groups;\n\n    if (groups.length > 0) {\n      data.data.groups = JSON.parse(JSON.stringify(groups));\n    }\n\n    var boundingSphere = this.boundingSphere;\n\n    if (boundingSphere !== null) {\n      data.data.boundingSphere = {\n        center: boundingSphere.center.toArray(),\n        radius: boundingSphere.radius\n      };\n    }\n\n    return data;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    var index = source.index;\n\n    if (index !== null) {\n      this.setIndex(index.clone());\n    }\n\n    var attributes = source.attributes;\n\n    for (var name in attributes) {\n      var attribute = attributes[name];\n      this.addAttribute(name, attribute.clone());\n    }\n\n    var groups = source.groups;\n\n    for (var i = 0, l = groups.length; i < l; i++) {\n      var group = groups[i];\n      this.addGroup(group.start, group.count);\n    }\n\n    return this;\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);\nTHREE.BufferGeometry.MaxIndex = 65535; // File:src/core/InstancedBufferGeometry.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\nTHREE.InstancedBufferGeometry = function () {\n  THREE.BufferGeometry.call(this);\n  this.type = 'InstancedBufferGeometry';\n  this.maxInstancedCount = undefined;\n};\n\nTHREE.InstancedBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.InstancedBufferGeometry.prototype.constructor = THREE.InstancedBufferGeometry;\n\nTHREE.InstancedBufferGeometry.prototype.addGroup = function (start, count, instances) {\n  this.groups.push({\n    start: start,\n    count: count,\n    instances: instances\n  });\n};\n\nTHREE.InstancedBufferGeometry.prototype.copy = function (source) {\n  var index = source.index;\n\n  if (index !== null) {\n    this.setIndex(index.clone());\n  }\n\n  var attributes = source.attributes;\n\n  for (var name in attributes) {\n    var attribute = attributes[name];\n    this.addAttribute(name, attribute.clone());\n  }\n\n  var groups = source.groups;\n\n  for (var i = 0, l = groups.length; i < l; i++) {\n    var group = groups[i];\n    this.addGroup(group.start, group.count, group.instances);\n  }\n\n  return this;\n};\n\nTHREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype); // File:src/cameras/Camera.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\n\nTHREE.Camera = function () {\n  THREE.Object3D.call(this);\n  this.type = 'Camera';\n  this.matrixWorldInverse = new THREE.Matrix4();\n  this.projectionMatrix = new THREE.Matrix4();\n};\n\nTHREE.Camera.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Camera.prototype.constructor = THREE.Camera;\n\nTHREE.Camera.prototype.getWorldDirection = function () {\n  var quaternion = new THREE.Quaternion();\n  return function (optionalTarget) {\n    var result = optionalTarget || new THREE.Vector3();\n    this.getWorldQuaternion(quaternion);\n    return result.set(0, 0, -1).applyQuaternion(quaternion);\n  };\n}();\n\nTHREE.Camera.prototype.lookAt = function () {\n  // This routine does not support cameras with rotated and/or translated parent(s)\n  var m1 = new THREE.Matrix4();\n  return function (vector) {\n    m1.lookAt(this.position, vector, this.up);\n    this.quaternion.setFromRotationMatrix(m1);\n  };\n}();\n\nTHREE.Camera.prototype.clone = function () {\n  return new this.constructor().copy(this);\n};\n\nTHREE.Camera.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source);\n  this.matrixWorldInverse.copy(source.matrixWorldInverse);\n  this.projectionMatrix.copy(source.projectionMatrix);\n  return this;\n}; // File:src/cameras/CubeCamera.js\n\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.CubeCamera = function (near, far, cubeResolution) {\n  THREE.Object3D.call(this);\n  this.type = 'CubeCamera';\n  var fov = 90,\n      aspect = 1;\n  var cameraPX = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraPX.up.set(0, -1, 0);\n  cameraPX.lookAt(new THREE.Vector3(1, 0, 0));\n  this.add(cameraPX);\n  var cameraNX = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraNX.up.set(0, -1, 0);\n  cameraNX.lookAt(new THREE.Vector3(-1, 0, 0));\n  this.add(cameraNX);\n  var cameraPY = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraPY.up.set(0, 0, 1);\n  cameraPY.lookAt(new THREE.Vector3(0, 1, 0));\n  this.add(cameraPY);\n  var cameraNY = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraNY.up.set(0, 0, -1);\n  cameraNY.lookAt(new THREE.Vector3(0, -1, 0));\n  this.add(cameraNY);\n  var cameraPZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraPZ.up.set(0, -1, 0);\n  cameraPZ.lookAt(new THREE.Vector3(0, 0, 1));\n  this.add(cameraPZ);\n  var cameraNZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\n  cameraNZ.up.set(0, -1, 0);\n  cameraNZ.lookAt(new THREE.Vector3(0, 0, -1));\n  this.add(cameraNZ);\n  this.renderTarget = new THREE.WebGLRenderTargetCube(cubeResolution, cubeResolution, {\n    format: THREE.RGBFormat,\n    magFilter: THREE.LinearFilter,\n    minFilter: THREE.LinearFilter\n  });\n\n  this.updateCubeMap = function (renderer, scene) {\n    if (this.parent === null) this.updateMatrixWorld();\n    var renderTarget = this.renderTarget;\n    var generateMipmaps = renderTarget.generateMipmaps;\n    renderTarget.generateMipmaps = false;\n    renderTarget.activeCubeFace = 0;\n    renderer.render(scene, cameraPX, renderTarget);\n    renderTarget.activeCubeFace = 1;\n    renderer.render(scene, cameraNX, renderTarget);\n    renderTarget.activeCubeFace = 2;\n    renderer.render(scene, cameraPY, renderTarget);\n    renderTarget.activeCubeFace = 3;\n    renderer.render(scene, cameraNY, renderTarget);\n    renderTarget.activeCubeFace = 4;\n    renderer.render(scene, cameraPZ, renderTarget);\n    renderTarget.generateMipmaps = generateMipmaps;\n    renderTarget.activeCubeFace = 5;\n    renderer.render(scene, cameraNZ, renderTarget);\n    renderer.setRenderTarget(null);\n  };\n};\n\nTHREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera; // File:src/cameras/OrthographicCamera.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.OrthographicCamera = function (left, right, top, bottom, near, far) {\n  THREE.Camera.call(this);\n  this.type = 'OrthographicCamera';\n  this.zoom = 1;\n  this.left = left;\n  this.right = right;\n  this.top = top;\n  this.bottom = bottom;\n  this.near = near !== undefined ? near : 0.1;\n  this.far = far !== undefined ? far : 2000;\n  this.updateProjectionMatrix();\n};\n\nTHREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype);\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\n\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function () {\n  var dx = (this.right - this.left) / (2 * this.zoom);\n  var dy = (this.top - this.bottom) / (2 * this.zoom);\n  var cx = (this.right + this.left) / 2;\n  var cy = (this.top + this.bottom) / 2;\n  this.projectionMatrix.makeOrthographic(cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far);\n};\n\nTHREE.OrthographicCamera.prototype.copy = function (source) {\n  THREE.Camera.prototype.copy.call(this, source);\n  this.left = source.left;\n  this.right = source.right;\n  this.top = source.top;\n  this.bottom = source.bottom;\n  this.near = source.near;\n  this.far = source.far;\n  this.zoom = source.zoom;\n  return this;\n};\n\nTHREE.OrthographicCamera.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.zoom = this.zoom;\n  data.object.left = this.left;\n  data.object.right = this.right;\n  data.object.top = this.top;\n  data.object.bottom = this.bottom;\n  data.object.near = this.near;\n  data.object.far = this.far;\n  return data;\n}; // File:src/cameras/PerspectiveCamera.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\n\n\nTHREE.PerspectiveCamera = function (fov, aspect, near, far) {\n  THREE.Camera.call(this);\n  this.type = 'PerspectiveCamera';\n  this.zoom = 1;\n  this.fov = fov !== undefined ? fov : 50;\n  this.aspect = aspect !== undefined ? aspect : 1;\n  this.near = near !== undefined ? near : 0.1;\n  this.far = far !== undefined ? far : 2000;\n  this.updateProjectionMatrix();\n};\n\nTHREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype);\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (full-frame) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\n\nTHREE.PerspectiveCamera.prototype.setLens = function (focalLength, frameHeight) {\n  if (frameHeight === undefined) frameHeight = 24;\n  this.fov = 2 * THREE.Math.radToDeg(Math.atan(frameHeight / (focalLength * 2)));\n  this.updateProjectionMatrix();\n};\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\n\n\nTHREE.PerspectiveCamera.prototype.setViewOffset = function (fullWidth, fullHeight, x, y, width, height) {\n  this.fullWidth = fullWidth;\n  this.fullHeight = fullHeight;\n  this.x = x;\n  this.y = y;\n  this.width = width;\n  this.height = height;\n  this.updateProjectionMatrix();\n};\n\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function () {\n  var fov = THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(this.fov) * 0.5) / this.zoom));\n\n  if (this.fullWidth) {\n    var aspect = this.fullWidth / this.fullHeight;\n    var top = Math.tan(THREE.Math.degToRad(fov * 0.5)) * this.near;\n    var bottom = -top;\n    var left = aspect * bottom;\n    var right = aspect * top;\n    var width = Math.abs(right - left);\n    var height = Math.abs(top - bottom);\n    this.projectionMatrix.makeFrustum(left + this.x * width / this.fullWidth, left + (this.x + this.width) * width / this.fullWidth, top - (this.y + this.height) * height / this.fullHeight, top - this.y * height / this.fullHeight, this.near, this.far);\n  } else {\n    this.projectionMatrix.makePerspective(fov, this.aspect, this.near, this.far);\n  }\n};\n\nTHREE.PerspectiveCamera.prototype.copy = function (source) {\n  THREE.Camera.prototype.copy.call(this, source);\n  this.fov = source.fov;\n  this.aspect = source.aspect;\n  this.near = source.near;\n  this.far = source.far;\n  this.zoom = source.zoom;\n  return this;\n};\n\nTHREE.PerspectiveCamera.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.zoom = this.zoom;\n  data.object.fov = this.fov;\n  data.object.aspect = this.aspect;\n  data.object.near = this.near;\n  data.object.far = this.far;\n  return data;\n}; // File:src/lights/Light.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.Light = function (color) {\n  THREE.Object3D.call(this);\n  this.type = 'Light';\n  this.color = new THREE.Color(color);\n};\n\nTHREE.Light.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Light.prototype.constructor = THREE.Light;\n\nTHREE.Light.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  return this;\n}; // File:src/lights/AmbientLight.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.AmbientLight = function (color) {\n  THREE.Light.call(this, color);\n  this.type = 'AmbientLight';\n};\n\nTHREE.AmbientLight.prototype = Object.create(THREE.Light.prototype);\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\n\nTHREE.AmbientLight.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.color = this.color.getHex();\n  return data;\n}; // File:src/lights/DirectionalLight.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.DirectionalLight = function (color, intensity) {\n  THREE.Light.call(this, color);\n  this.type = 'DirectionalLight';\n  this.position.set(0, 1, 0);\n  this.updateMatrix();\n  this.target = new THREE.Object3D();\n  this.intensity = intensity !== undefined ? intensity : 1;\n  this.castShadow = false;\n  this.onlyShadow = false;\n  this.shadowCameraNear = 50;\n  this.shadowCameraFar = 5000;\n  this.shadowCameraLeft = -500;\n  this.shadowCameraRight = 500;\n  this.shadowCameraTop = 500;\n  this.shadowCameraBottom = -500;\n  this.shadowCameraVisible = false;\n  this.shadowBias = 0;\n  this.shadowDarkness = 0.5;\n  this.shadowMapWidth = 512;\n  this.shadowMapHeight = 512;\n  this.shadowMap = null;\n  this.shadowMapSize = null;\n  this.shadowCamera = null;\n  this.shadowMatrix = null;\n};\n\nTHREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype);\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\n\nTHREE.DirectionalLight.prototype.copy = function (source) {\n  THREE.Light.prototype.copy.call(this, source);\n  this.intensity = source.intensity;\n  this.target = source.target.clone();\n  this.castShadow = source.castShadow;\n  this.onlyShadow = source.onlyShadow;\n  this.shadowCameraNear = source.shadowCameraNear;\n  this.shadowCameraFar = source.shadowCameraFar;\n  this.shadowCameraLeft = source.shadowCameraLeft;\n  this.shadowCameraRight = source.shadowCameraRight;\n  this.shadowCameraTop = source.shadowCameraTop;\n  this.shadowCameraBottom = source.shadowCameraBottom;\n  this.shadowCameraVisible = source.shadowCameraVisible;\n  this.shadowBias = source.shadowBias;\n  this.shadowDarkness = source.shadowDarkness;\n  this.shadowMapWidth = source.shadowMapWidth;\n  this.shadowMapHeight = source.shadowMapHeight;\n  return this;\n};\n\nTHREE.DirectionalLight.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.color = this.color.getHex();\n  data.object.intensity = this.intensity;\n  return data;\n}; // File:src/lights/HemisphereLight.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.HemisphereLight = function (skyColor, groundColor, intensity) {\n  THREE.Light.call(this, skyColor);\n  this.type = 'HemisphereLight';\n  this.position.set(0, 1, 0);\n  this.updateMatrix();\n  this.groundColor = new THREE.Color(groundColor);\n  this.intensity = intensity !== undefined ? intensity : 1;\n};\n\nTHREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype);\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\n\nTHREE.HemisphereLight.prototype.copy = function (source) {\n  THREE.Light.prototype.copy.call(this, source);\n  this.groundColor.copy(source.groundColor);\n  this.intensity = source.intensity;\n  return this;\n};\n\nTHREE.HemisphereLight.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.color = this.color.getHex();\n  data.object.groundColor = this.groundColor.getHex();\n  data.object.intensity = this.intensity;\n  return data;\n}; // File:src/lights/PointLight.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.PointLight = function (color, intensity, distance, decay) {\n  THREE.Light.call(this, color);\n  this.type = 'PointLight';\n  this.intensity = intensity !== undefined ? intensity : 1;\n  this.distance = distance !== undefined ? distance : 0;\n  this.decay = decay !== undefined ? decay : 1; // for physically correct lights, should be 2.\n};\n\nTHREE.PointLight.prototype = Object.create(THREE.Light.prototype);\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\n\nTHREE.PointLight.prototype.copy = function (source) {\n  THREE.Light.prototype.copy.call(this, source);\n  this.intensity = source.intensity;\n  this.distance = source.distance;\n  this.decay = source.decay;\n  return this;\n};\n\nTHREE.PointLight.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.color = this.color.getHex();\n  data.object.intensity = this.intensity;\n  data.object.distance = this.distance;\n  data.object.decay = this.decay;\n  return data;\n}; // File:src/lights/SpotLight.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.SpotLight = function (color, intensity, distance, angle, exponent, decay) {\n  THREE.Light.call(this, color);\n  this.type = 'SpotLight';\n  this.position.set(0, 1, 0);\n  this.updateMatrix();\n  this.target = new THREE.Object3D();\n  this.intensity = intensity !== undefined ? intensity : 1;\n  this.distance = distance !== undefined ? distance : 0;\n  this.angle = angle !== undefined ? angle : Math.PI / 3;\n  this.exponent = exponent !== undefined ? exponent : 10;\n  this.decay = decay !== undefined ? decay : 1; // for physically correct lights, should be 2.\n\n  this.castShadow = false;\n  this.onlyShadow = false;\n  this.shadowCameraNear = 50;\n  this.shadowCameraFar = 5000;\n  this.shadowCameraFov = 50;\n  this.shadowCameraVisible = false;\n  this.shadowBias = 0;\n  this.shadowDarkness = 0.5;\n  this.shadowMapWidth = 512;\n  this.shadowMapHeight = 512;\n  this.shadowMap = null;\n  this.shadowMapSize = null;\n  this.shadowCamera = null;\n  this.shadowMatrix = null;\n};\n\nTHREE.SpotLight.prototype = Object.create(THREE.Light.prototype);\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\n\nTHREE.SpotLight.prototype.copy = function (source) {\n  THREE.Light.prototype.copy.call(this, source);\n  this.intensity = source.intensity;\n  this.distance = source.distance;\n  this.angle = source.angle;\n  this.exponent = source.exponent;\n  this.decay = source.decay;\n  this.target = source.target.clone();\n  this.castShadow = source.castShadow;\n  this.onlyShadow = source.onlyShadow;\n  this.shadowCameraNear = source.shadowCameraNear;\n  this.shadowCameraFar = source.shadowCameraFar;\n  this.shadowCameraFov = source.shadowCameraFov;\n  this.shadowCameraVisible = source.shadowCameraVisible;\n  this.shadowBias = source.shadowBias;\n  this.shadowDarkness = source.shadowDarkness;\n  this.shadowMapWidth = source.shadowMapWidth;\n  this.shadowMapHeight = source.shadowMapHeight;\n  return this;\n};\n\nTHREE.SpotLight.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.color = this.color.getHex();\n  data.object.intensity = this.intensity;\n  data.object.distance = this.distance;\n  data.object.angle = this.angle;\n  data.object.exponent = this.exponent;\n  data.object.decay = this.decay;\n  return data;\n}; // File:src/loaders/Cache.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.Cache = {\n  enabled: false,\n  files: {},\n  add: function (key, file) {\n    if (this.enabled === false) return; // console.log( 'THREE.Cache', 'Adding key:', key );\n\n    this.files[key] = file;\n  },\n  get: function (key) {\n    if (this.enabled === false) return; // console.log( 'THREE.Cache', 'Checking key:', key );\n\n    return this.files[key];\n  },\n  remove: function (key) {\n    delete this.files[key];\n  },\n  clear: function () {\n    this.files = {};\n  }\n}; // File:src/loaders/Loader.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Loader = function () {\n  this.onLoadStart = function () {};\n\n  this.onLoadProgress = function () {};\n\n  this.onLoadComplete = function () {};\n};\n\nTHREE.Loader.prototype = {\n  constructor: THREE.Loader,\n  crossOrigin: undefined,\n  extractUrlBase: function (url) {\n    var parts = url.split('/');\n    if (parts.length === 1) return './';\n    parts.pop();\n    return parts.join('/') + '/';\n  },\n  initMaterials: function (materials, texturePath, crossOrigin) {\n    var array = [];\n\n    for (var i = 0; i < materials.length; ++i) {\n      array[i] = this.createMaterial(materials[i], texturePath, crossOrigin);\n    }\n\n    return array;\n  },\n  createMaterial: function () {\n    var imageLoader;\n    return function createMaterial(m, texturePath, crossOrigin) {\n      var scope = this;\n      if (crossOrigin === undefined && scope.crossOrigin !== undefined) crossOrigin = scope.crossOrigin;\n      if (imageLoader === undefined) imageLoader = new THREE.ImageLoader();\n\n      function nearest_pow2(n) {\n        var l = Math.log(n) / Math.LN2;\n        return Math.pow(2, Math.round(l));\n      }\n\n      function create_texture(where, name, sourceFile, repeat, offset, wrap, anisotropy) {\n        var fullPath = texturePath + sourceFile;\n        var texture;\n        var loader = THREE.Loader.Handlers.get(fullPath);\n\n        if (loader !== null) {\n          texture = loader.load(fullPath);\n        } else {\n          texture = new THREE.Texture();\n          loader = imageLoader;\n          loader.setCrossOrigin(crossOrigin);\n          loader.load(fullPath, function (image) {\n            if (THREE.Math.isPowerOfTwo(image.width) === false || THREE.Math.isPowerOfTwo(image.height) === false) {\n              var width = nearest_pow2(image.width);\n              var height = nearest_pow2(image.height);\n              var canvas = document.createElement('canvas');\n              canvas.width = width;\n              canvas.height = height;\n              var context = canvas.getContext('2d');\n              context.drawImage(image, 0, 0, width, height);\n              texture.image = canvas;\n            } else {\n              texture.image = image;\n            }\n\n            texture.needsUpdate = true;\n          });\n        }\n\n        texture.sourceFile = sourceFile;\n\n        if (repeat) {\n          texture.repeat.set(repeat[0], repeat[1]);\n          if (repeat[0] !== 1) texture.wrapS = THREE.RepeatWrapping;\n          if (repeat[1] !== 1) texture.wrapT = THREE.RepeatWrapping;\n        }\n\n        if (offset) {\n          texture.offset.set(offset[0], offset[1]);\n        }\n\n        if (wrap) {\n          var wrapMap = {\n            'repeat': THREE.RepeatWrapping,\n            'mirror': THREE.MirroredRepeatWrapping\n          };\n          if (wrapMap[wrap[0]] !== undefined) texture.wrapS = wrapMap[wrap[0]];\n          if (wrapMap[wrap[1]] !== undefined) texture.wrapT = wrapMap[wrap[1]];\n        }\n\n        if (anisotropy) {\n          texture.anisotropy = anisotropy;\n        }\n\n        where[name] = texture;\n      }\n\n      function rgb2hex(rgb) {\n        return (rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255;\n      } // defaults\n\n\n      var mtype = 'MeshLambertMaterial';\n      var mpars = {}; // parameters from model file\n\n      if (m.shading) {\n        var shading = m.shading.toLowerCase();\n        if (shading === 'phong') mtype = 'MeshPhongMaterial';else if (shading === 'basic') mtype = 'MeshBasicMaterial';\n      }\n\n      if (m.blending !== undefined && THREE[m.blending] !== undefined) {\n        mpars.blending = THREE[m.blending];\n      }\n\n      if (m.transparent !== undefined) {\n        mpars.transparent = m.transparent;\n      }\n\n      if (m.opacity !== undefined && m.opacity < 1.0) {\n        mpars.transparent = true;\n      }\n\n      if (m.depthTest !== undefined) {\n        mpars.depthTest = m.depthTest;\n      }\n\n      if (m.depthWrite !== undefined) {\n        mpars.depthWrite = m.depthWrite;\n      }\n\n      if (m.visible !== undefined) {\n        mpars.visible = m.visible;\n      }\n\n      if (m.flipSided !== undefined) {\n        mpars.side = THREE.BackSide;\n      }\n\n      if (m.doubleSided !== undefined) {\n        mpars.side = THREE.DoubleSide;\n      }\n\n      if (m.wireframe !== undefined) {\n        mpars.wireframe = m.wireframe;\n      }\n\n      if (m.vertexColors !== undefined) {\n        if (m.vertexColors === 'face') {\n          mpars.vertexColors = THREE.FaceColors;\n        } else if (m.vertexColors) {\n          mpars.vertexColors = THREE.VertexColors;\n        }\n      } // colors\n\n\n      if (m.colorDiffuse) {\n        mpars.color = rgb2hex(m.colorDiffuse);\n      } else if (m.DbgColor) {\n        mpars.color = m.DbgColor;\n      }\n\n      if (m.colorEmissive) {\n        mpars.emissive = rgb2hex(m.colorEmissive);\n      }\n\n      if (mtype === 'MeshPhongMaterial') {\n        if (m.colorSpecular) {\n          mpars.specular = rgb2hex(m.colorSpecular);\n        }\n\n        if (m.specularCoef) {\n          mpars.shininess = m.specularCoef;\n        }\n      } // modifiers\n\n\n      if (m.transparency !== undefined) {\n        console.warn('THREE.Loader: transparency has been renamed to opacity');\n        m.opacity = m.transparency;\n      }\n\n      if (m.opacity !== undefined) {\n        mpars.opacity = m.opacity;\n      } // textures\n\n\n      if (texturePath) {\n        if (m.mapDiffuse) {\n          create_texture(mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy);\n        }\n\n        if (m.mapLight) {\n          create_texture(mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy);\n        }\n\n        if (m.mapAO) {\n          create_texture(mpars, 'aoMap', m.mapAO, m.mapAORepeat, m.mapAOOffset, m.mapAOWrap, m.mapAOAnisotropy);\n        }\n\n        if (m.mapBump) {\n          create_texture(mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy);\n        }\n\n        if (m.mapNormal) {\n          create_texture(mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy);\n        }\n\n        if (m.mapSpecular) {\n          create_texture(mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy);\n        }\n\n        if (m.mapAlpha) {\n          create_texture(mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy);\n        }\n      } //\n\n\n      if (m.mapBumpScale) {\n        mpars.bumpScale = m.mapBumpScale;\n      }\n\n      if (m.mapNormalFactor) {\n        mpars.normalScale = new THREE.Vector2(m.mapNormalFactor, m.mapNormalFactor);\n      }\n\n      var material = new THREE[mtype](mpars);\n      if (m.DbgName !== undefined) material.name = m.DbgName;\n      return material;\n    };\n  }()\n};\nTHREE.Loader.Handlers = {\n  handlers: [],\n  add: function (regex, loader) {\n    this.handlers.push(regex, loader);\n  },\n  get: function (file) {\n    for (var i = 0, l = this.handlers.length; i < l; i += 2) {\n      var regex = this.handlers[i];\n      var loader = this.handlers[i + 1];\n\n      if (regex.test(file)) {\n        return loader;\n      }\n    }\n\n    return null;\n  }\n}; // File:src/loaders/XHRLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.XHRLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n};\n\nTHREE.XHRLoader.prototype = {\n  constructor: THREE.XHRLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var cached = THREE.Cache.get(url);\n\n    if (cached !== undefined) {\n      if (onLoad) {\n        setTimeout(function () {\n          onLoad(cached);\n        }, 0);\n      }\n\n      return cached;\n    }\n\n    var request = new XMLHttpRequest();\n    request.open('GET', url, true);\n    request.addEventListener('load', function (event) {\n      THREE.Cache.add(url, this.response);\n      if (onLoad) onLoad(this.response);\n      scope.manager.itemEnd(url);\n    }, false);\n\n    if (onProgress !== undefined) {\n      request.addEventListener('progress', function (event) {\n        onProgress(event);\n      }, false);\n    }\n\n    request.addEventListener('error', function (event) {\n      if (onError) onError(event);\n      scope.manager.itemError(url);\n    }, false);\n    if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;\n    if (this.responseType !== undefined) request.responseType = this.responseType;\n    if (this.withCredentials !== undefined) request.withCredentials = this.withCredentials;\n    request.send(null);\n    scope.manager.itemStart(url);\n    return request;\n  },\n  setResponseType: function (value) {\n    this.responseType = value;\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  },\n  setWithCredentials: function (value) {\n    this.withCredentials = value;\n  }\n}; // File:src/loaders/ImageLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.ImageLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n};\n\nTHREE.ImageLoader.prototype = {\n  constructor: THREE.ImageLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var cached = THREE.Cache.get(url);\n\n    if (cached !== undefined) {\n      if (onLoad) {\n        setTimeout(function () {\n          onLoad(cached);\n        }, 0);\n      }\n\n      return cached;\n    }\n\n    var image = document.createElement('img');\n    image.addEventListener('load', function (event) {\n      THREE.Cache.add(url, this);\n      if (onLoad) onLoad(this);\n      scope.manager.itemEnd(url);\n    }, false);\n\n    if (onProgress !== undefined) {\n      image.addEventListener('progress', function (event) {\n        onProgress(event);\n      }, false);\n    }\n\n    image.addEventListener('error', function (event) {\n      if (onError) onError(event);\n      scope.manager.itemError(url);\n    }, false);\n    if (this.crossOrigin !== undefined) image.crossOrigin = this.crossOrigin;\n    scope.manager.itemStart(url);\n    image.src = url;\n    return image;\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  }\n}; // File:src/loaders/JSONLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.JSONLoader = function (manager) {\n  if (typeof manager === 'boolean') {\n    console.warn('THREE.JSONLoader: showStatus parameter has been removed from constructor.');\n    manager = undefined;\n  }\n\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n  this.withCredentials = false;\n};\n\nTHREE.JSONLoader.prototype = {\n  constructor: THREE.JSONLoader,\n\n  // Deprecated\n  get statusDomElement() {\n    if (this._statusDomElement === undefined) {\n      this._statusDomElement = document.createElement('div');\n    }\n\n    console.warn('THREE.JSONLoader: .statusDomElement has been removed.');\n    return this._statusDomElement;\n  },\n\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var texturePath = this.texturePath && typeof this.texturePath === \"string\" ? this.texturePath : THREE.Loader.prototype.extractUrlBase(url);\n    var loader = new THREE.XHRLoader(this.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.setWithCredentials(this.withCredentials);\n    loader.load(url, function (text) {\n      var json = JSON.parse(text);\n      var metadata = json.metadata;\n\n      if (metadata !== undefined) {\n        if (metadata.type === 'object') {\n          console.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.');\n          return;\n        }\n\n        if (metadata.type === 'scene') {\n          console.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.SceneLoader instead.');\n          return;\n        }\n      }\n\n      var object = scope.parse(json, texturePath);\n      onLoad(object.geometry, object.materials);\n    });\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  },\n  setTexturePath: function (value) {\n    this.texturePath = value;\n  },\n  parse: function (json, texturePath) {\n    var geometry = new THREE.Geometry(),\n        scale = json.scale !== undefined ? 1.0 / json.scale : 1.0;\n    parseModel(scale);\n    parseSkin();\n    parseMorphing(scale);\n    geometry.computeFaceNormals();\n    geometry.computeBoundingSphere();\n\n    function parseModel(scale) {\n      function isBitSet(value, position) {\n        return value & 1 << position;\n      }\n\n      var i,\n          j,\n          fi,\n          offset,\n          zLength,\n          colorIndex,\n          normalIndex,\n          uvIndex,\n          materialIndex,\n          type,\n          isQuad,\n          hasMaterial,\n          hasFaceVertexUv,\n          hasFaceNormal,\n          hasFaceVertexNormal,\n          hasFaceColor,\n          hasFaceVertexColor,\n          vertex,\n          face,\n          faceA,\n          faceB,\n          hex,\n          normal,\n          uvLayer,\n          uv,\n          u,\n          v,\n          faces = json.faces,\n          vertices = json.vertices,\n          normals = json.normals,\n          colors = json.colors,\n          nUvLayers = 0;\n\n      if (json.uvs !== undefined) {\n        // disregard empty arrays\n        for (i = 0; i < json.uvs.length; i++) {\n          if (json.uvs[i].length) nUvLayers++;\n        }\n\n        for (i = 0; i < nUvLayers; i++) {\n          geometry.faceVertexUvs[i] = [];\n        }\n      }\n\n      offset = 0;\n      zLength = vertices.length;\n\n      while (offset < zLength) {\n        vertex = new THREE.Vector3();\n        vertex.x = vertices[offset++] * scale;\n        vertex.y = vertices[offset++] * scale;\n        vertex.z = vertices[offset++] * scale;\n        geometry.vertices.push(vertex);\n      }\n\n      offset = 0;\n      zLength = faces.length;\n\n      while (offset < zLength) {\n        type = faces[offset++];\n        isQuad = isBitSet(type, 0);\n        hasMaterial = isBitSet(type, 1);\n        hasFaceVertexUv = isBitSet(type, 3);\n        hasFaceNormal = isBitSet(type, 4);\n        hasFaceVertexNormal = isBitSet(type, 5);\n        hasFaceColor = isBitSet(type, 6);\n        hasFaceVertexColor = isBitSet(type, 7); // console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\n\n        if (isQuad) {\n          faceA = new THREE.Face3();\n          faceA.a = faces[offset];\n          faceA.b = faces[offset + 1];\n          faceA.c = faces[offset + 3];\n          faceB = new THREE.Face3();\n          faceB.a = faces[offset + 1];\n          faceB.b = faces[offset + 2];\n          faceB.c = faces[offset + 3];\n          offset += 4;\n\n          if (hasMaterial) {\n            materialIndex = faces[offset++];\n            faceA.materialIndex = materialIndex;\n            faceB.materialIndex = materialIndex;\n          } // to get face <=> uv index correspondence\n\n\n          fi = geometry.faces.length;\n\n          if (hasFaceVertexUv) {\n            for (i = 0; i < nUvLayers; i++) {\n              uvLayer = json.uvs[i];\n              geometry.faceVertexUvs[i][fi] = [];\n              geometry.faceVertexUvs[i][fi + 1] = [];\n\n              for (j = 0; j < 4; j++) {\n                uvIndex = faces[offset++];\n                u = uvLayer[uvIndex * 2];\n                v = uvLayer[uvIndex * 2 + 1];\n                uv = new THREE.Vector2(u, v);\n                if (j !== 2) geometry.faceVertexUvs[i][fi].push(uv);\n                if (j !== 0) geometry.faceVertexUvs[i][fi + 1].push(uv);\n              }\n            }\n          }\n\n          if (hasFaceNormal) {\n            normalIndex = faces[offset++] * 3;\n            faceA.normal.set(normals[normalIndex++], normals[normalIndex++], normals[normalIndex]);\n            faceB.normal.copy(faceA.normal);\n          }\n\n          if (hasFaceVertexNormal) {\n            for (i = 0; i < 4; i++) {\n              normalIndex = faces[offset++] * 3;\n              normal = new THREE.Vector3(normals[normalIndex++], normals[normalIndex++], normals[normalIndex]);\n              if (i !== 2) faceA.vertexNormals.push(normal);\n              if (i !== 0) faceB.vertexNormals.push(normal);\n            }\n          }\n\n          if (hasFaceColor) {\n            colorIndex = faces[offset++];\n            hex = colors[colorIndex];\n            faceA.color.setHex(hex);\n            faceB.color.setHex(hex);\n          }\n\n          if (hasFaceVertexColor) {\n            for (i = 0; i < 4; i++) {\n              colorIndex = faces[offset++];\n              hex = colors[colorIndex];\n              if (i !== 2) faceA.vertexColors.push(new THREE.Color(hex));\n              if (i !== 0) faceB.vertexColors.push(new THREE.Color(hex));\n            }\n          }\n\n          geometry.faces.push(faceA);\n          geometry.faces.push(faceB);\n        } else {\n          face = new THREE.Face3();\n          face.a = faces[offset++];\n          face.b = faces[offset++];\n          face.c = faces[offset++];\n\n          if (hasMaterial) {\n            materialIndex = faces[offset++];\n            face.materialIndex = materialIndex;\n          } // to get face <=> uv index correspondence\n\n\n          fi = geometry.faces.length;\n\n          if (hasFaceVertexUv) {\n            for (i = 0; i < nUvLayers; i++) {\n              uvLayer = json.uvs[i];\n              geometry.faceVertexUvs[i][fi] = [];\n\n              for (j = 0; j < 3; j++) {\n                uvIndex = faces[offset++];\n                u = uvLayer[uvIndex * 2];\n                v = uvLayer[uvIndex * 2 + 1];\n                uv = new THREE.Vector2(u, v);\n                geometry.faceVertexUvs[i][fi].push(uv);\n              }\n            }\n          }\n\n          if (hasFaceNormal) {\n            normalIndex = faces[offset++] * 3;\n            face.normal.set(normals[normalIndex++], normals[normalIndex++], normals[normalIndex]);\n          }\n\n          if (hasFaceVertexNormal) {\n            for (i = 0; i < 3; i++) {\n              normalIndex = faces[offset++] * 3;\n              normal = new THREE.Vector3(normals[normalIndex++], normals[normalIndex++], normals[normalIndex]);\n              face.vertexNormals.push(normal);\n            }\n          }\n\n          if (hasFaceColor) {\n            colorIndex = faces[offset++];\n            face.color.setHex(colors[colorIndex]);\n          }\n\n          if (hasFaceVertexColor) {\n            for (i = 0; i < 3; i++) {\n              colorIndex = faces[offset++];\n              face.vertexColors.push(new THREE.Color(colors[colorIndex]));\n            }\n          }\n\n          geometry.faces.push(face);\n        }\n      }\n    }\n\n    ;\n\n    function parseSkin() {\n      var influencesPerVertex = json.influencesPerVertex !== undefined ? json.influencesPerVertex : 2;\n\n      if (json.skinWeights) {\n        for (var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex) {\n          var x = json.skinWeights[i];\n          var y = influencesPerVertex > 1 ? json.skinWeights[i + 1] : 0;\n          var z = influencesPerVertex > 2 ? json.skinWeights[i + 2] : 0;\n          var w = influencesPerVertex > 3 ? json.skinWeights[i + 3] : 0;\n          geometry.skinWeights.push(new THREE.Vector4(x, y, z, w));\n        }\n      }\n\n      if (json.skinIndices) {\n        for (var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex) {\n          var a = json.skinIndices[i];\n          var b = influencesPerVertex > 1 ? json.skinIndices[i + 1] : 0;\n          var c = influencesPerVertex > 2 ? json.skinIndices[i + 2] : 0;\n          var d = influencesPerVertex > 3 ? json.skinIndices[i + 3] : 0;\n          geometry.skinIndices.push(new THREE.Vector4(a, b, c, d));\n        }\n      }\n\n      geometry.bones = json.bones;\n\n      if (geometry.bones && geometry.bones.length > 0 && (geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length)) {\n        console.warn('When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' + geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.');\n      } // could change this to json.animations[0] or remove completely\n\n\n      geometry.animation = json.animation;\n      geometry.animations = json.animations;\n    }\n\n    ;\n\n    function parseMorphing(scale) {\n      if (json.morphTargets !== undefined) {\n        var i, l, v, vl, dstVertices, srcVertices;\n\n        for (i = 0, l = json.morphTargets.length; i < l; i++) {\n          geometry.morphTargets[i] = {};\n          geometry.morphTargets[i].name = json.morphTargets[i].name;\n          geometry.morphTargets[i].vertices = [];\n          dstVertices = geometry.morphTargets[i].vertices;\n          srcVertices = json.morphTargets[i].vertices;\n\n          for (v = 0, vl = srcVertices.length; v < vl; v += 3) {\n            var vertex = new THREE.Vector3();\n            vertex.x = srcVertices[v] * scale;\n            vertex.y = srcVertices[v + 1] * scale;\n            vertex.z = srcVertices[v + 2] * scale;\n            dstVertices.push(vertex);\n          }\n        }\n      }\n\n      if (json.morphColors !== undefined) {\n        var i, l, c, cl, dstColors, srcColors, color;\n\n        for (i = 0, l = json.morphColors.length; i < l; i++) {\n          geometry.morphColors[i] = {};\n          geometry.morphColors[i].name = json.morphColors[i].name;\n          geometry.morphColors[i].colors = [];\n          dstColors = geometry.morphColors[i].colors;\n          srcColors = json.morphColors[i].colors;\n\n          for (c = 0, cl = srcColors.length; c < cl; c += 3) {\n            color = new THREE.Color(0xffaa00);\n            color.setRGB(srcColors[c], srcColors[c + 1], srcColors[c + 2]);\n            dstColors.push(color);\n          }\n        }\n      }\n    }\n\n    ;\n\n    if (json.materials === undefined || json.materials.length === 0) {\n      return {\n        geometry: geometry\n      };\n    } else {\n      var materials = THREE.Loader.prototype.initMaterials(json.materials, texturePath, this.crossOrigin);\n      return {\n        geometry: geometry,\n        materials: materials\n      };\n    }\n  }\n}; // File:src/loaders/LoadingManager.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.LoadingManager = function (onLoad, onProgress, onError) {\n  var scope = this;\n  var isLoading = false,\n      itemsLoaded = 0,\n      itemsTotal = 0;\n  this.onStart = undefined;\n  this.onLoad = onLoad;\n  this.onProgress = onProgress;\n  this.onError = onError;\n\n  this.itemStart = function (url) {\n    itemsTotal++;\n\n    if (isLoading === false) {\n      if (scope.onStart !== undefined) {\n        scope.onStart(url, itemsLoaded, itemsTotal);\n      }\n    }\n\n    isLoading = true;\n  };\n\n  this.itemEnd = function (url) {\n    itemsLoaded++;\n\n    if (scope.onProgress !== undefined) {\n      scope.onProgress(url, itemsLoaded, itemsTotal);\n    }\n\n    if (itemsLoaded === itemsTotal) {\n      isLoading = false;\n\n      if (scope.onLoad !== undefined) {\n        scope.onLoad();\n      }\n    }\n  };\n\n  this.itemError = function (url) {\n    if (scope.onError !== undefined) {\n      scope.onError(url);\n    }\n  };\n};\n\nTHREE.DefaultLoadingManager = new THREE.LoadingManager(); // File:src/loaders/BufferGeometryLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.BufferGeometryLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n};\n\nTHREE.BufferGeometryLoader.prototype = {\n  constructor: THREE.BufferGeometryLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new THREE.XHRLoader(scope.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.load(url, function (text) {\n      onLoad(scope.parse(JSON.parse(text)));\n    }, onProgress, onError);\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  },\n  parse: function (json) {\n    var geometry = new THREE.BufferGeometry();\n    var index = json.data.index;\n\n    if (index !== undefined) {\n      var typedArray = new self[index.type](index.array);\n      geometry.setIndex(new THREE.BufferAttribute(typedArray, 1));\n    }\n\n    var attributes = json.data.attributes;\n\n    for (var key in attributes) {\n      var attribute = attributes[key];\n      var typedArray = new self[attribute.type](attribute.array);\n      geometry.addAttribute(key, new THREE.BufferAttribute(typedArray, attribute.itemSize));\n    }\n\n    var groups = json.data.groups || json.data.drawcalls || json.data.offsets;\n\n    if (groups !== undefined) {\n      for (var i = 0, n = groups.length; i !== n; ++i) {\n        var group = groups[i];\n        geometry.addGroup(group.start, group.count);\n      }\n    }\n\n    var boundingSphere = json.data.boundingSphere;\n\n    if (boundingSphere !== undefined) {\n      var center = new THREE.Vector3();\n\n      if (boundingSphere.center !== undefined) {\n        center.fromArray(boundingSphere.center);\n      }\n\n      geometry.boundingSphere = new THREE.Sphere(center, boundingSphere.radius);\n    }\n\n    return geometry;\n  }\n}; // File:src/loaders/MaterialLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.MaterialLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n  this.textures = {};\n};\n\nTHREE.MaterialLoader.prototype = {\n  constructor: THREE.MaterialLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new THREE.XHRLoader(scope.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.load(url, function (text) {\n      onLoad(scope.parse(JSON.parse(text)));\n    }, onProgress, onError);\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  },\n  setTextures: function (value) {\n    this.textures = value;\n  },\n  getTexture: function (name) {\n    var textures = this.textures;\n\n    if (textures[name] === undefined) {\n      console.warn('THREE.MaterialLoader: Undefined texture', name);\n    }\n\n    return textures[name];\n  },\n  parse: function (json) {\n    var material = new THREE[json.type]();\n    material.uuid = json.uuid;\n    if (json.name !== undefined) material.name = json.name;\n    if (json.color !== undefined) material.color.setHex(json.color);\n    if (json.emissive !== undefined) material.emissive.setHex(json.emissive);\n    if (json.specular !== undefined) material.specular.setHex(json.specular);\n    if (json.shininess !== undefined) material.shininess = json.shininess;\n    if (json.uniforms !== undefined) material.uniforms = json.uniforms;\n    if (json.vertexShader !== undefined) material.vertexShader = json.vertexShader;\n    if (json.fragmentShader !== undefined) material.fragmentShader = json.fragmentShader;\n    if (json.vertexColors !== undefined) material.vertexColors = json.vertexColors;\n    if (json.shading !== undefined) material.shading = json.shading;\n    if (json.blending !== undefined) material.blending = json.blending;\n    if (json.side !== undefined) material.side = json.side;\n    if (json.opacity !== undefined) material.opacity = json.opacity;\n    if (json.transparent !== undefined) material.transparent = json.transparent;\n    if (json.alphaTest !== undefined) material.alphaTest = json.alphaTest;\n    if (json.depthTest !== undefined) material.depthTest = json.depthTest;\n    if (json.depthWrite !== undefined) material.depthWrite = json.depthWrite;\n    if (json.wireframe !== undefined) material.wireframe = json.wireframe;\n    if (json.wireframeLinewidth !== undefined) material.wireframeLinewidth = json.wireframeLinewidth; // for PointsMaterial\n\n    if (json.size !== undefined) material.size = json.size;\n    if (json.sizeAttenuation !== undefined) material.sizeAttenuation = json.sizeAttenuation; // maps\n\n    if (json.map !== undefined) material.map = this.getTexture(json.map);\n\n    if (json.alphaMap !== undefined) {\n      material.alphaMap = this.getTexture(json.alphaMap);\n      material.transparent = true;\n    }\n\n    if (json.bumpMap !== undefined) material.bumpMap = this.getTexture(json.bumpMap);\n    if (json.bumpScale !== undefined) material.bumpScale = json.bumpScale;\n    if (json.normalMap !== undefined) material.normalMap = this.getTexture(json.normalMap);\n    if (json.normalScale) material.normalScale = new THREE.Vector2(json.normalScale, json.normalScale);\n    if (json.displacementMap !== undefined) material.displacementMap = this.getTexture(json.displacementMap);\n    if (json.displacementScale !== undefined) material.displacementScale = json.displacementScale;\n    if (json.displacementBias !== undefined) material.displacementBias = json.displacementBias;\n    if (json.specularMap !== undefined) material.specularMap = this.getTexture(json.specularMap);\n\n    if (json.envMap !== undefined) {\n      material.envMap = this.getTexture(json.envMap);\n      material.combine = THREE.MultiplyOperation;\n    }\n\n    if (json.reflectivity) material.reflectivity = json.reflectivity;\n    if (json.lightMap !== undefined) material.lightMap = this.getTexture(json.lightMap);\n    if (json.lightMapIntensity !== undefined) material.lightMapIntensity = json.lightMapIntensity;\n    if (json.aoMap !== undefined) material.aoMap = this.getTexture(json.aoMap);\n    if (json.aoMapIntensity !== undefined) material.aoMapIntensity = json.aoMapIntensity; // MeshFaceMaterial\n\n    if (json.materials !== undefined) {\n      for (var i = 0, l = json.materials.length; i < l; i++) {\n        material.materials.push(this.parse(json.materials[i]));\n      }\n    }\n\n    return material;\n  }\n}; // File:src/loaders/ObjectLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.ObjectLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n  this.texturePath = '';\n};\n\nTHREE.ObjectLoader.prototype = {\n  constructor: THREE.ObjectLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    if (this.texturePath === '') {\n      this.texturePath = url.substring(0, url.lastIndexOf('/') + 1);\n    }\n\n    var scope = this;\n    var loader = new THREE.XHRLoader(scope.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.load(url, function (text) {\n      scope.parse(JSON.parse(text), onLoad);\n    }, onProgress, onError);\n  },\n  setTexturePath: function (value) {\n    this.texturePath = value;\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  },\n  parse: function (json, onLoad) {\n    var geometries = this.parseGeometries(json.geometries);\n    var images = this.parseImages(json.images, function () {\n      if (onLoad !== undefined) onLoad(object);\n    });\n    var textures = this.parseTextures(json.textures, images);\n    var materials = this.parseMaterials(json.materials, textures);\n    var object = this.parseObject(json.object, geometries, materials);\n\n    if (json.images === undefined || json.images.length === 0) {\n      if (onLoad !== undefined) onLoad(object);\n    }\n\n    return object;\n  },\n  parseGeometries: function (json) {\n    var geometries = {};\n\n    if (json !== undefined) {\n      var geometryLoader = new THREE.JSONLoader();\n      var bufferGeometryLoader = new THREE.BufferGeometryLoader();\n\n      for (var i = 0, l = json.length; i < l; i++) {\n        var geometry;\n        var data = json[i];\n\n        switch (data.type) {\n          case 'PlaneGeometry':\n          case 'PlaneBufferGeometry':\n            geometry = new THREE[data.type](data.width, data.height, data.widthSegments, data.heightSegments);\n            break;\n\n          case 'BoxGeometry':\n          case 'CubeGeometry':\n            // backwards compatible\n            geometry = new THREE.BoxGeometry(data.width, data.height, data.depth, data.widthSegments, data.heightSegments, data.depthSegments);\n            break;\n\n          case 'CircleBufferGeometry':\n            geometry = new THREE.CircleBufferGeometry(data.radius, data.segments, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'CircleGeometry':\n            geometry = new THREE.CircleGeometry(data.radius, data.segments, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'CylinderGeometry':\n            geometry = new THREE.CylinderGeometry(data.radiusTop, data.radiusBottom, data.height, data.radialSegments, data.heightSegments, data.openEnded, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'SphereGeometry':\n            geometry = new THREE.SphereGeometry(data.radius, data.widthSegments, data.heightSegments, data.phiStart, data.phiLength, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'SphereBufferGeometry':\n            geometry = new THREE.SphereBufferGeometry(data.radius, data.widthSegments, data.heightSegments, data.phiStart, data.phiLength, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'DodecahedronGeometry':\n            geometry = new THREE.DodecahedronGeometry(data.radius, data.detail);\n            break;\n\n          case 'IcosahedronGeometry':\n            geometry = new THREE.IcosahedronGeometry(data.radius, data.detail);\n            break;\n\n          case 'OctahedronGeometry':\n            geometry = new THREE.OctahedronGeometry(data.radius, data.detail);\n            break;\n\n          case 'TetrahedronGeometry':\n            geometry = new THREE.TetrahedronGeometry(data.radius, data.detail);\n            break;\n\n          case 'RingGeometry':\n            geometry = new THREE.RingGeometry(data.innerRadius, data.outerRadius, data.thetaSegments, data.phiSegments, data.thetaStart, data.thetaLength);\n            break;\n\n          case 'TorusGeometry':\n            geometry = new THREE.TorusGeometry(data.radius, data.tube, data.radialSegments, data.tubularSegments, data.arc);\n            break;\n\n          case 'TorusKnotGeometry':\n            geometry = new THREE.TorusKnotGeometry(data.radius, data.tube, data.radialSegments, data.tubularSegments, data.p, data.q, data.heightScale);\n            break;\n\n          case 'TextGeometry':\n            geometry = new THREE.TextGeometry(data.text, data.data);\n            break;\n\n          case 'BufferGeometry':\n            geometry = bufferGeometryLoader.parse(data);\n            break;\n\n          case 'Geometry':\n            geometry = geometryLoader.parse(data.data, this.texturePath).geometry;\n            break;\n\n          default:\n            console.warn('THREE.ObjectLoader: Unsupported geometry type \"' + data.type + '\"');\n            continue;\n        }\n\n        geometry.uuid = data.uuid;\n        if (data.name !== undefined) geometry.name = data.name;\n        geometries[data.uuid] = geometry;\n      }\n    }\n\n    return geometries;\n  },\n  parseMaterials: function (json, textures) {\n    var materials = {};\n\n    if (json !== undefined) {\n      var loader = new THREE.MaterialLoader();\n      loader.setTextures(textures);\n\n      for (var i = 0, l = json.length; i < l; i++) {\n        var material = loader.parse(json[i]);\n        materials[material.uuid] = material;\n      }\n    }\n\n    return materials;\n  },\n  parseImages: function (json, onLoad) {\n    var scope = this;\n    var images = {};\n\n    function loadImage(url) {\n      scope.manager.itemStart(url);\n      return loader.load(url, function () {\n        scope.manager.itemEnd(url);\n      });\n    }\n\n    if (json !== undefined && json.length > 0) {\n      var manager = new THREE.LoadingManager(onLoad);\n      var loader = new THREE.ImageLoader(manager);\n      loader.setCrossOrigin(this.crossOrigin);\n\n      for (var i = 0, l = json.length; i < l; i++) {\n        var image = json[i];\n        var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.texturePath + image.url;\n        images[image.uuid] = loadImage(path);\n      }\n    }\n\n    return images;\n  },\n  parseTextures: function (json, images) {\n    function parseConstant(value) {\n      if (typeof value === 'number') return value;\n      console.warn('THREE.ObjectLoader.parseTexture: Constant should be in numeric form.', value);\n      return THREE[value];\n    }\n\n    var textures = {};\n\n    if (json !== undefined) {\n      for (var i = 0, l = json.length; i < l; i++) {\n        var data = json[i];\n\n        if (data.image === undefined) {\n          console.warn('THREE.ObjectLoader: No \"image\" specified for', data.uuid);\n        }\n\n        if (images[data.image] === undefined) {\n          console.warn('THREE.ObjectLoader: Undefined image', data.image);\n        }\n\n        var texture = new THREE.Texture(images[data.image]);\n        texture.needsUpdate = true;\n        texture.uuid = data.uuid;\n        if (data.name !== undefined) texture.name = data.name;\n        if (data.mapping !== undefined) texture.mapping = parseConstant(data.mapping);\n        if (data.offset !== undefined) texture.offset = new THREE.Vector2(data.offset[0], data.offset[1]);\n        if (data.repeat !== undefined) texture.repeat = new THREE.Vector2(data.repeat[0], data.repeat[1]);\n        if (data.minFilter !== undefined) texture.minFilter = parseConstant(data.minFilter);\n        if (data.magFilter !== undefined) texture.magFilter = parseConstant(data.magFilter);\n        if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\n\n        if (Array.isArray(data.wrap)) {\n          texture.wrapS = parseConstant(data.wrap[0]);\n          texture.wrapT = parseConstant(data.wrap[1]);\n        }\n\n        textures[data.uuid] = texture;\n      }\n    }\n\n    return textures;\n  },\n  parseObject: function () {\n    var matrix = new THREE.Matrix4();\n    return function (data, geometries, materials) {\n      var object;\n\n      var getGeometry = function (name) {\n        if (geometries[name] === undefined) {\n          console.warn('THREE.ObjectLoader: Undefined geometry', name);\n        }\n\n        return geometries[name];\n      };\n\n      var getMaterial = function (name) {\n        if (materials[name] === undefined) {\n          console.warn('THREE.ObjectLoader: Undefined material', name);\n        }\n\n        return materials[name];\n      };\n\n      switch (data.type) {\n        case 'Scene':\n          object = new THREE.Scene();\n          break;\n\n        case 'PerspectiveCamera':\n          object = new THREE.PerspectiveCamera(data.fov, data.aspect, data.near, data.far);\n          break;\n\n        case 'OrthographicCamera':\n          object = new THREE.OrthographicCamera(data.left, data.right, data.top, data.bottom, data.near, data.far);\n          break;\n\n        case 'AmbientLight':\n          object = new THREE.AmbientLight(data.color);\n          break;\n\n        case 'DirectionalLight':\n          object = new THREE.DirectionalLight(data.color, data.intensity);\n          break;\n\n        case 'PointLight':\n          object = new THREE.PointLight(data.color, data.intensity, data.distance, data.decay);\n          break;\n\n        case 'SpotLight':\n          object = new THREE.SpotLight(data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay);\n          break;\n\n        case 'HemisphereLight':\n          object = new THREE.HemisphereLight(data.color, data.groundColor, data.intensity);\n          break;\n\n        case 'Mesh':\n          object = new THREE.Mesh(getGeometry(data.geometry), getMaterial(data.material));\n          break;\n\n        case 'LOD':\n          object = new THREE.LOD();\n          break;\n\n        case 'Line':\n          object = new THREE.Line(getGeometry(data.geometry), getMaterial(data.material), data.mode);\n          break;\n\n        case 'PointCloud':\n        case 'Points':\n          object = new THREE.Points(getGeometry(data.geometry), getMaterial(data.material));\n          break;\n\n        case 'Sprite':\n          object = new THREE.Sprite(getMaterial(data.material));\n          break;\n\n        case 'Group':\n          object = new THREE.Group();\n          break;\n\n        default:\n          object = new THREE.Object3D();\n      }\n\n      object.uuid = data.uuid;\n      if (data.name !== undefined) object.name = data.name;\n\n      if (data.matrix !== undefined) {\n        matrix.fromArray(data.matrix);\n        matrix.decompose(object.position, object.quaternion, object.scale);\n      } else {\n        if (data.position !== undefined) object.position.fromArray(data.position);\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\n      }\n\n      if (data.castShadow !== undefined) object.castShadow = data.castShadow;\n      if (data.receiveShadow !== undefined) object.receiveShadow = data.receiveShadow;\n      if (data.visible !== undefined) object.visible = data.visible;\n      if (data.userData !== undefined) object.userData = data.userData;\n\n      if (data.children !== undefined) {\n        for (var child in data.children) {\n          object.add(this.parseObject(data.children[child], geometries, materials));\n        }\n      }\n\n      if (data.type === 'LOD') {\n        var levels = data.levels;\n\n        for (var l = 0; l < levels.length; l++) {\n          var level = levels[l];\n          var child = object.getObjectByProperty('uuid', level.object);\n\n          if (child !== undefined) {\n            object.addLevel(child, level.distance);\n          }\n        }\n      }\n\n      return object;\n    };\n  }()\n}; // File:src/loaders/TextureLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.TextureLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager;\n};\n\nTHREE.TextureLoader.prototype = {\n  constructor: THREE.TextureLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new THREE.ImageLoader(scope.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.load(url, function (image) {\n      var texture = new THREE.Texture(image);\n      texture.needsUpdate = true;\n\n      if (onLoad !== undefined) {\n        onLoad(texture);\n      }\n    }, onProgress, onError);\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  }\n}; // File:src/loaders/BinaryTextureLoader.js\n\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\n\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager; // override in sub classes\n\n  this._parser = null;\n};\n\nTHREE.BinaryTextureLoader.prototype = {\n  constructor: THREE.BinaryTextureLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var texture = new THREE.DataTexture();\n    var loader = new THREE.XHRLoader(this.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, function (buffer) {\n      var texData = scope._parser(buffer);\n\n      if (!texData) return;\n\n      if (undefined !== texData.image) {\n        texture.image = texData.image;\n      } else if (undefined !== texData.data) {\n        texture.image.width = texData.width;\n        texture.image.height = texData.height;\n        texture.image.data = texData.data;\n      }\n\n      texture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\n      texture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\n      texture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\n      texture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\n      texture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\n\n      if (undefined !== texData.format) {\n        texture.format = texData.format;\n      }\n\n      if (undefined !== texData.type) {\n        texture.type = texData.type;\n      }\n\n      if (undefined !== texData.mipmaps) {\n        texture.mipmaps = texData.mipmaps;\n      }\n\n      if (1 === texData.mipmapCount) {\n        texture.minFilter = THREE.LinearFilter;\n      }\n\n      texture.needsUpdate = true;\n      if (onLoad) onLoad(texture, texData);\n    }, onProgress, onError);\n    return texture;\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  }\n}; // File:src/loaders/CompressedTextureLoader.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\n\nTHREE.CompressedTextureLoader = function (manager) {\n  this.manager = manager !== undefined ? manager : THREE.DefaultLoadingManager; // override in sub classes\n\n  this._parser = null;\n};\n\nTHREE.CompressedTextureLoader.prototype = {\n  constructor: THREE.CompressedTextureLoader,\n  load: function (url, onLoad, onProgress, onError) {\n    var scope = this;\n    var images = [];\n    var texture = new THREE.CompressedTexture();\n    texture.image = images;\n    var loader = new THREE.XHRLoader(this.manager);\n    loader.setCrossOrigin(this.crossOrigin);\n    loader.setResponseType('arraybuffer');\n\n    if (Array.isArray(url)) {\n      var loaded = 0;\n\n      var loadTexture = function (i) {\n        loader.load(url[i], function (buffer) {\n          var texDatas = scope._parser(buffer, true);\n\n          images[i] = {\n            width: texDatas.width,\n            height: texDatas.height,\n            format: texDatas.format,\n            mipmaps: texDatas.mipmaps\n          };\n          loaded += 1;\n\n          if (loaded === 6) {\n            if (texDatas.mipmapCount === 1) texture.minFilter = THREE.LinearFilter;\n            texture.format = texDatas.format;\n            texture.needsUpdate = true;\n            if (onLoad) onLoad(texture);\n          }\n        }, onProgress, onError);\n      };\n\n      for (var i = 0, il = url.length; i < il; ++i) {\n        loadTexture(i);\n      }\n    } else {\n      // compressed cubemap texture stored in a single DDS file\n      loader.load(url, function (buffer) {\n        var texDatas = scope._parser(buffer, true);\n\n        if (texDatas.isCubemap) {\n          var faces = texDatas.mipmaps.length / texDatas.mipmapCount;\n\n          for (var f = 0; f < faces; f++) {\n            images[f] = {\n              mipmaps: []\n            };\n\n            for (var i = 0; i < texDatas.mipmapCount; i++) {\n              images[f].mipmaps.push(texDatas.mipmaps[f * texDatas.mipmapCount + i]);\n              images[f].format = texDatas.format;\n              images[f].width = texDatas.width;\n              images[f].height = texDatas.height;\n            }\n          }\n        } else {\n          texture.image.width = texDatas.width;\n          texture.image.height = texDatas.height;\n          texture.mipmaps = texDatas.mipmaps;\n        }\n\n        if (texDatas.mipmapCount === 1) {\n          texture.minFilter = THREE.LinearFilter;\n        }\n\n        texture.format = texDatas.format;\n        texture.needsUpdate = true;\n        if (onLoad) onLoad(texture);\n      }, onProgress, onError);\n    }\n\n    return texture;\n  },\n  setCrossOrigin: function (value) {\n    this.crossOrigin = value;\n  }\n}; // File:src/materials/Material.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Material = function () {\n  Object.defineProperty(this, 'id', {\n    value: THREE.MaterialIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.type = 'Material';\n  this.side = THREE.FrontSide;\n  this.opacity = 1;\n  this.transparent = false;\n  this.blending = THREE.NormalBlending;\n  this.blendSrc = THREE.SrcAlphaFactor;\n  this.blendDst = THREE.OneMinusSrcAlphaFactor;\n  this.blendEquation = THREE.AddEquation;\n  this.blendSrcAlpha = null;\n  this.blendDstAlpha = null;\n  this.blendEquationAlpha = null;\n  this.depthFunc = THREE.LessEqualDepth;\n  this.depthTest = true;\n  this.depthWrite = true;\n  this.colorWrite = true;\n  this.precision = null; // override the renderer's default precision for this material\n\n  this.polygonOffset = false;\n  this.polygonOffsetFactor = 0;\n  this.polygonOffsetUnits = 0;\n  this.alphaTest = 0;\n  this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\n\n  this.visible = true;\n  this._needsUpdate = true;\n};\n\nTHREE.Material.prototype = {\n  constructor: THREE.Material,\n\n  get needsUpdate() {\n    return this._needsUpdate;\n  },\n\n  set needsUpdate(value) {\n    if (value === true) this.update();\n    this._needsUpdate = value;\n  },\n\n  setValues: function (values) {\n    if (values === undefined) return;\n\n    for (var key in values) {\n      var newValue = values[key];\n\n      if (newValue === undefined) {\n        console.warn(\"THREE.Material: '\" + key + \"' parameter is undefined.\");\n        continue;\n      }\n\n      var currentValue = this[key];\n\n      if (currentValue === undefined) {\n        console.warn(\"THREE.\" + this.type + \": '\" + key + \"' is not a property of this material.\");\n        continue;\n      }\n\n      if (currentValue instanceof THREE.Color) {\n        currentValue.set(newValue);\n      } else if (currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3) {\n        currentValue.copy(newValue);\n      } else if (key === 'overdraw') {\n        // ensure overdraw is backwards-compatible with legacy boolean type\n        this[key] = Number(newValue);\n      } else {\n        this[key] = newValue;\n      }\n    }\n  },\n  toJSON: function (meta) {\n    var data = {\n      metadata: {\n        version: 4.4,\n        type: 'Material',\n        generator: 'Material.toJSON'\n      }\n    }; // standard Material serialization\n\n    data.uuid = this.uuid;\n    data.type = this.type;\n    if (this.name !== '') data.name = this.name;\n    if (this.color instanceof THREE.Color) data.color = this.color.getHex();\n    if (this.emissive instanceof THREE.Color) data.emissive = this.emissive.getHex();\n    if (this.specular instanceof THREE.Color) data.specular = this.specular.getHex();\n    if (this.shininess !== undefined) data.shininess = this.shininess;\n    if (this.map instanceof THREE.Texture) data.map = this.map.toJSON(meta).uuid;\n    if (this.alphaMap instanceof THREE.Texture) data.alphaMap = this.alphaMap.toJSON(meta).uuid;\n    if (this.lightMap instanceof THREE.Texture) data.lightMap = this.lightMap.toJSON(meta).uuid;\n\n    if (this.bumpMap instanceof THREE.Texture) {\n      data.bumpMap = this.bumpMap.toJSON(meta).uuid;\n      data.bumpScale = this.bumpScale;\n    }\n\n    if (this.normalMap instanceof THREE.Texture) {\n      data.normalMap = this.normalMap.toJSON(meta).uuid;\n      data.normalScale = this.normalScale; // Removed for now, causes issue in editor ui.js\n    }\n\n    if (this.displacementMap instanceof THREE.Texture) {\n      data.displacementMap = this.displacementMap.toJSON(meta).uuid;\n      data.displacementScale = this.displacementScale;\n      data.displacementBias = this.displacementBias;\n    }\n\n    if (this.specularMap instanceof THREE.Texture) data.specularMap = this.specularMap.toJSON(meta).uuid;\n\n    if (this.envMap instanceof THREE.Texture) {\n      data.envMap = this.envMap.toJSON(meta).uuid;\n      data.reflectivity = this.reflectivity; // Scale behind envMap\n    }\n\n    if (this.size !== undefined) data.size = this.size;\n    if (this.sizeAttenuation !== undefined) data.sizeAttenuation = this.sizeAttenuation;\n    if (this.vertexColors !== undefined && this.vertexColors !== THREE.NoColors) data.vertexColors = this.vertexColors;\n    if (this.shading !== undefined && this.shading !== THREE.SmoothShading) data.shading = this.shading;\n    if (this.blending !== undefined && this.blending !== THREE.NormalBlending) data.blending = this.blending;\n    if (this.side !== undefined && this.side !== THREE.FrontSide) data.side = this.side;\n    if (this.opacity < 1) data.opacity = this.opacity;\n    if (this.transparent === true) data.transparent = this.transparent;\n    if (this.alphaTest > 0) data.alphaTest = this.alphaTest;\n    if (this.wireframe === true) data.wireframe = this.wireframe;\n    if (this.wireframeLinewidth > 1) data.wireframeLinewidth = this.wireframeLinewidth;\n    return data;\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    this.name = source.name;\n    this.side = source.side;\n    this.opacity = source.opacity;\n    this.transparent = source.transparent;\n    this.blending = source.blending;\n    this.blendSrc = source.blendSrc;\n    this.blendDst = source.blendDst;\n    this.blendEquation = source.blendEquation;\n    this.blendSrcAlpha = source.blendSrcAlpha;\n    this.blendDstAlpha = source.blendDstAlpha;\n    this.blendEquationAlpha = source.blendEquationAlpha;\n    this.depthFunc = source.depthFunc;\n    this.depthTest = source.depthTest;\n    this.depthWrite = source.depthWrite;\n    this.precision = source.precision;\n    this.polygonOffset = source.polygonOffset;\n    this.polygonOffsetFactor = source.polygonOffsetFactor;\n    this.polygonOffsetUnits = source.polygonOffsetUnits;\n    this.alphaTest = source.alphaTest;\n    this.overdraw = source.overdraw;\n    this.visible = source.visible;\n    return this;\n  },\n  update: function () {\n    this.dispatchEvent({\n      type: 'update'\n    });\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  },\n\n  // Deprecated\n  get wrapAround() {\n    console.warn('THREE.' + this.type + ': .wrapAround has been removed.');\n  },\n\n  set wrapAround(boolean) {\n    console.warn('THREE.' + this.type + ': .wrapAround has been removed.');\n  },\n\n  get wrapRGB() {\n    console.warn('THREE.' + this.type + ': .wrapRGB has been removed.');\n    return new THREE.Color();\n  }\n\n};\nTHREE.EventDispatcher.prototype.apply(THREE.Material.prototype);\nTHREE.MaterialIdCount = 0; // File:src/materials/LineBasicMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\n\nTHREE.LineBasicMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'LineBasicMaterial';\n  this.color = new THREE.Color(0xffffff);\n  this.linewidth = 1;\n  this.linecap = 'round';\n  this.linejoin = 'round';\n  this.vertexColors = THREE.NoColors;\n  this.fog = true;\n  this.setValues(parameters);\n};\n\nTHREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\n\nTHREE.LineBasicMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.linewidth = source.linewidth;\n  this.linecap = source.linecap;\n  this.linejoin = source.linejoin;\n  this.vertexColors = source.vertexColors;\n  this.fog = source.fog;\n  return this;\n}; // File:src/materials/LineDashedMaterial.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\n\n\nTHREE.LineDashedMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'LineDashedMaterial';\n  this.color = new THREE.Color(0xffffff);\n  this.linewidth = 1;\n  this.scale = 1;\n  this.dashSize = 3;\n  this.gapSize = 1;\n  this.vertexColors = false;\n  this.fog = true;\n  this.setValues(parameters);\n};\n\nTHREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\n\nTHREE.LineDashedMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.linewidth = source.linewidth;\n  this.scale = source.scale;\n  this.dashSize = source.dashSize;\n  this.gapSize = source.gapSize;\n  this.vertexColors = source.vertexColors;\n  this.fog = source.fog;\n  return this;\n}; // File:src/materials/MeshBasicMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\n\n\nTHREE.MeshBasicMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'MeshBasicMaterial';\n  this.color = new THREE.Color(0xffffff); // emissive\n\n  this.map = null;\n  this.aoMap = null;\n  this.aoMapIntensity = 1.0;\n  this.specularMap = null;\n  this.alphaMap = null;\n  this.envMap = null;\n  this.combine = THREE.MultiplyOperation;\n  this.reflectivity = 1;\n  this.refractionRatio = 0.98;\n  this.fog = true;\n  this.shading = THREE.SmoothShading;\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.wireframeLinecap = 'round';\n  this.wireframeLinejoin = 'round';\n  this.vertexColors = THREE.NoColors;\n  this.skinning = false;\n  this.morphTargets = false;\n  this.setValues(parameters);\n};\n\nTHREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\n\nTHREE.MeshBasicMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.map = source.map;\n  this.aoMap = source.aoMap;\n  this.aoMapIntensity = source.aoMapIntensity;\n  this.specularMap = source.specularMap;\n  this.alphaMap = source.alphaMap;\n  this.envMap = source.envMap;\n  this.combine = source.combine;\n  this.reflectivity = source.reflectivity;\n  this.refractionRatio = source.refractionRatio;\n  this.fog = source.fog;\n  this.shading = source.shading;\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  this.wireframeLinecap = source.wireframeLinecap;\n  this.wireframeLinejoin = source.wireframeLinejoin;\n  this.vertexColors = source.vertexColors;\n  this.skinning = source.skinning;\n  this.morphTargets = source.morphTargets;\n  return this;\n}; // File:src/materials/MeshLambertMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\n\n\nTHREE.MeshLambertMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'MeshLambertMaterial';\n  this.color = new THREE.Color(0xffffff); // diffuse\n\n  this.emissive = new THREE.Color(0x000000);\n  this.map = null;\n  this.specularMap = null;\n  this.alphaMap = null;\n  this.envMap = null;\n  this.combine = THREE.MultiplyOperation;\n  this.reflectivity = 1;\n  this.refractionRatio = 0.98;\n  this.fog = true;\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.wireframeLinecap = 'round';\n  this.wireframeLinejoin = 'round';\n  this.vertexColors = THREE.NoColors;\n  this.skinning = false;\n  this.morphTargets = false;\n  this.morphNormals = false;\n  this.setValues(parameters);\n};\n\nTHREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\n\nTHREE.MeshLambertMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.emissive.copy(source.emissive);\n  this.map = source.map;\n  this.specularMap = source.specularMap;\n  this.alphaMap = source.alphaMap;\n  this.envMap = source.envMap;\n  this.combine = source.combine;\n  this.reflectivity = source.reflectivity;\n  this.refractionRatio = source.refractionRatio;\n  this.fog = source.fog;\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  this.wireframeLinecap = source.wireframeLinecap;\n  this.wireframeLinejoin = source.wireframeLinejoin;\n  this.vertexColors = source.vertexColors;\n  this.skinning = source.skinning;\n  this.morphTargets = source.morphTargets;\n  this.morphNormals = source.morphNormals;\n  return this;\n}; // File:src/materials/MeshPhongMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *  lightMapIntensity: <float>\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  emissiveMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  displacementMap: new THREE.Texture( <Image> ),\r\n *  displacementScale: <float>,\r\n *  displacementBias: <float>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\n\n\nTHREE.MeshPhongMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'MeshPhongMaterial';\n  this.color = new THREE.Color(0xffffff); // diffuse\n\n  this.emissive = new THREE.Color(0x000000);\n  this.specular = new THREE.Color(0x111111);\n  this.shininess = 30;\n  this.metal = false;\n  this.map = null;\n  this.lightMap = null;\n  this.lightMapIntensity = 1.0;\n  this.aoMap = null;\n  this.aoMapIntensity = 1.0;\n  this.emissiveMap = null;\n  this.bumpMap = null;\n  this.bumpScale = 1;\n  this.normalMap = null;\n  this.normalScale = new THREE.Vector2(1, 1);\n  this.displacementMap = null;\n  this.displacementScale = 1;\n  this.displacementBias = 0;\n  this.specularMap = null;\n  this.alphaMap = null;\n  this.envMap = null;\n  this.combine = THREE.MultiplyOperation;\n  this.reflectivity = 1;\n  this.refractionRatio = 0.98;\n  this.fog = true;\n  this.shading = THREE.SmoothShading;\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.wireframeLinecap = 'round';\n  this.wireframeLinejoin = 'round';\n  this.vertexColors = THREE.NoColors;\n  this.skinning = false;\n  this.morphTargets = false;\n  this.morphNormals = false;\n  this.setValues(parameters);\n};\n\nTHREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\n\nTHREE.MeshPhongMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.emissive.copy(source.emissive);\n  this.specular.copy(source.specular);\n  this.shininess = source.shininess;\n  this.metal = source.metal;\n  this.map = source.map;\n  this.lightMap = source.lightMap;\n  this.lightMapIntensity = source.lightMapIntensity;\n  this.aoMap = source.aoMap;\n  this.aoMapIntensity = source.aoMapIntensity;\n  this.emissiveMap = source.emissiveMap;\n  this.bumpMap = source.bumpMap;\n  this.bumpScale = source.bumpScale;\n  this.normalMap = source.normalMap;\n  this.normalScale.copy(source.normalScale);\n  this.displacementMap = source.displacementMap;\n  this.displacementScale = source.displacementScale;\n  this.displacementBias = source.displacementBias;\n  this.specularMap = source.specularMap;\n  this.alphaMap = source.alphaMap;\n  this.envMap = source.envMap;\n  this.combine = source.combine;\n  this.reflectivity = source.reflectivity;\n  this.refractionRatio = source.refractionRatio;\n  this.fog = source.fog;\n  this.shading = source.shading;\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  this.wireframeLinecap = source.wireframeLinecap;\n  this.wireframeLinejoin = source.wireframeLinejoin;\n  this.vertexColors = source.vertexColors;\n  this.skinning = source.skinning;\n  this.morphTargets = source.morphTargets;\n  this.morphNormals = source.morphNormals;\n  return this;\n}; // File:src/materials/MeshDepthMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\n\n\nTHREE.MeshDepthMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'MeshDepthMaterial';\n  this.morphTargets = false;\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.setValues(parameters);\n};\n\nTHREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\n\nTHREE.MeshDepthMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  return this;\n}; // File:src/materials/MeshNormalMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\n\n\nTHREE.MeshNormalMaterial = function (parameters) {\n  THREE.Material.call(this, parameters);\n  this.type = 'MeshNormalMaterial';\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.morphTargets = false;\n  this.setValues(parameters);\n};\n\nTHREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\n\nTHREE.MeshNormalMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  return this;\n}; // File:src/materials/MultiMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.MultiMaterial = function (materials) {\n  this.uuid = THREE.Math.generateUUID();\n  this.type = 'MultiMaterial';\n  this.materials = materials instanceof Array ? materials : [];\n  this.visible = true;\n};\n\nTHREE.MultiMaterial.prototype = {\n  constructor: THREE.MultiMaterial,\n  toJSON: function () {\n    var output = {\n      metadata: {\n        version: 4.2,\n        type: 'material',\n        generator: 'MaterialExporter'\n      },\n      uuid: this.uuid,\n      type: this.type,\n      materials: []\n    };\n\n    for (var i = 0, l = this.materials.length; i < l; i++) {\n      output.materials.push(this.materials[i].toJSON());\n    }\n\n    output.visible = this.visible;\n    return output;\n  },\n  clone: function () {\n    var material = new this.constructor();\n\n    for (var i = 0; i < this.materials.length; i++) {\n      material.materials.push(this.materials[i].clone());\n    }\n\n    material.visible = this.visible;\n    return material;\n  }\n}; // backwards compatibility\n\nTHREE.MeshFaceMaterial = THREE.MultiMaterial; // File:src/materials/PointsMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\n\nTHREE.PointsMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'PointsMaterial';\n  this.color = new THREE.Color(0xffffff);\n  this.map = null;\n  this.size = 1;\n  this.sizeAttenuation = true;\n  this.vertexColors = THREE.NoColors;\n  this.fog = true;\n  this.setValues(parameters);\n};\n\nTHREE.PointsMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.PointsMaterial.prototype.constructor = THREE.PointsMaterial;\n\nTHREE.PointsMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.map = source.map;\n  this.size = source.size;\n  this.sizeAttenuation = source.sizeAttenuation;\n  this.vertexColors = source.vertexColors;\n  this.fog = source.fog;\n  return this;\n}; // backwards compatibility\n\n\nTHREE.PointCloudMaterial = function (parameters) {\n  console.warn('THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.');\n  return new THREE.PointsMaterial(parameters);\n};\n\nTHREE.ParticleBasicMaterial = function (parameters) {\n  console.warn('THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.');\n  return new THREE.PointsMaterial(parameters);\n};\n\nTHREE.ParticleSystemMaterial = function (parameters) {\n  console.warn('THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.');\n  return new THREE.PointsMaterial(parameters);\n}; // File:src/materials/ShaderMaterial.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\n\n\nTHREE.ShaderMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'ShaderMaterial';\n  this.defines = {};\n  this.uniforms = {};\n  this.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\n  this.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\n  this.shading = THREE.SmoothShading;\n  this.linewidth = 1;\n  this.wireframe = false;\n  this.wireframeLinewidth = 1;\n  this.fog = false; // set to use scene fog\n\n  this.lights = false; // set to use scene lights\n\n  this.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\n\n  this.skinning = false; // set to use skinning attribute streams\n\n  this.morphTargets = false; // set to use morph targets\n\n  this.morphNormals = false; // set to use morph normals\n\n  this.derivatives = false; // set to use derivatives\n  // When rendered geometry doesn't include these attributes but the material does,\n  // use these default values in WebGL. This avoids errors when buffer data is missing.\n\n  this.defaultAttributeValues = {\n    'color': [1, 1, 1],\n    'uv': [0, 0],\n    'uv2': [0, 0]\n  };\n  this.index0AttributeName = undefined;\n\n  if (parameters !== undefined) {\n    if (parameters.attributes !== undefined) {\n      console.error('THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.');\n    }\n\n    this.setValues(parameters);\n  }\n};\n\nTHREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\n\nTHREE.ShaderMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.fragmentShader = source.fragmentShader;\n  this.vertexShader = source.vertexShader;\n  this.uniforms = THREE.UniformsUtils.clone(source.uniforms);\n  this.attributes = source.attributes;\n  this.defines = source.defines;\n  this.shading = source.shading;\n  this.wireframe = source.wireframe;\n  this.wireframeLinewidth = source.wireframeLinewidth;\n  this.fog = source.fog;\n  this.lights = source.lights;\n  this.vertexColors = source.vertexColors;\n  this.skinning = source.skinning;\n  this.morphTargets = source.morphTargets;\n  this.morphNormals = source.morphNormals;\n  this.derivatives = source.derivatives;\n  return this;\n};\n\nTHREE.ShaderMaterial.prototype.toJSON = function (meta) {\n  var data = THREE.Material.prototype.toJSON.call(this, meta);\n  data.uniforms = this.uniforms;\n  data.attributes = this.attributes;\n  data.vertexShader = this.vertexShader;\n  data.fragmentShader = this.fragmentShader;\n  return data;\n}; // File:src/materials/RawShaderMaterial.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.RawShaderMaterial = function (parameters) {\n  THREE.ShaderMaterial.call(this, parameters);\n  this.type = 'RawShaderMaterial';\n};\n\nTHREE.RawShaderMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial; // File:src/materials/SpriteMaterial.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\n\nTHREE.SpriteMaterial = function (parameters) {\n  THREE.Material.call(this);\n  this.type = 'SpriteMaterial';\n  this.color = new THREE.Color(0xffffff);\n  this.map = null;\n  this.rotation = 0;\n  this.fog = false; // set parameters\n\n  this.setValues(parameters);\n};\n\nTHREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype);\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\n\nTHREE.SpriteMaterial.prototype.copy = function (source) {\n  THREE.Material.prototype.copy.call(this, source);\n  this.color.copy(source.color);\n  this.map = source.map;\n  this.rotation = source.rotation;\n  this.fog = source.fog;\n  return this;\n}; // File:src/textures/Texture.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\n\n\nTHREE.Texture = function (image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\n  Object.defineProperty(this, 'id', {\n    value: THREE.TextureIdCount++\n  });\n  this.uuid = THREE.Math.generateUUID();\n  this.name = '';\n  this.sourceFile = '';\n  this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\n  this.mipmaps = [];\n  this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\n  this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\n  this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\n  this.anisotropy = anisotropy !== undefined ? anisotropy : 1;\n  this.format = format !== undefined ? format : THREE.RGBAFormat;\n  this.type = type !== undefined ? type : THREE.UnsignedByteType;\n  this.offset = new THREE.Vector2(0, 0);\n  this.repeat = new THREE.Vector2(1, 1);\n  this.generateMipmaps = true;\n  this.premultiplyAlpha = false;\n  this.flipY = true;\n  this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\n\n  this.version = 0;\n  this.onUpdate = null;\n};\n\nTHREE.Texture.DEFAULT_IMAGE = undefined;\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\nTHREE.Texture.prototype = {\n  constructor: THREE.Texture,\n\n  set needsUpdate(value) {\n    if (value === true) this.version++;\n  },\n\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    this.image = source.image;\n    this.mipmaps = source.mipmaps.slice(0);\n    this.mapping = source.mapping;\n    this.wrapS = source.wrapS;\n    this.wrapT = source.wrapT;\n    this.magFilter = source.magFilter;\n    this.minFilter = source.minFilter;\n    this.anisotropy = source.anisotropy;\n    this.format = source.format;\n    this.type = source.type;\n    this.offset.copy(source.offset);\n    this.repeat.copy(source.repeat);\n    this.generateMipmaps = source.generateMipmaps;\n    this.premultiplyAlpha = source.premultiplyAlpha;\n    this.flipY = source.flipY;\n    this.unpackAlignment = source.unpackAlignment;\n    return this;\n  },\n  toJSON: function (meta) {\n    if (meta.textures[this.uuid] !== undefined) {\n      return meta.textures[this.uuid];\n    }\n\n    function getDataURL(image) {\n      var canvas;\n\n      if (image.toDataURL !== undefined) {\n        canvas = image;\n      } else {\n        canvas = document.createElement('canvas');\n        canvas.width = image.width;\n        canvas.height = image.height;\n        canvas.getContext('2d').drawImage(image, 0, 0, image.width, image.height);\n      }\n\n      if (canvas.width > 2048 || canvas.height > 2048) {\n        return canvas.toDataURL('image/jpeg', 0.6);\n      } else {\n        return canvas.toDataURL('image/png');\n      }\n    }\n\n    var output = {\n      metadata: {\n        version: 4.4,\n        type: 'Texture',\n        generator: 'Texture.toJSON'\n      },\n      uuid: this.uuid,\n      name: this.name,\n      mapping: this.mapping,\n      repeat: [this.repeat.x, this.repeat.y],\n      offset: [this.offset.x, this.offset.y],\n      wrap: [this.wrapS, this.wrapT],\n      minFilter: this.minFilter,\n      magFilter: this.magFilter,\n      anisotropy: this.anisotropy\n    };\n\n    if (this.image !== undefined) {\n      // TODO: Move to THREE.Image\n      var image = this.image;\n\n      if (image.uuid === undefined) {\n        image.uuid = THREE.Math.generateUUID(); // UGH\n      }\n\n      if (meta.images[image.uuid] === undefined) {\n        meta.images[image.uuid] = {\n          uuid: image.uuid,\n          url: getDataURL(image)\n        };\n      }\n\n      output.image = image.uuid;\n    }\n\n    meta.textures[this.uuid] = output;\n    return output;\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  },\n  transformUv: function (uv) {\n    if (this.mapping !== THREE.UVMapping) return;\n    uv.multiply(this.repeat);\n    uv.add(this.offset);\n\n    if (uv.x < 0 || uv.x > 1) {\n      switch (this.wrapS) {\n        case THREE.RepeatWrapping:\n          uv.x = uv.x - Math.floor(uv.x);\n          break;\n\n        case THREE.ClampToEdgeWrapping:\n          uv.x = uv.x < 0 ? 0 : 1;\n          break;\n\n        case THREE.MirroredRepeatWrapping:\n          if (Math.abs(Math.floor(uv.x) % 2) === 1) {\n            uv.x = Math.ceil(uv.x) - uv.x;\n          } else {\n            uv.x = uv.x - Math.floor(uv.x);\n          }\n\n          break;\n      }\n    }\n\n    if (uv.y < 0 || uv.y > 1) {\n      switch (this.wrapT) {\n        case THREE.RepeatWrapping:\n          uv.y = uv.y - Math.floor(uv.y);\n          break;\n\n        case THREE.ClampToEdgeWrapping:\n          uv.y = uv.y < 0 ? 0 : 1;\n          break;\n\n        case THREE.MirroredRepeatWrapping:\n          if (Math.abs(Math.floor(uv.y) % 2) === 1) {\n            uv.y = Math.ceil(uv.y) - uv.y;\n          } else {\n            uv.y = uv.y - Math.floor(uv.y);\n          }\n\n          break;\n      }\n    }\n\n    if (this.flipY) {\n      uv.y = 1 - uv.y;\n    }\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);\nTHREE.TextureIdCount = 0; // File:src/textures/CanvasTexture.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.CanvasTexture = function (canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\n  THREE.Texture.call(this, canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\n  this.needsUpdate = true;\n};\n\nTHREE.CanvasTexture.prototype = Object.create(THREE.Texture.prototype);\nTHREE.CanvasTexture.prototype.constructor = THREE.CanvasTexture; // File:src/textures/CubeTexture.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.CubeTexture = function (images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\n  mapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\n  THREE.Texture.call(this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\n  this.images = images;\n  this.flipY = false;\n};\n\nTHREE.CubeTexture.prototype = Object.create(THREE.Texture.prototype);\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\n\nTHREE.CubeTexture.prototype.copy = function (source) {\n  THREE.Texture.prototype.copy.call(this, source);\n  this.images = source.images;\n  return this;\n}; // File:src/textures/CompressedTexture.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.CompressedTexture = function (mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\n  this.image = {\n    width: width,\n    height: height\n  };\n  this.mipmaps = mipmaps; // no flipping for cube textures\n  // (also flipping doesn't work for compressed textures )\n\n  this.flipY = false; // can't generate mipmaps for compressed textures\n  // mips must be embedded in DDS files\n\n  this.generateMipmaps = false;\n};\n\nTHREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype);\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture; // File:src/textures/DataTexture.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.DataTexture = function (data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\n  this.image = {\n    data: data,\n    width: width,\n    height: height\n  };\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.NearestFilter;\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.NearestFilter;\n  this.flipY = false;\n  this.generateMipmaps = false;\n};\n\nTHREE.DataTexture.prototype = Object.create(THREE.Texture.prototype);\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture; // File:src/textures/VideoTexture.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.VideoTexture = function (video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\n  THREE.Texture.call(this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\n  this.generateMipmaps = false;\n  var scope = this;\n\n  var update = function () {\n    requestAnimationFrame(update);\n\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n      scope.needsUpdate = true;\n    }\n  };\n\n  update();\n};\n\nTHREE.VideoTexture.prototype = Object.create(THREE.Texture.prototype);\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture; // File:src/objects/Group.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.Group = function () {\n  THREE.Object3D.call(this);\n  this.type = 'Group';\n};\n\nTHREE.Group.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Group.prototype.constructor = THREE.Group; // File:src/objects/Points.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Points = function (geometry, material) {\n  THREE.Object3D.call(this);\n  this.type = 'Points';\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\n  this.material = material !== undefined ? material : new THREE.PointsMaterial({\n    color: Math.random() * 0xffffff\n  });\n};\n\nTHREE.Points.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Points.prototype.constructor = THREE.Points;\n\nTHREE.Points.prototype.raycast = function () {\n  var inverseMatrix = new THREE.Matrix4();\n  var ray = new THREE.Ray();\n  return function raycast(raycaster, intersects) {\n    var object = this;\n    var geometry = object.geometry;\n    var threshold = raycaster.params.Points.threshold;\n    inverseMatrix.getInverse(this.matrixWorld);\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\n\n    if (geometry.boundingBox !== null) {\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\n        return;\n      }\n    }\n\n    var localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\n    var localThresholdSq = localThreshold * localThreshold;\n    var position = new THREE.Vector3();\n\n    function testPoint(point, index) {\n      var rayPointDistanceSq = ray.distanceSqToPoint(point);\n\n      if (rayPointDistanceSq < localThresholdSq) {\n        var intersectPoint = ray.closestPointToPoint(point);\n        intersectPoint.applyMatrix4(object.matrixWorld);\n        var distance = raycaster.ray.origin.distanceTo(intersectPoint);\n        if (distance < raycaster.near || distance > raycaster.far) return;\n        intersects.push({\n          distance: distance,\n          distanceToRay: Math.sqrt(rayPointDistanceSq),\n          point: intersectPoint.clone(),\n          index: index,\n          face: null,\n          object: object\n        });\n      }\n    }\n\n    if (geometry instanceof THREE.BufferGeometry) {\n      var index = geometry.index;\n      var attributes = geometry.attributes;\n      var positions = attributes.position.array;\n\n      if (index !== null) {\n        var indices = index.array;\n\n        for (var i = 0, il = indices.length; i < il; i++) {\n          var a = indices[i];\n          position.fromArray(positions, a * 3);\n          testPoint(position, a);\n        }\n      } else {\n        for (var i = 0, l = positions.length / 3; i < l; i++) {\n          position.fromArray(positions, i * 3);\n          testPoint(position, i);\n        }\n      }\n    } else {\n      var vertices = geometry.vertices;\n\n      for (var i = 0, l = vertices.length; i < l; i++) {\n        testPoint(vertices[i], i);\n      }\n    }\n  };\n}();\n\nTHREE.Points.prototype.clone = function () {\n  return new this.constructor(this.geometry, this.material).copy(this);\n};\n\nTHREE.Points.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta); // only serialize if not in meta geometries cache\n\n  if (meta.geometries[this.geometry.uuid] === undefined) {\n    meta.geometries[this.geometry.uuid] = this.geometry.toJSON();\n  } // only serialize if not in meta materials cache\n\n\n  if (meta.materials[this.material.uuid] === undefined) {\n    meta.materials[this.material.uuid] = this.material.toJSON();\n  }\n\n  data.object.geometry = this.geometry.uuid;\n  data.object.material = this.material.uuid;\n  return data;\n}; // Backwards compatibility\n\n\nTHREE.PointCloud = function (geometry, material) {\n  console.warn('THREE.PointCloud has been renamed to THREE.Points.');\n  return new THREE.Points(geometry, material);\n};\n\nTHREE.ParticleSystem = function (geometry, material) {\n  console.warn('THREE.ParticleSystem has been renamed to THREE.Points.');\n  return new THREE.Points(geometry, material);\n}; // File:src/objects/Line.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.Line = function (geometry, material, mode) {\n  if (mode === 1) {\n    console.warn('THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.');\n    return new THREE.LineSegments(geometry, material);\n  }\n\n  THREE.Object3D.call(this);\n  this.type = 'Line';\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\n  this.material = material !== undefined ? material : new THREE.LineBasicMaterial({\n    color: Math.random() * 0xffffff\n  });\n};\n\nTHREE.Line.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Line.prototype.constructor = THREE.Line;\n\nTHREE.Line.prototype.raycast = function () {\n  var inverseMatrix = new THREE.Matrix4();\n  var ray = new THREE.Ray();\n  var sphere = new THREE.Sphere();\n  return function raycast(raycaster, intersects) {\n    var precision = raycaster.linePrecision;\n    var precisionSq = precision * precision;\n    var geometry = this.geometry;\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere(); // Checking boundingSphere distance to ray\n\n    sphere.copy(geometry.boundingSphere);\n    sphere.applyMatrix4(this.matrixWorld);\n\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\n      return;\n    }\n\n    inverseMatrix.getInverse(this.matrixWorld);\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\n    var vStart = new THREE.Vector3();\n    var vEnd = new THREE.Vector3();\n    var interSegment = new THREE.Vector3();\n    var interRay = new THREE.Vector3();\n    var step = this instanceof THREE.LineSegments ? 2 : 1;\n\n    if (geometry instanceof THREE.BufferGeometry) {\n      var index = geometry.index;\n      var attributes = geometry.attributes;\n\n      if (index !== null) {\n        var indices = index.array;\n        var positions = attributes.position.array;\n\n        for (var i = 0, l = indices.length - 1; i < l; i += step) {\n          var a = indices[i];\n          var b = indices[i + 1];\n          vStart.fromArray(positions, a * 3);\n          vEnd.fromArray(positions, b * 3);\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\n          if (distSq > precisionSq) continue;\n          interRay.applyMatrix4(this.matrixWorld); //Move back to world space for distance calculation\n\n          var distance = raycaster.ray.origin.distanceTo(interRay);\n          if (distance < raycaster.near || distance > raycaster.far) continue;\n          intersects.push({\n            distance: distance,\n            // What do we want? intersection point on the ray or on the segment??\n            // point: raycaster.ray.at( distance ),\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\n            index: i,\n            face: null,\n            faceIndex: null,\n            object: this\n          });\n        }\n      } else {\n        var positions = attributes.position.array;\n\n        for (var i = 0, l = positions.length / 3 - 1; i < l; i += step) {\n          vStart.fromArray(positions, 3 * i);\n          vEnd.fromArray(positions, 3 * i + 3);\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\n          if (distSq > precisionSq) continue;\n          interRay.applyMatrix4(this.matrixWorld); //Move back to world space for distance calculation\n\n          var distance = raycaster.ray.origin.distanceTo(interRay);\n          if (distance < raycaster.near || distance > raycaster.far) continue;\n          intersects.push({\n            distance: distance,\n            // What do we want? intersection point on the ray or on the segment??\n            // point: raycaster.ray.at( distance ),\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\n            index: i,\n            face: null,\n            faceIndex: null,\n            object: this\n          });\n        }\n      }\n    } else if (geometry instanceof THREE.Geometry) {\n      var vertices = geometry.vertices;\n      var nbVertices = vertices.length;\n\n      for (var i = 0; i < nbVertices - 1; i += step) {\n        var distSq = ray.distanceSqToSegment(vertices[i], vertices[i + 1], interRay, interSegment);\n        if (distSq > precisionSq) continue;\n        interRay.applyMatrix4(this.matrixWorld); //Move back to world space for distance calculation\n\n        var distance = raycaster.ray.origin.distanceTo(interRay);\n        if (distance < raycaster.near || distance > raycaster.far) continue;\n        intersects.push({\n          distance: distance,\n          // What do we want? intersection point on the ray or on the segment??\n          // point: raycaster.ray.at( distance ),\n          point: interSegment.clone().applyMatrix4(this.matrixWorld),\n          index: i,\n          face: null,\n          faceIndex: null,\n          object: this\n        });\n      }\n    }\n  };\n}();\n\nTHREE.Line.prototype.clone = function () {\n  return new this.constructor(this.geometry, this.material).copy(this);\n};\n\nTHREE.Line.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta); // only serialize if not in meta geometries cache\n\n  if (meta.geometries[this.geometry.uuid] === undefined) {\n    meta.geometries[this.geometry.uuid] = this.geometry.toJSON();\n  } // only serialize if not in meta materials cache\n\n\n  if (meta.materials[this.material.uuid] === undefined) {\n    meta.materials[this.material.uuid] = this.material.toJSON();\n  }\n\n  data.object.geometry = this.geometry.uuid;\n  data.object.material = this.material.uuid;\n  return data;\n}; // DEPRECATED\n\n\nTHREE.LineStrip = 0;\nTHREE.LinePieces = 1; // File:src/objects/LineSegments.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.LineSegments = function (geometry, material) {\n  THREE.Line.call(this, geometry, material);\n  this.type = 'LineSegments';\n};\n\nTHREE.LineSegments.prototype = Object.create(THREE.Line.prototype);\nTHREE.LineSegments.prototype.constructor = THREE.LineSegments; // File:src/objects/Mesh.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\n\nTHREE.Mesh = function (geometry, material) {\n  THREE.Object3D.call(this);\n  this.type = 'Mesh';\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\n  this.material = material !== undefined ? material : new THREE.MeshBasicMaterial({\n    color: Math.random() * 0xffffff\n  });\n  this.updateMorphTargets();\n};\n\nTHREE.Mesh.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\n\nTHREE.Mesh.prototype.updateMorphTargets = function () {\n  if (this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0) {\n    this.morphTargetBase = -1;\n    this.morphTargetInfluences = [];\n    this.morphTargetDictionary = {};\n\n    for (var m = 0, ml = this.geometry.morphTargets.length; m < ml; m++) {\n      this.morphTargetInfluences.push(0);\n      this.morphTargetDictionary[this.geometry.morphTargets[m].name] = m;\n    }\n  }\n};\n\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function (name) {\n  if (this.morphTargetDictionary[name] !== undefined) {\n    return this.morphTargetDictionary[name];\n  }\n\n  console.warn('THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.');\n  return 0;\n};\n\nTHREE.Mesh.prototype.raycast = function () {\n  var inverseMatrix = new THREE.Matrix4();\n  var ray = new THREE.Ray();\n  var sphere = new THREE.Sphere();\n  var vA = new THREE.Vector3();\n  var vB = new THREE.Vector3();\n  var vC = new THREE.Vector3();\n  var tempA = new THREE.Vector3();\n  var tempB = new THREE.Vector3();\n  var tempC = new THREE.Vector3();\n  var uvA = new THREE.Vector2();\n  var uvB = new THREE.Vector2();\n  var uvC = new THREE.Vector2();\n  var barycoord = new THREE.Vector3();\n  var intersectionPoint = new THREE.Vector3();\n  var intersectionPointWorld = new THREE.Vector3();\n\n  function uvIntersection(point, p1, p2, p3, uv1, uv2, uv3) {\n    THREE.Triangle.barycoordFromPoint(point, p1, p2, p3, barycoord);\n    uv1.multiplyScalar(barycoord.x);\n    uv2.multiplyScalar(barycoord.y);\n    uv3.multiplyScalar(barycoord.z);\n    uv1.add(uv2).add(uv3);\n    return uv1.clone();\n  }\n\n  return function raycast(raycaster, intersects) {\n    var geometry = this.geometry;\n    var material = this.material;\n    if (material === undefined) return; // Checking boundingSphere distance to ray\n\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\n    sphere.copy(geometry.boundingSphere);\n    sphere.applyMatrix4(this.matrixWorld);\n\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\n      return;\n    } // Check boundingBox before continuing\n\n\n    inverseMatrix.getInverse(this.matrixWorld);\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\n\n    if (geometry.boundingBox !== null) {\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\n        return;\n      }\n    }\n\n    var a, b, c;\n\n    if (geometry instanceof THREE.BufferGeometry) {\n      var index = geometry.index;\n      var attributes = geometry.attributes;\n\n      if (index !== null) {\n        var indices = index.array;\n        var positions = attributes.position.array;\n\n        for (var i = 0, l = indices.length; i < l; i += 3) {\n          a = indices[i];\n          b = indices[i + 1];\n          c = indices[i + 2];\n          vA.fromArray(positions, a * 3);\n          vB.fromArray(positions, b * 3);\n          vC.fromArray(positions, c * 3);\n\n          if (material.side === THREE.BackSide) {\n            if (ray.intersectTriangle(vC, vB, vA, true, intersectionPoint) === null) continue;\n          } else {\n            if (ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide, intersectionPoint) === null) continue;\n          }\n\n          intersectionPointWorld.copy(intersectionPoint);\n          intersectionPointWorld.applyMatrix4(this.matrixWorld);\n          var distance = raycaster.ray.origin.distanceTo(intersectionPointWorld);\n          if (distance < raycaster.near || distance > raycaster.far) continue;\n          var uv;\n\n          if (attributes.uv !== undefined) {\n            var uvs = attributes.uv.array;\n            uvA.fromArray(uvs, a * 2);\n            uvB.fromArray(uvs, b * 2);\n            uvC.fromArray(uvs, c * 2);\n            uv = uvIntersection(intersectionPoint, vA, vB, vC, uvA, uvB, uvC);\n          }\n\n          intersects.push({\n            distance: distance,\n            point: intersectionPointWorld.clone(),\n            uv: uv,\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\n            faceIndex: Math.floor(i / 3),\n            // triangle number in indices buffer semantics\n            object: this\n          });\n        }\n      } else {\n        var positions = attributes.position.array;\n\n        for (var i = 0, l = positions.length; i < l; i += 9) {\n          vA.fromArray(positions, i);\n          vB.fromArray(positions, i + 3);\n          vC.fromArray(positions, i + 6);\n\n          if (material.side === THREE.BackSide) {\n            if (ray.intersectTriangle(vC, vB, vA, true, intersectionPoint) === null) continue;\n          } else {\n            if (ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide, intersectionPoint) === null) continue;\n          }\n\n          intersectionPointWorld.copy(intersectionPoint);\n          intersectionPointWorld.applyMatrix4(this.matrixWorld);\n          var distance = raycaster.ray.origin.distanceTo(intersectionPointWorld);\n          if (distance < raycaster.near || distance > raycaster.far) continue;\n          var uv;\n\n          if (attributes.uv !== undefined) {\n            var uvs = attributes.uv.array;\n            uvA.fromArray(uvs, i);\n            uvB.fromArray(uvs, i + 2);\n            uvC.fromArray(uvs, i + 4);\n            uv = uvIntersection(intersectionPoint, vA, vB, vC, uvA, uvB, uvC);\n          }\n\n          a = i / 3;\n          b = a + 1;\n          c = a + 2;\n          intersects.push({\n            distance: distance,\n            point: intersectionPointWorld.clone(),\n            uv: uv,\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\n            index: a,\n            // triangle number in positions buffer semantics\n            object: this\n          });\n        }\n      }\n    } else if (geometry instanceof THREE.Geometry) {\n      var isFaceMaterial = material instanceof THREE.MeshFaceMaterial;\n      var materials = isFaceMaterial === true ? material.materials : null;\n      var vertices = geometry.vertices;\n      var faces = geometry.faces;\n\n      for (var f = 0, fl = faces.length; f < fl; f++) {\n        var face = faces[f];\n        var faceMaterial = isFaceMaterial === true ? materials[face.materialIndex] : material;\n        if (faceMaterial === undefined) continue;\n        a = vertices[face.a];\n        b = vertices[face.b];\n        c = vertices[face.c];\n\n        if (faceMaterial.morphTargets === true) {\n          var morphTargets = geometry.morphTargets;\n          var morphInfluences = this.morphTargetInfluences;\n          vA.set(0, 0, 0);\n          vB.set(0, 0, 0);\n          vC.set(0, 0, 0);\n\n          for (var t = 0, tl = morphTargets.length; t < tl; t++) {\n            var influence = morphInfluences[t];\n            if (influence === 0) continue;\n            var targets = morphTargets[t].vertices;\n            vA.addScaledVector(tempA.subVectors(targets[face.a], a), influence);\n            vB.addScaledVector(tempB.subVectors(targets[face.b], b), influence);\n            vC.addScaledVector(tempC.subVectors(targets[face.c], c), influence);\n          }\n\n          vA.add(a);\n          vB.add(b);\n          vC.add(c);\n          a = vA;\n          b = vB;\n          c = vC;\n        }\n\n        if (faceMaterial.side === THREE.BackSide) {\n          if (ray.intersectTriangle(c, b, a, true, intersectionPoint) === null) continue;\n        } else {\n          if (ray.intersectTriangle(a, b, c, faceMaterial.side !== THREE.DoubleSide, intersectionPoint) === null) continue;\n        }\n\n        intersectionPointWorld.copy(intersectionPoint);\n        intersectionPointWorld.applyMatrix4(this.matrixWorld);\n        var distance = raycaster.ray.origin.distanceTo(intersectionPointWorld);\n        if (distance < raycaster.near || distance > raycaster.far) continue;\n        var uv;\n\n        if (geometry.faceVertexUvs[0].length > 0) {\n          var uvs = geometry.faceVertexUvs[0][f];\n          uvA.copy(uvs[0]);\n          uvB.copy(uvs[1]);\n          uvC.copy(uvs[2]);\n          uv = uvIntersection(intersectionPoint, a, b, c, uvA, uvB, uvC);\n        }\n\n        intersects.push({\n          distance: distance,\n          point: intersectionPointWorld.clone(),\n          uv: uv,\n          face: face,\n          faceIndex: f,\n          object: this\n        });\n      }\n    }\n  };\n}();\n\nTHREE.Mesh.prototype.clone = function () {\n  return new this.constructor(this.geometry, this.material).copy(this);\n};\n\nTHREE.Mesh.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta); // only serialize if not in meta geometries cache\n\n  if (meta.geometries[this.geometry.uuid] === undefined) {\n    meta.geometries[this.geometry.uuid] = this.geometry.toJSON(meta);\n  } // only serialize if not in meta materials cache\n\n\n  if (meta.materials[this.material.uuid] === undefined) {\n    meta.materials[this.material.uuid] = this.material.toJSON(meta);\n  }\n\n  data.object.geometry = this.geometry.uuid;\n  data.object.material = this.material.uuid;\n  return data;\n}; // File:src/objects/Bone.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\n\n\nTHREE.Bone = function (skin) {\n  THREE.Object3D.call(this);\n  this.type = 'Bone';\n  this.skin = skin;\n};\n\nTHREE.Bone.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Bone.prototype.constructor = THREE.Bone;\n\nTHREE.Bone.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source);\n  this.skin = source.skin;\n  return this;\n}; // File:src/objects/Skeleton.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\n\n\nTHREE.Skeleton = function (bones, boneInverses, useVertexTexture) {\n  this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\n  this.identityMatrix = new THREE.Matrix4(); // copy the bone array\n\n  bones = bones || [];\n  this.bones = bones.slice(0); // create a bone texture or an array of floats\n\n  if (this.useVertexTexture) {\n    // layout (1 matrix = 4 pixels)\n    //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\n    //  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)\n    //       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)\n    //       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)\n    //       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)\n    var size = Math.sqrt(this.bones.length * 4); // 4 pixels needed for 1 matrix\n\n    size = THREE.Math.nextPowerOfTwo(Math.ceil(size));\n    size = Math.max(size, 4);\n    this.boneTextureWidth = size;\n    this.boneTextureHeight = size;\n    this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4); // 4 floats per RGBA pixel\n\n    this.boneTexture = new THREE.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType);\n  } else {\n    this.boneMatrices = new Float32Array(16 * this.bones.length);\n  } // use the supplied bone inverses or calculate the inverses\n\n\n  if (boneInverses === undefined) {\n    this.calculateInverses();\n  } else {\n    if (this.bones.length === boneInverses.length) {\n      this.boneInverses = boneInverses.slice(0);\n    } else {\n      console.warn('THREE.Skeleton bonInverses is the wrong length.');\n      this.boneInverses = [];\n\n      for (var b = 0, bl = this.bones.length; b < bl; b++) {\n        this.boneInverses.push(new THREE.Matrix4());\n      }\n    }\n  }\n};\n\nTHREE.Skeleton.prototype.calculateInverses = function () {\n  this.boneInverses = [];\n\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\n    var inverse = new THREE.Matrix4();\n\n    if (this.bones[b]) {\n      inverse.getInverse(this.bones[b].matrixWorld);\n    }\n\n    this.boneInverses.push(inverse);\n  }\n};\n\nTHREE.Skeleton.prototype.pose = function () {\n  var bone; // recover the bind-time world matrices\n\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\n    bone = this.bones[b];\n\n    if (bone) {\n      bone.matrixWorld.getInverse(this.boneInverses[b]);\n    }\n  } // compute the local matrices, positions, rotations and scales\n\n\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\n    bone = this.bones[b];\n\n    if (bone) {\n      if (bone.parent) {\n        bone.matrix.getInverse(bone.parent.matrixWorld);\n        bone.matrix.multiply(bone.matrixWorld);\n      } else {\n        bone.matrix.copy(bone.matrixWorld);\n      }\n\n      bone.matrix.decompose(bone.position, bone.quaternion, bone.scale);\n    }\n  }\n};\n\nTHREE.Skeleton.prototype.update = function () {\n  var offsetMatrix = new THREE.Matrix4();\n  return function update() {\n    // flatten bone matrices to array\n    for (var b = 0, bl = this.bones.length; b < bl; b++) {\n      // compute the offset between the current and the original transform\n      var matrix = this.bones[b] ? this.bones[b].matrixWorld : this.identityMatrix;\n      offsetMatrix.multiplyMatrices(matrix, this.boneInverses[b]);\n      offsetMatrix.flattenToArrayOffset(this.boneMatrices, b * 16);\n    }\n\n    if (this.useVertexTexture) {\n      this.boneTexture.needsUpdate = true;\n    }\n  };\n}();\n\nTHREE.Skeleton.prototype.clone = function () {\n  return new THREE.Skeleton(this.bones, this.boneInverses, this.useVertexTexture);\n}; // File:src/objects/SkinnedMesh.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\n\n\nTHREE.SkinnedMesh = function (geometry, material, useVertexTexture) {\n  THREE.Mesh.call(this, geometry, material);\n  this.type = 'SkinnedMesh';\n  this.bindMode = \"attached\";\n  this.bindMatrix = new THREE.Matrix4();\n  this.bindMatrixInverse = new THREE.Matrix4(); // init bones\n  // TODO: remove bone creation as there is no reason (other than\n  // convenience) for THREE.SkinnedMesh to do this.\n\n  var bones = [];\n\n  if (this.geometry && this.geometry.bones !== undefined) {\n    var bone, gbone;\n\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\n      gbone = this.geometry.bones[b];\n      bone = new THREE.Bone(this);\n      bones.push(bone);\n      bone.name = gbone.name;\n      bone.position.fromArray(gbone.pos);\n      bone.quaternion.fromArray(gbone.rotq);\n      if (gbone.scl !== undefined) bone.scale.fromArray(gbone.scl);\n    }\n\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\n      gbone = this.geometry.bones[b];\n\n      if (gbone.parent !== -1) {\n        bones[gbone.parent].add(bones[b]);\n      } else {\n        this.add(bones[b]);\n      }\n    }\n  }\n\n  this.normalizeSkinWeights();\n  this.updateMatrixWorld(true);\n  this.bind(new THREE.Skeleton(bones, undefined, useVertexTexture), this.matrixWorld);\n};\n\nTHREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype);\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\n\nTHREE.SkinnedMesh.prototype.bind = function (skeleton, bindMatrix) {\n  this.skeleton = skeleton;\n\n  if (bindMatrix === undefined) {\n    this.updateMatrixWorld(true);\n    this.skeleton.calculateInverses();\n    bindMatrix = this.matrixWorld;\n  }\n\n  this.bindMatrix.copy(bindMatrix);\n  this.bindMatrixInverse.getInverse(bindMatrix);\n};\n\nTHREE.SkinnedMesh.prototype.pose = function () {\n  this.skeleton.pose();\n};\n\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function () {\n  if (this.geometry instanceof THREE.Geometry) {\n    for (var i = 0; i < this.geometry.skinIndices.length; i++) {\n      var sw = this.geometry.skinWeights[i];\n      var scale = 1.0 / sw.lengthManhattan();\n\n      if (scale !== Infinity) {\n        sw.multiplyScalar(scale);\n      } else {\n        sw.set(1); // this will be normalized by the shader anyway\n      }\n    }\n  } else {// skinning weights assumed to be normalized for THREE.BufferGeometry\n  }\n};\n\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function (force) {\n  THREE.Mesh.prototype.updateMatrixWorld.call(this, true);\n\n  if (this.bindMode === \"attached\") {\n    this.bindMatrixInverse.getInverse(this.matrixWorld);\n  } else if (this.bindMode === \"detached\") {\n    this.bindMatrixInverse.getInverse(this.bindMatrix);\n  } else {\n    console.warn('THREE.SkinnedMesh unrecognized bindMode: ' + this.bindMode);\n  }\n};\n\nTHREE.SkinnedMesh.prototype.clone = function () {\n  return new this.constructor(this.geometry, this.material, this.useVertexTexture).copy(this);\n}; // File:src/objects/MorphAnimMesh.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.MorphAnimMesh = function (geometry, material) {\n  THREE.Mesh.call(this, geometry, material);\n  this.type = 'MorphAnimMesh'; // API\n\n  this.duration = 1000; // milliseconds\n\n  this.mirroredLoop = false;\n  this.time = 0; // internals\n\n  this.lastKeyframe = 0;\n  this.currentKeyframe = 0;\n  this.direction = 1;\n  this.directionBackwards = false;\n  this.setFrameRange(0, geometry.morphTargets.length - 1);\n};\n\nTHREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype);\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\n\nTHREE.MorphAnimMesh.prototype.setFrameRange = function (start, end) {\n  this.startKeyframe = start;\n  this.endKeyframe = end;\n  this.length = this.endKeyframe - this.startKeyframe + 1;\n};\n\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function () {\n  this.direction = 1;\n  this.directionBackwards = false;\n};\n\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function () {\n  this.direction = -1;\n  this.directionBackwards = true;\n};\n\nTHREE.MorphAnimMesh.prototype.parseAnimations = function () {\n  var geometry = this.geometry;\n  if (!geometry.animations) geometry.animations = {};\n  var firstAnimation,\n      animations = geometry.animations;\n  var pattern = /([a-z]+)_?(\\d+)/;\n\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\n    var morph = geometry.morphTargets[i];\n    var parts = morph.name.match(pattern);\n\n    if (parts && parts.length > 1) {\n      var label = parts[1];\n      if (!animations[label]) animations[label] = {\n        start: Infinity,\n        end: -Infinity\n      };\n      var animation = animations[label];\n      if (i < animation.start) animation.start = i;\n      if (i > animation.end) animation.end = i;\n      if (!firstAnimation) firstAnimation = label;\n    }\n  }\n\n  geometry.firstAnimation = firstAnimation;\n};\n\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function (label, start, end) {\n  if (!this.geometry.animations) this.geometry.animations = {};\n  this.geometry.animations[label] = {\n    start: start,\n    end: end\n  };\n};\n\nTHREE.MorphAnimMesh.prototype.playAnimation = function (label, fps) {\n  var animation = this.geometry.animations[label];\n\n  if (animation) {\n    this.setFrameRange(animation.start, animation.end);\n    this.duration = 1000 * ((animation.end - animation.start) / fps);\n    this.time = 0;\n  } else {\n    console.warn('THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()');\n  }\n};\n\nTHREE.MorphAnimMesh.prototype.updateAnimation = function (delta) {\n  var frameTime = this.duration / this.length;\n  this.time += this.direction * delta;\n\n  if (this.mirroredLoop) {\n    if (this.time > this.duration || this.time < 0) {\n      this.direction *= -1;\n\n      if (this.time > this.duration) {\n        this.time = this.duration;\n        this.directionBackwards = true;\n      }\n\n      if (this.time < 0) {\n        this.time = 0;\n        this.directionBackwards = false;\n      }\n    }\n  } else {\n    this.time = this.time % this.duration;\n    if (this.time < 0) this.time += this.duration;\n  }\n\n  var keyframe = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / frameTime), 0, this.length - 1);\n  var influences = this.morphTargetInfluences;\n\n  if (keyframe !== this.currentKeyframe) {\n    influences[this.lastKeyframe] = 0;\n    influences[this.currentKeyframe] = 1;\n    influences[keyframe] = 0;\n    this.lastKeyframe = this.currentKeyframe;\n    this.currentKeyframe = keyframe;\n  }\n\n  var mix = this.time % frameTime / frameTime;\n\n  if (this.directionBackwards) {\n    mix = 1 - mix;\n  }\n\n  influences[this.currentKeyframe] = mix;\n  influences[this.lastKeyframe] = 1 - mix;\n};\n\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function (a, b, t) {\n  var influences = this.morphTargetInfluences;\n\n  for (var i = 0, l = influences.length; i < l; i++) {\n    influences[i] = 0;\n  }\n\n  if (a > -1) influences[a] = 1 - t;\n  if (b > -1) influences[b] = t;\n};\n\nTHREE.MorphAnimMesh.prototype.copy = function (source) {\n  THREE.Mesh.prototype.copy.call(this, source);\n  this.duration = source.duration;\n  this.mirroredLoop = source.mirroredLoop;\n  this.time = source.time;\n  this.lastKeyframe = source.lastKeyframe;\n  this.currentKeyframe = source.currentKeyframe;\n  this.direction = source.direction;\n  this.directionBackwards = source.directionBackwards;\n  return this;\n}; // File:src/objects/LOD.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.LOD = function () {\n  THREE.Object3D.call(this);\n  this.type = 'LOD';\n  Object.defineProperties(this, {\n    levels: {\n      enumerable: true,\n      value: []\n    },\n    objects: {\n      get: function () {\n        console.warn('THREE.LOD: .objects has been renamed to .levels.');\n        return this.levels;\n      }\n    }\n  });\n};\n\nTHREE.LOD.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.LOD.prototype.constructor = THREE.LOD;\n\nTHREE.LOD.prototype.addLevel = function (object, distance) {\n  if (distance === undefined) distance = 0;\n  distance = Math.abs(distance);\n  var levels = this.levels;\n\n  for (var l = 0; l < levels.length; l++) {\n    if (distance < levels[l].distance) {\n      break;\n    }\n  }\n\n  levels.splice(l, 0, {\n    distance: distance,\n    object: object\n  });\n  this.add(object);\n};\n\nTHREE.LOD.prototype.getObjectForDistance = function (distance) {\n  var levels = this.levels;\n\n  for (var i = 1, l = levels.length; i < l; i++) {\n    if (distance < levels[i].distance) {\n      break;\n    }\n  }\n\n  return levels[i - 1].object;\n};\n\nTHREE.LOD.prototype.raycast = function () {\n  var matrixPosition = new THREE.Vector3();\n  return function raycast(raycaster, intersects) {\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\n    var distance = raycaster.ray.origin.distanceTo(matrixPosition);\n    this.getObjectForDistance(distance).raycast(raycaster, intersects);\n  };\n}();\n\nTHREE.LOD.prototype.update = function () {\n  var v1 = new THREE.Vector3();\n  var v2 = new THREE.Vector3();\n  return function update(camera) {\n    var levels = this.levels;\n\n    if (levels.length > 1) {\n      v1.setFromMatrixPosition(camera.matrixWorld);\n      v2.setFromMatrixPosition(this.matrixWorld);\n      var distance = v1.distanceTo(v2);\n      levels[0].object.visible = true;\n\n      for (var i = 1, l = levels.length; i < l; i++) {\n        if (distance >= levels[i].distance) {\n          levels[i - 1].object.visible = false;\n          levels[i].object.visible = true;\n        } else {\n          break;\n        }\n      }\n\n      for (; i < l; i++) {\n        levels[i].object.visible = false;\n      }\n    }\n  };\n}();\n\nTHREE.LOD.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source, false);\n  var levels = source.levels;\n\n  for (var i = 0, l = levels.length; i < l; i++) {\n    var level = levels[i];\n    this.addLevel(level.object.clone(), level.distance);\n  }\n\n  return this;\n};\n\nTHREE.LOD.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta);\n  data.object.levels = [];\n  var levels = this.levels;\n\n  for (var i = 0, l = levels.length; i < l; i++) {\n    var level = levels[i];\n    data.object.levels.push({\n      object: level.object.uuid,\n      distance: level.distance\n    });\n  }\n\n  return data;\n}; // File:src/objects/Sprite.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.Sprite = function () {\n  var indices = new Uint16Array([0, 1, 2, 0, 2, 3]);\n  var vertices = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);\n  var uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\n  var geometry = new THREE.BufferGeometry();\n  geometry.setIndex(new THREE.BufferAttribute(indices, 1));\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\n  geometry.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\n  return function Sprite(material) {\n    THREE.Object3D.call(this);\n    this.type = 'Sprite';\n    this.geometry = geometry;\n    this.material = material !== undefined ? material : new THREE.SpriteMaterial();\n  };\n}();\n\nTHREE.Sprite.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\n\nTHREE.Sprite.prototype.raycast = function () {\n  var matrixPosition = new THREE.Vector3();\n  return function raycast(raycaster, intersects) {\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\n    var distanceSq = raycaster.ray.distanceSqToPoint(matrixPosition);\n    var guessSizeSq = this.scale.x * this.scale.y;\n\n    if (distanceSq > guessSizeSq) {\n      return;\n    }\n\n    intersects.push({\n      distance: Math.sqrt(distanceSq),\n      point: this.position,\n      face: null,\n      object: this\n    });\n  };\n}();\n\nTHREE.Sprite.prototype.clone = function () {\n  return new this.constructor(this.material).copy(this);\n};\n\nTHREE.Sprite.prototype.toJSON = function (meta) {\n  var data = THREE.Object3D.prototype.toJSON.call(this, meta); // only serialize if not in meta materials cache\n\n  if (meta.materials[this.material.uuid] === undefined) {\n    meta.materials[this.material.uuid] = this.material.toJSON();\n  }\n\n  data.object.material = this.material.uuid;\n  return data;\n}; // Backwards compatibility\n\n\nTHREE.Particle = THREE.Sprite; // File:src/objects/LensFlare.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.LensFlare = function (texture, size, distance, blending, color) {\n  THREE.Object3D.call(this);\n  this.lensFlares = [];\n  this.positionScreen = new THREE.Vector3();\n  this.customUpdateCallback = undefined;\n\n  if (texture !== undefined) {\n    this.add(texture, size, distance, blending, color);\n  }\n};\n\nTHREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\n/*\r\n * Add: adds another flare\r\n */\n\nTHREE.LensFlare.prototype.add = function (texture, size, distance, blending, color, opacity) {\n  if (size === undefined) size = -1;\n  if (distance === undefined) distance = 0;\n  if (opacity === undefined) opacity = 1;\n  if (color === undefined) color = new THREE.Color(0xffffff);\n  if (blending === undefined) blending = THREE.NormalBlending;\n  distance = Math.min(distance, Math.max(0, distance));\n  this.lensFlares.push({\n    texture: texture,\n    // THREE.Texture\n    size: size,\n    // size in pixels (-1 = use texture.width)\n    distance: distance,\n    // distance (0-1) from light source (0=at light source)\n    x: 0,\n    y: 0,\n    z: 0,\n    // screen position (-1 => 1) z = 0 is in front z = 1 is back\n    scale: 1,\n    // scale\n    rotation: 0,\n    // rotation\n    opacity: opacity,\n    // opacity\n    color: color,\n    // color\n    blending: blending // blending\n\n  });\n};\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\n\n\nTHREE.LensFlare.prototype.updateLensFlares = function () {\n  var f,\n      fl = this.lensFlares.length;\n  var flare;\n  var vecX = -this.positionScreen.x * 2;\n  var vecY = -this.positionScreen.y * 2;\n\n  for (f = 0; f < fl; f++) {\n    flare = this.lensFlares[f];\n    flare.x = this.positionScreen.x + vecX * flare.distance;\n    flare.y = this.positionScreen.y + vecY * flare.distance;\n    flare.wantedRotation = flare.x * Math.PI * 0.25;\n    flare.rotation += (flare.wantedRotation - flare.rotation) * 0.25;\n  }\n};\n\nTHREE.LensFlare.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source);\n  this.positionScreen.copy(source.positionScreen);\n  this.customUpdateCallback = source.customUpdateCallback;\n\n  for (var i = 0, l = source.lensFlares.length; i < l; i++) {\n    this.lensFlares.push(source.lensFlares[i]);\n  }\n\n  return this;\n}; // File:src/scenes/Scene.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.Scene = function () {\n  THREE.Object3D.call(this);\n  this.type = 'Scene';\n  this.fog = null;\n  this.overrideMaterial = null;\n  this.autoUpdate = true; // checked by the renderer\n};\n\nTHREE.Scene.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Scene.prototype.constructor = THREE.Scene;\n\nTHREE.Scene.prototype.copy = function (source) {\n  THREE.Object3D.prototype.copy.call(this, source);\n  if (source.fog !== null) this.fog = source.fog.clone();\n  if (source.overrideMaterial !== null) this.overrideMaterial = source.overrideMaterial.clone();\n  this.autoUpdate = source.autoUpdate;\n  this.matrixAutoUpdate = source.matrixAutoUpdate;\n  return this;\n}; // File:src/scenes/Fog.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.Fog = function (color, near, far) {\n  this.name = '';\n  this.color = new THREE.Color(color);\n  this.near = near !== undefined ? near : 1;\n  this.far = far !== undefined ? far : 1000;\n};\n\nTHREE.Fog.prototype.clone = function () {\n  return new THREE.Fog(this.color.getHex(), this.near, this.far);\n}; // File:src/scenes/FogExp2.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.FogExp2 = function (color, density) {\n  this.name = '';\n  this.color = new THREE.Color(color);\n  this.density = density !== undefined ? density : 0.00025;\n};\n\nTHREE.FogExp2.prototype.clone = function () {\n  return new THREE.FogExp2(this.color.getHex(), this.density);\n}; // File:src/renderers/shaders/ShaderChunk.js\n\n\nTHREE.ShaderChunk = {}; // File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\n\nTHREE.ShaderChunk['alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\n\nTHREE.ShaderChunk['alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\n\nTHREE.ShaderChunk['alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/aomap_fragment.glsl\n\nTHREE.ShaderChunk['aomap_fragment'] = \"#ifdef USE_AOMAP\\n\\n\ttotalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/aomap_pars_fragment.glsl\n\nTHREE.ShaderChunk['aomap_pars_fragment'] = \"#ifdef USE_AOMAP\\n\\n\tuniform sampler2D aoMap;\\n\tuniform float aoMapIntensity;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/begin_vertex.glsl\n\nTHREE.ShaderChunk['begin_vertex'] = \"\\nvec3 transformed = vec3( position );\\n\"; // File:src/renderers/shaders/ShaderChunk/beginnormal_vertex.glsl\n\nTHREE.ShaderChunk['beginnormal_vertex'] = \"\\nvec3 objectNormal = vec3( normal );\\n\"; // File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\n\nTHREE.ShaderChunk['color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\n\nTHREE.ShaderChunk['color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\n\nTHREE.ShaderChunk['color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\n\nTHREE.ShaderChunk['color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = color.xyz;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/common.glsl\n\nTHREE.ShaderChunk['common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\n\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n\\n}\\n\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n\\n}\\n\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\n\treturn - distance * planeNormal + point;\\n\\n}\\n\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n\\n}\\n\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n\\n}\\n\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\\n\tif ( decayExponent > 0.0 ) {\\n\\n\t  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\n\t}\\n\\n\treturn 1.0;\\n\\n}\\n\\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\\n\\n\t// Original approximation by Christophe Schlick '94\\n\t//;float fresnel = pow( 1.0 - dotLH, 5.0 );\\n\\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\\n\tfloat fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\\n\\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n\\n}\\n\\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\\n\\n\t// geometry term is (nl)(nv) / 4(nl)(nv)\\n\\n\treturn 0.25;\\n\\n}\\n\\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\\n\\n\t// factor of 1/PI in distribution term omitted\\n\\n\treturn ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n\\n}\\n\\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\\n\\n\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\n\t//float dotNL = saturate( dot( normal, lightDir ) );\\n\t//float dotNV = saturate( dot( normal, viewDir ) );\\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\tfloat dotLH = saturate( dot( lightDir, halfDir ) );\\n\\n\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\\n\\n\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\n\treturn F * G * D;\\n\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n\\n\t#ifdef GAMMA_INPUT\\n\\n\t\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n\\n\t#else\\n\\n\t\treturn a;\\n\\n\t#endif\\n\\n}\\n\\nvec3 linearToOutput( in vec3 a ) {\\n\\n\t#ifdef GAMMA_OUTPUT\\n\\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n\\n\t#else\\n\\n\t\treturn a;\\n\\n\t#endif\\n\\n}\\n\"; // File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\n\nTHREE.ShaderChunk['defaultnormal_vertex'] = \"#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\"; // File:src/renderers/shaders/ShaderChunk/displacementmap_vertex.glsl\n\nTHREE.ShaderChunk['displacementmap_vertex'] = \"#ifdef USE_DISPLACEMENTMAP\\n\\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/displacementmap_pars_vertex.glsl\n\nTHREE.ShaderChunk['displacementmap_pars_vertex'] = \"#ifdef USE_DISPLACEMENTMAP\\n\\n\tuniform sampler2D displacementMap;\\n\tuniform float displacementScale;\\n\tuniform float displacementBias;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/emissivemap_fragment.glsl\n\nTHREE.ShaderChunk['emissivemap_fragment'] = \"#ifdef USE_EMISSIVEMAP\\n\\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\n\temissiveColor.rgb = inputToLinear( emissiveColor.rgb );\\n\\n\ttotalEmissiveLight *= emissiveColor.rgb;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/emissivemap_pars_fragment.glsl\n\nTHREE.ShaderChunk['emissivemap_pars_fragment'] = \"#ifdef USE_EMISSIVEMAP\\n\\n\tuniform sampler2D emissiveMap;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\n\nTHREE.ShaderChunk['envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\n\nTHREE.ShaderChunk['envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\n\nTHREE.ShaderChunk['envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\n\nTHREE.ShaderChunk['fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\n\nTHREE.ShaderChunk['fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\n\nTHREE.ShaderChunk['lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\ttotalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tuniform sampler2D lightMap;\\n\tuniform float lightMapIntensity;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\n\nTHREE.ShaderChunk['lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\n\nTHREE.ShaderChunk['lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\nvec3 normal = normalize( transformedNormal );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = pointLightColor[ i ];\\n\\n\t\tvec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\t// attenuation\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = spotLightColor[ i ];\\n\\n\t\tvec3 lightPosition = spotLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition - mvPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\\n\\n\t\t\t// attenuation\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tattenuation *= spotEffect;\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = directionalLightColor[ i ];\\n\\n\t\tvec3 lightDir = directionalLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tvLightFront += lightColor * saturate( dotProduct );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += lightColor * saturate( - dotProduct );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tfloat hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\n\nTHREE.ShaderChunk['lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 viewDir = normalize( vViewPosition );\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = pointLightColor[ i ];\\n\\n\t\tvec3 lightPosition = pointLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\t// attenuation\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\t// diffuse\\n\\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\\n\\n\t\t// specular\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = spotLightColor[ i ];\\n\\n\t\tvec3 lightPosition = spotLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\\n\\n\t\t\t// attenuation\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tattenuation *= spotEffect;\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = directionalLightColor[ i ];\\n\\n\t\tvec3 lightDir = directionalLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\ttotalDiffuseLight += lightColor * cosineTerm;\\n\\n\t\t// specular\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += lightColor;\\n\\n\t\t// specular (sky term only)\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * max( dotProduct, 0.0 );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\n\nTHREE.ShaderChunk['lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\n\nTHREE.ShaderChunk['lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\n\nTHREE.ShaderChunk['lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\n\nTHREE.ShaderChunk['linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\"; // File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\n\nTHREE.ShaderChunk['logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\n\nTHREE.ShaderChunk['logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\n\nTHREE.ShaderChunk['logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\n\nTHREE.ShaderChunk['logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\n\nTHREE.ShaderChunk['map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\n\nTHREE.ShaderChunk['map_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\n\nTHREE.ShaderChunk['map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\n\nTHREE.ShaderChunk['map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\n\nTHREE.ShaderChunk['morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\n\nTHREE.ShaderChunk['morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\n\nTHREE.ShaderChunk['morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/project_vertex.glsl\n\nTHREE.ShaderChunk['project_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\"; // File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\n\nTHREE.ShaderChunk['shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t#endif\\n\\n\t}\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\n\nTHREE.ShaderChunk['shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\n\nTHREE.ShaderChunk['shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\n\nTHREE.ShaderChunk['skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\n\nTHREE.ShaderChunk['skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\n\nTHREE.ShaderChunk['skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\n\nTHREE.ShaderChunk['skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\n\nTHREE.ShaderChunk['specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\n\nTHREE.ShaderChunk['specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/uv2_pars_fragment.glsl\n\nTHREE.ShaderChunk['uv2_pars_fragment'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/uv2_pars_vertex.glsl\n\nTHREE.ShaderChunk['uv2_pars_vertex'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tattribute vec2 uv2;\\n\tvarying vec2 vUv2;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/uv2_vertex.glsl\n\nTHREE.ShaderChunk['uv2_vertex'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tvUv2 = uv2;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/uv_pars_fragment.glsl\n\nTHREE.ShaderChunk['uv_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/uv_pars_vertex.glsl\n\nTHREE.ShaderChunk['uv_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\"; // File:src/renderers/shaders/ShaderChunk/uv_vertex.glsl\n\nTHREE.ShaderChunk['uv_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\"; // File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\n\nTHREE.ShaderChunk['worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\"; // File:src/renderers/shaders/UniformsUtils.js\n\n/**\r\n * Uniform Utilities\r\n */\n\nTHREE.UniformsUtils = {\n  merge: function (uniforms) {\n    var merged = {};\n\n    for (var u = 0; u < uniforms.length; u++) {\n      var tmp = this.clone(uniforms[u]);\n\n      for (var p in tmp) {\n        merged[p] = tmp[p];\n      }\n    }\n\n    return merged;\n  },\n  clone: function (uniforms_src) {\n    var uniforms_dst = {};\n\n    for (var u in uniforms_src) {\n      uniforms_dst[u] = {};\n\n      for (var p in uniforms_src[u]) {\n        var parameter_src = uniforms_src[u][p];\n\n        if (parameter_src instanceof THREE.Color || parameter_src instanceof THREE.Vector2 || parameter_src instanceof THREE.Vector3 || parameter_src instanceof THREE.Vector4 || parameter_src instanceof THREE.Matrix3 || parameter_src instanceof THREE.Matrix4 || parameter_src instanceof THREE.Texture) {\n          uniforms_dst[u][p] = parameter_src.clone();\n        } else if (Array.isArray(parameter_src)) {\n          uniforms_dst[u][p] = parameter_src.slice();\n        } else {\n          uniforms_dst[u][p] = parameter_src;\n        }\n      }\n    }\n\n    return uniforms_dst;\n  }\n}; // File:src/renderers/shaders/UniformsLib.js\n\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\n\nTHREE.UniformsLib = {\n  common: {\n    \"diffuse\": {\n      type: \"c\",\n      value: new THREE.Color(0xeeeeee)\n    },\n    \"opacity\": {\n      type: \"f\",\n      value: 1.0\n    },\n    \"map\": {\n      type: \"t\",\n      value: null\n    },\n    \"offsetRepeat\": {\n      type: \"v4\",\n      value: new THREE.Vector4(0, 0, 1, 1)\n    },\n    \"specularMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"alphaMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"envMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"flipEnvMap\": {\n      type: \"f\",\n      value: -1\n    },\n    \"reflectivity\": {\n      type: \"f\",\n      value: 1.0\n    },\n    \"refractionRatio\": {\n      type: \"f\",\n      value: 0.98\n    }\n  },\n  aomap: {\n    \"aoMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"aoMapIntensity\": {\n      type: \"f\",\n      value: 1\n    }\n  },\n  lightmap: {\n    \"lightMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"lightMapIntensity\": {\n      type: \"f\",\n      value: 1\n    }\n  },\n  emissivemap: {\n    \"emissiveMap\": {\n      type: \"t\",\n      value: null\n    }\n  },\n  bumpmap: {\n    \"bumpMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"bumpScale\": {\n      type: \"f\",\n      value: 1\n    }\n  },\n  normalmap: {\n    \"normalMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"normalScale\": {\n      type: \"v2\",\n      value: new THREE.Vector2(1, 1)\n    }\n  },\n  displacementmap: {\n    \"displacementMap\": {\n      type: \"t\",\n      value: null\n    },\n    \"displacementScale\": {\n      type: \"f\",\n      value: 1\n    },\n    \"displacementBias\": {\n      type: \"f\",\n      value: 0\n    }\n  },\n  fog: {\n    \"fogDensity\": {\n      type: \"f\",\n      value: 0.00025\n    },\n    \"fogNear\": {\n      type: \"f\",\n      value: 1\n    },\n    \"fogFar\": {\n      type: \"f\",\n      value: 2000\n    },\n    \"fogColor\": {\n      type: \"c\",\n      value: new THREE.Color(0xffffff)\n    }\n  },\n  lights: {\n    \"ambientLightColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"directionalLightDirection\": {\n      type: \"fv\",\n      value: []\n    },\n    \"directionalLightColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"hemisphereLightDirection\": {\n      type: \"fv\",\n      value: []\n    },\n    \"hemisphereLightSkyColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"hemisphereLightGroundColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"pointLightColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"pointLightPosition\": {\n      type: \"fv\",\n      value: []\n    },\n    \"pointLightDistance\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"pointLightDecay\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"spotLightColor\": {\n      type: \"fv\",\n      value: []\n    },\n    \"spotLightPosition\": {\n      type: \"fv\",\n      value: []\n    },\n    \"spotLightDirection\": {\n      type: \"fv\",\n      value: []\n    },\n    \"spotLightDistance\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"spotLightAngleCos\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"spotLightExponent\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"spotLightDecay\": {\n      type: \"fv1\",\n      value: []\n    }\n  },\n  points: {\n    \"psColor\": {\n      type: \"c\",\n      value: new THREE.Color(0xeeeeee)\n    },\n    \"opacity\": {\n      type: \"f\",\n      value: 1.0\n    },\n    \"size\": {\n      type: \"f\",\n      value: 1.0\n    },\n    \"scale\": {\n      type: \"f\",\n      value: 1.0\n    },\n    \"map\": {\n      type: \"t\",\n      value: null\n    },\n    \"offsetRepeat\": {\n      type: \"v4\",\n      value: new THREE.Vector4(0, 0, 1, 1)\n    },\n    \"fogDensity\": {\n      type: \"f\",\n      value: 0.00025\n    },\n    \"fogNear\": {\n      type: \"f\",\n      value: 1\n    },\n    \"fogFar\": {\n      type: \"f\",\n      value: 2000\n    },\n    \"fogColor\": {\n      type: \"c\",\n      value: new THREE.Color(0xffffff)\n    }\n  },\n  shadowmap: {\n    \"shadowMap\": {\n      type: \"tv\",\n      value: []\n    },\n    \"shadowMapSize\": {\n      type: \"v2v\",\n      value: []\n    },\n    \"shadowBias\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"shadowDarkness\": {\n      type: \"fv1\",\n      value: []\n    },\n    \"shadowMatrix\": {\n      type: \"m4v\",\n      value: []\n    }\n  }\n}; // File:src/renderers/shaders/ShaderLib.js\n\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\n\nTHREE.ShaderLib = {\n  'basic': {\n    uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib[\"common\"], THREE.UniformsLib[\"aomap\"], THREE.UniformsLib[\"fog\"], THREE.UniformsLib[\"shadowmap\"]]),\n    vertexShader: [THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], \"\t#ifdef USE_ENVMAP\", THREE.ShaderChunk[\"beginnormal_vertex\"], THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"\t#endif\", THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform vec3 diffuse;\", \"uniform float opacity;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_fragment\"], THREE.ShaderChunk[\"uv_pars_fragment\"], THREE.ShaderChunk[\"uv2_pars_fragment\"], THREE.ShaderChunk[\"map_pars_fragment\"], THREE.ShaderChunk[\"alphamap_pars_fragment\"], THREE.ShaderChunk[\"aomap_pars_fragment\"], THREE.ShaderChunk[\"envmap_pars_fragment\"], THREE.ShaderChunk[\"fog_pars_fragment\"], THREE.ShaderChunk[\"shadowmap_pars_fragment\"], THREE.ShaderChunk[\"specularmap_pars_fragment\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tvec3 outgoingLight = vec3( 0.0 );\", \"\tvec4 diffuseColor = vec4( diffuse, opacity );\", \"\tvec3 totalAmbientLight = vec3( 1.0 );\", // hardwired\n    THREE.ShaderChunk[\"logdepthbuf_fragment\"], THREE.ShaderChunk[\"map_fragment\"], THREE.ShaderChunk[\"color_fragment\"], THREE.ShaderChunk[\"alphamap_fragment\"], THREE.ShaderChunk[\"alphatest_fragment\"], THREE.ShaderChunk[\"specularmap_fragment\"], THREE.ShaderChunk[\"aomap_fragment\"], \"\toutgoingLight = diffuseColor.rgb * totalAmbientLight;\", // simple shader\n    THREE.ShaderChunk[\"envmap_fragment\"], THREE.ShaderChunk[\"shadowmap_fragment\"], // TODO: Shadows on an otherwise unlit surface doesn't make sense.\n    THREE.ShaderChunk[\"linear_to_gamma_fragment\"], THREE.ShaderChunk[\"fog_fragment\"], \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", \"}\"].join(\"\\n\")\n  },\n  'lambert': {\n    uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib[\"common\"], THREE.UniformsLib[\"fog\"], THREE.UniformsLib[\"lights\"], THREE.UniformsLib[\"shadowmap\"], {\n      \"emissive\": {\n        type: \"c\",\n        value: new THREE.Color(0x000000)\n      }\n    }]),\n    vertexShader: [\"#define LAMBERT\", \"varying vec3 vLightFront;\", \"#ifdef DOUBLE_SIDED\", \"\tvarying vec3 vLightBack;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_lambert_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_lambert_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform vec3 diffuse;\", \"uniform vec3 emissive;\", \"uniform float opacity;\", \"varying vec3 vLightFront;\", \"#ifdef DOUBLE_SIDED\", \"\tvarying vec3 vLightBack;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_fragment\"], THREE.ShaderChunk[\"uv_pars_fragment\"], THREE.ShaderChunk[\"uv2_pars_fragment\"], THREE.ShaderChunk[\"map_pars_fragment\"], THREE.ShaderChunk[\"alphamap_pars_fragment\"], THREE.ShaderChunk[\"envmap_pars_fragment\"], THREE.ShaderChunk[\"fog_pars_fragment\"], THREE.ShaderChunk[\"shadowmap_pars_fragment\"], THREE.ShaderChunk[\"specularmap_pars_fragment\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\n    \"\tvec4 diffuseColor = vec4( diffuse, opacity );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], THREE.ShaderChunk[\"map_fragment\"], THREE.ShaderChunk[\"color_fragment\"], THREE.ShaderChunk[\"alphamap_fragment\"], THREE.ShaderChunk[\"alphatest_fragment\"], THREE.ShaderChunk[\"specularmap_fragment\"], \"\t#ifdef DOUBLE_SIDED\", \"\t\tif ( gl_FrontFacing )\", \"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\", \"\t\telse\", \"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\", \"\t#else\", \"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\", \"\t#endif\", THREE.ShaderChunk[\"envmap_fragment\"], THREE.ShaderChunk[\"shadowmap_fragment\"], THREE.ShaderChunk[\"linear_to_gamma_fragment\"], THREE.ShaderChunk[\"fog_fragment\"], \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", \"}\"].join(\"\\n\")\n  },\n  'phong': {\n    uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib[\"common\"], THREE.UniformsLib[\"aomap\"], THREE.UniformsLib[\"lightmap\"], THREE.UniformsLib[\"emissivemap\"], THREE.UniformsLib[\"bumpmap\"], THREE.UniformsLib[\"normalmap\"], THREE.UniformsLib[\"displacementmap\"], THREE.UniformsLib[\"fog\"], THREE.UniformsLib[\"lights\"], THREE.UniformsLib[\"shadowmap\"], {\n      \"emissive\": {\n        type: \"c\",\n        value: new THREE.Color(0x000000)\n      },\n      \"specular\": {\n        type: \"c\",\n        value: new THREE.Color(0x111111)\n      },\n      \"shininess\": {\n        type: \"f\",\n        value: 30\n      }\n    }]),\n    vertexShader: [\"#define PHONG\", \"varying vec3 vViewPosition;\", \"#ifndef FLAT_SHADED\", \"\tvarying vec3 vNormal;\", \"#endif\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"uv_pars_vertex\"], THREE.ShaderChunk[\"uv2_pars_vertex\"], THREE.ShaderChunk[\"displacementmap_pars_vertex\"], THREE.ShaderChunk[\"envmap_pars_vertex\"], THREE.ShaderChunk[\"lights_phong_pars_vertex\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"uv_vertex\"], THREE.ShaderChunk[\"uv2_vertex\"], THREE.ShaderChunk[\"color_vertex\"], THREE.ShaderChunk[\"beginnormal_vertex\"], THREE.ShaderChunk[\"morphnormal_vertex\"], THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"skinnormal_vertex\"], THREE.ShaderChunk[\"defaultnormal_vertex\"], \"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\n    \"\tvNormal = normalize( transformedNormal );\", \"#endif\", THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"displacementmap_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"\tvViewPosition = - mvPosition.xyz;\", THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"envmap_vertex\"], THREE.ShaderChunk[\"lights_phong_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"#define PHONG\", \"uniform vec3 diffuse;\", \"uniform vec3 emissive;\", \"uniform vec3 specular;\", \"uniform float shininess;\", \"uniform float opacity;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_fragment\"], THREE.ShaderChunk[\"uv_pars_fragment\"], THREE.ShaderChunk[\"uv2_pars_fragment\"], THREE.ShaderChunk[\"map_pars_fragment\"], THREE.ShaderChunk[\"alphamap_pars_fragment\"], THREE.ShaderChunk[\"aomap_pars_fragment\"], THREE.ShaderChunk[\"lightmap_pars_fragment\"], THREE.ShaderChunk[\"emissivemap_pars_fragment\"], THREE.ShaderChunk[\"envmap_pars_fragment\"], THREE.ShaderChunk[\"fog_pars_fragment\"], THREE.ShaderChunk[\"lights_phong_pars_fragment\"], THREE.ShaderChunk[\"shadowmap_pars_fragment\"], THREE.ShaderChunk[\"bumpmap_pars_fragment\"], THREE.ShaderChunk[\"normalmap_pars_fragment\"], THREE.ShaderChunk[\"specularmap_pars_fragment\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tvec3 outgoingLight = vec3( 0.0 );\", \"\tvec4 diffuseColor = vec4( diffuse, opacity );\", \"\tvec3 totalAmbientLight = ambientLightColor;\", \"\tvec3 totalEmissiveLight = emissive;\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], THREE.ShaderChunk[\"map_fragment\"], THREE.ShaderChunk[\"color_fragment\"], THREE.ShaderChunk[\"alphamap_fragment\"], THREE.ShaderChunk[\"alphatest_fragment\"], THREE.ShaderChunk[\"specularmap_fragment\"], THREE.ShaderChunk[\"lightmap_fragment\"], THREE.ShaderChunk[\"aomap_fragment\"], THREE.ShaderChunk[\"emissivemap_fragment\"], THREE.ShaderChunk[\"lights_phong_fragment\"], THREE.ShaderChunk[\"envmap_fragment\"], THREE.ShaderChunk[\"shadowmap_fragment\"], THREE.ShaderChunk[\"linear_to_gamma_fragment\"], THREE.ShaderChunk[\"fog_fragment\"], \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", \"}\"].join(\"\\n\")\n  },\n  'points': {\n    uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib[\"points\"], THREE.UniformsLib[\"shadowmap\"]]),\n    vertexShader: [\"uniform float size;\", \"uniform float scale;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"shadowmap_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"color_vertex\"], \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\", \"\t#ifdef USE_SIZEATTENUATION\", \"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\", \"\t#else\", \"\t\tgl_PointSize = size;\", \"\t#endif\", \"\tgl_Position = projectionMatrix * mvPosition;\", THREE.ShaderChunk[\"logdepthbuf_vertex\"], THREE.ShaderChunk[\"worldpos_vertex\"], THREE.ShaderChunk[\"shadowmap_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform vec3 psColor;\", \"uniform float opacity;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_fragment\"], THREE.ShaderChunk[\"map_particle_pars_fragment\"], THREE.ShaderChunk[\"fog_pars_fragment\"], THREE.ShaderChunk[\"shadowmap_pars_fragment\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tvec3 outgoingLight = vec3( 0.0 );\", \"\tvec4 diffuseColor = vec4( psColor, opacity );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], THREE.ShaderChunk[\"map_particle_fragment\"], THREE.ShaderChunk[\"color_fragment\"], THREE.ShaderChunk[\"alphatest_fragment\"], \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\n    THREE.ShaderChunk[\"shadowmap_fragment\"], THREE.ShaderChunk[\"fog_fragment\"], \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", \"}\"].join(\"\\n\")\n  },\n  'dashed': {\n    uniforms: THREE.UniformsUtils.merge([THREE.UniformsLib[\"common\"], THREE.UniformsLib[\"fog\"], {\n      \"scale\": {\n        type: \"f\",\n        value: 1\n      },\n      \"dashSize\": {\n        type: \"f\",\n        value: 1\n      },\n      \"totalSize\": {\n        type: \"f\",\n        value: 2\n      }\n    }]),\n    vertexShader: [\"uniform float scale;\", \"attribute float lineDistance;\", \"varying float vLineDistance;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"color_vertex\"], \"\tvLineDistance = scale * lineDistance;\", \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\", \"\tgl_Position = projectionMatrix * mvPosition;\", THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform vec3 diffuse;\", \"uniform float opacity;\", \"uniform float dashSize;\", \"uniform float totalSize;\", \"varying float vLineDistance;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"color_pars_fragment\"], THREE.ShaderChunk[\"fog_pars_fragment\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\", \"\t\tdiscard;\", \"\t}\", \"\tvec3 outgoingLight = vec3( 0.0 );\", \"\tvec4 diffuseColor = vec4( diffuse, opacity );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], THREE.ShaderChunk[\"color_fragment\"], \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\n    THREE.ShaderChunk[\"fog_fragment\"], \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", \"}\"].join(\"\\n\")\n  },\n  'depth': {\n    uniforms: {\n      \"mNear\": {\n        type: \"f\",\n        value: 1.0\n      },\n      \"mFar\": {\n        type: \"f\",\n        value: 2000.0\n      },\n      \"opacity\": {\n        type: \"f\",\n        value: 1.0\n      }\n    },\n    vertexShader: [THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform float mNear;\", \"uniform float mFar;\", \"uniform float opacity;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], \"\t#ifdef USE_LOGDEPTHBUF_EXT\", \"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\", \"\t#else\", \"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\", \"\t#endif\", \"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\", \"\tgl_FragColor = vec4( vec3( color ), opacity );\", \"}\"].join(\"\\n\")\n  },\n  'normal': {\n    uniforms: {\n      \"opacity\": {\n        type: \"f\",\n        value: 1.0\n      }\n    },\n    vertexShader: [\"varying vec3 vNormal;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", \"\tvNormal = normalize( normalMatrix * normal );\", THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform float opacity;\", \"varying vec3 vNormal;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], \"}\"].join(\"\\n\")\n  },\n\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\n  'cube': {\n    uniforms: {\n      \"tCube\": {\n        type: \"t\",\n        value: null\n      },\n      \"tFlip\": {\n        type: \"f\",\n        value: -1\n      }\n    },\n    vertexShader: [\"varying vec3 vWorldPosition;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", \"\tvWorldPosition = transformDirection( position, modelMatrix );\", \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\", THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform samplerCube tCube;\", \"uniform float tFlip;\", \"varying vec3 vWorldPosition;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], \"}\"].join(\"\\n\")\n  },\n\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\n  'equirect': {\n    uniforms: {\n      \"tEquirect\": {\n        type: \"t\",\n        value: null\n      },\n      \"tFlip\": {\n        type: \"f\",\n        value: -1\n      }\n    },\n    vertexShader: [\"varying vec3 vWorldPosition;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", \"\tvWorldPosition = transformDirection( position, modelMatrix );\", \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\", THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [\"uniform sampler2D tEquirect;\", \"uniform float tFlip;\", \"varying vec3 vWorldPosition;\", THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"void main() {\", // \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\n    \"vec3 direction = normalize( vWorldPosition );\", \"vec2 sampleUV;\", \"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\", \"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\", \"gl_FragColor = texture2D( tEquirect, sampleUV );\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], \"}\"].join(\"\\n\")\n  },\n\n  /* Depth encoding into RGBA texture\r\n   *\r\n   * based on SpiderGL shadow map example\r\n   * http://spidergl.org/example.php?id=6\r\n   *\r\n   * originally from\r\n   * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n   *\r\n   * see also\r\n   * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n   */\n  'depthRGBA': {\n    uniforms: {},\n    vertexShader: [THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"morphtarget_pars_vertex\"], THREE.ShaderChunk[\"skinning_pars_vertex\"], THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"], \"void main() {\", THREE.ShaderChunk[\"skinbase_vertex\"], THREE.ShaderChunk[\"begin_vertex\"], THREE.ShaderChunk[\"morphtarget_vertex\"], THREE.ShaderChunk[\"skinning_vertex\"], THREE.ShaderChunk[\"project_vertex\"], THREE.ShaderChunk[\"logdepthbuf_vertex\"], \"}\"].join(\"\\n\"),\n    fragmentShader: [THREE.ShaderChunk[\"common\"], THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"], \"vec4 pack_depth( const in float depth ) {\", \"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\", \"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\", \"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\n    \"\tres -= res.xxyz * bit_mask;\", \"\treturn res;\", \"}\", \"void main() {\", THREE.ShaderChunk[\"logdepthbuf_fragment\"], \"\t#ifdef USE_LOGDEPTHBUF_EXT\", \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\", \"\t#else\", \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\", \"\t#endif\", //\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\n    //\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\n    //\"gl_FragData[ 0 ] = pack_depth( z );\",\n    //\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\n    \"}\"].join(\"\\n\")\n  }\n}; // File:src/renderers/WebGLRenderer.js\n\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\n\nTHREE.WebGLRenderer = function (parameters) {\n  console.log('THREE.WebGLRenderer', THREE.REVISION);\n  parameters = parameters || {};\n\n  var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),\n      _context = parameters.context !== undefined ? parameters.context : null,\n      _width = _canvas.width,\n      _height = _canvas.height,\n      pixelRatio = 1,\n      _alpha = parameters.alpha !== undefined ? parameters.alpha : false,\n      _depth = parameters.depth !== undefined ? parameters.depth : true,\n      _stencil = parameters.stencil !== undefined ? parameters.stencil : true,\n      _antialias = parameters.antialias !== undefined ? parameters.antialias : false,\n      _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\n      _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\n      _clearColor = new THREE.Color(0x000000),\n      _clearAlpha = 0;\n\n  var lights = [];\n  var opaqueObjects = [];\n  var opaqueObjectsLastIndex = -1;\n  var transparentObjects = [];\n  var transparentObjectsLastIndex = -1;\n  var opaqueImmediateObjects = [];\n  var opaqueImmediateObjectsLastIndex = -1;\n  var transparentImmediateObjects = [];\n  var transparentImmediateObjectsLastIndex = -1;\n  var morphInfluences = new Float32Array(8);\n  var sprites = [];\n  var lensFlares = []; // public properties\n\n  this.domElement = _canvas;\n  this.context = null; // clearing\n\n  this.autoClear = true;\n  this.autoClearColor = true;\n  this.autoClearDepth = true;\n  this.autoClearStencil = true; // scene graph\n\n  this.sortObjects = true; // physically based shading\n\n  this.gammaFactor = 2.0; // for backwards compatibility\n\n  this.gammaInput = false;\n  this.gammaOutput = false; // morphs\n\n  this.maxMorphTargets = 8;\n  this.maxMorphNormals = 4; // flags\n\n  this.autoScaleCubemaps = true; // internal properties\n\n  var _this = this,\n      // internal state cache\n  _currentProgram = null,\n      _currentFramebuffer = null,\n      _currentMaterialId = -1,\n      _currentGeometryProgram = '',\n      _currentCamera = null,\n      _usedTextureUnits = 0,\n      _viewportX = 0,\n      _viewportY = 0,\n      _viewportWidth = _canvas.width,\n      _viewportHeight = _canvas.height,\n      _currentWidth = 0,\n      _currentHeight = 0,\n      // frustum\n  _frustum = new THREE.Frustum(),\n      // camera matrices cache\n  _projScreenMatrix = new THREE.Matrix4(),\n      _vector3 = new THREE.Vector3(),\n      // light arrays cache\n  _direction = new THREE.Vector3(),\n      _lightsNeedUpdate = true,\n      _lights = {\n    ambient: [0, 0, 0],\n    directional: {\n      length: 0,\n      colors: [],\n      positions: []\n    },\n    point: {\n      length: 0,\n      colors: [],\n      positions: [],\n      distances: [],\n      decays: []\n    },\n    spot: {\n      length: 0,\n      colors: [],\n      positions: [],\n      distances: [],\n      directions: [],\n      anglesCos: [],\n      exponents: [],\n      decays: []\n    },\n    hemi: {\n      length: 0,\n      skyColors: [],\n      groundColors: [],\n      positions: []\n    }\n  },\n      // info\n  _infoMemory = {\n    geometries: 0,\n    textures: 0\n  },\n      _infoRender = {\n    calls: 0,\n    vertices: 0,\n    faces: 0,\n    points: 0\n  };\n\n  this.info = {\n    render: _infoRender,\n    memory: _infoMemory,\n    programs: null\n  }; // initialize\n\n  var _gl;\n\n  try {\n    var attributes = {\n      alpha: _alpha,\n      depth: _depth,\n      stencil: _stencil,\n      antialias: _antialias,\n      premultipliedAlpha: _premultipliedAlpha,\n      preserveDrawingBuffer: _preserveDrawingBuffer\n    };\n    _gl = _context || _canvas.getContext('webgl', attributes) || _canvas.getContext('experimental-webgl', attributes);\n\n    if (_gl === null) {\n      if (_canvas.getContext('webgl') !== null) {\n        throw 'Error creating WebGL context with your selected attributes.';\n      } else {\n        throw 'Error creating WebGL context.';\n      }\n    }\n\n    _canvas.addEventListener('webglcontextlost', onContextLost, false);\n  } catch (error) {\n    console.error('THREE.WebGLRenderer: ' + error);\n  }\n\n  var extensions = new THREE.WebGLExtensions(_gl);\n  extensions.get('OES_texture_float');\n  extensions.get('OES_texture_float_linear');\n  extensions.get('OES_texture_half_float');\n  extensions.get('OES_texture_half_float_linear');\n  extensions.get('OES_standard_derivatives');\n  extensions.get('ANGLE_instanced_arrays');\n\n  if (extensions.get('OES_element_index_uint')) {\n    THREE.BufferGeometry.MaxIndex = 4294967296;\n  }\n\n  var capabilities = new THREE.WebGLCapabilities(_gl, extensions, parameters);\n  var state = new THREE.WebGLState(_gl, extensions, paramThreeToGL);\n  var properties = new THREE.WebGLProperties();\n  var objects = new THREE.WebGLObjects(_gl, properties, this.info);\n  var programCache = new THREE.WebGLPrograms(this, capabilities);\n  this.info.programs = programCache.programs;\n  var bufferRenderer = new THREE.WebGLBufferRenderer(_gl, extensions, _infoRender);\n  var indexedBufferRenderer = new THREE.WebGLIndexedBufferRenderer(_gl, extensions, _infoRender); //\n\n  function glClearColor(r, g, b, a) {\n    if (_premultipliedAlpha === true) {\n      r *= a;\n      g *= a;\n      b *= a;\n    }\n\n    _gl.clearColor(r, g, b, a);\n  }\n\n  function setDefaultGLState() {\n    state.init();\n\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\n\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\n  }\n\n  function resetGLState() {\n    _currentProgram = null;\n    _currentCamera = null;\n    _currentGeometryProgram = '';\n    _currentMaterialId = -1;\n    _lightsNeedUpdate = true;\n    state.reset();\n  }\n\n  setDefaultGLState();\n  this.context = _gl;\n  this.capabilities = capabilities;\n  this.extensions = extensions;\n  this.state = state; // shadow map\n\n  var shadowMap = new THREE.WebGLShadowMap(this, lights, objects);\n  this.shadowMap = shadowMap; // Plugins\n\n  var spritePlugin = new THREE.SpritePlugin(this, sprites);\n  var lensFlarePlugin = new THREE.LensFlarePlugin(this, lensFlares); // API\n\n  this.getContext = function () {\n    return _gl;\n  };\n\n  this.getContextAttributes = function () {\n    return _gl.getContextAttributes();\n  };\n\n  this.forceContextLoss = function () {\n    extensions.get('WEBGL_lose_context').loseContext();\n  };\n\n  this.getMaxAnisotropy = function () {\n    var value;\n    return function getMaxAnisotropy() {\n      if (value !== undefined) return value;\n      var extension = extensions.get('EXT_texture_filter_anisotropic');\n\n      if (extension !== null) {\n        value = _gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT);\n      } else {\n        value = 0;\n      }\n\n      return value;\n    };\n  }();\n\n  this.getPrecision = function () {\n    return capabilities.precision;\n  };\n\n  this.getPixelRatio = function () {\n    return pixelRatio;\n  };\n\n  this.setPixelRatio = function (value) {\n    if (value !== undefined) pixelRatio = value;\n  };\n\n  this.getSize = function () {\n    return {\n      width: _width,\n      height: _height\n    };\n  };\n\n  this.setSize = function (width, height, updateStyle) {\n    _width = width;\n    _height = height;\n    _canvas.width = width * pixelRatio;\n    _canvas.height = height * pixelRatio;\n\n    if (updateStyle !== false) {\n      _canvas.style.width = width + 'px';\n      _canvas.style.height = height + 'px';\n    }\n\n    this.setViewport(0, 0, width, height);\n  };\n\n  this.setViewport = function (x, y, width, height) {\n    _viewportX = x * pixelRatio;\n    _viewportY = y * pixelRatio;\n    _viewportWidth = width * pixelRatio;\n    _viewportHeight = height * pixelRatio;\n\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\n  };\n\n  this.setScissor = function (x, y, width, height) {\n    _gl.scissor(x * pixelRatio, y * pixelRatio, width * pixelRatio, height * pixelRatio);\n  };\n\n  this.enableScissorTest = function (boolean) {\n    state.setScissorTest(boolean);\n  }; // Clearing\n\n\n  this.getClearColor = function () {\n    return _clearColor;\n  };\n\n  this.setClearColor = function (color, alpha) {\n    _clearColor.set(color);\n\n    _clearAlpha = alpha !== undefined ? alpha : 1;\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\n  };\n\n  this.getClearAlpha = function () {\n    return _clearAlpha;\n  };\n\n  this.setClearAlpha = function (alpha) {\n    _clearAlpha = alpha;\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\n  };\n\n  this.clear = function (color, depth, stencil) {\n    var bits = 0;\n    if (color === undefined || color) bits |= _gl.COLOR_BUFFER_BIT;\n    if (depth === undefined || depth) bits |= _gl.DEPTH_BUFFER_BIT;\n    if (stencil === undefined || stencil) bits |= _gl.STENCIL_BUFFER_BIT;\n\n    _gl.clear(bits);\n  };\n\n  this.clearColor = function () {\n    _gl.clear(_gl.COLOR_BUFFER_BIT);\n  };\n\n  this.clearDepth = function () {\n    _gl.clear(_gl.DEPTH_BUFFER_BIT);\n  };\n\n  this.clearStencil = function () {\n    _gl.clear(_gl.STENCIL_BUFFER_BIT);\n  };\n\n  this.clearTarget = function (renderTarget, color, depth, stencil) {\n    this.setRenderTarget(renderTarget);\n    this.clear(color, depth, stencil);\n  }; // Reset\n\n\n  this.resetGLState = resetGLState;\n\n  this.dispose = function () {\n    _canvas.removeEventListener('webglcontextlost', onContextLost, false);\n  }; // Events\n\n\n  function onContextLost(event) {\n    event.preventDefault();\n    resetGLState();\n    setDefaultGLState();\n    properties.clear();\n  }\n\n  ;\n\n  function onTextureDispose(event) {\n    var texture = event.target;\n    texture.removeEventListener('dispose', onTextureDispose);\n    deallocateTexture(texture);\n    _infoMemory.textures--;\n  }\n\n  function onRenderTargetDispose(event) {\n    var renderTarget = event.target;\n    renderTarget.removeEventListener('dispose', onRenderTargetDispose);\n    deallocateRenderTarget(renderTarget);\n    _infoMemory.textures--;\n  }\n\n  function onMaterialDispose(event) {\n    var material = event.target;\n    material.removeEventListener('dispose', onMaterialDispose);\n    deallocateMaterial(material);\n  } // Buffer deallocation\n\n\n  function deallocateTexture(texture) {\n    var textureProperties = properties.get(texture);\n\n    if (texture.image && textureProperties.__image__webglTextureCube) {\n      // cube texture\n      _gl.deleteTexture(textureProperties.__image__webglTextureCube);\n    } else {\n      // 2D texture\n      if (textureProperties.__webglInit === undefined) return;\n\n      _gl.deleteTexture(textureProperties.__webglTexture);\n    } // remove all webgl properties\n\n\n    properties.delete(texture);\n  }\n\n  function deallocateRenderTarget(renderTarget) {\n    var renderTargetProperties = properties.get(renderTarget);\n    if (!renderTarget || renderTargetProperties.__webglTexture === undefined) return;\n\n    _gl.deleteTexture(renderTargetProperties.__webglTexture);\n\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\n      for (var i = 0; i < 6; i++) {\n        _gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]);\n\n        _gl.deleteRenderbuffer(renderTargetProperties.__webglRenderbuffer[i]);\n      }\n    } else {\n      _gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer);\n\n      _gl.deleteRenderbuffer(renderTargetProperties.__webglRenderbuffer);\n    }\n\n    properties.delete(renderTarget);\n  }\n\n  function deallocateMaterial(material) {\n    releaseMaterialProgramReference(material);\n    properties.delete(material);\n  }\n\n  function releaseMaterialProgramReference(material) {\n    var programInfo = properties.get(material).program;\n    material.program = undefined;\n\n    if (programInfo !== undefined) {\n      programCache.releaseProgram(programInfo);\n    }\n  } // Buffer rendering\n\n\n  this.renderBufferImmediate = function (object, program, material) {\n    state.initAttributes();\n    var buffers = properties.get(object);\n    if (object.hasPositions && !buffers.position) buffers.position = _gl.createBuffer();\n    if (object.hasNormals && !buffers.normal) buffers.normal = _gl.createBuffer();\n    if (object.hasUvs && !buffers.uv) buffers.uv = _gl.createBuffer();\n    if (object.hasColors && !buffers.color) buffers.color = _gl.createBuffer();\n    var attributes = program.getAttributes();\n\n    if (object.hasPositions) {\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, buffers.position);\n\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW);\n\n      state.enableAttribute(attributes.position);\n\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\n    }\n\n    if (object.hasNormals) {\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, buffers.normal);\n\n      if (material.type !== 'MeshPhongMaterial' && material.shading === THREE.FlatShading) {\n        for (var i = 0, l = object.count * 3; i < l; i += 9) {\n          var array = object.normalArray;\n          var nx = (array[i + 0] + array[i + 3] + array[i + 6]) / 3;\n          var ny = (array[i + 1] + array[i + 4] + array[i + 7]) / 3;\n          var nz = (array[i + 2] + array[i + 5] + array[i + 8]) / 3;\n          array[i + 0] = nx;\n          array[i + 1] = ny;\n          array[i + 2] = nz;\n          array[i + 3] = nx;\n          array[i + 4] = ny;\n          array[i + 5] = nz;\n          array[i + 6] = nx;\n          array[i + 7] = ny;\n          array[i + 8] = nz;\n        }\n      }\n\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW);\n\n      state.enableAttribute(attributes.normal);\n\n      _gl.vertexAttribPointer(attributes.normal, 3, _gl.FLOAT, false, 0, 0);\n    }\n\n    if (object.hasUvs && material.map) {\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, buffers.uv);\n\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW);\n\n      state.enableAttribute(attributes.uv);\n\n      _gl.vertexAttribPointer(attributes.uv, 2, _gl.FLOAT, false, 0, 0);\n    }\n\n    if (object.hasColors && material.vertexColors !== THREE.NoColors) {\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, buffers.color);\n\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW);\n\n      state.enableAttribute(attributes.color);\n\n      _gl.vertexAttribPointer(attributes.color, 3, _gl.FLOAT, false, 0, 0);\n    }\n\n    state.disableUnusedAttributes();\n\n    _gl.drawArrays(_gl.TRIANGLES, 0, object.count);\n\n    object.count = 0;\n  };\n\n  this.renderBufferDirect = function (camera, lights, fog, geometry, material, object, group) {\n    setMaterial(material);\n    var program = setProgram(camera, lights, fog, material, object);\n    var updateBuffers = false;\n    var geometryProgram = geometry.id + '_' + program.id + '_' + material.wireframe;\n\n    if (geometryProgram !== _currentGeometryProgram) {\n      _currentGeometryProgram = geometryProgram;\n      updateBuffers = true;\n    } // morph targets\n\n\n    var morphTargetInfluences = object.morphTargetInfluences;\n\n    if (morphTargetInfluences !== undefined) {\n      var activeInfluences = [];\n\n      for (var i = 0, l = morphTargetInfluences.length; i < l; i++) {\n        var influence = morphTargetInfluences[i];\n        activeInfluences.push([influence, i]);\n      }\n\n      activeInfluences.sort(numericalSort);\n\n      if (activeInfluences.length > 8) {\n        activeInfluences.length = 8;\n      }\n\n      var morphAttributes = geometry.morphAttributes;\n\n      for (var i = 0, l = activeInfluences.length; i < l; i++) {\n        var influence = activeInfluences[i];\n        morphInfluences[i] = influence[0];\n\n        if (influence[0] !== 0) {\n          var index = influence[1];\n          if (material.morphTargets === true && morphAttributes.position) geometry.addAttribute('morphTarget' + i, morphAttributes.position[index]);\n          if (material.morphNormals === true && morphAttributes.normal) geometry.addAttribute('morphNormal' + i, morphAttributes.normal[index]);\n        } else {\n          if (material.morphTargets === true) geometry.removeAttribute('morphTarget' + i);\n          if (material.morphNormals === true) geometry.removeAttribute('morphNormal' + i);\n        }\n      }\n\n      var uniforms = program.getUniforms();\n\n      if (uniforms.morphTargetInfluences !== null) {\n        _gl.uniform1fv(uniforms.morphTargetInfluences, morphInfluences);\n      }\n\n      updateBuffers = true;\n    } //\n\n\n    var index = geometry.index;\n    var position = geometry.attributes.position;\n\n    if (material.wireframe === true) {\n      index = objects.getWireframeAttribute(geometry);\n    }\n\n    var renderer;\n\n    if (index !== null) {\n      renderer = indexedBufferRenderer;\n      renderer.setIndex(index);\n    } else {\n      renderer = bufferRenderer;\n    }\n\n    if (updateBuffers) {\n      setupVertexAttributes(material, program, geometry);\n\n      if (index !== null) {\n        _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, objects.getAttributeBuffer(index));\n      }\n    }\n\n    if (group === undefined) {\n      var count;\n\n      if (index !== null) {\n        count = index.count;\n      } else if (position instanceof THREE.InterleavedBufferAttribute) {\n        count = position.data.array.length / 3;\n      } else {\n        count = position.count;\n      }\n\n      var drawRange = geometry.drawRange;\n      group = {\n        start: drawRange.start,\n        count: Math.min(drawRange.count, count)\n      };\n    }\n\n    if (object instanceof THREE.Mesh) {\n      if (material.wireframe === true) {\n        state.setLineWidth(material.wireframeLinewidth * pixelRatio);\n        renderer.setMode(_gl.LINES);\n      } else {\n        renderer.setMode(_gl.TRIANGLES);\n      }\n\n      if (geometry instanceof THREE.InstancedBufferGeometry && geometry.maxInstancedCount > 0) {\n        renderer.renderInstances(geometry);\n      } else {\n        renderer.render(group.start, group.count);\n      }\n    } else if (object instanceof THREE.Line) {\n      var lineWidth = material.linewidth;\n      if (lineWidth === undefined) lineWidth = 1; // Not using Line*Material\n\n      state.setLineWidth(lineWidth * pixelRatio);\n\n      if (object instanceof THREE.LineSegments) {\n        renderer.setMode(_gl.LINES);\n      } else {\n        renderer.setMode(_gl.LINE_STRIP);\n      }\n\n      renderer.render(group.start, group.count);\n    } else if (object instanceof THREE.Points) {\n      renderer.setMode(_gl.POINTS);\n      renderer.render(group.start, group.count);\n    }\n  };\n\n  function setupVertexAttributes(material, program, geometry, startIndex) {\n    var extension;\n\n    if (geometry instanceof THREE.InstancedBufferGeometry) {\n      extension = extensions.get('ANGLE_instanced_arrays');\n\n      if (extension === null) {\n        console.error('THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');\n        return;\n      }\n    }\n\n    if (startIndex === undefined) startIndex = 0;\n    state.initAttributes();\n    var geometryAttributes = geometry.attributes;\n    var programAttributes = program.getAttributes();\n    var materialDefaultAttributeValues = material.defaultAttributeValues;\n\n    for (var name in programAttributes) {\n      var programAttribute = programAttributes[name];\n\n      if (programAttribute >= 0) {\n        var geometryAttribute = geometryAttributes[name];\n\n        if (geometryAttribute !== undefined) {\n          state.enableAttribute(programAttribute);\n          var size = geometryAttribute.itemSize;\n          var buffer = objects.getAttributeBuffer(geometryAttribute);\n\n          if (geometryAttribute instanceof THREE.InterleavedBufferAttribute) {\n            var data = geometryAttribute.data;\n            var stride = data.stride;\n            var offset = geometryAttribute.offset;\n\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, buffer);\n\n            _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, stride * data.array.BYTES_PER_ELEMENT, (startIndex * stride + offset) * data.array.BYTES_PER_ELEMENT);\n\n            if (data instanceof THREE.InstancedInterleavedBuffer) {\n              if (extension === null) {\n                console.error('THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.');\n                return;\n              }\n\n              extension.vertexAttribDivisorANGLE(programAttribute, data.meshPerAttribute);\n\n              if (geometry.maxInstancedCount === undefined) {\n                geometry.maxInstancedCount = data.meshPerAttribute * data.count;\n              }\n            }\n          } else {\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, buffer);\n\n            _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4); // 4 bytes per Float32\n\n\n            if (geometryAttribute instanceof THREE.InstancedBufferAttribute) {\n              if (extension === null) {\n                console.error('THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.');\n                return;\n              }\n\n              extension.vertexAttribDivisorANGLE(programAttribute, geometryAttribute.meshPerAttribute);\n\n              if (geometry.maxInstancedCount === undefined) {\n                geometry.maxInstancedCount = geometryAttribute.meshPerAttribute * geometryAttribute.count;\n              }\n            }\n          }\n        } else if (materialDefaultAttributeValues !== undefined) {\n          var value = materialDefaultAttributeValues[name];\n\n          if (value !== undefined) {\n            switch (value.length) {\n              case 2:\n                _gl.vertexAttrib2fv(programAttribute, value);\n\n                break;\n\n              case 3:\n                _gl.vertexAttrib3fv(programAttribute, value);\n\n                break;\n\n              case 4:\n                _gl.vertexAttrib4fv(programAttribute, value);\n\n                break;\n\n              default:\n                _gl.vertexAttrib1fv(programAttribute, value);\n\n            }\n          }\n        }\n      }\n    }\n\n    state.disableUnusedAttributes();\n  } // Sorting\n\n\n  function numericalSort(a, b) {\n    return b[0] - a[0];\n  }\n\n  function painterSortStable(a, b) {\n    if (a.object.renderOrder !== b.object.renderOrder) {\n      return a.object.renderOrder - b.object.renderOrder;\n    } else if (a.material.id !== b.material.id) {\n      return a.material.id - b.material.id;\n    } else if (a.z !== b.z) {\n      return a.z - b.z;\n    } else {\n      return a.id - b.id;\n    }\n  }\n\n  function reversePainterSortStable(a, b) {\n    if (a.object.renderOrder !== b.object.renderOrder) {\n      return a.object.renderOrder - b.object.renderOrder;\n    }\n\n    if (a.z !== b.z) {\n      return b.z - a.z;\n    } else {\n      return a.id - b.id;\n    }\n  } // Rendering\n\n\n  this.render = function (scene, camera, renderTarget, forceClear) {\n    if (camera instanceof THREE.Camera === false) {\n      console.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\n      return;\n    }\n\n    var fog = scene.fog; // reset caching for this frame\n\n    _currentGeometryProgram = '';\n    _currentMaterialId = -1;\n    _currentCamera = null;\n    _lightsNeedUpdate = true; // update scene graph\n\n    if (scene.autoUpdate === true) scene.updateMatrixWorld(); // update camera matrices and frustum\n\n    if (camera.parent === null) camera.updateMatrixWorld();\n    camera.matrixWorldInverse.getInverse(camera.matrixWorld);\n\n    _projScreenMatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\n\n    _frustum.setFromMatrix(_projScreenMatrix);\n\n    lights.length = 0;\n    opaqueObjectsLastIndex = -1;\n    transparentObjectsLastIndex = -1;\n    opaqueImmediateObjectsLastIndex = -1;\n    transparentImmediateObjectsLastIndex = -1;\n    sprites.length = 0;\n    lensFlares.length = 0;\n    projectObject(scene);\n    opaqueObjects.length = opaqueObjectsLastIndex + 1;\n    transparentObjects.length = transparentObjectsLastIndex + 1;\n    opaqueImmediateObjects.length = opaqueImmediateObjectsLastIndex + 1;\n    transparentImmediateObjects.length = transparentImmediateObjectsLastIndex + 1;\n\n    if (_this.sortObjects === true) {\n      opaqueObjects.sort(painterSortStable);\n      transparentObjects.sort(reversePainterSortStable);\n    } //\n\n\n    shadowMap.render(scene, camera); //\n\n    _infoRender.calls = 0;\n    _infoRender.vertices = 0;\n    _infoRender.faces = 0;\n    _infoRender.points = 0;\n    this.setRenderTarget(renderTarget);\n\n    if (this.autoClear || forceClear) {\n      this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);\n    } //\n\n\n    if (scene.overrideMaterial) {\n      var overrideMaterial = scene.overrideMaterial;\n      renderObjects(opaqueObjects, camera, lights, fog, overrideMaterial);\n      renderObjects(transparentObjects, camera, lights, fog, overrideMaterial);\n      renderObjectsImmediate(opaqueImmediateObjects, camera, lights, fog, overrideMaterial);\n      renderObjectsImmediate(transparentImmediateObjects, camera, lights, fog, overrideMaterial);\n    } else {\n      // opaque pass (front-to-back order)\n      state.setBlending(THREE.NoBlending);\n      renderObjects(opaqueObjects, camera, lights, fog);\n      renderObjectsImmediate(opaqueImmediateObjects, camera, lights, fog); // transparent pass (back-to-front order)\n\n      renderObjects(transparentObjects, camera, lights, fog);\n      renderObjectsImmediate(transparentImmediateObjects, camera, lights, fog);\n    } // custom render plugins (post pass)\n\n\n    spritePlugin.render(scene, camera);\n    lensFlarePlugin.render(scene, camera, _currentWidth, _currentHeight); // Generate mipmap if we're using any kind of mipmap filtering\n\n    if (renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter) {\n      updateRenderTargetMipmap(renderTarget);\n    } // Ensure depth buffer writing is enabled so it can be cleared on next render\n\n\n    state.setDepthTest(true);\n    state.setDepthWrite(true);\n    state.setColorWrite(true); // _gl.finish();\n  };\n\n  function pushImmediateRenderItem(object) {\n    var array, index; // allocate the next position in the appropriate array\n\n    if (object.material.transparent) {\n      array = transparentImmediateObjects;\n      index = ++transparentImmediateObjectsLastIndex;\n    } else {\n      array = opaqueImmediateObjects;\n      index = ++opaqueImmediateObjectsLastIndex;\n    } // recycle existing position or grow the array\n\n\n    if (index < array.length) {\n      array[index] = object;\n    } else {\n      // assert( index === array.length );\n      array.push(object);\n    }\n  }\n\n  function pushRenderItem(object, geometry, material, z, group) {\n    var array, index; // allocate the next position in the appropriate array\n\n    if (material.transparent) {\n      array = transparentObjects;\n      index = ++transparentObjectsLastIndex;\n    } else {\n      array = opaqueObjects;\n      index = ++opaqueObjectsLastIndex;\n    } // recycle existing render item or grow the array\n\n\n    var renderItem = array[index];\n\n    if (renderItem !== undefined) {\n      renderItem.id = object.id;\n      renderItem.object = object;\n      renderItem.geometry = geometry;\n      renderItem.material = material;\n      renderItem.z = _vector3.z;\n      renderItem.group = group;\n    } else {\n      renderItem = {\n        id: object.id,\n        object: object,\n        geometry: geometry,\n        material: material,\n        z: _vector3.z,\n        group: group\n      }; // assert( index === array.length );\n\n      array.push(renderItem);\n    }\n  }\n\n  function projectObject(object) {\n    if (object.visible === false) return;\n\n    if (object instanceof THREE.Light) {\n      lights.push(object);\n    } else if (object instanceof THREE.Sprite) {\n      sprites.push(object);\n    } else if (object instanceof THREE.LensFlare) {\n      lensFlares.push(object);\n    } else if (object instanceof THREE.ImmediateRenderObject) {\n      pushImmediateRenderItem(object);\n    } else if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Points) {\n      if (object instanceof THREE.SkinnedMesh) {\n        object.skeleton.update();\n      }\n\n      if (object.frustumCulled === false || _frustum.intersectsObject(object) === true) {\n        var material = object.material;\n\n        if (material.visible === true) {\n          if (_this.sortObjects === true) {\n            _vector3.setFromMatrixPosition(object.matrixWorld);\n\n            _vector3.applyProjection(_projScreenMatrix);\n          }\n\n          var geometry = objects.update(object);\n\n          if (material instanceof THREE.MeshFaceMaterial) {\n            var groups = geometry.groups;\n            var materials = material.materials;\n\n            for (var i = 0, l = groups.length; i < l; i++) {\n              var group = groups[i];\n              var groupMaterial = materials[group.materialIndex];\n\n              if (groupMaterial.visible === true) {\n                pushRenderItem(object, geometry, groupMaterial, _vector3.z, group);\n              }\n            }\n          } else {\n            pushRenderItem(object, geometry, material, _vector3.z);\n          }\n        }\n      }\n    }\n\n    var children = object.children;\n\n    for (var i = 0, l = children.length; i < l; i++) {\n      projectObject(children[i]);\n    }\n  }\n\n  function renderObjects(renderList, camera, lights, fog, overrideMaterial) {\n    for (var i = 0, l = renderList.length; i < l; i++) {\n      var renderItem = renderList[i];\n      var object = renderItem.object;\n      var geometry = renderItem.geometry;\n      var material = overrideMaterial === undefined ? renderItem.material : overrideMaterial;\n      var group = renderItem.group;\n      object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\n      object.normalMatrix.getNormalMatrix(object.modelViewMatrix);\n\n      _this.renderBufferDirect(camera, lights, fog, geometry, material, object, group);\n    }\n  }\n\n  function renderObjectsImmediate(renderList, camera, lights, fog, overrideMaterial) {\n    var material = overrideMaterial;\n\n    for (var i = 0, l = renderList.length; i < l; i++) {\n      var object = renderList[i];\n      object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\n      object.normalMatrix.getNormalMatrix(object.modelViewMatrix);\n      if (overrideMaterial === undefined) material = object.material;\n      setMaterial(material);\n      var program = setProgram(camera, lights, fog, material, object);\n      _currentGeometryProgram = '';\n      object.render(function (object) {\n        _this.renderBufferImmediate(object, program, material);\n      });\n    }\n  }\n\n  function initMaterial(material, lights, fog, object) {\n    var materialProperties = properties.get(material);\n    var parameters = programCache.getParameters(material, lights, fog, object);\n    var code = programCache.getProgramCode(material, parameters);\n    var program = materialProperties.program;\n    var programChange = true;\n\n    if (program === undefined) {\n      // new material\n      material.addEventListener('dispose', onMaterialDispose);\n    } else if (program.code !== code) {\n      // changed glsl or parameters\n      releaseMaterialProgramReference(material);\n    } else if (parameters.shaderID !== undefined) {\n      // same glsl and uniform list\n      return;\n    } else {\n      // only rebuild uniform list\n      programChange = false;\n    }\n\n    if (programChange) {\n      if (parameters.shaderID) {\n        var shader = THREE.ShaderLib[parameters.shaderID];\n        materialProperties.__webglShader = {\n          name: material.type,\n          uniforms: THREE.UniformsUtils.clone(shader.uniforms),\n          vertexShader: shader.vertexShader,\n          fragmentShader: shader.fragmentShader\n        };\n      } else {\n        materialProperties.__webglShader = {\n          name: material.type,\n          uniforms: material.uniforms,\n          vertexShader: material.vertexShader,\n          fragmentShader: material.fragmentShader\n        };\n      }\n\n      material.__webglShader = materialProperties.__webglShader;\n      program = programCache.acquireProgram(material, parameters, code);\n      materialProperties.program = program;\n      material.program = program;\n    }\n\n    var attributes = program.getAttributes();\n\n    if (material.morphTargets) {\n      material.numSupportedMorphTargets = 0;\n\n      for (var i = 0; i < _this.maxMorphTargets; i++) {\n        if (attributes['morphTarget' + i] >= 0) {\n          material.numSupportedMorphTargets++;\n        }\n      }\n    }\n\n    if (material.morphNormals) {\n      material.numSupportedMorphNormals = 0;\n\n      for (i = 0; i < _this.maxMorphNormals; i++) {\n        if (attributes['morphNormal' + i] >= 0) {\n          material.numSupportedMorphNormals++;\n        }\n      }\n    }\n\n    materialProperties.uniformsList = [];\n    var uniformLocations = materialProperties.program.getUniforms();\n\n    for (var u in materialProperties.__webglShader.uniforms) {\n      var location = uniformLocations[u];\n\n      if (location) {\n        materialProperties.uniformsList.push([materialProperties.__webglShader.uniforms[u], location]);\n      }\n    }\n  }\n\n  function setMaterial(material) {\n    setMaterialFaces(material);\n\n    if (material.transparent === true) {\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha);\n    } else {\n      state.setBlending(THREE.NoBlending);\n    }\n\n    state.setDepthFunc(material.depthFunc);\n    state.setDepthTest(material.depthTest);\n    state.setDepthWrite(material.depthWrite);\n    state.setColorWrite(material.colorWrite);\n    state.setPolygonOffset(material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits);\n  }\n\n  function setMaterialFaces(material) {\n    material.side !== THREE.DoubleSide ? state.enable(_gl.CULL_FACE) : state.disable(_gl.CULL_FACE);\n    state.setFlipSided(material.side === THREE.BackSide);\n  }\n\n  function setProgram(camera, lights, fog, material, object) {\n    _usedTextureUnits = 0;\n    var materialProperties = properties.get(material);\n\n    if (material.needsUpdate || !materialProperties.program) {\n      initMaterial(material, lights, fog, object);\n      material.needsUpdate = false;\n    }\n\n    var refreshProgram = false;\n    var refreshMaterial = false;\n    var refreshLights = false;\n    var program = materialProperties.program,\n        p_uniforms = program.getUniforms(),\n        m_uniforms = materialProperties.__webglShader.uniforms;\n\n    if (program.id !== _currentProgram) {\n      _gl.useProgram(program.program);\n\n      _currentProgram = program.id;\n      refreshProgram = true;\n      refreshMaterial = true;\n      refreshLights = true;\n    }\n\n    if (material.id !== _currentMaterialId) {\n      if (_currentMaterialId === -1) refreshLights = true;\n      _currentMaterialId = material.id;\n      refreshMaterial = true;\n    }\n\n    if (refreshProgram || camera !== _currentCamera) {\n      _gl.uniformMatrix4fv(p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\n\n      if (capabilities.logarithmicDepthBuffer) {\n        _gl.uniform1f(p_uniforms.logDepthBufFC, 2.0 / (Math.log(camera.far + 1.0) / Math.LN2));\n      }\n\n      if (camera !== _currentCamera) _currentCamera = camera; // load material specific uniforms\n      // (shader material also gets them for the sake of genericity)\n\n      if (material instanceof THREE.ShaderMaterial || material instanceof THREE.MeshPhongMaterial || material.envMap) {\n        if (p_uniforms.cameraPosition !== undefined) {\n          _vector3.setFromMatrixPosition(camera.matrixWorld);\n\n          _gl.uniform3f(p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z);\n        }\n      }\n\n      if (material instanceof THREE.MeshPhongMaterial || material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshBasicMaterial || material instanceof THREE.ShaderMaterial || material.skinning) {\n        if (p_uniforms.viewMatrix !== undefined) {\n          _gl.uniformMatrix4fv(p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements);\n        }\n      }\n    } // skinning uniforms must be set even if material didn't change\n    // auto-setting of texture unit for bone texture must go before other textures\n    // not sure why, but otherwise weird things happen\n\n\n    if (material.skinning) {\n      if (object.bindMatrix && p_uniforms.bindMatrix !== undefined) {\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrix, false, object.bindMatrix.elements);\n      }\n\n      if (object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== undefined) {\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements);\n      }\n\n      if (capabilities.floatVertexTextures && object.skeleton && object.skeleton.useVertexTexture) {\n        if (p_uniforms.boneTexture !== undefined) {\n          var textureUnit = getTextureUnit();\n\n          _gl.uniform1i(p_uniforms.boneTexture, textureUnit);\n\n          _this.setTexture(object.skeleton.boneTexture, textureUnit);\n        }\n\n        if (p_uniforms.boneTextureWidth !== undefined) {\n          _gl.uniform1i(p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth);\n        }\n\n        if (p_uniforms.boneTextureHeight !== undefined) {\n          _gl.uniform1i(p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight);\n        }\n      } else if (object.skeleton && object.skeleton.boneMatrices) {\n        if (p_uniforms.boneGlobalMatrices !== undefined) {\n          _gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices);\n        }\n      }\n    }\n\n    if (refreshMaterial) {\n      // refresh uniforms common to several materials\n      if (fog && material.fog) {\n        refreshUniformsFog(m_uniforms, fog);\n      }\n\n      if (material instanceof THREE.MeshPhongMaterial || material instanceof THREE.MeshLambertMaterial || material.lights) {\n        if (_lightsNeedUpdate) {\n          refreshLights = true;\n          setupLights(lights, camera);\n          _lightsNeedUpdate = false;\n        }\n\n        if (refreshLights) {\n          refreshUniformsLights(m_uniforms, _lights);\n          markUniformsLightsNeedsUpdate(m_uniforms, true);\n        } else {\n          markUniformsLightsNeedsUpdate(m_uniforms, false);\n        }\n      }\n\n      if (material instanceof THREE.MeshBasicMaterial || material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial) {\n        refreshUniformsCommon(m_uniforms, material);\n      } // refresh single material specific uniforms\n\n\n      if (material instanceof THREE.LineBasicMaterial) {\n        refreshUniformsLine(m_uniforms, material);\n      } else if (material instanceof THREE.LineDashedMaterial) {\n        refreshUniformsLine(m_uniforms, material);\n        refreshUniformsDash(m_uniforms, material);\n      } else if (material instanceof THREE.PointsMaterial) {\n        refreshUniformsParticle(m_uniforms, material);\n      } else if (material instanceof THREE.MeshPhongMaterial) {\n        refreshUniformsPhong(m_uniforms, material);\n      } else if (material instanceof THREE.MeshDepthMaterial) {\n        m_uniforms.mNear.value = camera.near;\n        m_uniforms.mFar.value = camera.far;\n        m_uniforms.opacity.value = material.opacity;\n      } else if (material instanceof THREE.MeshNormalMaterial) {\n        m_uniforms.opacity.value = material.opacity;\n      }\n\n      if (object.receiveShadow && !material._shadowPass) {\n        refreshUniformsShadow(m_uniforms, lights);\n      } // load common uniforms\n\n\n      loadUniformsGeneric(materialProperties.uniformsList);\n    }\n\n    loadUniformsMatrices(p_uniforms, object);\n\n    if (p_uniforms.modelMatrix !== undefined) {\n      _gl.uniformMatrix4fv(p_uniforms.modelMatrix, false, object.matrixWorld.elements);\n    }\n\n    return program;\n  } // Uniforms (refresh uniforms objects)\n\n\n  function refreshUniformsCommon(uniforms, material) {\n    uniforms.opacity.value = material.opacity;\n    uniforms.diffuse.value = material.color;\n\n    if (material.emissive) {\n      uniforms.emissive.value = material.emissive;\n    }\n\n    uniforms.map.value = material.map;\n    uniforms.specularMap.value = material.specularMap;\n    uniforms.alphaMap.value = material.alphaMap;\n\n    if (material.aoMap) {\n      uniforms.aoMap.value = material.aoMap;\n      uniforms.aoMapIntensity.value = material.aoMapIntensity;\n    } // uv repeat and offset setting priorities\n    // 1. color map\n    // 2. specular map\n    // 3. normal map\n    // 4. bump map\n    // 5. alpha map\n    // 6. emissive map\n\n\n    var uvScaleMap;\n\n    if (material.map) {\n      uvScaleMap = material.map;\n    } else if (material.specularMap) {\n      uvScaleMap = material.specularMap;\n    } else if (material.displacementMap) {\n      uvScaleMap = material.displacementMap;\n    } else if (material.normalMap) {\n      uvScaleMap = material.normalMap;\n    } else if (material.bumpMap) {\n      uvScaleMap = material.bumpMap;\n    } else if (material.alphaMap) {\n      uvScaleMap = material.alphaMap;\n    } else if (material.emissiveMap) {\n      uvScaleMap = material.emissiveMap;\n    }\n\n    if (uvScaleMap !== undefined) {\n      var offset = uvScaleMap.offset;\n      var repeat = uvScaleMap.repeat;\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\n    }\n\n    uniforms.envMap.value = material.envMap;\n    uniforms.flipEnvMap.value = material.envMap instanceof THREE.WebGLRenderTargetCube ? 1 : -1;\n    uniforms.reflectivity.value = material.reflectivity;\n    uniforms.refractionRatio.value = material.refractionRatio;\n  }\n\n  function refreshUniformsLine(uniforms, material) {\n    uniforms.diffuse.value = material.color;\n    uniforms.opacity.value = material.opacity;\n  }\n\n  function refreshUniformsDash(uniforms, material) {\n    uniforms.dashSize.value = material.dashSize;\n    uniforms.totalSize.value = material.dashSize + material.gapSize;\n    uniforms.scale.value = material.scale;\n  }\n\n  function refreshUniformsParticle(uniforms, material) {\n    uniforms.psColor.value = material.color;\n    uniforms.opacity.value = material.opacity;\n    uniforms.size.value = material.size;\n    uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\n\n    uniforms.map.value = material.map;\n\n    if (material.map !== null) {\n      var offset = material.map.offset;\n      var repeat = material.map.repeat;\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\n    }\n  }\n\n  function refreshUniformsFog(uniforms, fog) {\n    uniforms.fogColor.value = fog.color;\n\n    if (fog instanceof THREE.Fog) {\n      uniforms.fogNear.value = fog.near;\n      uniforms.fogFar.value = fog.far;\n    } else if (fog instanceof THREE.FogExp2) {\n      uniforms.fogDensity.value = fog.density;\n    }\n  }\n\n  function refreshUniformsPhong(uniforms, material) {\n    uniforms.specular.value = material.specular;\n    uniforms.shininess.value = material.shininess;\n\n    if (material.lightMap) {\n      uniforms.lightMap.value = material.lightMap;\n      uniforms.lightMapIntensity.value = material.lightMapIntensity;\n    }\n\n    if (material.emissiveMap) {\n      uniforms.emissiveMap.value = material.emissiveMap;\n    }\n\n    if (material.bumpMap) {\n      uniforms.bumpMap.value = material.bumpMap;\n      uniforms.bumpScale.value = material.bumpScale;\n    }\n\n    if (material.normalMap) {\n      uniforms.normalMap.value = material.normalMap;\n      uniforms.normalScale.value.copy(material.normalScale);\n    }\n\n    if (material.displacementMap) {\n      uniforms.displacementMap.value = material.displacementMap;\n      uniforms.displacementScale.value = material.displacementScale;\n      uniforms.displacementBias.value = material.displacementBias;\n    }\n  }\n\n  function refreshUniformsLights(uniforms, lights) {\n    uniforms.ambientLightColor.value = lights.ambient;\n    uniforms.directionalLightColor.value = lights.directional.colors;\n    uniforms.directionalLightDirection.value = lights.directional.positions;\n    uniforms.pointLightColor.value = lights.point.colors;\n    uniforms.pointLightPosition.value = lights.point.positions;\n    uniforms.pointLightDistance.value = lights.point.distances;\n    uniforms.pointLightDecay.value = lights.point.decays;\n    uniforms.spotLightColor.value = lights.spot.colors;\n    uniforms.spotLightPosition.value = lights.spot.positions;\n    uniforms.spotLightDistance.value = lights.spot.distances;\n    uniforms.spotLightDirection.value = lights.spot.directions;\n    uniforms.spotLightAngleCos.value = lights.spot.anglesCos;\n    uniforms.spotLightExponent.value = lights.spot.exponents;\n    uniforms.spotLightDecay.value = lights.spot.decays;\n    uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\n    uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\n    uniforms.hemisphereLightDirection.value = lights.hemi.positions;\n  } // If uniforms are marked as clean, they don't need to be loaded to the GPU.\n\n\n  function markUniformsLightsNeedsUpdate(uniforms, value) {\n    uniforms.ambientLightColor.needsUpdate = value;\n    uniforms.directionalLightColor.needsUpdate = value;\n    uniforms.directionalLightDirection.needsUpdate = value;\n    uniforms.pointLightColor.needsUpdate = value;\n    uniforms.pointLightPosition.needsUpdate = value;\n    uniforms.pointLightDistance.needsUpdate = value;\n    uniforms.pointLightDecay.needsUpdate = value;\n    uniforms.spotLightColor.needsUpdate = value;\n    uniforms.spotLightPosition.needsUpdate = value;\n    uniforms.spotLightDistance.needsUpdate = value;\n    uniforms.spotLightDirection.needsUpdate = value;\n    uniforms.spotLightAngleCos.needsUpdate = value;\n    uniforms.spotLightExponent.needsUpdate = value;\n    uniforms.spotLightDecay.needsUpdate = value;\n    uniforms.hemisphereLightSkyColor.needsUpdate = value;\n    uniforms.hemisphereLightGroundColor.needsUpdate = value;\n    uniforms.hemisphereLightDirection.needsUpdate = value;\n  }\n\n  function refreshUniformsShadow(uniforms, lights) {\n    if (uniforms.shadowMatrix) {\n      var j = 0;\n\n      for (var i = 0, il = lights.length; i < il; i++) {\n        var light = lights[i];\n        if (!light.castShadow) continue;\n\n        if (light instanceof THREE.SpotLight || light instanceof THREE.DirectionalLight) {\n          uniforms.shadowMap.value[j] = light.shadowMap;\n          uniforms.shadowMapSize.value[j] = light.shadowMapSize;\n          uniforms.shadowMatrix.value[j] = light.shadowMatrix;\n          uniforms.shadowDarkness.value[j] = light.shadowDarkness;\n          uniforms.shadowBias.value[j] = light.shadowBias;\n          j++;\n        }\n      }\n    }\n  } // Uniforms (load to GPU)\n\n\n  function loadUniformsMatrices(uniforms, object) {\n    _gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, object.modelViewMatrix.elements);\n\n    if (uniforms.normalMatrix) {\n      _gl.uniformMatrix3fv(uniforms.normalMatrix, false, object.normalMatrix.elements);\n    }\n  }\n\n  function getTextureUnit() {\n    var textureUnit = _usedTextureUnits;\n\n    if (textureUnit >= capabilities.maxTextures) {\n      console.warn('WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + capabilities.maxTextures);\n    }\n\n    _usedTextureUnits += 1;\n    return textureUnit;\n  }\n\n  function loadUniformsGeneric(uniforms) {\n    var texture, textureUnit;\n\n    for (var j = 0, jl = uniforms.length; j < jl; j++) {\n      var uniform = uniforms[j][0]; // needsUpdate property is not added to all uniforms.\n\n      if (uniform.needsUpdate === false) continue;\n      var type = uniform.type;\n      var value = uniform.value;\n      var location = uniforms[j][1];\n\n      switch (type) {\n        case '1i':\n          _gl.uniform1i(location, value);\n\n          break;\n\n        case '1f':\n          _gl.uniform1f(location, value);\n\n          break;\n\n        case '2f':\n          _gl.uniform2f(location, value[0], value[1]);\n\n          break;\n\n        case '3f':\n          _gl.uniform3f(location, value[0], value[1], value[2]);\n\n          break;\n\n        case '4f':\n          _gl.uniform4f(location, value[0], value[1], value[2], value[3]);\n\n          break;\n\n        case '1iv':\n          _gl.uniform1iv(location, value);\n\n          break;\n\n        case '3iv':\n          _gl.uniform3iv(location, value);\n\n          break;\n\n        case '1fv':\n          _gl.uniform1fv(location, value);\n\n          break;\n\n        case '2fv':\n          _gl.uniform2fv(location, value);\n\n          break;\n\n        case '3fv':\n          _gl.uniform3fv(location, value);\n\n          break;\n\n        case '4fv':\n          _gl.uniform4fv(location, value);\n\n          break;\n\n        case 'Matrix3fv':\n          _gl.uniformMatrix3fv(location, false, value);\n\n          break;\n\n        case 'Matrix4fv':\n          _gl.uniformMatrix4fv(location, false, value);\n\n          break;\n        //\n\n        case 'i':\n          // single integer\n          _gl.uniform1i(location, value);\n\n          break;\n\n        case 'f':\n          // single float\n          _gl.uniform1f(location, value);\n\n          break;\n\n        case 'v2':\n          // single THREE.Vector2\n          _gl.uniform2f(location, value.x, value.y);\n\n          break;\n\n        case 'v3':\n          // single THREE.Vector3\n          _gl.uniform3f(location, value.x, value.y, value.z);\n\n          break;\n\n        case 'v4':\n          // single THREE.Vector4\n          _gl.uniform4f(location, value.x, value.y, value.z, value.w);\n\n          break;\n\n        case 'c':\n          // single THREE.Color\n          _gl.uniform3f(location, value.r, value.g, value.b);\n\n          break;\n\n        case 'iv1':\n          // flat array of integers (JS or typed array)\n          _gl.uniform1iv(location, value);\n\n          break;\n\n        case 'iv':\n          // flat array of integers with 3 x N size (JS or typed array)\n          _gl.uniform3iv(location, value);\n\n          break;\n\n        case 'fv1':\n          // flat array of floats (JS or typed array)\n          _gl.uniform1fv(location, value);\n\n          break;\n\n        case 'fv':\n          // flat array of floats with 3 x N size (JS or typed array)\n          _gl.uniform3fv(location, value);\n\n          break;\n\n        case 'v2v':\n          // array of THREE.Vector2\n          if (uniform._array === undefined) {\n            uniform._array = new Float32Array(2 * value.length);\n          }\n\n          for (var i = 0, i2 = 0, il = value.length; i < il; i++, i2 += 2) {\n            uniform._array[i2 + 0] = value[i].x;\n            uniform._array[i2 + 1] = value[i].y;\n          }\n\n          _gl.uniform2fv(location, uniform._array);\n\n          break;\n\n        case 'v3v':\n          // array of THREE.Vector3\n          if (uniform._array === undefined) {\n            uniform._array = new Float32Array(3 * value.length);\n          }\n\n          for (var i = 0, i3 = 0, il = value.length; i < il; i++, i3 += 3) {\n            uniform._array[i3 + 0] = value[i].x;\n            uniform._array[i3 + 1] = value[i].y;\n            uniform._array[i3 + 2] = value[i].z;\n          }\n\n          _gl.uniform3fv(location, uniform._array);\n\n          break;\n\n        case 'v4v':\n          // array of THREE.Vector4\n          if (uniform._array === undefined) {\n            uniform._array = new Float32Array(4 * value.length);\n          }\n\n          for (var i = 0, i4 = 0, il = value.length; i < il; i++, i4 += 4) {\n            uniform._array[i4 + 0] = value[i].x;\n            uniform._array[i4 + 1] = value[i].y;\n            uniform._array[i4 + 2] = value[i].z;\n            uniform._array[i4 + 3] = value[i].w;\n          }\n\n          _gl.uniform4fv(location, uniform._array);\n\n          break;\n\n        case 'm3':\n          // single THREE.Matrix3\n          _gl.uniformMatrix3fv(location, false, value.elements);\n\n          break;\n\n        case 'm3v':\n          // array of THREE.Matrix3\n          if (uniform._array === undefined) {\n            uniform._array = new Float32Array(9 * value.length);\n          }\n\n          for (var i = 0, il = value.length; i < il; i++) {\n            value[i].flattenToArrayOffset(uniform._array, i * 9);\n          }\n\n          _gl.uniformMatrix3fv(location, false, uniform._array);\n\n          break;\n\n        case 'm4':\n          // single THREE.Matrix4\n          _gl.uniformMatrix4fv(location, false, value.elements);\n\n          break;\n\n        case 'm4v':\n          // array of THREE.Matrix4\n          if (uniform._array === undefined) {\n            uniform._array = new Float32Array(16 * value.length);\n          }\n\n          for (var i = 0, il = value.length; i < il; i++) {\n            value[i].flattenToArrayOffset(uniform._array, i * 16);\n          }\n\n          _gl.uniformMatrix4fv(location, false, uniform._array);\n\n          break;\n\n        case 't':\n          // single THREE.Texture (2d or cube)\n          texture = value;\n          textureUnit = getTextureUnit();\n\n          _gl.uniform1i(location, textureUnit);\n\n          if (!texture) continue;\n\n          if (texture instanceof THREE.CubeTexture || Array.isArray(texture.image) && texture.image.length === 6) {\n            // CompressedTexture can have Array in image :/\n            setCubeTexture(texture, textureUnit);\n          } else if (texture instanceof THREE.WebGLRenderTargetCube) {\n            setCubeTextureDynamic(texture, textureUnit);\n          } else {\n            _this.setTexture(texture, textureUnit);\n          }\n\n          break;\n\n        case 'tv':\n          // array of THREE.Texture (2d)\n          if (uniform._array === undefined) {\n            uniform._array = [];\n          }\n\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\n            uniform._array[i] = getTextureUnit();\n          }\n\n          _gl.uniform1iv(location, uniform._array);\n\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\n            texture = uniform.value[i];\n            textureUnit = uniform._array[i];\n            if (!texture) continue;\n\n            _this.setTexture(texture, textureUnit);\n          }\n\n          break;\n\n        default:\n          console.warn('THREE.WebGLRenderer: Unknown uniform type: ' + type);\n      }\n    }\n  }\n\n  function setColorLinear(array, offset, color, intensity) {\n    array[offset + 0] = color.r * intensity;\n    array[offset + 1] = color.g * intensity;\n    array[offset + 2] = color.b * intensity;\n  }\n\n  function setupLights(lights, camera) {\n    var l,\n        ll,\n        light,\n        r = 0,\n        g = 0,\n        b = 0,\n        color,\n        skyColor,\n        groundColor,\n        intensity,\n        distance,\n        zlights = _lights,\n        viewMatrix = camera.matrixWorldInverse,\n        dirColors = zlights.directional.colors,\n        dirPositions = zlights.directional.positions,\n        pointColors = zlights.point.colors,\n        pointPositions = zlights.point.positions,\n        pointDistances = zlights.point.distances,\n        pointDecays = zlights.point.decays,\n        spotColors = zlights.spot.colors,\n        spotPositions = zlights.spot.positions,\n        spotDistances = zlights.spot.distances,\n        spotDirections = zlights.spot.directions,\n        spotAnglesCos = zlights.spot.anglesCos,\n        spotExponents = zlights.spot.exponents,\n        spotDecays = zlights.spot.decays,\n        hemiSkyColors = zlights.hemi.skyColors,\n        hemiGroundColors = zlights.hemi.groundColors,\n        hemiPositions = zlights.hemi.positions,\n        dirLength = 0,\n        pointLength = 0,\n        spotLength = 0,\n        hemiLength = 0,\n        dirCount = 0,\n        pointCount = 0,\n        spotCount = 0,\n        hemiCount = 0,\n        dirOffset = 0,\n        pointOffset = 0,\n        spotOffset = 0,\n        hemiOffset = 0;\n\n    for (l = 0, ll = lights.length; l < ll; l++) {\n      light = lights[l];\n      if (light.onlyShadow) continue;\n      color = light.color;\n      intensity = light.intensity;\n      distance = light.distance;\n\n      if (light instanceof THREE.AmbientLight) {\n        if (!light.visible) continue;\n        r += color.r;\n        g += color.g;\n        b += color.b;\n      } else if (light instanceof THREE.DirectionalLight) {\n        dirCount += 1;\n        if (!light.visible) continue;\n\n        _direction.setFromMatrixPosition(light.matrixWorld);\n\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\n\n        _direction.sub(_vector3);\n\n        _direction.transformDirection(viewMatrix);\n\n        dirOffset = dirLength * 3;\n        dirPositions[dirOffset + 0] = _direction.x;\n        dirPositions[dirOffset + 1] = _direction.y;\n        dirPositions[dirOffset + 2] = _direction.z;\n        setColorLinear(dirColors, dirOffset, color, intensity);\n        dirLength += 1;\n      } else if (light instanceof THREE.PointLight) {\n        pointCount += 1;\n        if (!light.visible) continue;\n        pointOffset = pointLength * 3;\n        setColorLinear(pointColors, pointOffset, color, intensity);\n\n        _vector3.setFromMatrixPosition(light.matrixWorld);\n\n        _vector3.applyMatrix4(viewMatrix);\n\n        pointPositions[pointOffset + 0] = _vector3.x;\n        pointPositions[pointOffset + 1] = _vector3.y;\n        pointPositions[pointOffset + 2] = _vector3.z; // distance is 0 if decay is 0, because there is no attenuation at all.\n\n        pointDistances[pointLength] = distance;\n        pointDecays[pointLength] = light.distance === 0 ? 0.0 : light.decay;\n        pointLength += 1;\n      } else if (light instanceof THREE.SpotLight) {\n        spotCount += 1;\n        if (!light.visible) continue;\n        spotOffset = spotLength * 3;\n        setColorLinear(spotColors, spotOffset, color, intensity);\n\n        _direction.setFromMatrixPosition(light.matrixWorld);\n\n        _vector3.copy(_direction).applyMatrix4(viewMatrix);\n\n        spotPositions[spotOffset + 0] = _vector3.x;\n        spotPositions[spotOffset + 1] = _vector3.y;\n        spotPositions[spotOffset + 2] = _vector3.z;\n        spotDistances[spotLength] = distance;\n\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\n\n        _direction.sub(_vector3);\n\n        _direction.transformDirection(viewMatrix);\n\n        spotDirections[spotOffset + 0] = _direction.x;\n        spotDirections[spotOffset + 1] = _direction.y;\n        spotDirections[spotOffset + 2] = _direction.z;\n        spotAnglesCos[spotLength] = Math.cos(light.angle);\n        spotExponents[spotLength] = light.exponent;\n        spotDecays[spotLength] = light.distance === 0 ? 0.0 : light.decay;\n        spotLength += 1;\n      } else if (light instanceof THREE.HemisphereLight) {\n        hemiCount += 1;\n        if (!light.visible) continue;\n\n        _direction.setFromMatrixPosition(light.matrixWorld);\n\n        _direction.transformDirection(viewMatrix);\n\n        hemiOffset = hemiLength * 3;\n        hemiPositions[hemiOffset + 0] = _direction.x;\n        hemiPositions[hemiOffset + 1] = _direction.y;\n        hemiPositions[hemiOffset + 2] = _direction.z;\n        skyColor = light.color;\n        groundColor = light.groundColor;\n        setColorLinear(hemiSkyColors, hemiOffset, skyColor, intensity);\n        setColorLinear(hemiGroundColors, hemiOffset, groundColor, intensity);\n        hemiLength += 1;\n      }\n    } // null eventual remains from removed lights\n    // (this is to avoid if in shader)\n\n\n    for (l = dirLength * 3, ll = Math.max(dirColors.length, dirCount * 3); l < ll; l++) dirColors[l] = 0.0;\n\n    for (l = pointLength * 3, ll = Math.max(pointColors.length, pointCount * 3); l < ll; l++) pointColors[l] = 0.0;\n\n    for (l = spotLength * 3, ll = Math.max(spotColors.length, spotCount * 3); l < ll; l++) spotColors[l] = 0.0;\n\n    for (l = hemiLength * 3, ll = Math.max(hemiSkyColors.length, hemiCount * 3); l < ll; l++) hemiSkyColors[l] = 0.0;\n\n    for (l = hemiLength * 3, ll = Math.max(hemiGroundColors.length, hemiCount * 3); l < ll; l++) hemiGroundColors[l] = 0.0;\n\n    zlights.directional.length = dirLength;\n    zlights.point.length = pointLength;\n    zlights.spot.length = spotLength;\n    zlights.hemi.length = hemiLength;\n    zlights.ambient[0] = r;\n    zlights.ambient[1] = g;\n    zlights.ambient[2] = b;\n  } // GL state setting\n\n\n  this.setFaceCulling = function (cullFace, frontFaceDirection) {\n    if (cullFace === THREE.CullFaceNone) {\n      state.disable(_gl.CULL_FACE);\n    } else {\n      if (frontFaceDirection === THREE.FrontFaceDirectionCW) {\n        _gl.frontFace(_gl.CW);\n      } else {\n        _gl.frontFace(_gl.CCW);\n      }\n\n      if (cullFace === THREE.CullFaceBack) {\n        _gl.cullFace(_gl.BACK);\n      } else if (cullFace === THREE.CullFaceFront) {\n        _gl.cullFace(_gl.FRONT);\n      } else {\n        _gl.cullFace(_gl.FRONT_AND_BACK);\n      }\n\n      state.enable(_gl.CULL_FACE);\n    }\n  }; // Textures\n\n\n  function setTextureParameters(textureType, texture, isImagePowerOfTwo) {\n    var extension;\n\n    if (isImagePowerOfTwo) {\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL(texture.wrapS));\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL(texture.wrapT));\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL(texture.magFilter));\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL(texture.minFilter));\n    } else {\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE);\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE);\n\n      if (texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping) {\n        console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )');\n      }\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, filterFallback(texture.magFilter));\n\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, filterFallback(texture.minFilter));\n\n      if (texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter) {\n        console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )');\n      }\n    }\n\n    extension = extensions.get('EXT_texture_filter_anisotropic');\n\n    if (extension) {\n      if (texture.type === THREE.FloatType && extensions.get('OES_texture_float_linear') === null) return;\n      if (texture.type === THREE.HalfFloatType && extensions.get('OES_texture_half_float_linear') === null) return;\n\n      if (texture.anisotropy > 1 || properties.get(texture).__currentAnisotropy) {\n        _gl.texParameterf(textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(texture.anisotropy, _this.getMaxAnisotropy()));\n\n        properties.get(texture).__currentAnisotropy = texture.anisotropy;\n      }\n    }\n  }\n\n  function uploadTexture(textureProperties, texture, slot) {\n    if (textureProperties.__webglInit === undefined) {\n      textureProperties.__webglInit = true;\n      texture.__webglInit = true;\n      texture.addEventListener('dispose', onTextureDispose);\n      textureProperties.__webglTexture = _gl.createTexture();\n      _infoMemory.textures++;\n    }\n\n    state.activeTexture(_gl.TEXTURE0 + slot);\n    state.bindTexture(_gl.TEXTURE_2D, textureProperties.__webglTexture);\n\n    _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\n\n    _gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha);\n\n    _gl.pixelStorei(_gl.UNPACK_ALIGNMENT, texture.unpackAlignment);\n\n    texture.image = clampToMaxSize(texture.image, capabilities.maxTextureSize);\n    var image = texture.image,\n        isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\n        glFormat = paramThreeToGL(texture.format),\n        glType = paramThreeToGL(texture.type);\n    setTextureParameters(_gl.TEXTURE_2D, texture, isImagePowerOfTwo);\n    var mipmap,\n        mipmaps = texture.mipmaps;\n\n    if (texture instanceof THREE.DataTexture) {\n      // use manually created mipmaps if available\n      // if there are no manual mipmaps\n      // set 0 level mipmap and then use GL to generate other mipmap levels\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\n          mipmap = mipmaps[i];\n          state.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\n        }\n\n        texture.generateMipmaps = false;\n      } else {\n        state.texImage2D(_gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data);\n      }\n    } else if (texture instanceof THREE.CompressedTexture) {\n      for (var i = 0, il = mipmaps.length; i < il; i++) {\n        mipmap = mipmaps[i];\n\n        if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\n          if (state.getCompressedTextureFormats().indexOf(glFormat) > -1) {\n            state.compressedTexImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\n          } else {\n            console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\");\n          }\n        } else {\n          state.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\n        }\n      }\n    } else {\n      // regular Texture (image, video, canvas)\n      // use manually created mipmaps if available\n      // if there are no manual mipmaps\n      // set 0 level mipmap and then use GL to generate other mipmap levels\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\n          mipmap = mipmaps[i];\n          state.texImage2D(_gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap);\n        }\n\n        texture.generateMipmaps = false;\n      } else {\n        state.texImage2D(_gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image);\n      }\n    }\n\n    if (texture.generateMipmaps && isImagePowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\n    textureProperties.__version = texture.version;\n    if (texture.onUpdate) texture.onUpdate(texture);\n  }\n\n  this.setTexture = function (texture, slot) {\n    var textureProperties = properties.get(texture);\n\n    if (texture.version > 0 && textureProperties.__version !== texture.version) {\n      var image = texture.image;\n\n      if (image === undefined) {\n        console.warn('THREE.WebGLRenderer: Texture marked for update but image is undefined', texture);\n        return;\n      }\n\n      if (image.complete === false) {\n        console.warn('THREE.WebGLRenderer: Texture marked for update but image is incomplete', texture);\n        return;\n      }\n\n      uploadTexture(textureProperties, texture, slot);\n      return;\n    }\n\n    state.activeTexture(_gl.TEXTURE0 + slot);\n    state.bindTexture(_gl.TEXTURE_2D, textureProperties.__webglTexture);\n  };\n\n  function clampToMaxSize(image, maxSize) {\n    if (image.width > maxSize || image.height > maxSize) {\n      // Warning: Scaling through the canvas will only work with images that use\n      // premultiplied alpha.\n      var scale = maxSize / Math.max(image.width, image.height);\n      var canvas = document.createElement('canvas');\n      canvas.width = Math.floor(image.width * scale);\n      canvas.height = Math.floor(image.height * scale);\n      var context = canvas.getContext('2d');\n      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\n      console.warn('THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image);\n      return canvas;\n    }\n\n    return image;\n  }\n\n  function setCubeTexture(texture, slot) {\n    var textureProperties = properties.get(texture);\n\n    if (texture.image.length === 6) {\n      if (texture.version > 0 && textureProperties.__version !== texture.version) {\n        if (!textureProperties.__image__webglTextureCube) {\n          texture.addEventListener('dispose', onTextureDispose);\n          textureProperties.__image__webglTextureCube = _gl.createTexture();\n          _infoMemory.textures++;\n        }\n\n        state.activeTexture(_gl.TEXTURE0 + slot);\n        state.bindTexture(_gl.TEXTURE_CUBE_MAP, textureProperties.__image__webglTextureCube);\n\n        _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\n\n        var isCompressed = texture instanceof THREE.CompressedTexture;\n        var isDataTexture = texture.image[0] instanceof THREE.DataTexture;\n        var cubeImage = [];\n\n        for (var i = 0; i < 6; i++) {\n          if (_this.autoScaleCubemaps && !isCompressed && !isDataTexture) {\n            cubeImage[i] = clampToMaxSize(texture.image[i], capabilities.maxCubemapSize);\n          } else {\n            cubeImage[i] = isDataTexture ? texture.image[i].image : texture.image[i];\n          }\n        }\n\n        var image = cubeImage[0],\n            isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\n            glFormat = paramThreeToGL(texture.format),\n            glType = paramThreeToGL(texture.type);\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo);\n\n        for (var i = 0; i < 6; i++) {\n          if (!isCompressed) {\n            if (isDataTexture) {\n              state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[i].width, cubeImage[i].height, 0, glFormat, glType, cubeImage[i].data);\n            } else {\n              state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[i]);\n            }\n          } else {\n            var mipmap,\n                mipmaps = cubeImage[i].mipmaps;\n\n            for (var j = 0, jl = mipmaps.length; j < jl; j++) {\n              mipmap = mipmaps[j];\n\n              if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\n                if (state.getCompressedTextureFormats().indexOf(glFormat) > -1) {\n                  state.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\n                } else {\n                  console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\");\n                }\n              } else {\n                state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\n              }\n            }\n          }\n        }\n\n        if (texture.generateMipmaps && isImagePowerOfTwo) {\n          _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\n        }\n\n        textureProperties.__version = texture.version;\n        if (texture.onUpdate) texture.onUpdate(texture);\n      } else {\n        state.activeTexture(_gl.TEXTURE0 + slot);\n        state.bindTexture(_gl.TEXTURE_CUBE_MAP, textureProperties.__image__webglTextureCube);\n      }\n    }\n  }\n\n  function setCubeTextureDynamic(texture, slot) {\n    state.activeTexture(_gl.TEXTURE0 + slot);\n    state.bindTexture(_gl.TEXTURE_CUBE_MAP, properties.get(texture).__webglTexture);\n  } // Render targets\n\n\n  function setupFrameBuffer(framebuffer, renderTarget, textureTarget) {\n    _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\n\n    _gl.framebufferTexture2D(_gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, properties.get(renderTarget).__webglTexture, 0);\n  }\n\n  function setupRenderBuffer(renderbuffer, renderTarget) {\n    _gl.bindRenderbuffer(_gl.RENDERBUFFER, renderbuffer);\n\n    if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height);\n\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\n      /* For some reason this is not working. Defaulting to RGBA4.\r\n      } else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n      \t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n      \t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n      */\n\n    } else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height);\n\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\n    } else {\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height);\n    }\n  }\n\n  this.setRenderTarget = function (renderTarget) {\n    var isCube = renderTarget instanceof THREE.WebGLRenderTargetCube;\n\n    if (renderTarget && properties.get(renderTarget).__webglFramebuffer === undefined) {\n      var renderTargetProperties = properties.get(renderTarget);\n      if (renderTarget.depthBuffer === undefined) renderTarget.depthBuffer = true;\n      if (renderTarget.stencilBuffer === undefined) renderTarget.stencilBuffer = true;\n      renderTarget.addEventListener('dispose', onRenderTargetDispose);\n      renderTargetProperties.__webglTexture = _gl.createTexture();\n      _infoMemory.textures++; // Setup texture, create render and frame buffers\n\n      var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo(renderTarget.width) && THREE.Math.isPowerOfTwo(renderTarget.height),\n          glFormat = paramThreeToGL(renderTarget.format),\n          glType = paramThreeToGL(renderTarget.type);\n\n      if (isCube) {\n        renderTargetProperties.__webglFramebuffer = [];\n        renderTargetProperties.__webglRenderbuffer = [];\n        state.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTargetProperties.__webglTexture);\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo);\n\n        for (var i = 0; i < 6; i++) {\n          renderTargetProperties.__webglFramebuffer[i] = _gl.createFramebuffer();\n          renderTargetProperties.__webglRenderbuffer[i] = _gl.createRenderbuffer();\n          state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\n          setupFrameBuffer(renderTargetProperties.__webglFramebuffer[i], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i);\n          setupRenderBuffer(renderTargetProperties.__webglRenderbuffer[i], renderTarget);\n        }\n\n        if (renderTarget.generateMipmaps && isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\n      } else {\n        renderTargetProperties.__webglFramebuffer = _gl.createFramebuffer();\n\n        if (renderTarget.shareDepthFrom) {\n          renderTargetProperties.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\n        } else {\n          renderTargetProperties.__webglRenderbuffer = _gl.createRenderbuffer();\n        }\n\n        state.bindTexture(_gl.TEXTURE_2D, renderTargetProperties.__webglTexture);\n        setTextureParameters(_gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo);\n        state.texImage2D(_gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\n        setupFrameBuffer(renderTargetProperties.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D);\n\n        if (renderTarget.shareDepthFrom) {\n          if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTargetProperties.__webglRenderbuffer);\n          } else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTargetProperties.__webglRenderbuffer);\n          }\n        } else {\n          setupRenderBuffer(renderTargetProperties.__webglRenderbuffer, renderTarget);\n        }\n\n        if (renderTarget.generateMipmaps && isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\n      } // Release everything\n\n\n      if (isCube) {\n        state.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\n      } else {\n        state.bindTexture(_gl.TEXTURE_2D, null);\n      }\n\n      _gl.bindRenderbuffer(_gl.RENDERBUFFER, null);\n\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, null);\n    }\n\n    var framebuffer, width, height, vx, vy;\n\n    if (renderTarget) {\n      var renderTargetProperties = properties.get(renderTarget);\n\n      if (isCube) {\n        framebuffer = renderTargetProperties.__webglFramebuffer[renderTarget.activeCubeFace];\n      } else {\n        framebuffer = renderTargetProperties.__webglFramebuffer;\n      }\n\n      width = renderTarget.width;\n      height = renderTarget.height;\n      vx = 0;\n      vy = 0;\n    } else {\n      framebuffer = null;\n      width = _viewportWidth;\n      height = _viewportHeight;\n      vx = _viewportX;\n      vy = _viewportY;\n    }\n\n    if (framebuffer !== _currentFramebuffer) {\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\n\n      _gl.viewport(vx, vy, width, height);\n\n      _currentFramebuffer = framebuffer;\n    }\n\n    _currentWidth = width;\n    _currentHeight = height;\n  };\n\n  this.readRenderTargetPixels = function (renderTarget, x, y, width, height, buffer) {\n    if (!(renderTarget instanceof THREE.WebGLRenderTarget)) {\n      console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\n      return;\n    }\n\n    if (properties.get(renderTarget).__webglFramebuffer) {\n      if (renderTarget.format !== THREE.RGBAFormat) {\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.');\n        return;\n      }\n\n      var restore = false;\n\n      if (properties.get(renderTarget).__webglFramebuffer !== _currentFramebuffer) {\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, properties.get(renderTarget).__webglFramebuffer);\n\n        restore = true;\n      }\n\n      if (_gl.checkFramebufferStatus(_gl.FRAMEBUFFER) === _gl.FRAMEBUFFER_COMPLETE) {\n        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer);\n      } else {\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');\n      }\n\n      if (restore) {\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, _currentFramebuffer);\n      }\n    }\n  };\n\n  function updateRenderTargetMipmap(renderTarget) {\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\n      state.bindTexture(_gl.TEXTURE_CUBE_MAP, properties.get(renderTarget).__webglTexture);\n\n      _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\n\n      state.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\n    } else {\n      state.bindTexture(_gl.TEXTURE_2D, properties.get(renderTarget).__webglTexture);\n\n      _gl.generateMipmap(_gl.TEXTURE_2D);\n\n      state.bindTexture(_gl.TEXTURE_2D, null);\n    }\n  } // Fallback filters for non-power-of-2 textures\n\n\n  function filterFallback(f) {\n    if (f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter) {\n      return _gl.NEAREST;\n    }\n\n    return _gl.LINEAR;\n  } // Map three.js constants to WebGL constants\n\n\n  function paramThreeToGL(p) {\n    var extension;\n    if (p === THREE.RepeatWrapping) return _gl.REPEAT;\n    if (p === THREE.ClampToEdgeWrapping) return _gl.CLAMP_TO_EDGE;\n    if (p === THREE.MirroredRepeatWrapping) return _gl.MIRRORED_REPEAT;\n    if (p === THREE.NearestFilter) return _gl.NEAREST;\n    if (p === THREE.NearestMipMapNearestFilter) return _gl.NEAREST_MIPMAP_NEAREST;\n    if (p === THREE.NearestMipMapLinearFilter) return _gl.NEAREST_MIPMAP_LINEAR;\n    if (p === THREE.LinearFilter) return _gl.LINEAR;\n    if (p === THREE.LinearMipMapNearestFilter) return _gl.LINEAR_MIPMAP_NEAREST;\n    if (p === THREE.LinearMipMapLinearFilter) return _gl.LINEAR_MIPMAP_LINEAR;\n    if (p === THREE.UnsignedByteType) return _gl.UNSIGNED_BYTE;\n    if (p === THREE.UnsignedShort4444Type) return _gl.UNSIGNED_SHORT_4_4_4_4;\n    if (p === THREE.UnsignedShort5551Type) return _gl.UNSIGNED_SHORT_5_5_5_1;\n    if (p === THREE.UnsignedShort565Type) return _gl.UNSIGNED_SHORT_5_6_5;\n    if (p === THREE.ByteType) return _gl.BYTE;\n    if (p === THREE.ShortType) return _gl.SHORT;\n    if (p === THREE.UnsignedShortType) return _gl.UNSIGNED_SHORT;\n    if (p === THREE.IntType) return _gl.INT;\n    if (p === THREE.UnsignedIntType) return _gl.UNSIGNED_INT;\n    if (p === THREE.FloatType) return _gl.FLOAT;\n    extension = extensions.get('OES_texture_half_float');\n\n    if (extension !== null) {\n      if (p === THREE.HalfFloatType) return extension.HALF_FLOAT_OES;\n    }\n\n    if (p === THREE.AlphaFormat) return _gl.ALPHA;\n    if (p === THREE.RGBFormat) return _gl.RGB;\n    if (p === THREE.RGBAFormat) return _gl.RGBA;\n    if (p === THREE.LuminanceFormat) return _gl.LUMINANCE;\n    if (p === THREE.LuminanceAlphaFormat) return _gl.LUMINANCE_ALPHA;\n    if (p === THREE.AddEquation) return _gl.FUNC_ADD;\n    if (p === THREE.SubtractEquation) return _gl.FUNC_SUBTRACT;\n    if (p === THREE.ReverseSubtractEquation) return _gl.FUNC_REVERSE_SUBTRACT;\n    if (p === THREE.ZeroFactor) return _gl.ZERO;\n    if (p === THREE.OneFactor) return _gl.ONE;\n    if (p === THREE.SrcColorFactor) return _gl.SRC_COLOR;\n    if (p === THREE.OneMinusSrcColorFactor) return _gl.ONE_MINUS_SRC_COLOR;\n    if (p === THREE.SrcAlphaFactor) return _gl.SRC_ALPHA;\n    if (p === THREE.OneMinusSrcAlphaFactor) return _gl.ONE_MINUS_SRC_ALPHA;\n    if (p === THREE.DstAlphaFactor) return _gl.DST_ALPHA;\n    if (p === THREE.OneMinusDstAlphaFactor) return _gl.ONE_MINUS_DST_ALPHA;\n    if (p === THREE.DstColorFactor) return _gl.DST_COLOR;\n    if (p === THREE.OneMinusDstColorFactor) return _gl.ONE_MINUS_DST_COLOR;\n    if (p === THREE.SrcAlphaSaturateFactor) return _gl.SRC_ALPHA_SATURATE;\n    extension = extensions.get('WEBGL_compressed_texture_s3tc');\n\n    if (extension !== null) {\n      if (p === THREE.RGB_S3TC_DXT1_Format) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\n      if (p === THREE.RGBA_S3TC_DXT1_Format) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\n      if (p === THREE.RGBA_S3TC_DXT3_Format) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\n      if (p === THREE.RGBA_S3TC_DXT5_Format) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\n    }\n\n    extension = extensions.get('WEBGL_compressed_texture_pvrtc');\n\n    if (extension !== null) {\n      if (p === THREE.RGB_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\n      if (p === THREE.RGB_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\n      if (p === THREE.RGBA_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\n      if (p === THREE.RGBA_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\n    }\n\n    extension = extensions.get('EXT_blend_minmax');\n\n    if (extension !== null) {\n      if (p === THREE.MinEquation) return extension.MIN_EXT;\n      if (p === THREE.MaxEquation) return extension.MAX_EXT;\n    }\n\n    return 0;\n  } // DEPRECATED\n\n\n  this.supportsFloatTextures = function () {\n    console.warn('THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( \\'OES_texture_float\\' ).');\n    return extensions.get('OES_texture_float');\n  };\n\n  this.supportsHalfFloatTextures = function () {\n    console.warn('THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( \\'OES_texture_half_float\\' ).');\n    return extensions.get('OES_texture_half_float');\n  };\n\n  this.supportsStandardDerivatives = function () {\n    console.warn('THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( \\'OES_standard_derivatives\\' ).');\n    return extensions.get('OES_standard_derivatives');\n  };\n\n  this.supportsCompressedTextureS3TC = function () {\n    console.warn('THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( \\'WEBGL_compressed_texture_s3tc\\' ).');\n    return extensions.get('WEBGL_compressed_texture_s3tc');\n  };\n\n  this.supportsCompressedTexturePVRTC = function () {\n    console.warn('THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( \\'WEBGL_compressed_texture_pvrtc\\' ).');\n    return extensions.get('WEBGL_compressed_texture_pvrtc');\n  };\n\n  this.supportsBlendMinMax = function () {\n    console.warn('THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( \\'EXT_blend_minmax\\' ).');\n    return extensions.get('EXT_blend_minmax');\n  };\n\n  this.supportsVertexTextures = function () {\n    return capabilities.vertexTextures;\n  };\n\n  this.supportsInstancedArrays = function () {\n    console.warn('THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( \\'ANGLE_instanced_arrays\\' ).');\n    return extensions.get('ANGLE_instanced_arrays');\n  }; //\n\n\n  this.initMaterial = function () {\n    console.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');\n  };\n\n  this.addPrePlugin = function () {\n    console.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');\n  };\n\n  this.addPostPlugin = function () {\n    console.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');\n  };\n\n  this.updateShadowMap = function () {\n    console.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');\n  };\n\n  Object.defineProperties(this, {\n    shadowMapEnabled: {\n      get: function () {\n        return shadowMap.enabled;\n      },\n      set: function (value) {\n        console.warn('THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.');\n        shadowMap.enabled = value;\n      }\n    },\n    shadowMapType: {\n      get: function () {\n        return shadowMap.type;\n      },\n      set: function (value) {\n        console.warn('THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.');\n        shadowMap.type = value;\n      }\n    },\n    shadowMapCullFace: {\n      get: function () {\n        return shadowMap.cullFace;\n      },\n      set: function (value) {\n        console.warn('THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.');\n        shadowMap.cullFace = value;\n      }\n    },\n    shadowMapDebug: {\n      get: function () {\n        return shadowMap.debug;\n      },\n      set: function (value) {\n        console.warn('THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug.');\n        shadowMap.debug = value;\n      }\n    }\n  });\n}; // File:src/renderers/WebGLRenderTarget.js\n\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.WebGLRenderTarget = function (width, height, options) {\n  this.uuid = THREE.Math.generateUUID();\n  this.width = width;\n  this.height = height;\n  options = options || {};\n  this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\n  this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\n  this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\n  this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\n  this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\n  this.offset = new THREE.Vector2(0, 0);\n  this.repeat = new THREE.Vector2(1, 1);\n  this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\n  this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\n  this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\n  this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\n  this.generateMipmaps = true;\n  this.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\n};\n\nTHREE.WebGLRenderTarget.prototype = {\n  constructor: THREE.WebGLRenderTarget,\n  setSize: function (width, height) {\n    if (this.width !== width || this.height !== height) {\n      this.width = width;\n      this.height = height;\n      this.dispose();\n    }\n  },\n  clone: function () {\n    return new this.constructor().copy(this);\n  },\n  copy: function (source) {\n    this.width = source.width;\n    this.height = source.height;\n    this.wrapS = source.wrapS;\n    this.wrapT = source.wrapT;\n    this.magFilter = source.magFilter;\n    this.minFilter = source.minFilter;\n    this.anisotropy = source.anisotropy;\n    this.offset.copy(source.offset);\n    this.repeat.copy(source.repeat);\n    this.format = source.format;\n    this.type = source.type;\n    this.depthBuffer = source.depthBuffer;\n    this.stencilBuffer = source.stencilBuffer;\n    this.generateMipmaps = source.generateMipmaps;\n    this.shareDepthFrom = source.shareDepthFrom;\n    return this;\n  },\n  dispose: function () {\n    this.dispatchEvent({\n      type: 'dispose'\n    });\n  }\n};\nTHREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype); // File:src/renderers/WebGLRenderTargetCube.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\n\nTHREE.WebGLRenderTargetCube = function (width, height, options) {\n  THREE.WebGLRenderTarget.call(this, width, height, options);\n  this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\n};\n\nTHREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype);\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube; // File:src/renderers/webgl/WebGLBufferRenderer.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\nTHREE.WebGLBufferRenderer = function (_gl, extensions, _infoRender) {\n  var mode;\n\n  function setMode(value) {\n    mode = value;\n  }\n\n  function render(start, count) {\n    _gl.drawArrays(mode, start, count);\n\n    _infoRender.calls++;\n    _infoRender.vertices += count;\n    if (mode === _gl.TRIANGLES) _infoRender.faces += count / 3;\n  }\n\n  function renderInstances(geometry) {\n    var extension = extensions.get('ANGLE_instanced_arrays');\n\n    if (extension === null) {\n      console.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');\n      return;\n    }\n\n    var position = geometry.attributes.position;\n\n    if (position instanceof THREE.InterleavedBufferAttribute) {\n      extension.drawArraysInstancedANGLE(mode, 0, position.data.count, geometry.maxInstancedCount);\n    } else {\n      extension.drawArraysInstancedANGLE(mode, 0, position.count, geometry.maxInstancedCount);\n    }\n  }\n\n  this.setMode = setMode;\n  this.render = render;\n  this.renderInstances = renderInstances;\n}; // File:src/renderers/webgl/WebGLIndexedBufferRenderer.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\n\nTHREE.WebGLIndexedBufferRenderer = function (_gl, extensions, _infoRender) {\n  var mode;\n\n  function setMode(value) {\n    mode = value;\n  }\n\n  var type, size;\n\n  function setIndex(index) {\n    if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\n      type = _gl.UNSIGNED_INT;\n      size = 4;\n    } else {\n      type = _gl.UNSIGNED_SHORT;\n      size = 2;\n    }\n  }\n\n  function render(start, count) {\n    _gl.drawElements(mode, count, type, start * size);\n\n    _infoRender.calls++;\n    _infoRender.vertices += count;\n    if (mode === _gl.TRIANGLES) _infoRender.faces += count / 3;\n  }\n\n  function renderInstances(geometry) {\n    var extension = extensions.get('ANGLE_instanced_arrays');\n\n    if (extension === null) {\n      console.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');\n      return;\n    }\n\n    var index = geometry.index;\n    extension.drawElementsInstancedANGLE(mode, index.array.length, type, 0, geometry.maxInstancedCount);\n  }\n\n  this.setMode = setMode;\n  this.setIndex = setIndex;\n  this.render = render;\n  this.renderInstances = renderInstances;\n}; // File:src/renderers/webgl/WebGLExtensions.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\n\nTHREE.WebGLExtensions = function (gl) {\n  var extensions = {};\n\n  this.get = function (name) {\n    if (extensions[name] !== undefined) {\n      return extensions[name];\n    }\n\n    var extension;\n\n    switch (name) {\n      case 'EXT_texture_filter_anisotropic':\n        extension = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\n        break;\n\n      case 'WEBGL_compressed_texture_s3tc':\n        extension = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\n        break;\n\n      case 'WEBGL_compressed_texture_pvrtc':\n        extension = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\n        break;\n\n      default:\n        extension = gl.getExtension(name);\n    }\n\n    if (extension === null) {\n      console.warn('THREE.WebGLRenderer: ' + name + ' extension not supported.');\n    }\n\n    extensions[name] = extension;\n    return extension;\n  };\n}; // File:src/renderers/webgl/WebGLCapabilities.js\n\n\nTHREE.WebGLCapabilities = function (gl, extensions, parameters) {\n  function getMaxPrecision(precision) {\n    if (precision === 'highp') {\n      if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision > 0 && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision > 0) {\n        return 'highp';\n      }\n\n      precision = 'mediump';\n    }\n\n    if (precision === 'mediump') {\n      if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision > 0 && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision > 0) {\n        return 'mediump';\n      }\n    }\n\n    return 'lowp';\n  }\n\n  this.getMaxPrecision = getMaxPrecision;\n  this.precision = parameters.precision !== undefined ? parameters.precision : 'highp', this.logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false;\n  this.maxTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n  this.maxVertexTextures = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\n  this.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n  this.maxCubemapSize = gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);\n  this.maxAttributes = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n  this.maxVertexUniforms = gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);\n  this.maxVaryings = gl.getParameter(gl.MAX_VARYING_VECTORS);\n  this.maxFragmentUniforms = gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);\n  this.vertexTextures = this.maxVertexTextures > 0;\n  this.floatFragmentTextures = !!extensions.get('OES_texture_float');\n  this.floatVertexTextures = this.vertexTextures && this.floatFragmentTextures;\n\n  var _maxPrecision = getMaxPrecision(this.precision);\n\n  if (_maxPrecision !== this.precision) {\n    console.warn('THREE.WebGLRenderer:', this.precision, 'not supported, using', _maxPrecision, 'instead.');\n    this.precision = _maxPrecision;\n  }\n\n  if (this.logarithmicDepthBuffer) {\n    this.logarithmicDepthBuffer = !!extensions.get('EXT_frag_depth');\n  }\n}; // File:src/renderers/webgl/WebGLGeometries.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\n\nTHREE.WebGLGeometries = function (gl, properties, info) {\n  var geometries = {};\n\n  function get(object) {\n    var geometry = object.geometry;\n\n    if (geometries[geometry.id] !== undefined) {\n      return geometries[geometry.id];\n    }\n\n    geometry.addEventListener('dispose', onGeometryDispose);\n    var buffergeometry;\n\n    if (geometry instanceof THREE.BufferGeometry) {\n      buffergeometry = geometry;\n    } else if (geometry instanceof THREE.Geometry) {\n      if (geometry._bufferGeometry === undefined) {\n        geometry._bufferGeometry = new THREE.BufferGeometry().setFromObject(object);\n      }\n\n      buffergeometry = geometry._bufferGeometry;\n    }\n\n    geometries[geometry.id] = buffergeometry;\n    info.memory.geometries++;\n    return buffergeometry;\n  }\n\n  function onGeometryDispose(event) {\n    var geometry = event.target;\n    var buffergeometry = geometries[geometry.id];\n    deleteAttributes(buffergeometry.attributes);\n    geometry.removeEventListener('dispose', onGeometryDispose);\n    delete geometries[geometry.id];\n    var property = properties.get(geometry);\n    if (property.wireframe) deleteAttribute(property.wireframe);\n    info.memory.geometries--;\n  }\n\n  function getAttributeBuffer(attribute) {\n    if (attribute instanceof THREE.InterleavedBufferAttribute) {\n      return properties.get(attribute.data).__webglBuffer;\n    }\n\n    return properties.get(attribute).__webglBuffer;\n  }\n\n  function deleteAttribute(attribute) {\n    var buffer = getAttributeBuffer(attribute);\n\n    if (buffer !== undefined) {\n      gl.deleteBuffer(buffer);\n      removeAttributeBuffer(attribute);\n    }\n  }\n\n  function deleteAttributes(attributes) {\n    for (var name in attributes) {\n      deleteAttribute(attributes[name]);\n    }\n  }\n\n  function removeAttributeBuffer(attribute) {\n    if (attribute instanceof THREE.InterleavedBufferAttribute) {\n      properties.delete(attribute.data);\n    } else {\n      properties.delete(attribute);\n    }\n  }\n\n  this.get = get;\n}; // File:src/renderers/webgl/WebGLObjects.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\n\nTHREE.WebGLObjects = function (gl, properties, info) {\n  var geometries = new THREE.WebGLGeometries(gl, properties, info); //\n\n  function update(object) {\n    // TODO: Avoid updating twice (when using shadowMap). Maybe add frame counter.\n    var geometry = geometries.get(object);\n\n    if (object.geometry instanceof THREE.Geometry) {\n      geometry.updateFromObject(object);\n    }\n\n    var index = geometry.index;\n    var attributes = geometry.attributes;\n\n    if (index !== null) {\n      updateAttribute(index, gl.ELEMENT_ARRAY_BUFFER);\n    }\n\n    for (var name in attributes) {\n      updateAttribute(attributes[name], gl.ARRAY_BUFFER);\n    } // morph targets\n\n\n    var morphAttributes = geometry.morphAttributes;\n\n    for (var name in morphAttributes) {\n      var array = morphAttributes[name];\n\n      for (var i = 0, l = array.length; i < l; i++) {\n        updateAttribute(array[i], gl.ARRAY_BUFFER);\n      }\n    }\n\n    return geometry;\n  }\n\n  function updateAttribute(attribute, bufferType) {\n    var data = attribute instanceof THREE.InterleavedBufferAttribute ? attribute.data : attribute;\n    var attributeProperties = properties.get(data);\n\n    if (attributeProperties.__webglBuffer === undefined) {\n      createBuffer(attributeProperties, data, bufferType);\n    } else if (attributeProperties.version !== data.version) {\n      updateBuffer(attributeProperties, data, bufferType);\n    }\n  }\n\n  function createBuffer(attributeProperties, data, bufferType) {\n    attributeProperties.__webglBuffer = gl.createBuffer();\n    gl.bindBuffer(bufferType, attributeProperties.__webglBuffer);\n    var usage = data.dynamic ? gl.DYNAMIC_DRAW : gl.STATIC_DRAW;\n    gl.bufferData(bufferType, data.array, usage);\n    attributeProperties.version = data.version;\n  }\n\n  function updateBuffer(attributeProperties, data, bufferType) {\n    gl.bindBuffer(bufferType, attributeProperties.__webglBuffer);\n\n    if (data.dynamic === false || data.updateRange.count === -1) {\n      // Not using update ranges\n      gl.bufferSubData(bufferType, 0, data.array);\n    } else if (data.updateRange.count === 0) {\n      console.error('THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.');\n    } else {\n      gl.bufferSubData(bufferType, data.updateRange.offset * data.array.BYTES_PER_ELEMENT, data.array.subarray(data.updateRange.offset, data.updateRange.offset + data.updateRange.count));\n      data.updateRange.count = 0; // reset range\n    }\n\n    attributeProperties.version = data.version;\n  }\n\n  function getAttributeBuffer(attribute) {\n    if (attribute instanceof THREE.InterleavedBufferAttribute) {\n      return properties.get(attribute.data).__webglBuffer;\n    }\n\n    return properties.get(attribute).__webglBuffer;\n  }\n\n  function getWireframeAttribute(geometry) {\n    var property = properties.get(geometry);\n\n    if (property.wireframe !== undefined) {\n      return property.wireframe;\n    }\n\n    var indices = [];\n    var index = geometry.index;\n    var attributes = geometry.attributes;\n    var position = attributes.position; // console.time( 'wireframe' );\n\n    if (index !== null) {\n      var edges = {};\n      var array = index.array;\n\n      for (var i = 0, l = array.length; i < l; i += 3) {\n        var a = array[i + 0];\n        var b = array[i + 1];\n        var c = array[i + 2];\n        if (checkEdge(edges, a, b)) indices.push(a, b);\n        if (checkEdge(edges, b, c)) indices.push(b, c);\n        if (checkEdge(edges, c, a)) indices.push(c, a);\n      }\n    } else {\n      var array = attributes.position.array;\n\n      for (var i = 0, l = array.length / 3 - 1; i < l; i += 3) {\n        var a = i + 0;\n        var b = i + 1;\n        var c = i + 2;\n        indices.push(a, b, b, c, c, a);\n      }\n    } // console.timeEnd( 'wireframe' );\n\n\n    var TypeArray = position.count > 65535 ? Uint32Array : Uint16Array;\n    var attribute = new THREE.BufferAttribute(new TypeArray(indices), 1);\n    updateAttribute(attribute, gl.ELEMENT_ARRAY_BUFFER);\n    property.wireframe = attribute;\n    return attribute;\n  }\n\n  function checkEdge(edges, a, b) {\n    if (a > b) {\n      var tmp = a;\n      a = b;\n      b = tmp;\n    }\n\n    var list = edges[a];\n\n    if (list === undefined) {\n      edges[a] = [b];\n      return true;\n    } else if (list.indexOf(b) === -1) {\n      list.push(b);\n      return true;\n    }\n\n    return false;\n  }\n\n  this.getAttributeBuffer = getAttributeBuffer;\n  this.getWireframeAttribute = getWireframeAttribute;\n  this.update = update;\n}; // File:src/renderers/webgl/WebGLProgram.js\n\n\nTHREE.WebGLProgram = function () {\n  var programIdCount = 0;\n\n  function generateDefines(defines) {\n    var chunks = [];\n\n    for (var name in defines) {\n      var value = defines[name];\n      if (value === false) continue;\n      chunks.push('#define ' + name + ' ' + value);\n    }\n\n    return chunks.join('\\n');\n  }\n\n  function fetchUniformLocations(gl, program, identifiers) {\n    var uniforms = {};\n    var n = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n\n    for (var i = 0; i < n; i++) {\n      var info = gl.getActiveUniform(program, i);\n      var name = info.name;\n      var location = gl.getUniformLocation(program, name); // console.log(\"THREE.WebGLProgram: ACTIVE UNIFORM:\", name);\n\n      var suffixPos = name.lastIndexOf('[0]');\n\n      if (suffixPos !== -1 && suffixPos === name.length - 3) {\n        uniforms[name.substr(0, suffixPos)] = location;\n      }\n\n      uniforms[name] = location;\n    }\n\n    return uniforms;\n  }\n\n  function fetchAttributeLocations(gl, program, identifiers) {\n    var attributes = {};\n    var n = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n\n    for (var i = 0; i < n; i++) {\n      var info = gl.getActiveAttrib(program, i);\n      var name = info.name; // console.log(\"THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:\", name, i );\n\n      attributes[name] = gl.getAttribLocation(program, name);\n    }\n\n    return attributes;\n  }\n\n  function filterEmptyLine(string) {\n    return string !== '';\n  }\n\n  return function WebGLProgram(renderer, code, material, parameters) {\n    var gl = renderer.context;\n    var defines = material.defines;\n    var vertexShader = material.__webglShader.vertexShader;\n    var fragmentShader = material.__webglShader.fragmentShader;\n    var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\n\n    if (parameters.shadowMapType === THREE.PCFShadowMap) {\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\n    } else if (parameters.shadowMapType === THREE.PCFSoftShadowMap) {\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\n    }\n\n    var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n    var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\n    var envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\n\n    if (parameters.envMap) {\n      switch (material.envMap.mapping) {\n        case THREE.CubeReflectionMapping:\n        case THREE.CubeRefractionMapping:\n          envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n          break;\n\n        case THREE.EquirectangularReflectionMapping:\n        case THREE.EquirectangularRefractionMapping:\n          envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\n          break;\n\n        case THREE.SphericalReflectionMapping:\n          envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\n          break;\n      }\n\n      switch (material.envMap.mapping) {\n        case THREE.CubeRefractionMapping:\n        case THREE.EquirectangularRefractionMapping:\n          envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\n          break;\n      }\n\n      switch (material.combine) {\n        case THREE.MultiplyOperation:\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\n          break;\n\n        case THREE.MixOperation:\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\n          break;\n\n        case THREE.AddOperation:\n          envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\n          break;\n      }\n    }\n\n    var gammaFactorDefine = renderer.gammaFactor > 0 ? renderer.gammaFactor : 1.0; // console.log( 'building new program ' );\n    //\n\n    var customDefines = generateDefines(defines); //\n\n    var program = gl.createProgram();\n    var prefixVertex, prefixFragment;\n\n    if (material instanceof THREE.RawShaderMaterial) {\n      prefixVertex = '';\n      prefixFragment = '';\n    } else {\n      prefixVertex = ['precision ' + parameters.precision + ' float;', 'precision ' + parameters.precision + ' int;', '#define SHADER_NAME ' + material.__webglShader.name, customDefines, parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '', renderer.gammaInput ? '#define GAMMA_INPUT' : '', renderer.gammaOutput ? '#define GAMMA_OUTPUT' : '', '#define GAMMA_FACTOR ' + gammaFactorDefine, '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights, '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights, '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights, '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights, '#define MAX_SHADOWS ' + parameters.maxShadows, '#define MAX_BONES ' + parameters.maxBones, parameters.map ? '#define USE_MAP' : '', parameters.envMap ? '#define USE_ENVMAP' : '', parameters.envMap ? '#define ' + envMapModeDefine : '', parameters.lightMap ? '#define USE_LIGHTMAP' : '', parameters.aoMap ? '#define USE_AOMAP' : '', parameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '', parameters.bumpMap ? '#define USE_BUMPMAP' : '', parameters.normalMap ? '#define USE_NORMALMAP' : '', parameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '', parameters.specularMap ? '#define USE_SPECULARMAP' : '', parameters.alphaMap ? '#define USE_ALPHAMAP' : '', parameters.vertexColors ? '#define USE_COLOR' : '', parameters.flatShading ? '#define FLAT_SHADED' : '', parameters.skinning ? '#define USE_SKINNING' : '', parameters.useVertexTexture ? '#define BONE_TEXTURE' : '', parameters.morphTargets ? '#define USE_MORPHTARGETS' : '', parameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '', parameters.doubleSided ? '#define DOUBLE_SIDED' : '', parameters.flipSided ? '#define FLIP_SIDED' : '', parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '', parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '', parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '', parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '', parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '', parameters.logarithmicDepthBuffer && renderer.extensions.get('EXT_frag_depth') ? '#define USE_LOGDEPTHBUF_EXT' : '', 'uniform mat4 modelMatrix;', 'uniform mat4 modelViewMatrix;', 'uniform mat4 projectionMatrix;', 'uniform mat4 viewMatrix;', 'uniform mat3 normalMatrix;', 'uniform vec3 cameraPosition;', 'attribute vec3 position;', 'attribute vec3 normal;', 'attribute vec2 uv;', '#ifdef USE_COLOR', '\tattribute vec3 color;', '#endif', '#ifdef USE_MORPHTARGETS', '\tattribute vec3 morphTarget0;', '\tattribute vec3 morphTarget1;', '\tattribute vec3 morphTarget2;', '\tattribute vec3 morphTarget3;', '\t#ifdef USE_MORPHNORMALS', '\t\tattribute vec3 morphNormal0;', '\t\tattribute vec3 morphNormal1;', '\t\tattribute vec3 morphNormal2;', '\t\tattribute vec3 morphNormal3;', '\t#else', '\t\tattribute vec3 morphTarget4;', '\t\tattribute vec3 morphTarget5;', '\t\tattribute vec3 morphTarget6;', '\t\tattribute vec3 morphTarget7;', '\t#endif', '#endif', '#ifdef USE_SKINNING', '\tattribute vec4 skinIndex;', '\tattribute vec4 skinWeight;', '#endif', '\\n'].filter(filterEmptyLine).join('\\n');\n      prefixFragment = [parameters.bumpMap || parameters.normalMap || parameters.flatShading || material.derivatives ? '#extension GL_OES_standard_derivatives : enable' : '', parameters.logarithmicDepthBuffer && renderer.extensions.get('EXT_frag_depth') ? '#extension GL_EXT_frag_depth : enable' : '', 'precision ' + parameters.precision + ' float;', 'precision ' + parameters.precision + ' int;', '#define SHADER_NAME ' + material.__webglShader.name, customDefines, '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights, '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights, '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights, '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights, '#define MAX_SHADOWS ' + parameters.maxShadows, parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '', renderer.gammaInput ? '#define GAMMA_INPUT' : '', renderer.gammaOutput ? '#define GAMMA_OUTPUT' : '', '#define GAMMA_FACTOR ' + gammaFactorDefine, parameters.useFog && parameters.fog ? '#define USE_FOG' : '', parameters.useFog && parameters.fogExp ? '#define FOG_EXP2' : '', parameters.map ? '#define USE_MAP' : '', parameters.envMap ? '#define USE_ENVMAP' : '', parameters.envMap ? '#define ' + envMapTypeDefine : '', parameters.envMap ? '#define ' + envMapModeDefine : '', parameters.envMap ? '#define ' + envMapBlendingDefine : '', parameters.lightMap ? '#define USE_LIGHTMAP' : '', parameters.aoMap ? '#define USE_AOMAP' : '', parameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '', parameters.bumpMap ? '#define USE_BUMPMAP' : '', parameters.normalMap ? '#define USE_NORMALMAP' : '', parameters.specularMap ? '#define USE_SPECULARMAP' : '', parameters.alphaMap ? '#define USE_ALPHAMAP' : '', parameters.vertexColors ? '#define USE_COLOR' : '', parameters.flatShading ? '#define FLAT_SHADED' : '', parameters.metal ? '#define METAL' : '', parameters.doubleSided ? '#define DOUBLE_SIDED' : '', parameters.flipSided ? '#define FLIP_SIDED' : '', parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '', parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '', parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '', parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '', parameters.logarithmicDepthBuffer && renderer.extensions.get('EXT_frag_depth') ? '#define USE_LOGDEPTHBUF_EXT' : '', 'uniform mat4 viewMatrix;', 'uniform vec3 cameraPosition;', '\\n'].filter(filterEmptyLine).join('\\n');\n    }\n\n    var vertexGlsl = prefixVertex + vertexShader;\n    var fragmentGlsl = prefixFragment + fragmentShader;\n    var glVertexShader = THREE.WebGLShader(gl, gl.VERTEX_SHADER, vertexGlsl);\n    var glFragmentShader = THREE.WebGLShader(gl, gl.FRAGMENT_SHADER, fragmentGlsl);\n    gl.attachShader(program, glVertexShader);\n    gl.attachShader(program, glFragmentShader); // Force a particular attribute to index 0.\n\n    if (material.index0AttributeName !== undefined) {\n      gl.bindAttribLocation(program, 0, material.index0AttributeName);\n    } else if (parameters.morphTargets === true) {\n      // programs with morphTargets displace position out of attribute 0\n      gl.bindAttribLocation(program, 0, 'position');\n    }\n\n    gl.linkProgram(program);\n    var programLog = gl.getProgramInfoLog(program);\n    var vertexLog = gl.getShaderInfoLog(glVertexShader);\n    var fragmentLog = gl.getShaderInfoLog(glFragmentShader);\n    var runnable = true;\n    var haveDiagnostics = true;\n\n    if (gl.getProgramParameter(program, gl.LINK_STATUS) === false) {\n      runnable = false;\n      console.error('THREE.WebGLProgram: shader error: ', gl.getError(), 'gl.VALIDATE_STATUS', gl.getProgramParameter(program, gl.VALIDATE_STATUS), 'gl.getProgramInfoLog', programLog, vertexLog, fragmentLog);\n    } else if (programLog !== '') {\n      console.warn('THREE.WebGLProgram: gl.getProgramInfoLog()', programLog);\n    } else if (vertexLog === '' || fragmentLog === '') {\n      haveDiagnostics = false;\n    }\n\n    if (haveDiagnostics) {\n      this.diagnostics = {\n        runnable: runnable,\n        material: material,\n        programLog: programLog,\n        vertexShader: {\n          log: vertexLog,\n          prefix: prefixVertex\n        },\n        fragmentShader: {\n          log: fragmentLog,\n          prefix: prefixFragment\n        }\n      };\n    } // clean up\n\n\n    gl.deleteShader(glVertexShader);\n    gl.deleteShader(glFragmentShader); // set up caching for uniform locations\n\n    var cachedUniforms;\n\n    this.getUniforms = function () {\n      if (cachedUniforms === undefined) {\n        cachedUniforms = fetchUniformLocations(gl, program);\n      }\n\n      return cachedUniforms;\n    }; // set up caching for attribute locations\n\n\n    var cachedAttributes;\n\n    this.getAttributes = function () {\n      if (cachedAttributes === undefined) {\n        cachedAttributes = fetchAttributeLocations(gl, program);\n      }\n\n      return cachedAttributes;\n    }; // free resource\n\n\n    this.destroy = function () {\n      gl.deleteProgram(program);\n      this.program = undefined;\n    }; // DEPRECATED\n\n\n    Object.defineProperties(this, {\n      uniforms: {\n        get: function () {\n          console.warn('THREE.WebGLProgram: .uniforms is now .getUniforms().');\n          return this.getUniforms();\n        }\n      },\n      attributes: {\n        get: function () {\n          console.warn('THREE.WebGLProgram: .attributes is now .getAttributes().');\n          return this.getAttributes();\n        }\n      }\n    }); //\n\n    this.id = programIdCount++;\n    this.code = code;\n    this.usedTimes = 1;\n    this.program = program;\n    this.vertexShader = glVertexShader;\n    this.fragmentShader = glFragmentShader;\n    return this;\n  };\n}(); // File:src/renderers/webgl/WebGLPrograms.js\n\n\nTHREE.WebGLPrograms = function (renderer, capabilities) {\n  var programs = [];\n  var shaderIDs = {\n    MeshDepthMaterial: 'depth',\n    MeshNormalMaterial: 'normal',\n    MeshBasicMaterial: 'basic',\n    MeshLambertMaterial: 'lambert',\n    MeshPhongMaterial: 'phong',\n    LineBasicMaterial: 'basic',\n    LineDashedMaterial: 'dashed',\n    PointsMaterial: 'points'\n  };\n  var parameterNames = [\"precision\", \"supportsVertexTextures\", \"map\", \"envMap\", \"envMapMode\", \"lightMap\", \"aoMap\", \"emissiveMap\", \"bumpMap\", \"normalMap\", \"specularMap\", \"alphaMap\", \"combine\", \"vertexColors\", \"fog\", \"useFog\", \"fogExp\", \"flatShading\", \"sizeAttenuation\", \"logarithmicDepthBuffer\", \"skinning\", \"maxBones\", \"useVertexTexture\", \"morphTargets\", \"morphNormals\", \"maxMorphTargets\", \"maxMorphNormals\", \"maxDirLights\", \"maxPointLights\", \"maxSpotLights\", \"maxHemiLights\", \"maxShadows\", \"shadowMapEnabled\", \"shadowMapType\", \"shadowMapDebug\", \"alphaTest\", \"metal\", \"doubleSided\", \"flipSided\"];\n\n  function allocateBones(object) {\n    if (capabilities.floatVertexTextures && object && object.skeleton && object.skeleton.useVertexTexture) {\n      return 1024;\n    } else {\n      // default for when object is not specified\n      // ( for example when prebuilding shader to be used with multiple objects )\n      //\n      //  - leave some extra space for other uniforms\n      //  - limit here is ANGLE's 254 max uniform vectors\n      //    (up to 54 should be safe)\n      var nVertexUniforms = capabilities.maxVertexUniforms;\n      var nVertexMatrices = Math.floor((nVertexUniforms - 20) / 4);\n      var maxBones = nVertexMatrices;\n\n      if (object !== undefined && object instanceof THREE.SkinnedMesh) {\n        maxBones = Math.min(object.skeleton.bones.length, maxBones);\n\n        if (maxBones < object.skeleton.bones.length) {\n          console.warn('WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)');\n        }\n      }\n\n      return maxBones;\n    }\n  }\n\n  function allocateLights(lights) {\n    var dirLights = 0;\n    var pointLights = 0;\n    var spotLights = 0;\n    var hemiLights = 0;\n\n    for (var l = 0, ll = lights.length; l < ll; l++) {\n      var light = lights[l];\n      if (light.onlyShadow || light.visible === false) continue;\n      if (light instanceof THREE.DirectionalLight) dirLights++;\n      if (light instanceof THREE.PointLight) pointLights++;\n      if (light instanceof THREE.SpotLight) spotLights++;\n      if (light instanceof THREE.HemisphereLight) hemiLights++;\n    }\n\n    return {\n      'directional': dirLights,\n      'point': pointLights,\n      'spot': spotLights,\n      'hemi': hemiLights\n    };\n  }\n\n  function allocateShadows(lights) {\n    var maxShadows = 0;\n\n    for (var l = 0, ll = lights.length; l < ll; l++) {\n      var light = lights[l];\n      if (!light.castShadow) continue;\n      if (light instanceof THREE.SpotLight) maxShadows++;\n      if (light instanceof THREE.DirectionalLight) maxShadows++;\n    }\n\n    return maxShadows;\n  }\n\n  this.getParameters = function (material, lights, fog, object) {\n    var shaderID = shaderIDs[material.type]; // heuristics to create shader parameters according to lights in the scene\n    // (not to blow over maxLights budget)\n\n    var maxLightCount = allocateLights(lights);\n    var maxShadows = allocateShadows(lights);\n    var maxBones = allocateBones(object);\n    var precision = renderer.getPrecision();\n\n    if (material.precision !== null) {\n      precision = capabilities.getMaxPrecision(material.precision);\n\n      if (precision !== material.precision) {\n        console.warn('THREE.WebGLRenderer.initMaterial:', material.precision, 'not supported, using', precision, 'instead.');\n      }\n    }\n\n    var parameters = {\n      shaderID: shaderID,\n      precision: precision,\n      supportsVertexTextures: capabilities.vertexTextures,\n      map: !!material.map,\n      envMap: !!material.envMap,\n      envMapMode: material.envMap && material.envMap.mapping,\n      lightMap: !!material.lightMap,\n      aoMap: !!material.aoMap,\n      emissiveMap: !!material.emissiveMap,\n      bumpMap: !!material.bumpMap,\n      normalMap: !!material.normalMap,\n      displacementMap: !!material.displacementMap,\n      specularMap: !!material.specularMap,\n      alphaMap: !!material.alphaMap,\n      combine: material.combine,\n      vertexColors: material.vertexColors,\n      fog: fog,\n      useFog: material.fog,\n      fogExp: fog instanceof THREE.FogExp2,\n      flatShading: material.shading === THREE.FlatShading,\n      sizeAttenuation: material.sizeAttenuation,\n      logarithmicDepthBuffer: capabilities.logarithmicDepthBuffer,\n      skinning: material.skinning,\n      maxBones: maxBones,\n      useVertexTexture: capabilities.floatVertexTextures && object && object.skeleton && object.skeleton.useVertexTexture,\n      morphTargets: material.morphTargets,\n      morphNormals: material.morphNormals,\n      maxMorphTargets: renderer.maxMorphTargets,\n      maxMorphNormals: renderer.maxMorphNormals,\n      maxDirLights: maxLightCount.directional,\n      maxPointLights: maxLightCount.point,\n      maxSpotLights: maxLightCount.spot,\n      maxHemiLights: maxLightCount.hemi,\n      maxShadows: maxShadows,\n      shadowMapEnabled: renderer.shadowMap.enabled && object.receiveShadow && maxShadows > 0,\n      shadowMapType: renderer.shadowMap.type,\n      shadowMapDebug: renderer.shadowMap.debug,\n      alphaTest: material.alphaTest,\n      metal: material.metal,\n      doubleSided: material.side === THREE.DoubleSide,\n      flipSided: material.side === THREE.BackSide\n    };\n    return parameters;\n  };\n\n  this.getProgramCode = function (material, parameters) {\n    var chunks = [];\n\n    if (parameters.shaderID) {\n      chunks.push(parameters.shaderID);\n    } else {\n      chunks.push(material.fragmentShader);\n      chunks.push(material.vertexShader);\n    }\n\n    if (material.defines !== undefined) {\n      for (var name in material.defines) {\n        chunks.push(name);\n        chunks.push(material.defines[name]);\n      }\n    }\n\n    for (var i = 0; i < parameterNames.length; i++) {\n      var parameterName = parameterNames[i];\n      chunks.push(parameterName);\n      chunks.push(parameters[parameterName]);\n    }\n\n    return chunks.join();\n  };\n\n  this.acquireProgram = function (material, parameters, code) {\n    var program; // Check if code has been already compiled\n\n    for (var p = 0, pl = programs.length; p < pl; p++) {\n      var programInfo = programs[p];\n\n      if (programInfo.code === code) {\n        program = programInfo;\n        ++program.usedTimes;\n        break;\n      }\n    }\n\n    if (program === undefined) {\n      program = new THREE.WebGLProgram(renderer, code, material, parameters);\n      programs.push(program);\n    }\n\n    return program;\n  };\n\n  this.releaseProgram = function (program) {\n    if (--program.usedTimes === 0) {\n      // Remove from unordered set\n      var i = programs.indexOf(program);\n      programs[i] = programs[programs.length - 1];\n      programs.pop(); // Free WebGL resources\n\n      program.destroy();\n    }\n  }; // Exposed for resource monitoring & error feedback via renderer.info:\n\n\n  this.programs = programs;\n}; // File:src/renderers/webgl/WebGLProperties.js\n\n/**\r\n* @author fordacious / fordacious.github.io\r\n*/\n\n\nTHREE.WebGLProperties = function () {\n  var properties = {};\n\n  this.get = function (object) {\n    var uuid = object.uuid;\n    var map = properties[uuid];\n\n    if (map === undefined) {\n      map = {};\n      properties[uuid] = map;\n    }\n\n    return map;\n  };\n\n  this.delete = function (object) {\n    delete properties[object.uuid];\n  };\n\n  this.clear = function () {\n    properties = {};\n  };\n}; // File:src/renderers/webgl/WebGLShader.js\n\n\nTHREE.WebGLShader = function () {\n  var addLineNumbers = function (string) {\n    var lines = string.split('\\n');\n\n    for (var i = 0; i < lines.length; i++) {\n      lines[i] = i + 1 + ': ' + lines[i];\n    }\n\n    return lines.join('\\n');\n  };\n\n  return function WebGLShader(gl, type, string) {\n    var shader = gl.createShader(type);\n    gl.shaderSource(shader, string);\n    gl.compileShader(shader);\n\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) === false) {\n      console.error('THREE.WebGLShader: Shader couldn\\'t compile.');\n    }\n\n    if (gl.getShaderInfoLog(shader) !== '') {\n      console.warn('THREE.WebGLShader: gl.getShaderInfoLog()', type === gl.VERTEX_SHADER ? 'vertex' : 'fragment', gl.getShaderInfoLog(shader), addLineNumbers(string));\n    } // --enable-privileged-webgl-extension\n    // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\n\n\n    return shader;\n  };\n}(); // File:src/renderers/webgl/WebGLShadowMap.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.WebGLShadowMap = function (_renderer, _lights, _objects) {\n  var _gl = _renderer.context,\n      _state = _renderer.state,\n      _frustum = new THREE.Frustum(),\n      _projScreenMatrix = new THREE.Matrix4(),\n      _min = new THREE.Vector3(),\n      _max = new THREE.Vector3(),\n      _matrixPosition = new THREE.Vector3(),\n      _renderList = []; // init\n\n\n  var depthShader = THREE.ShaderLib[\"depthRGBA\"];\n  var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);\n\n  var _depthMaterial = new THREE.ShaderMaterial({\n    uniforms: depthUniforms,\n    vertexShader: depthShader.vertexShader,\n    fragmentShader: depthShader.fragmentShader\n  });\n\n  var _depthMaterialMorph = new THREE.ShaderMaterial({\n    uniforms: depthUniforms,\n    vertexShader: depthShader.vertexShader,\n    fragmentShader: depthShader.fragmentShader,\n    morphTargets: true\n  });\n\n  var _depthMaterialSkin = new THREE.ShaderMaterial({\n    uniforms: depthUniforms,\n    vertexShader: depthShader.vertexShader,\n    fragmentShader: depthShader.fragmentShader,\n    skinning: true\n  });\n\n  var _depthMaterialMorphSkin = new THREE.ShaderMaterial({\n    uniforms: depthUniforms,\n    vertexShader: depthShader.vertexShader,\n    fragmentShader: depthShader.fragmentShader,\n    morphTargets: true,\n    skinning: true\n  });\n\n  _depthMaterial._shadowPass = true;\n  _depthMaterialMorph._shadowPass = true;\n  _depthMaterialSkin._shadowPass = true;\n  _depthMaterialMorphSkin._shadowPass = true; //\n\n  var scope = this;\n  this.enabled = false;\n  this.autoUpdate = true;\n  this.needsUpdate = false;\n  this.type = THREE.PCFShadowMap;\n  this.cullFace = THREE.CullFaceFront;\n\n  this.render = function (scene, camera) {\n    if (scope.enabled === false) return;\n    if (scope.autoUpdate === false && scope.needsUpdate === false) return; // set GL state for depth map\n\n    _gl.clearColor(1, 1, 1, 1);\n\n    _state.disable(_gl.BLEND);\n\n    _state.enable(_gl.CULL_FACE);\n\n    _gl.frontFace(_gl.CCW);\n\n    if (scope.cullFace === THREE.CullFaceFront) {\n      _gl.cullFace(_gl.FRONT);\n    } else {\n      _gl.cullFace(_gl.BACK);\n    }\n\n    _state.setDepthTest(true); // render depth map\n\n\n    for (var i = 0, il = _lights.length; i < il; i++) {\n      var light = _lights[i];\n      if (!light.castShadow) continue;\n\n      if (!light.shadowMap) {\n        var shadowFilter = THREE.LinearFilter;\n\n        if (scope.type === THREE.PCFSoftShadowMap) {\n          shadowFilter = THREE.NearestFilter;\n        }\n\n        var pars = {\n          minFilter: shadowFilter,\n          magFilter: shadowFilter,\n          format: THREE.RGBAFormat\n        };\n        light.shadowMap = new THREE.WebGLRenderTarget(light.shadowMapWidth, light.shadowMapHeight, pars);\n        light.shadowMapSize = new THREE.Vector2(light.shadowMapWidth, light.shadowMapHeight);\n        light.shadowMatrix = new THREE.Matrix4();\n      }\n\n      if (!light.shadowCamera) {\n        if (light instanceof THREE.SpotLight) {\n          light.shadowCamera = new THREE.PerspectiveCamera(light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar);\n        } else if (light instanceof THREE.DirectionalLight) {\n          light.shadowCamera = new THREE.OrthographicCamera(light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar);\n        } else {\n          console.error(\"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light);\n          continue;\n        }\n\n        scene.add(light.shadowCamera);\n        if (scene.autoUpdate === true) scene.updateMatrixWorld();\n      }\n\n      if (light.shadowCameraVisible && !light.cameraHelper) {\n        light.cameraHelper = new THREE.CameraHelper(light.shadowCamera);\n        scene.add(light.cameraHelper);\n      }\n\n      var shadowMap = light.shadowMap;\n      var shadowMatrix = light.shadowMatrix;\n      var shadowCamera = light.shadowCamera; //\n\n      shadowCamera.position.setFromMatrixPosition(light.matrixWorld);\n\n      _matrixPosition.setFromMatrixPosition(light.target.matrixWorld);\n\n      shadowCamera.lookAt(_matrixPosition);\n      shadowCamera.updateMatrixWorld();\n      shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld); //\n\n      if (light.cameraHelper) light.cameraHelper.visible = light.shadowCameraVisible;\n      if (light.shadowCameraVisible) light.cameraHelper.update(); // compute shadow matrix\n\n      shadowMatrix.set(0.5, 0.0, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 1.0);\n      shadowMatrix.multiply(shadowCamera.projectionMatrix);\n      shadowMatrix.multiply(shadowCamera.matrixWorldInverse); // update camera matrices and frustum\n\n      _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\n\n      _frustum.setFromMatrix(_projScreenMatrix); // render shadow map\n\n\n      _renderer.setRenderTarget(shadowMap);\n\n      _renderer.clear(); // set object matrices & frustum culling\n\n\n      _renderList.length = 0;\n      projectObject(scene, shadowCamera); // render regular objects\n\n      for (var j = 0, jl = _renderList.length; j < jl; j++) {\n        var object = _renderList[j];\n\n        var geometry = _objects.update(object);\n\n        var material = object.material;\n\n        if (material instanceof THREE.MeshFaceMaterial) {\n          var groups = geometry.groups;\n          var materials = material.materials;\n\n          for (var k = 0, kl = groups.length; k < kl; k++) {\n            var group = groups[k];\n            var groupMaterial = materials[group.materialIndex];\n\n            if (groupMaterial.visible === true) {\n              _renderer.renderBufferDirect(shadowCamera, _lights, null, geometry, getDepthMaterial(object, groupMaterial), object, group);\n            }\n          }\n        } else {\n          _renderer.renderBufferDirect(shadowCamera, _lights, null, geometry, getDepthMaterial(object, material), object);\n        }\n      }\n    } // restore GL state\n\n\n    var clearColor = _renderer.getClearColor(),\n        clearAlpha = _renderer.getClearAlpha();\n\n    _renderer.setClearColor(clearColor, clearAlpha);\n\n    _state.enable(_gl.BLEND);\n\n    if (scope.cullFace === THREE.CullFaceFront) {\n      _gl.cullFace(_gl.BACK);\n    }\n\n    _renderer.resetGLState();\n\n    scope.needsUpdate = false;\n  };\n\n  function getDepthMaterial(object, material) {\n    var geometry = object.geometry;\n    var useMorphing = geometry.morphTargets !== undefined && geometry.morphTargets.length > 0 && material.morphTargets;\n    var useSkinning = object instanceof THREE.SkinnedMesh && material.skinning;\n    var depthMaterial;\n\n    if (object.customDepthMaterial) {\n      depthMaterial = object.customDepthMaterial;\n    } else if (useSkinning) {\n      depthMaterial = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\n    } else if (useMorphing) {\n      depthMaterial = _depthMaterialMorph;\n    } else {\n      depthMaterial = _depthMaterial;\n    }\n\n    depthMaterial.visible = material.visible;\n    depthMaterial.wireframe = material.wireframe;\n    depthMaterial.wireframeLinewidth = material.wireframeLinewidth;\n    return depthMaterial;\n  }\n\n  function projectObject(object, camera) {\n    if (object.visible === false) return;\n\n    if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Points) {\n      if (object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\n        var material = object.material;\n\n        if (material.visible === true) {\n          object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\n\n          _renderList.push(object);\n        }\n      }\n    }\n\n    var children = object.children;\n\n    for (var i = 0, l = children.length; i < l; i++) {\n      projectObject(children[i], camera);\n    }\n  }\n}; // File:src/renderers/webgl/WebGLState.js\n\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\n\n\nTHREE.WebGLState = function (gl, extensions, paramThreeToGL) {\n  var _this = this;\n\n  var newAttributes = new Uint8Array(16);\n  var enabledAttributes = new Uint8Array(16);\n  var capabilities = {};\n  var compressedTextureFormats = null;\n  var currentBlending = null;\n  var currentBlendEquation = null;\n  var currentBlendSrc = null;\n  var currentBlendDst = null;\n  var currentBlendEquationAlpha = null;\n  var currentBlendSrcAlpha = null;\n  var currentBlendDstAlpha = null;\n  var currentDepthFunc = null;\n  var currentDepthWrite = null;\n  var currentColorWrite = null;\n  var currentFlipSided = null;\n  var currentLineWidth = null;\n  var currentPolygonOffsetFactor = null;\n  var currentPolygonOffsetUnits = null;\n  var maxTextures = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n  var currentTextureSlot = undefined;\n  var currentBoundTextures = {};\n\n  this.init = function () {\n    gl.clearColor(0, 0, 0, 1);\n    gl.clearDepth(1);\n    gl.clearStencil(0);\n    this.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.frontFace(gl.CCW);\n    gl.cullFace(gl.BACK);\n    this.enable(gl.CULL_FACE);\n    this.enable(gl.BLEND);\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n  };\n\n  this.initAttributes = function () {\n    for (var i = 0, l = newAttributes.length; i < l; i++) {\n      newAttributes[i] = 0;\n    }\n  };\n\n  this.enableAttribute = function (attribute) {\n    newAttributes[attribute] = 1;\n\n    if (enabledAttributes[attribute] === 0) {\n      gl.enableVertexAttribArray(attribute);\n      enabledAttributes[attribute] = 1;\n    }\n  };\n\n  this.disableUnusedAttributes = function () {\n    for (var i = 0, l = enabledAttributes.length; i < l; i++) {\n      if (enabledAttributes[i] !== newAttributes[i]) {\n        gl.disableVertexAttribArray(i);\n        enabledAttributes[i] = 0;\n      }\n    }\n  };\n\n  this.enable = function (id) {\n    if (capabilities[id] !== true) {\n      gl.enable(id);\n      capabilities[id] = true;\n    }\n  };\n\n  this.disable = function (id) {\n    if (capabilities[id] !== false) {\n      gl.disable(id);\n      capabilities[id] = false;\n    }\n  };\n\n  this.getCompressedTextureFormats = function () {\n    if (compressedTextureFormats === null) {\n      compressedTextureFormats = [];\n\n      if (extensions.get('WEBGL_compressed_texture_pvrtc') || extensions.get('WEBGL_compressed_texture_s3tc')) {\n        var formats = gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS);\n\n        for (var i = 0; i < formats.length; i++) {\n          compressedTextureFormats.push(formats[i]);\n        }\n      }\n    }\n\n    return compressedTextureFormats;\n  };\n\n  this.setBlending = function (blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha) {\n    if (blending !== currentBlending) {\n      if (blending === THREE.NoBlending) {\n        this.disable(gl.BLEND);\n      } else if (blending === THREE.AdditiveBlending) {\n        this.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n      } else if (blending === THREE.SubtractiveBlending) {\n        // TODO: Find blendFuncSeparate() combination\n        this.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);\n      } else if (blending === THREE.MultiplyBlending) {\n        // TODO: Find blendFuncSeparate() combination\n        this.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFunc(gl.ZERO, gl.SRC_COLOR);\n      } else if (blending === THREE.CustomBlending) {\n        this.enable(gl.BLEND);\n      } else {\n        this.enable(gl.BLEND);\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n      }\n\n      currentBlending = blending;\n    }\n\n    if (blending === THREE.CustomBlending) {\n      blendEquationAlpha = blendEquationAlpha || blendEquation;\n      blendSrcAlpha = blendSrcAlpha || blendSrc;\n      blendDstAlpha = blendDstAlpha || blendDst;\n\n      if (blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha) {\n        gl.blendEquationSeparate(paramThreeToGL(blendEquation), paramThreeToGL(blendEquationAlpha));\n        currentBlendEquation = blendEquation;\n        currentBlendEquationAlpha = blendEquationAlpha;\n      }\n\n      if (blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha) {\n        gl.blendFuncSeparate(paramThreeToGL(blendSrc), paramThreeToGL(blendDst), paramThreeToGL(blendSrcAlpha), paramThreeToGL(blendDstAlpha));\n        currentBlendSrc = blendSrc;\n        currentBlendDst = blendDst;\n        currentBlendSrcAlpha = blendSrcAlpha;\n        currentBlendDstAlpha = blendDstAlpha;\n      }\n    } else {\n      currentBlendEquation = null;\n      currentBlendSrc = null;\n      currentBlendDst = null;\n      currentBlendEquationAlpha = null;\n      currentBlendSrcAlpha = null;\n      currentBlendDstAlpha = null;\n    }\n  };\n\n  this.setDepthFunc = function (depthFunc) {\n    if (currentDepthFunc !== depthFunc) {\n      if (depthFunc) {\n        switch (depthFunc) {\n          case THREE.NeverDepth:\n            gl.depthFunc(gl.NEVER);\n            break;\n\n          case THREE.AlwaysDepth:\n            gl.depthFunc(gl.ALWAYS);\n            break;\n\n          case THREE.LessDepth:\n            gl.depthFunc(gl.LESS);\n            break;\n\n          case THREE.LessEqualDepth:\n            gl.depthFunc(gl.LEQUAL);\n            break;\n\n          case THREE.EqualDepth:\n            gl.depthFunc(gl.EQUAL);\n            break;\n\n          case THREE.GreaterEqualDepth:\n            gl.depthFunc(gl.GEQUAL);\n            break;\n\n          case THREE.GreaterDepth:\n            gl.depthFunc(gl.GREATER);\n            break;\n\n          case THREE.NotEqualDepth:\n            gl.depthFunc(gl.NOTEQUAL);\n            break;\n\n          default:\n            gl.depthFunc(gl.LEQUAL);\n        }\n      } else {\n        gl.depthFunc(gl.LEQUAL);\n      }\n\n      currentDepthFunc = depthFunc;\n    }\n  };\n\n  this.setDepthTest = function (depthTest) {\n    if (depthTest) {\n      this.enable(gl.DEPTH_TEST);\n    } else {\n      this.disable(gl.DEPTH_TEST);\n    }\n  };\n\n  this.setDepthWrite = function (depthWrite) {\n    if (currentDepthWrite !== depthWrite) {\n      gl.depthMask(depthWrite);\n      currentDepthWrite = depthWrite;\n    }\n  };\n\n  this.setColorWrite = function (colorWrite) {\n    if (currentColorWrite !== colorWrite) {\n      gl.colorMask(colorWrite, colorWrite, colorWrite, colorWrite);\n      currentColorWrite = colorWrite;\n    }\n  };\n\n  this.setFlipSided = function (flipSided) {\n    if (currentFlipSided !== flipSided) {\n      if (flipSided) {\n        gl.frontFace(gl.CW);\n      } else {\n        gl.frontFace(gl.CCW);\n      }\n\n      currentFlipSided = flipSided;\n    }\n  };\n\n  this.setLineWidth = function (width) {\n    if (width !== currentLineWidth) {\n      gl.lineWidth(width);\n      currentLineWidth = width;\n    }\n  };\n\n  this.setPolygonOffset = function (polygonOffset, factor, units) {\n    if (polygonOffset) {\n      this.enable(gl.POLYGON_OFFSET_FILL);\n    } else {\n      this.disable(gl.POLYGON_OFFSET_FILL);\n    }\n\n    if (polygonOffset && (currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units)) {\n      gl.polygonOffset(factor, units);\n      currentPolygonOffsetFactor = factor;\n      currentPolygonOffsetUnits = units;\n    }\n  };\n\n  this.setScissorTest = function (scissorTest) {\n    if (scissorTest) {\n      this.enable(gl.SCISSOR_TEST);\n    } else {\n      this.disable(gl.SCISSOR_TEST);\n    }\n  }; // texture\n\n\n  this.activeTexture = function (webglSlot) {\n    if (webglSlot === undefined) webglSlot = gl.TEXTURE0 + maxTextures - 1;\n\n    if (currentTextureSlot !== webglSlot) {\n      gl.activeTexture(webglSlot);\n      currentTextureSlot = webglSlot;\n    }\n  };\n\n  this.bindTexture = function (webglType, webglTexture) {\n    if (currentTextureSlot === undefined) {\n      _this.activeTexture();\n    }\n\n    var boundTexture = currentBoundTextures[currentTextureSlot];\n\n    if (boundTexture === undefined) {\n      boundTexture = {\n        type: undefined,\n        texture: undefined\n      };\n      currentBoundTextures[currentTextureSlot] = boundTexture;\n    }\n\n    if (boundTexture.type !== webglType || boundTexture.texture !== webglTexture) {\n      gl.bindTexture(webglType, webglTexture);\n      boundTexture.type = webglType;\n      boundTexture.texture = webglTexture;\n    }\n  };\n\n  this.compressedTexImage2D = function () {\n    try {\n      gl.compressedTexImage2D.apply(gl, arguments);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  this.texImage2D = function () {\n    try {\n      gl.texImage2D.apply(gl, arguments);\n    } catch (error) {\n      console.error(error);\n    }\n  }; //\n\n\n  this.reset = function () {\n    for (var i = 0; i < enabledAttributes.length; i++) {\n      if (enabledAttributes[i] === 1) {\n        gl.disableVertexAttribArray(i);\n        enabledAttributes[i] = 0;\n      }\n    }\n\n    capabilities = {};\n    compressedTextureFormats = null;\n    currentBlending = null;\n    currentDepthWrite = null;\n    currentColorWrite = null;\n    currentFlipSided = null;\n  };\n}; // File:src/renderers/webgl/plugins/LensFlarePlugin.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.LensFlarePlugin = function (renderer, flares) {\n  var gl = renderer.context;\n  var state = renderer.state;\n  var vertexBuffer, elementBuffer;\n  var program, attributes, uniforms;\n  var hasVertexTexture;\n  var tempTexture, occlusionTexture;\n\n  var init = function () {\n    var vertices = new Float32Array([-1, -1, 0, 0, 1, -1, 1, 0, 1, 1, 1, 1, -1, 1, 0, 1]);\n    var faces = new Uint16Array([0, 1, 2, 0, 2, 3]); // buffers\n\n    vertexBuffer = gl.createBuffer();\n    elementBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW); // textures\n\n    tempTexture = gl.createTexture();\n    occlusionTexture = gl.createTexture();\n    state.bindTexture(gl.TEXTURE_2D, tempTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    state.bindTexture(gl.TEXTURE_2D, occlusionTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    hasVertexTexture = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;\n    var shader;\n\n    if (hasVertexTexture) {\n      shader = {\n        vertexShader: [\"uniform lowp int renderType;\", \"uniform vec3 screenPosition;\", \"uniform vec2 scale;\", \"uniform float rotation;\", \"uniform sampler2D occlusionMap;\", \"attribute vec2 position;\", \"attribute vec2 uv;\", \"varying vec2 vUV;\", \"varying float vVisibility;\", \"void main() {\", \"vUV = uv;\", \"vec2 pos = position;\", \"if( renderType == 2 ) {\", \"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\", \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\", \"vVisibility =        visibility.r / 9.0;\", \"vVisibility *= 1.0 - visibility.g / 9.0;\", \"vVisibility *=       visibility.b / 9.0;\", \"vVisibility *= 1.0 - visibility.a / 9.0;\", \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\", \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\", \"}\", \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\", \"}\"].join(\"\\n\"),\n        fragmentShader: [\"uniform lowp int renderType;\", \"uniform sampler2D map;\", \"uniform float opacity;\", \"uniform vec3 color;\", \"varying vec2 vUV;\", \"varying float vVisibility;\", \"void main() {\", // pink square\n        \"if( renderType == 0 ) {\", \"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\", // restore\n        \"} else if( renderType == 1 ) {\", \"gl_FragColor = texture2D( map, vUV );\", // flare\n        \"} else {\", \"vec4 texture = texture2D( map, vUV );\", \"texture.a *= opacity * vVisibility;\", \"gl_FragColor = texture;\", \"gl_FragColor.rgb *= color;\", \"}\", \"}\"].join(\"\\n\")\n      };\n    } else {\n      shader = {\n        vertexShader: [\"uniform lowp int renderType;\", \"uniform vec3 screenPosition;\", \"uniform vec2 scale;\", \"uniform float rotation;\", \"attribute vec2 position;\", \"attribute vec2 uv;\", \"varying vec2 vUV;\", \"void main() {\", \"vUV = uv;\", \"vec2 pos = position;\", \"if( renderType == 2 ) {\", \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\", \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\", \"}\", \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\", \"}\"].join(\"\\n\"),\n        fragmentShader: [\"precision mediump float;\", \"uniform lowp int renderType;\", \"uniform sampler2D map;\", \"uniform sampler2D occlusionMap;\", \"uniform float opacity;\", \"uniform vec3 color;\", \"varying vec2 vUV;\", \"void main() {\", // pink square\n        \"if( renderType == 0 ) {\", \"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\", // restore\n        \"} else if( renderType == 1 ) {\", \"gl_FragColor = texture2D( map, vUV );\", // flare\n        \"} else {\", \"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\", \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\", \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\", \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\", \"visibility = ( 1.0 - visibility / 4.0 );\", \"vec4 texture = texture2D( map, vUV );\", \"texture.a *= opacity * visibility;\", \"gl_FragColor = texture;\", \"gl_FragColor.rgb *= color;\", \"}\", \"}\"].join(\"\\n\")\n      };\n    }\n\n    program = createProgram(shader);\n    attributes = {\n      vertex: gl.getAttribLocation(program, \"position\"),\n      uv: gl.getAttribLocation(program, \"uv\")\n    };\n    uniforms = {\n      renderType: gl.getUniformLocation(program, \"renderType\"),\n      map: gl.getUniformLocation(program, \"map\"),\n      occlusionMap: gl.getUniformLocation(program, \"occlusionMap\"),\n      opacity: gl.getUniformLocation(program, \"opacity\"),\n      color: gl.getUniformLocation(program, \"color\"),\n      scale: gl.getUniformLocation(program, \"scale\"),\n      rotation: gl.getUniformLocation(program, \"rotation\"),\n      screenPosition: gl.getUniformLocation(program, \"screenPosition\")\n    };\n  };\n  /*\r\n   * Render lens flares\r\n   * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n   *         reads these back and calculates occlusion.\r\n   */\n\n\n  this.render = function (scene, camera, viewportWidth, viewportHeight) {\n    if (flares.length === 0) return;\n    var tempPosition = new THREE.Vector3();\n    var invAspect = viewportHeight / viewportWidth,\n        halfViewportWidth = viewportWidth * 0.5,\n        halfViewportHeight = viewportHeight * 0.5;\n    var size = 16 / viewportHeight,\n        scale = new THREE.Vector2(size * invAspect, size);\n    var screenPosition = new THREE.Vector3(1, 1, 0),\n        screenPositionPixels = new THREE.Vector2(1, 1);\n\n    if (program === undefined) {\n      init();\n    }\n\n    gl.useProgram(program);\n    state.initAttributes();\n    state.enableAttribute(attributes.vertex);\n    state.enableAttribute(attributes.uv);\n    state.disableUnusedAttributes(); // loop through all lens flares to update their occlusion and positions\n    // setup gl and common used attribs/uniforms\n\n    gl.uniform1i(uniforms.occlusionMap, 0);\n    gl.uniform1i(uniforms.map, 1);\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0);\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\n    state.disable(gl.CULL_FACE);\n    gl.depthMask(false);\n\n    for (var i = 0, l = flares.length; i < l; i++) {\n      size = 16 / viewportHeight;\n      scale.set(size * invAspect, size); // calc object screen position\n\n      var flare = flares[i];\n      tempPosition.set(flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14]);\n      tempPosition.applyMatrix4(camera.matrixWorldInverse);\n      tempPosition.applyProjection(camera.projectionMatrix); // setup arrays for gl programs\n\n      screenPosition.copy(tempPosition);\n      screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\n      screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight; // screen cull\n\n      if (hasVertexTexture || screenPositionPixels.x > 0 && screenPositionPixels.x < viewportWidth && screenPositionPixels.y > 0 && screenPositionPixels.y < viewportHeight) {\n        // save current RGB to temp texture\n        state.activeTexture(gl.TEXTURE0);\n        state.bindTexture(gl.TEXTURE_2D, null);\n        state.activeTexture(gl.TEXTURE1);\n        state.bindTexture(gl.TEXTURE_2D, tempTexture);\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0); // render pink quad\n\n        gl.uniform1i(uniforms.renderType, 0);\n        gl.uniform2f(uniforms.scale, scale.x, scale.y);\n        gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\n        state.disable(gl.BLEND);\n        state.enable(gl.DEPTH_TEST);\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0); // copy result to occlusionMap\n\n        state.activeTexture(gl.TEXTURE0);\n        state.bindTexture(gl.TEXTURE_2D, occlusionTexture);\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0); // restore graphics\n\n        gl.uniform1i(uniforms.renderType, 1);\n        state.disable(gl.DEPTH_TEST);\n        state.activeTexture(gl.TEXTURE1);\n        state.bindTexture(gl.TEXTURE_2D, tempTexture);\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0); // update object positions\n\n        flare.positionScreen.copy(screenPosition);\n\n        if (flare.customUpdateCallback) {\n          flare.customUpdateCallback(flare);\n        } else {\n          flare.updateLensFlares();\n        } // render flares\n\n\n        gl.uniform1i(uniforms.renderType, 2);\n        state.enable(gl.BLEND);\n\n        for (var j = 0, jl = flare.lensFlares.length; j < jl; j++) {\n          var sprite = flare.lensFlares[j];\n\n          if (sprite.opacity > 0.001 && sprite.scale > 0.001) {\n            screenPosition.x = sprite.x;\n            screenPosition.y = sprite.y;\n            screenPosition.z = sprite.z;\n            size = sprite.size * sprite.scale / viewportHeight;\n            scale.x = size * invAspect;\n            scale.y = size;\n            gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\n            gl.uniform2f(uniforms.scale, scale.x, scale.y);\n            gl.uniform1f(uniforms.rotation, sprite.rotation);\n            gl.uniform1f(uniforms.opacity, sprite.opacity);\n            gl.uniform3f(uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b);\n            state.setBlending(sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst);\n            renderer.setTexture(sprite.texture, 1);\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n          }\n        }\n      }\n    } // restore gl\n\n\n    state.enable(gl.CULL_FACE);\n    state.enable(gl.DEPTH_TEST);\n    gl.depthMask(true);\n    renderer.resetGLState();\n  };\n\n  function createProgram(shader) {\n    var program = gl.createProgram();\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    var prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\n    gl.shaderSource(fragmentShader, prefix + shader.fragmentShader);\n    gl.shaderSource(vertexShader, prefix + shader.vertexShader);\n    gl.compileShader(fragmentShader);\n    gl.compileShader(vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.linkProgram(program);\n    return program;\n  }\n}; // File:src/renderers/webgl/plugins/SpritePlugin.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\n\nTHREE.SpritePlugin = function (renderer, sprites) {\n  var gl = renderer.context;\n  var state = renderer.state;\n  var vertexBuffer, elementBuffer;\n  var program, attributes, uniforms;\n  var texture; // decompose matrixWorld\n\n  var spritePosition = new THREE.Vector3();\n  var spriteRotation = new THREE.Quaternion();\n  var spriteScale = new THREE.Vector3();\n\n  var init = function () {\n    var vertices = new Float32Array([-0.5, -0.5, 0, 0, 0.5, -0.5, 1, 0, 0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1]);\n    var faces = new Uint16Array([0, 1, 2, 0, 2, 3]);\n    vertexBuffer = gl.createBuffer();\n    elementBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\n    program = createProgram();\n    attributes = {\n      position: gl.getAttribLocation(program, 'position'),\n      uv: gl.getAttribLocation(program, 'uv')\n    };\n    uniforms = {\n      uvOffset: gl.getUniformLocation(program, 'uvOffset'),\n      uvScale: gl.getUniformLocation(program, 'uvScale'),\n      rotation: gl.getUniformLocation(program, 'rotation'),\n      scale: gl.getUniformLocation(program, 'scale'),\n      color: gl.getUniformLocation(program, 'color'),\n      map: gl.getUniformLocation(program, 'map'),\n      opacity: gl.getUniformLocation(program, 'opacity'),\n      modelViewMatrix: gl.getUniformLocation(program, 'modelViewMatrix'),\n      projectionMatrix: gl.getUniformLocation(program, 'projectionMatrix'),\n      fogType: gl.getUniformLocation(program, 'fogType'),\n      fogDensity: gl.getUniformLocation(program, 'fogDensity'),\n      fogNear: gl.getUniformLocation(program, 'fogNear'),\n      fogFar: gl.getUniformLocation(program, 'fogFar'),\n      fogColor: gl.getUniformLocation(program, 'fogColor'),\n      alphaTest: gl.getUniformLocation(program, 'alphaTest')\n    };\n    var canvas = document.createElement('canvas');\n    canvas.width = 8;\n    canvas.height = 8;\n    var context = canvas.getContext('2d');\n    context.fillStyle = 'white';\n    context.fillRect(0, 0, 8, 8);\n    texture = new THREE.Texture(canvas);\n    texture.needsUpdate = true;\n  };\n\n  this.render = function (scene, camera) {\n    if (sprites.length === 0) return; // setup gl\n\n    if (program === undefined) {\n      init();\n    }\n\n    gl.useProgram(program);\n    state.initAttributes();\n    state.enableAttribute(attributes.position);\n    state.enableAttribute(attributes.uv);\n    state.disableUnusedAttributes();\n    state.disable(gl.CULL_FACE);\n    state.enable(gl.BLEND);\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\n    gl.vertexAttribPointer(attributes.position, 2, gl.FLOAT, false, 2 * 8, 0);\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\n    gl.uniformMatrix4fv(uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\n    state.activeTexture(gl.TEXTURE0);\n    gl.uniform1i(uniforms.map, 0);\n    var oldFogType = 0;\n    var sceneFogType = 0;\n    var fog = scene.fog;\n\n    if (fog) {\n      gl.uniform3f(uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b);\n\n      if (fog instanceof THREE.Fog) {\n        gl.uniform1f(uniforms.fogNear, fog.near);\n        gl.uniform1f(uniforms.fogFar, fog.far);\n        gl.uniform1i(uniforms.fogType, 1);\n        oldFogType = 1;\n        sceneFogType = 1;\n      } else if (fog instanceof THREE.FogExp2) {\n        gl.uniform1f(uniforms.fogDensity, fog.density);\n        gl.uniform1i(uniforms.fogType, 2);\n        oldFogType = 2;\n        sceneFogType = 2;\n      }\n    } else {\n      gl.uniform1i(uniforms.fogType, 0);\n      oldFogType = 0;\n      sceneFogType = 0;\n    } // update positions and sort\n\n\n    for (var i = 0, l = sprites.length; i < l; i++) {\n      var sprite = sprites[i];\n      sprite.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, sprite.matrixWorld);\n      sprite.z = -sprite.modelViewMatrix.elements[14];\n    }\n\n    sprites.sort(painterSortStable); // render all sprites\n\n    var scale = [];\n\n    for (var i = 0, l = sprites.length; i < l; i++) {\n      var sprite = sprites[i];\n      var material = sprite.material;\n      gl.uniform1f(uniforms.alphaTest, material.alphaTest);\n      gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, sprite.modelViewMatrix.elements);\n      sprite.matrixWorld.decompose(spritePosition, spriteRotation, spriteScale);\n      scale[0] = spriteScale.x;\n      scale[1] = spriteScale.y;\n      var fogType = 0;\n\n      if (scene.fog && material.fog) {\n        fogType = sceneFogType;\n      }\n\n      if (oldFogType !== fogType) {\n        gl.uniform1i(uniforms.fogType, fogType);\n        oldFogType = fogType;\n      }\n\n      if (material.map !== null) {\n        gl.uniform2f(uniforms.uvOffset, material.map.offset.x, material.map.offset.y);\n        gl.uniform2f(uniforms.uvScale, material.map.repeat.x, material.map.repeat.y);\n      } else {\n        gl.uniform2f(uniforms.uvOffset, 0, 0);\n        gl.uniform2f(uniforms.uvScale, 1, 1);\n      }\n\n      gl.uniform1f(uniforms.opacity, material.opacity);\n      gl.uniform3f(uniforms.color, material.color.r, material.color.g, material.color.b);\n      gl.uniform1f(uniforms.rotation, material.rotation);\n      gl.uniform2fv(uniforms.scale, scale);\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst);\n      state.setDepthTest(material.depthTest);\n      state.setDepthWrite(material.depthWrite);\n\n      if (material.map && material.map.image && material.map.image.width) {\n        renderer.setTexture(material.map, 0);\n      } else {\n        renderer.setTexture(texture, 0);\n      }\n\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\n    } // restore gl\n\n\n    state.enable(gl.CULL_FACE);\n    renderer.resetGLState();\n  };\n\n  function createProgram() {\n    var program = gl.createProgram();\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(vertexShader, ['precision ' + renderer.getPrecision() + ' float;', 'uniform mat4 modelViewMatrix;', 'uniform mat4 projectionMatrix;', 'uniform float rotation;', 'uniform vec2 scale;', 'uniform vec2 uvOffset;', 'uniform vec2 uvScale;', 'attribute vec2 position;', 'attribute vec2 uv;', 'varying vec2 vUV;', 'void main() {', 'vUV = uvOffset + uv * uvScale;', 'vec2 alignedPosition = position * scale;', 'vec2 rotatedPosition;', 'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;', 'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;', 'vec4 finalPosition;', 'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );', 'finalPosition.xy += rotatedPosition;', 'finalPosition = projectionMatrix * finalPosition;', 'gl_Position = finalPosition;', '}'].join('\\n'));\n    gl.shaderSource(fragmentShader, ['precision ' + renderer.getPrecision() + ' float;', 'uniform vec3 color;', 'uniform sampler2D map;', 'uniform float opacity;', 'uniform int fogType;', 'uniform vec3 fogColor;', 'uniform float fogDensity;', 'uniform float fogNear;', 'uniform float fogFar;', 'uniform float alphaTest;', 'varying vec2 vUV;', 'void main() {', 'vec4 texture = texture2D( map, vUV );', 'if ( texture.a < alphaTest ) discard;', 'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );', 'if ( fogType > 0 ) {', 'float depth = gl_FragCoord.z / gl_FragCoord.w;', 'float fogFactor = 0.0;', 'if ( fogType == 1 ) {', 'fogFactor = smoothstep( fogNear, fogFar, depth );', '} else {', 'const float LOG2 = 1.442695;', 'fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );', 'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );', '}', 'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );', '}', '}'].join('\\n'));\n    gl.compileShader(vertexShader);\n    gl.compileShader(fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    return program;\n  }\n\n  function painterSortStable(a, b) {\n    if (a.z !== b.z) {\n      return b.z - a.z;\n    } else {\n      return b.id - a.id;\n    }\n  }\n}; // File:src/extras/GeometryUtils.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.GeometryUtils = {\n  merge: function (geometry1, geometry2, materialIndexOffset) {\n    console.warn('THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.');\n    var matrix;\n\n    if (geometry2 instanceof THREE.Mesh) {\n      geometry2.matrixAutoUpdate && geometry2.updateMatrix();\n      matrix = geometry2.matrix;\n      geometry2 = geometry2.geometry;\n    }\n\n    geometry1.merge(geometry2, matrix, materialIndexOffset);\n  },\n  center: function (geometry) {\n    console.warn('THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.');\n    return geometry.center();\n  }\n}; // File:src/extras/ImageUtils.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\n\nTHREE.ImageUtils = {\n  crossOrigin: undefined,\n  loadTexture: function (url, mapping, onLoad, onError) {\n    var loader = new THREE.ImageLoader();\n    loader.crossOrigin = this.crossOrigin;\n    var texture = new THREE.Texture(undefined, mapping);\n    loader.load(url, function (image) {\n      texture.image = image;\n      texture.needsUpdate = true;\n      if (onLoad) onLoad(texture);\n    }, undefined, function (event) {\n      if (onError) onError(event);\n    });\n    texture.sourceFile = url;\n    return texture;\n  },\n  loadTextureCube: function (array, mapping, onLoad, onError) {\n    var images = [];\n    var loader = new THREE.ImageLoader();\n    loader.crossOrigin = this.crossOrigin;\n    var texture = new THREE.CubeTexture(images, mapping);\n    var loaded = 0;\n\n    var loadTexture = function (i) {\n      loader.load(array[i], function (image) {\n        texture.images[i] = image;\n        loaded += 1;\n\n        if (loaded === 6) {\n          texture.needsUpdate = true;\n          if (onLoad) onLoad(texture);\n        }\n      }, undefined, onError);\n    };\n\n    for (var i = 0, il = array.length; i < il; ++i) {\n      loadTexture(i);\n    }\n\n    return texture;\n  },\n  loadCompressedTexture: function () {\n    console.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.');\n  },\n  loadCompressedTextureCube: function () {\n    console.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.');\n  },\n  getNormalMap: function (image, depth) {\n    // Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\n    var cross = function (a, b) {\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n    };\n\n    var subtract = function (a, b) {\n      return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n    };\n\n    var normalize = function (a) {\n      var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n      return [a[0] / l, a[1] / l, a[2] / l];\n    };\n\n    depth = depth | 1;\n    var width = image.width;\n    var height = image.height;\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    var context = canvas.getContext('2d');\n    context.drawImage(image, 0, 0);\n    var data = context.getImageData(0, 0, width, height).data;\n    var imageData = context.createImageData(width, height);\n    var output = imageData.data;\n\n    for (var x = 0; x < width; x++) {\n      for (var y = 0; y < height; y++) {\n        var ly = y - 1 < 0 ? 0 : y - 1;\n        var uy = y + 1 > height - 1 ? height - 1 : y + 1;\n        var lx = x - 1 < 0 ? 0 : x - 1;\n        var ux = x + 1 > width - 1 ? width - 1 : x + 1;\n        var points = [];\n        var origin = [0, 0, data[(y * width + x) * 4] / 255 * depth];\n        points.push([-1, 0, data[(y * width + lx) * 4] / 255 * depth]);\n        points.push([-1, -1, data[(ly * width + lx) * 4] / 255 * depth]);\n        points.push([0, -1, data[(ly * width + x) * 4] / 255 * depth]);\n        points.push([1, -1, data[(ly * width + ux) * 4] / 255 * depth]);\n        points.push([1, 0, data[(y * width + ux) * 4] / 255 * depth]);\n        points.push([1, 1, data[(uy * width + ux) * 4] / 255 * depth]);\n        points.push([0, 1, data[(uy * width + x) * 4] / 255 * depth]);\n        points.push([-1, 1, data[(uy * width + lx) * 4] / 255 * depth]);\n        var normals = [];\n        var num_points = points.length;\n\n        for (var i = 0; i < num_points; i++) {\n          var v1 = points[i];\n          var v2 = points[(i + 1) % num_points];\n          v1 = subtract(v1, origin);\n          v2 = subtract(v2, origin);\n          normals.push(normalize(cross(v1, v2)));\n        }\n\n        var normal = [0, 0, 0];\n\n        for (var i = 0; i < normals.length; i++) {\n          normal[0] += normals[i][0];\n          normal[1] += normals[i][1];\n          normal[2] += normals[i][2];\n        }\n\n        normal[0] /= normals.length;\n        normal[1] /= normals.length;\n        normal[2] /= normals.length;\n        var idx = (y * width + x) * 4;\n        output[idx] = (normal[0] + 1.0) / 2.0 * 255 | 0;\n        output[idx + 1] = (normal[1] + 1.0) / 2.0 * 255 | 0;\n        output[idx + 2] = normal[2] * 255 | 0;\n        output[idx + 3] = 255;\n      }\n    }\n\n    context.putImageData(imageData, 0, 0);\n    return canvas;\n  },\n  generateDataTexture: function (width, height, color) {\n    var size = width * height;\n    var data = new Uint8Array(3 * size);\n    var r = Math.floor(color.r * 255);\n    var g = Math.floor(color.g * 255);\n    var b = Math.floor(color.b * 255);\n\n    for (var i = 0; i < size; i++) {\n      data[i * 3] = r;\n      data[i * 3 + 1] = g;\n      data[i * 3 + 2] = b;\n    }\n\n    var texture = new THREE.DataTexture(data, width, height, THREE.RGBFormat);\n    texture.needsUpdate = true;\n    return texture;\n  }\n}; // File:src/extras/SceneUtils.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.SceneUtils = {\n  createMultiMaterialObject: function (geometry, materials) {\n    var group = new THREE.Group();\n\n    for (var i = 0, l = materials.length; i < l; i++) {\n      group.add(new THREE.Mesh(geometry, materials[i]));\n    }\n\n    return group;\n  },\n  detach: function (child, parent, scene) {\n    child.applyMatrix(parent.matrixWorld);\n    parent.remove(child);\n    scene.add(child);\n  },\n  attach: function (child, scene, parent) {\n    var matrixWorldInverse = new THREE.Matrix4();\n    matrixWorldInverse.getInverse(parent.matrixWorld);\n    child.applyMatrix(matrixWorldInverse);\n    scene.remove(child);\n    parent.add(child);\n  }\n}; // File:src/extras/FontUtils.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\n\nTHREE.FontUtils = {\n  faces: {},\n  // Just for now. face[weight][style]\n  face: 'helvetiker',\n  weight: 'normal',\n  style: 'normal',\n  size: 150,\n  divisions: 10,\n  getFace: function () {\n    try {\n      return this.faces[this.face.toLowerCase()][this.weight][this.style];\n    } catch (e) {\n      throw \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\";\n    }\n  },\n  loadFace: function (data) {\n    var family = data.familyName.toLowerCase();\n    var ThreeFont = this;\n    ThreeFont.faces[family] = ThreeFont.faces[family] || {};\n    ThreeFont.faces[family][data.cssFontWeight] = ThreeFont.faces[family][data.cssFontWeight] || {};\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\n    return data;\n  },\n  drawText: function (text) {\n    // RenderText\n    var i,\n        face = this.getFace(),\n        scale = this.size / face.resolution,\n        offset = 0,\n        chars = String(text).split(''),\n        length = chars.length;\n    var fontPaths = [];\n\n    for (i = 0; i < length; i++) {\n      var path = new THREE.Path();\n      var ret = this.extractGlyphPoints(chars[i], face, scale, offset, path);\n      offset += ret.offset;\n      fontPaths.push(ret.path);\n    } // get the width\n\n\n    var width = offset / 2; //\n    // for ( p = 0; p < allPts.length; p++ ) {\n    //\n    // \tallPts[ p ].x -= width;\n    //\n    // }\n    //var extract = this.extractPoints( allPts, characterPts );\n    //extract.contour = allPts;\n    //extract.paths = fontPaths;\n    //extract.offset = width;\n\n    return {\n      paths: fontPaths,\n      offset: width\n    };\n  },\n  extractGlyphPoints: function (c, face, scale, offset, path) {\n    var pts = [];\n    var i,\n        i2,\n        divisions,\n        outline,\n        action,\n        length,\n        scaleX,\n        scaleY,\n        x,\n        y,\n        cpx,\n        cpy,\n        cpx0,\n        cpy0,\n        cpx1,\n        cpy1,\n        cpx2,\n        cpy2,\n        laste,\n        glyph = face.glyphs[c] || face.glyphs['?'];\n    if (!glyph) return;\n\n    if (glyph.o) {\n      outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\n      length = outline.length;\n      scaleX = scale;\n      scaleY = scale;\n\n      for (i = 0; i < length;) {\n        action = outline[i++]; //console.log( action );\n\n        switch (action) {\n          case 'm':\n            // Move To\n            x = outline[i++] * scaleX + offset;\n            y = outline[i++] * scaleY;\n            path.moveTo(x, y);\n            break;\n\n          case 'l':\n            // Line To\n            x = outline[i++] * scaleX + offset;\n            y = outline[i++] * scaleY;\n            path.lineTo(x, y);\n            break;\n\n          case 'q':\n            // QuadraticCurveTo\n            cpx = outline[i++] * scaleX + offset;\n            cpy = outline[i++] * scaleY;\n            cpx1 = outline[i++] * scaleX + offset;\n            cpy1 = outline[i++] * scaleY;\n            path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\n            laste = pts[pts.length - 1];\n\n            if (laste) {\n              cpx0 = laste.x;\n              cpy0 = laste.y;\n\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\n                var t = i2 / divisions;\n                THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\n                THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\n              }\n            }\n\n            break;\n\n          case 'b':\n            // Cubic Bezier Curve\n            cpx = outline[i++] * scaleX + offset;\n            cpy = outline[i++] * scaleY;\n            cpx1 = outline[i++] * scaleX + offset;\n            cpy1 = outline[i++] * scaleY;\n            cpx2 = outline[i++] * scaleX + offset;\n            cpy2 = outline[i++] * scaleY;\n            path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\n            laste = pts[pts.length - 1];\n\n            if (laste) {\n              cpx0 = laste.x;\n              cpy0 = laste.y;\n\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\n                var t = i2 / divisions;\n                THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\n                THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\n              }\n            }\n\n            break;\n        }\n      }\n    }\n\n    return {\n      offset: glyph.ha * scale,\n      path: path\n    };\n  }\n};\n\nTHREE.FontUtils.generateShapes = function (text, parameters) {\n  // Parameters\n  parameters = parameters || {};\n  var size = parameters.size !== undefined ? parameters.size : 100;\n  var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\n  var font = parameters.font !== undefined ? parameters.font : 'helvetiker';\n  var weight = parameters.weight !== undefined ? parameters.weight : 'normal';\n  var style = parameters.style !== undefined ? parameters.style : 'normal';\n  THREE.FontUtils.size = size;\n  THREE.FontUtils.divisions = curveSegments;\n  THREE.FontUtils.face = font;\n  THREE.FontUtils.weight = weight;\n  THREE.FontUtils.style = style; // Get a Font data json object\n\n  var data = THREE.FontUtils.drawText(text);\n  var paths = data.paths;\n  var shapes = [];\n\n  for (var p = 0, pl = paths.length; p < pl; p++) {\n    Array.prototype.push.apply(shapes, paths[p].toShapes());\n  }\n\n  return shapes;\n};\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\n\n\n(function (namespace) {\n  var EPSILON = 0.0000000001; // takes in an contour array and returns\n\n  var process = function (contour, indices) {\n    var n = contour.length;\n    if (n < 3) return null;\n    var result = [],\n        verts = [],\n        vertIndices = [];\n    /* we want a counter-clockwise polygon in verts */\n\n    var u, v, w;\n\n    if (area(contour) > 0.0) {\n      for (v = 0; v < n; v++) verts[v] = v;\n    } else {\n      for (v = 0; v < n; v++) verts[v] = n - 1 - v;\n    }\n\n    var nv = n;\n    /*  remove nv - 2 vertices, creating 1 triangle every time */\n\n    var count = 2 * nv;\n    /* error detection */\n\n    for (v = nv - 1; nv > 2;) {\n      /* if we loop, it is probably a non-simple polygon */\n      if (count-- <= 0) {\n        //** Triangulate: ERROR - probable bad polygon!\n        //throw ( \"Warning, unable to triangulate polygon!\" );\n        //return null;\n        // Sometimes warning is fine, especially polygons are triangulated in reverse.\n        console.warn('THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()');\n        if (indices) return vertIndices;\n        return result;\n      }\n      /* three consecutive vertices in current polygon, <u,v,w> */\n\n\n      u = v;\n      if (nv <= u) u = 0;\n      /* previous */\n\n      v = u + 1;\n      if (nv <= v) v = 0;\n      /* new v    */\n\n      w = v + 1;\n      if (nv <= w) w = 0;\n      /* next     */\n\n      if (snip(contour, u, v, w, nv, verts)) {\n        var a, b, c, s, t;\n        /* true names of the vertices */\n\n        a = verts[u];\n        b = verts[v];\n        c = verts[w];\n        /* output Triangle */\n\n        result.push([contour[a], contour[b], contour[c]]);\n        vertIndices.push([verts[u], verts[v], verts[w]]);\n        /* remove v from the remaining polygon */\n\n        for (s = v, t = v + 1; t < nv; s++, t++) {\n          verts[s] = verts[t];\n        }\n\n        nv--;\n        /* reset error detection counter */\n\n        count = 2 * nv;\n      }\n    }\n\n    if (indices) return vertIndices;\n    return result;\n  }; // calculate area of the contour polygon\n\n\n  var area = function (contour) {\n    var n = contour.length;\n    var a = 0.0;\n\n    for (var p = n - 1, q = 0; q < n; p = q++) {\n      a += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\n    }\n\n    return a * 0.5;\n  };\n\n  var snip = function (contour, u, v, w, n, verts) {\n    var p;\n    var ax, ay, bx, by;\n    var cx, cy, px, py;\n    ax = contour[verts[u]].x;\n    ay = contour[verts[u]].y;\n    bx = contour[verts[v]].x;\n    by = contour[verts[v]].y;\n    cx = contour[verts[w]].x;\n    cy = contour[verts[w]].y;\n    if (EPSILON > (bx - ax) * (cy - ay) - (by - ay) * (cx - ax)) return false;\n    var aX, aY, bX, bY, cX, cY;\n    var apx, apy, bpx, bpy, cpx, cpy;\n    var cCROSSap, bCROSScp, aCROSSbp;\n    aX = cx - bx;\n    aY = cy - by;\n    bX = ax - cx;\n    bY = ay - cy;\n    cX = bx - ax;\n    cY = by - ay;\n\n    for (p = 0; p < n; p++) {\n      px = contour[verts[p]].x;\n      py = contour[verts[p]].y;\n      if (px === ax && py === ay || px === bx && py === by || px === cx && py === cy) continue;\n      apx = px - ax;\n      apy = py - ay;\n      bpx = px - bx;\n      bpy = py - by;\n      cpx = px - cx;\n      cpy = py - cy; // see if p is inside triangle abc\n\n      aCROSSbp = aX * bpy - aY * bpx;\n      cCROSSap = cX * apy - cY * apx;\n      bCROSScp = bX * cpy - bY * cpx;\n      if (aCROSSbp >= -EPSILON && bCROSScp >= -EPSILON && cCROSSap >= -EPSILON) return false;\n    }\n\n    return true;\n  };\n\n  namespace.Triangulate = process;\n  namespace.Triangulate.area = area;\n  return namespace;\n})(THREE.FontUtils); // To use the typeface.js face files, hook up the API\n\n\nTHREE.typeface_js = {\n  faces: THREE.FontUtils.faces,\n  loadFace: THREE.FontUtils.loadFace\n};\nif (typeof self !== 'undefined') self._typeface_js = THREE.typeface_js; // File:src/extras/audio/Audio.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.Audio = function (listener) {\n  THREE.Object3D.call(this);\n  this.type = 'Audio';\n  this.context = listener.context;\n  this.source = this.context.createBufferSource();\n  this.source.onended = this.onEnded.bind(this);\n  this.gain = this.context.createGain();\n  this.gain.connect(this.context.destination);\n  this.panner = this.context.createPanner();\n  this.panner.connect(this.gain);\n  this.autoplay = false;\n  this.startTime = 0;\n  this.playbackRate = 1;\n  this.isPlaying = false;\n};\n\nTHREE.Audio.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.Audio.prototype.constructor = THREE.Audio;\n\nTHREE.Audio.prototype.load = function (file) {\n  var scope = this;\n  var request = new XMLHttpRequest();\n  request.open('GET', file, true);\n  request.responseType = 'arraybuffer';\n\n  request.onload = function (e) {\n    scope.context.decodeAudioData(this.response, function (buffer) {\n      scope.source.buffer = buffer;\n      if (scope.autoplay) scope.play();\n    });\n  };\n\n  request.send();\n  return this;\n};\n\nTHREE.Audio.prototype.play = function () {\n  if (this.isPlaying === true) {\n    console.warn('THREE.Audio: Audio is already playing.');\n    return;\n  }\n\n  var source = this.context.createBufferSource();\n  source.buffer = this.source.buffer;\n  source.loop = this.source.loop;\n  source.onended = this.source.onended;\n  source.start(0, this.startTime);\n  source.playbackRate.value = this.playbackRate;\n  this.isPlaying = true;\n  this.source = source;\n  this.connect();\n};\n\nTHREE.Audio.prototype.pause = function () {\n  this.source.stop();\n  this.startTime = this.context.currentTime;\n};\n\nTHREE.Audio.prototype.stop = function () {\n  this.source.stop();\n  this.startTime = 0;\n};\n\nTHREE.Audio.prototype.connect = function () {\n  if (this.filter !== undefined) {\n    this.source.connect(this.filter);\n    this.filter.connect(this.panner);\n  } else {\n    this.source.connect(this.panner);\n  }\n};\n\nTHREE.Audio.prototype.disconnect = function () {\n  if (this.filter !== undefined) {\n    this.source.disconnect(this.filter);\n    this.filter.disconnect(this.panner);\n  } else {\n    this.source.disconnect(this.panner);\n  }\n};\n\nTHREE.Audio.prototype.setFilter = function (value) {\n  if (this.isPlaying === true) {\n    this.disconnect();\n    this.filter = value;\n    this.connect();\n  } else {\n    this.filter = value;\n  }\n};\n\nTHREE.Audio.prototype.getFilter = function () {\n  return this.filter;\n};\n\nTHREE.Audio.prototype.setPlaybackRate = function (value) {\n  this.playbackRate = value;\n\n  if (this.isPlaying === true) {\n    this.source.playbackRate.value = this.playbackRate;\n  }\n};\n\nTHREE.Audio.prototype.getPlaybackRate = function () {\n  return this.playbackRate;\n};\n\nTHREE.Audio.prototype.onEnded = function () {\n  this.isPlaying = false;\n};\n\nTHREE.Audio.prototype.setLoop = function (value) {\n  this.source.loop = value;\n};\n\nTHREE.Audio.prototype.getLoop = function () {\n  return this.source.loop;\n};\n\nTHREE.Audio.prototype.setRefDistance = function (value) {\n  this.panner.refDistance = value;\n};\n\nTHREE.Audio.prototype.getRefDistance = function () {\n  return this.panner.refDistance;\n};\n\nTHREE.Audio.prototype.setRolloffFactor = function (value) {\n  this.panner.rolloffFactor = value;\n};\n\nTHREE.Audio.prototype.getRolloffFactor = function () {\n  return this.panner.rolloffFactor;\n};\n\nTHREE.Audio.prototype.setVolume = function (value) {\n  this.gain.gain.value = value;\n};\n\nTHREE.Audio.prototype.getVolume = function () {\n  return this.gain.gain.value;\n};\n\nTHREE.Audio.prototype.updateMatrixWorld = function () {\n  var position = new THREE.Vector3();\n  return function updateMatrixWorld(force) {\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\n    position.setFromMatrixPosition(this.matrixWorld);\n    this.panner.setPosition(position.x, position.y, position.z);\n  };\n}(); // File:src/extras/audio/AudioListener.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.AudioListener = function () {\n  THREE.Object3D.call(this);\n  this.type = 'AudioListener';\n  this.context = new (window.AudioContext || window.webkitAudioContext)();\n};\n\nTHREE.AudioListener.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\n\nTHREE.AudioListener.prototype.updateMatrixWorld = function () {\n  var position = new THREE.Vector3();\n  var quaternion = new THREE.Quaternion();\n  var scale = new THREE.Vector3();\n  var orientation = new THREE.Vector3();\n  return function updateMatrixWorld(force) {\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\n    var listener = this.context.listener;\n    var up = this.up;\n    this.matrixWorld.decompose(position, quaternion, scale);\n    orientation.set(0, 0, -1).applyQuaternion(quaternion);\n    listener.setPosition(position.x, position.y, position.z);\n    listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\n  };\n}(); // File:src/extras/core/Curve.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\n\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\n\n\nTHREE.Curve = function () {}; // Virtual base class method to overwrite and implement in subclasses\n//\t- t [0 .. 1]\n\n\nTHREE.Curve.prototype.getPoint = function (t) {\n  console.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");\n  return null;\n}; // Get point at relative position in curve according to arc length\n// - u [0 .. 1]\n\n\nTHREE.Curve.prototype.getPointAt = function (u) {\n  var t = this.getUtoTmapping(u);\n  return this.getPoint(t);\n}; // Get sequence of points using getPoint( t )\n\n\nTHREE.Curve.prototype.getPoints = function (divisions) {\n  if (!divisions) divisions = 5;\n  var d,\n      pts = [];\n\n  for (d = 0; d <= divisions; d++) {\n    pts.push(this.getPoint(d / divisions));\n  }\n\n  return pts;\n}; // Get sequence of points using getPointAt( u )\n\n\nTHREE.Curve.prototype.getSpacedPoints = function (divisions) {\n  if (!divisions) divisions = 5;\n  var d,\n      pts = [];\n\n  for (d = 0; d <= divisions; d++) {\n    pts.push(this.getPointAt(d / divisions));\n  }\n\n  return pts;\n}; // Get total curve arc length\n\n\nTHREE.Curve.prototype.getLength = function () {\n  var lengths = this.getLengths();\n  return lengths[lengths.length - 1];\n}; // Get list of cumulative segment lengths\n\n\nTHREE.Curve.prototype.getLengths = function (divisions) {\n  if (!divisions) divisions = this.__arcLengthDivisions ? this.__arcLengthDivisions : 200;\n\n  if (this.cacheArcLengths && this.cacheArcLengths.length === divisions + 1 && !this.needsUpdate) {\n    //console.log( \"cached\", this.cacheArcLengths );\n    return this.cacheArcLengths;\n  }\n\n  this.needsUpdate = false;\n  var cache = [];\n  var current,\n      last = this.getPoint(0);\n  var p,\n      sum = 0;\n  cache.push(0);\n\n  for (p = 1; p <= divisions; p++) {\n    current = this.getPoint(p / divisions);\n    sum += current.distanceTo(last);\n    cache.push(sum);\n    last = current;\n  }\n\n  this.cacheArcLengths = cache;\n  return cache; // { sums: cache, sum:sum }; Sum is in the last element.\n};\n\nTHREE.Curve.prototype.updateArcLengths = function () {\n  this.needsUpdate = true;\n  this.getLengths();\n}; // Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant\n\n\nTHREE.Curve.prototype.getUtoTmapping = function (u, distance) {\n  var arcLengths = this.getLengths();\n  var i = 0,\n      il = arcLengths.length;\n  var targetArcLength; // The targeted u distance value to get\n\n  if (distance) {\n    targetArcLength = distance;\n  } else {\n    targetArcLength = u * arcLengths[il - 1];\n  } //var time = Date.now();\n  // binary search for the index with largest value smaller than target u distance\n\n\n  var low = 0,\n      high = il - 1,\n      comparison;\n\n  while (low <= high) {\n    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\n\n    comparison = arcLengths[i] - targetArcLength;\n\n    if (comparison < 0) {\n      low = i + 1;\n    } else if (comparison > 0) {\n      high = i - 1;\n    } else {\n      high = i;\n      break; // DONE\n    }\n  }\n\n  i = high; //console.log('b' , i, low, high, Date.now()- time);\n\n  if (arcLengths[i] === targetArcLength) {\n    var t = i / (il - 1);\n    return t;\n  } // we could get finer grain at lengths, or use simple interpolation between two points\n\n\n  var lengthBefore = arcLengths[i];\n  var lengthAfter = arcLengths[i + 1];\n  var segmentLength = lengthAfter - lengthBefore; // determine where we are between the 'before' and 'after' points\n\n  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength; // add that fractional amount to t\n\n  var t = (i + segmentFraction) / (il - 1);\n  return t;\n}; // Returns a unit vector tangent at t\n// In case any sub curve does not implement its tangent derivation,\n// 2 points a small delta apart will be used to find its gradient\n// which seems to give a reasonable approximation\n\n\nTHREE.Curve.prototype.getTangent = function (t) {\n  var delta = 0.0001;\n  var t1 = t - delta;\n  var t2 = t + delta; // Capping in case of danger\n\n  if (t1 < 0) t1 = 0;\n  if (t2 > 1) t2 = 1;\n  var pt1 = this.getPoint(t1);\n  var pt2 = this.getPoint(t2);\n  var vec = pt2.clone().sub(pt1);\n  return vec.normalize();\n};\n\nTHREE.Curve.prototype.getTangentAt = function (u) {\n  var t = this.getUtoTmapping(u);\n  return this.getTangent(t);\n};\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\n\n\nTHREE.Curve.Utils = {\n  tangentQuadraticBezier: function (t, p0, p1, p2) {\n    return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\n  },\n  // Puay Bing, thanks for helping with this derivative!\n  tangentCubicBezier: function (t, p0, p1, p2, p3) {\n    return -3 * p0 * (1 - t) * (1 - t) + 3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) + 6 * t * p2 * (1 - t) - 3 * t * t * p2 + 3 * t * t * p3;\n  },\n  tangentSpline: function (t, p0, p1, p2, p3) {\n    // To check if my formulas are correct\n    var h00 = 6 * t * t - 6 * t; // derived from 2t^3  3t^2 + 1\n\n    var h10 = 3 * t * t - 4 * t + 1; // t^3  2t^2 + t\n\n    var h01 = -6 * t * t + 6 * t; //  2t3 + 3t2\n\n    var h11 = 3 * t * t - 2 * t; // t3  t2\n\n    return h00 + h10 + h01 + h11;\n  },\n  // Catmull-Rom\n  interpolate: function (p0, p1, p2, p3, t) {\n    var v0 = (p2 - p0) * 0.5;\n    var v1 = (p3 - p1) * 0.5;\n    var t2 = t * t;\n    var t3 = t * t2;\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n  }\n}; // TODO: Transformation for Curves?\n\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\n// A Factory method for creating new curve subclasses\n\nTHREE.Curve.create = function (constructor, getPointFunc) {\n  constructor.prototype = Object.create(THREE.Curve.prototype);\n  constructor.prototype.constructor = constructor;\n  constructor.prototype.getPoint = getPointFunc;\n  return constructor;\n}; // File:src/extras/core/CurvePath.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\n\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\n\n\nTHREE.CurvePath = function () {\n  this.curves = [];\n  this.bends = [];\n  this.autoClose = false; // Automatically closes the path\n};\n\nTHREE.CurvePath.prototype = Object.create(THREE.Curve.prototype);\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\n\nTHREE.CurvePath.prototype.add = function (curve) {\n  this.curves.push(curve);\n};\n\nTHREE.CurvePath.prototype.checkConnection = function () {// TODO\n  // If the ending of curve is not connected to the starting\n  // or the next curve, then, this is not a real path\n};\n\nTHREE.CurvePath.prototype.closePath = function () {\n  // TODO Test\n  // and verify for vector3 (needs to implement equals)\n  // Add a line curve if start and end of lines are not connected\n  var startPoint = this.curves[0].getPoint(0);\n  var endPoint = this.curves[this.curves.length - 1].getPoint(1);\n\n  if (!startPoint.equals(endPoint)) {\n    this.curves.push(new THREE.LineCurve(endPoint, startPoint));\n  }\n}; // To get accurate point with reference to\n// entire path distance at time t,\n// following has to be done:\n// 1. Length of each sub path have to be known\n// 2. Locate and identify type of curve\n// 3. Get t for the curve\n// 4. Return curve.getPointAt(t')\n\n\nTHREE.CurvePath.prototype.getPoint = function (t) {\n  var d = t * this.getLength();\n  var curveLengths = this.getCurveLengths();\n  var i = 0,\n      diff,\n      curve; // To think about boundaries points.\n\n  while (i < curveLengths.length) {\n    if (curveLengths[i] >= d) {\n      diff = curveLengths[i] - d;\n      curve = this.curves[i];\n      var u = 1 - diff / curve.getLength();\n      return curve.getPointAt(u);\n    }\n\n    i++;\n  }\n\n  return null; // loop where sum != 0, sum > d , sum+1 <d\n};\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\n// getPoint() depends on getLength\n\n\nTHREE.CurvePath.prototype.getLength = function () {\n  var lens = this.getCurveLengths();\n  return lens[lens.length - 1];\n}; // Compute lengths and cache them\n// We cannot overwrite getLengths() because UtoT mapping uses it.\n\n\nTHREE.CurvePath.prototype.getCurveLengths = function () {\n  // We use cache values if curves and cache array are same length\n  if (this.cacheLengths && this.cacheLengths.length === this.curves.length) {\n    return this.cacheLengths;\n  } // Get length of sub-curve\n  // Push sums into cached array\n\n\n  var lengths = [],\n      sums = 0;\n  var i,\n      il = this.curves.length;\n\n  for (i = 0; i < il; i++) {\n    sums += this.curves[i].getLength();\n    lengths.push(sums);\n  }\n\n  this.cacheLengths = lengths;\n  return lengths;\n}; // Returns min and max coordinates\n\n\nTHREE.CurvePath.prototype.getBoundingBox = function () {\n  var points = this.getPoints();\n  var maxX, maxY, maxZ;\n  var minX, minY, minZ;\n  maxX = maxY = Number.NEGATIVE_INFINITY;\n  minX = minY = Number.POSITIVE_INFINITY;\n  var p, i, il, sum;\n  var v3 = points[0] instanceof THREE.Vector3;\n  sum = v3 ? new THREE.Vector3() : new THREE.Vector2();\n\n  for (i = 0, il = points.length; i < il; i++) {\n    p = points[i];\n    if (p.x > maxX) maxX = p.x;else if (p.x < minX) minX = p.x;\n    if (p.y > maxY) maxY = p.y;else if (p.y < minY) minY = p.y;\n\n    if (v3) {\n      if (p.z > maxZ) maxZ = p.z;else if (p.z < minZ) minZ = p.z;\n    }\n\n    sum.add(p);\n  }\n\n  var ret = {\n    minX: minX,\n    minY: minY,\n    maxX: maxX,\n    maxY: maxY\n  };\n\n  if (v3) {\n    ret.maxZ = maxZ;\n    ret.minZ = minZ;\n  }\n\n  return ret;\n};\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\n/// Generate geometry from path points (for Line or Points objects)\n\n\nTHREE.CurvePath.prototype.createPointsGeometry = function (divisions) {\n  var pts = this.getPoints(divisions, true);\n  return this.createGeometry(pts);\n}; // Generate geometry from equidistant sampling along the path\n\n\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function (divisions) {\n  var pts = this.getSpacedPoints(divisions, true);\n  return this.createGeometry(pts);\n};\n\nTHREE.CurvePath.prototype.createGeometry = function (points) {\n  var geometry = new THREE.Geometry();\n\n  for (var i = 0; i < points.length; i++) {\n    geometry.vertices.push(new THREE.Vector3(points[i].x, points[i].y, points[i].z || 0));\n  }\n\n  return geometry;\n};\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\n// Wrap path / Bend modifiers?\n\n\nTHREE.CurvePath.prototype.addWrapPath = function (bendpath) {\n  this.bends.push(bendpath);\n};\n\nTHREE.CurvePath.prototype.getTransformedPoints = function (segments, bends) {\n  var oldPts = this.getPoints(segments); // getPoints getSpacedPoints\n\n  var i, il;\n\n  if (!bends) {\n    bends = this.bends;\n  }\n\n  for (i = 0, il = bends.length; i < il; i++) {\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\n  }\n\n  return oldPts;\n};\n\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function (segments, bends) {\n  var oldPts = this.getSpacedPoints(segments);\n  var i, il;\n\n  if (!bends) {\n    bends = this.bends;\n  }\n\n  for (i = 0, il = bends.length; i < il; i++) {\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\n  }\n\n  return oldPts;\n}; // This returns getPoints() bend/wrapped around the contour of a path.\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\n\n\nTHREE.CurvePath.prototype.getWrapPoints = function (oldPts, path) {\n  var bounds = this.getBoundingBox();\n  var i, il, p, oldX, oldY, xNorm;\n\n  for (i = 0, il = oldPts.length; i < il; i++) {\n    p = oldPts[i];\n    oldX = p.x;\n    oldY = p.y;\n    xNorm = oldX / bounds.maxX; // If using actual distance, for length > path, requires line extrusions\n    //xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\n\n    xNorm = path.getUtoTmapping(xNorm, oldX); // check for out of bounds?\n\n    var pathPt = path.getPoint(xNorm);\n    var normal = path.getTangent(xNorm);\n    normal.set(-normal.y, normal.x).multiplyScalar(oldY);\n    p.x = pathPt.x + normal.x;\n    p.y = pathPt.y + normal.y;\n  }\n\n  return oldPts;\n}; // File:src/extras/core/Path.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\n\n\nTHREE.Path = function (points) {\n  THREE.CurvePath.call(this);\n  this.actions = [];\n\n  if (points) {\n    this.fromPoints(points);\n  }\n};\n\nTHREE.Path.prototype = Object.create(THREE.CurvePath.prototype);\nTHREE.Path.prototype.constructor = THREE.Path;\nTHREE.PathActions = {\n  MOVE_TO: 'moveTo',\n  LINE_TO: 'lineTo',\n  QUADRATIC_CURVE_TO: 'quadraticCurveTo',\n  // Bezier quadratic curve\n  BEZIER_CURVE_TO: 'bezierCurveTo',\n  // Bezier cubic curve\n  CSPLINE_THRU: 'splineThru',\n  // Catmull-Rom spline\n  ARC: 'arc',\n  // Circle\n  ELLIPSE: 'ellipse'\n}; // TODO Clean up PATH API\n// Create path using straight lines to connect all points\n// - vectors: array of Vector2\n\nTHREE.Path.prototype.fromPoints = function (vectors) {\n  this.moveTo(vectors[0].x, vectors[0].y);\n\n  for (var v = 1, vlen = vectors.length; v < vlen; v++) {\n    this.lineTo(vectors[v].x, vectors[v].y);\n  }\n}; // startPath() endPath()?\n\n\nTHREE.Path.prototype.moveTo = function (x, y) {\n  var args = Array.prototype.slice.call(arguments);\n  this.actions.push({\n    action: THREE.PathActions.MOVE_TO,\n    args: args\n  });\n};\n\nTHREE.Path.prototype.lineTo = function (x, y) {\n  var args = Array.prototype.slice.call(arguments);\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1];\n  var curve = new THREE.LineCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(x, y));\n  this.curves.push(curve);\n  this.actions.push({\n    action: THREE.PathActions.LINE_TO,\n    args: args\n  });\n};\n\nTHREE.Path.prototype.quadraticCurveTo = function (aCPx, aCPy, aX, aY) {\n  var args = Array.prototype.slice.call(arguments);\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1];\n  var curve = new THREE.QuadraticBezierCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(aCPx, aCPy), new THREE.Vector2(aX, aY));\n  this.curves.push(curve);\n  this.actions.push({\n    action: THREE.PathActions.QUADRATIC_CURVE_TO,\n    args: args\n  });\n};\n\nTHREE.Path.prototype.bezierCurveTo = function (aCP1x, aCP1y, aCP2x, aCP2y, aX, aY) {\n  var args = Array.prototype.slice.call(arguments);\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1];\n  var curve = new THREE.CubicBezierCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(aCP1x, aCP1y), new THREE.Vector2(aCP2x, aCP2y), new THREE.Vector2(aX, aY));\n  this.curves.push(curve);\n  this.actions.push({\n    action: THREE.PathActions.BEZIER_CURVE_TO,\n    args: args\n  });\n};\n\nTHREE.Path.prototype.splineThru = function (pts\n/*Array of Vector*/\n) {\n  var args = Array.prototype.slice.call(arguments);\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1]; //---\n\n  var npts = [new THREE.Vector2(x0, y0)];\n  Array.prototype.push.apply(npts, pts);\n  var curve = new THREE.SplineCurve(npts);\n  this.curves.push(curve);\n  this.actions.push({\n    action: THREE.PathActions.CSPLINE_THRU,\n    args: args\n  });\n}; // FUTURE: Change the API or follow canvas API?\n\n\nTHREE.Path.prototype.arc = function (aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1];\n  this.absarc(aX + x0, aY + y0, aRadius, aStartAngle, aEndAngle, aClockwise);\n};\n\nTHREE.Path.prototype.absarc = function (aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\n  this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\n};\n\nTHREE.Path.prototype.ellipse = function (aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation) {\n  var lastargs = this.actions[this.actions.length - 1].args;\n  var x0 = lastargs[lastargs.length - 2];\n  var y0 = lastargs[lastargs.length - 1];\n  this.absellipse(aX + x0, aY + y0, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation);\n};\n\nTHREE.Path.prototype.absellipse = function (aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation) {\n  var args = [aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation || 0 // aRotation is optional.\n  ];\n  var curve = new THREE.EllipseCurve(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation);\n  this.curves.push(curve);\n  var lastPoint = curve.getPoint(1);\n  args.push(lastPoint.x);\n  args.push(lastPoint.y);\n  this.actions.push({\n    action: THREE.PathActions.ELLIPSE,\n    args: args\n  });\n};\n\nTHREE.Path.prototype.getSpacedPoints = function (divisions, closedPath) {\n  if (!divisions) divisions = 40;\n  var points = [];\n\n  for (var i = 0; i < divisions; i++) {\n    points.push(this.getPoint(i / divisions)); //if( !this.getPoint( i / divisions ) ) throw \"DIE\";\n  } // if ( closedPath ) {\n  //\n  // \tpoints.push( points[ 0 ] );\n  //\n  // }\n\n\n  return points;\n};\n/* Return an array of vectors based on contour of the path */\n\n\nTHREE.Path.prototype.getPoints = function (divisions, closedPath) {\n  if (this.useSpacedPoints) {\n    return this.getSpacedPoints(divisions, closedPath);\n  }\n\n  divisions = divisions || 12;\n  var points = [];\n  var i, il, item, action, args;\n  var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0, laste, j, t, tx, ty;\n\n  for (i = 0, il = this.actions.length; i < il; i++) {\n    item = this.actions[i];\n    action = item.action;\n    args = item.args;\n\n    switch (action) {\n      case THREE.PathActions.MOVE_TO:\n        points.push(new THREE.Vector2(args[0], args[1]));\n        break;\n\n      case THREE.PathActions.LINE_TO:\n        points.push(new THREE.Vector2(args[0], args[1]));\n        break;\n\n      case THREE.PathActions.QUADRATIC_CURVE_TO:\n        cpx = args[2];\n        cpy = args[3];\n        cpx1 = args[0];\n        cpy1 = args[1];\n\n        if (points.length > 0) {\n          laste = points[points.length - 1];\n          cpx0 = laste.x;\n          cpy0 = laste.y;\n        } else {\n          laste = this.actions[i - 1].args;\n          cpx0 = laste[laste.length - 2];\n          cpy0 = laste[laste.length - 1];\n        }\n\n        for (j = 1; j <= divisions; j++) {\n          t = j / divisions;\n          tx = THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\n          ty = THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\n          points.push(new THREE.Vector2(tx, ty));\n        }\n\n        break;\n\n      case THREE.PathActions.BEZIER_CURVE_TO:\n        cpx = args[4];\n        cpy = args[5];\n        cpx1 = args[0];\n        cpy1 = args[1];\n        cpx2 = args[2];\n        cpy2 = args[3];\n\n        if (points.length > 0) {\n          laste = points[points.length - 1];\n          cpx0 = laste.x;\n          cpy0 = laste.y;\n        } else {\n          laste = this.actions[i - 1].args;\n          cpx0 = laste[laste.length - 2];\n          cpy0 = laste[laste.length - 1];\n        }\n\n        for (j = 1; j <= divisions; j++) {\n          t = j / divisions;\n          tx = THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\n          ty = THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\n          points.push(new THREE.Vector2(tx, ty));\n        }\n\n        break;\n\n      case THREE.PathActions.CSPLINE_THRU:\n        laste = this.actions[i - 1].args;\n        var last = new THREE.Vector2(laste[laste.length - 2], laste[laste.length - 1]);\n        var spts = [last];\n        var n = divisions * args[0].length;\n        spts = spts.concat(args[0]);\n        var spline = new THREE.SplineCurve(spts);\n\n        for (j = 1; j <= n; j++) {\n          points.push(spline.getPointAt(j / n));\n        }\n\n        break;\n\n      case THREE.PathActions.ARC:\n        var aX = args[0],\n            aY = args[1],\n            aRadius = args[2],\n            aStartAngle = args[3],\n            aEndAngle = args[4],\n            aClockwise = !!args[5];\n        var deltaAngle = aEndAngle - aStartAngle;\n        var angle;\n        var tdivisions = divisions * 2;\n\n        for (j = 1; j <= tdivisions; j++) {\n          t = j / tdivisions;\n\n          if (!aClockwise) {\n            t = 1 - t;\n          }\n\n          angle = aStartAngle + t * deltaAngle;\n          tx = aX + aRadius * Math.cos(angle);\n          ty = aY + aRadius * Math.sin(angle); //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\n\n          points.push(new THREE.Vector2(tx, ty));\n        } //console.log(points);\n\n\n        break;\n\n      case THREE.PathActions.ELLIPSE:\n        var aX = args[0],\n            aY = args[1],\n            xRadius = args[2],\n            yRadius = args[3],\n            aStartAngle = args[4],\n            aEndAngle = args[5],\n            aClockwise = !!args[6],\n            aRotation = args[7];\n        var deltaAngle = aEndAngle - aStartAngle;\n        var angle;\n        var tdivisions = divisions * 2;\n        var cos, sin;\n\n        if (aRotation !== 0) {\n          cos = Math.cos(aRotation);\n          sin = Math.sin(aRotation);\n        }\n\n        for (j = 1; j <= tdivisions; j++) {\n          t = j / tdivisions;\n\n          if (!aClockwise) {\n            t = 1 - t;\n          }\n\n          angle = aStartAngle + t * deltaAngle;\n          tx = aX + xRadius * Math.cos(angle);\n          ty = aY + yRadius * Math.sin(angle);\n\n          if (aRotation !== 0) {\n            var x = tx,\n                y = ty; // Rotate the point about the center of the ellipse.\n\n            tx = (x - aX) * cos - (y - aY) * sin + aX;\n            ty = (x - aX) * sin + (y - aY) * cos + aY;\n          } //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\n\n\n          points.push(new THREE.Vector2(tx, ty));\n        } //console.log(points);\n\n\n        break;\n    } // end switch\n\n  } // Normalize to remove the closing point by default.\n\n\n  var lastPoint = points[points.length - 1];\n  var EPSILON = 0.0000000001;\n  if (Math.abs(lastPoint.x - points[0].x) < EPSILON && Math.abs(lastPoint.y - points[0].y) < EPSILON) points.splice(points.length - 1, 1);\n\n  if (closedPath) {\n    points.push(points[0]);\n  }\n\n  return points;\n}; //\n// Breaks path into shapes\n//\n//\tAssumptions (if parameter isCCW==true the opposite holds):\n//\t- solid shapes are defined clockwise (CW)\n//\t- holes are defined counterclockwise (CCW)\n//\n//\tIf parameter noHoles==true:\n//  - all subPaths are regarded as solid shapes\n//  - definition order CW/CCW has no relevance\n//\n\n\nTHREE.Path.prototype.toShapes = function (isCCW, noHoles) {\n  function extractSubpaths(inActions) {\n    var i, il, item, action, args;\n    var subPaths = [],\n        lastPath = new THREE.Path();\n\n    for (i = 0, il = inActions.length; i < il; i++) {\n      item = inActions[i];\n      args = item.args;\n      action = item.action;\n\n      if (action === THREE.PathActions.MOVE_TO) {\n        if (lastPath.actions.length !== 0) {\n          subPaths.push(lastPath);\n          lastPath = new THREE.Path();\n        }\n      }\n\n      lastPath[action].apply(lastPath, args);\n    }\n\n    if (lastPath.actions.length !== 0) {\n      subPaths.push(lastPath);\n    } // console.log(subPaths);\n\n\n    return subPaths;\n  }\n\n  function toShapesNoHoles(inSubpaths) {\n    var shapes = [];\n\n    for (var i = 0, il = inSubpaths.length; i < il; i++) {\n      var tmpPath = inSubpaths[i];\n      var tmpShape = new THREE.Shape();\n      tmpShape.actions = tmpPath.actions;\n      tmpShape.curves = tmpPath.curves;\n      shapes.push(tmpShape);\n    } //console.log(\"shape\", shapes);\n\n\n    return shapes;\n  }\n\n  function isPointInsidePolygon(inPt, inPolygon) {\n    var EPSILON = 0.0000000001;\n    var polyLen = inPolygon.length; // inPt on polygon contour => immediate success    or\n    // toggling of inside/outside at every single! intersection point of an edge\n    //  with the horizontal line through inPt, left of inPt\n    //  not counting lowerY endpoints of edges and whole edges on that line\n\n    var inside = false;\n\n    for (var p = polyLen - 1, q = 0; q < polyLen; p = q++) {\n      var edgeLowPt = inPolygon[p];\n      var edgeHighPt = inPolygon[q];\n      var edgeDx = edgeHighPt.x - edgeLowPt.x;\n      var edgeDy = edgeHighPt.y - edgeLowPt.y;\n\n      if (Math.abs(edgeDy) > EPSILON) {\n        // not parallel\n        if (edgeDy < 0) {\n          edgeLowPt = inPolygon[q];\n          edgeDx = -edgeDx;\n          edgeHighPt = inPolygon[p];\n          edgeDy = -edgeDy;\n        }\n\n        if (inPt.y < edgeLowPt.y || inPt.y > edgeHighPt.y) continue;\n\n        if (inPt.y === edgeLowPt.y) {\n          if (inPt.x === edgeLowPt.x) return true; // inPt is on contour ?\n          // continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\n        } else {\n          var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\n          if (perpEdge === 0) return true; // inPt is on contour ?\n\n          if (perpEdge < 0) continue;\n          inside = !inside; // true intersection left of inPt\n        }\n      } else {\n        // parallel or collinear\n        if (inPt.y !== edgeLowPt.y) continue; // parallel\n        // edge lies on the same horizontal line as inPt\n\n        if (edgeHighPt.x <= inPt.x && inPt.x <= edgeLowPt.x || edgeLowPt.x <= inPt.x && inPt.x <= edgeHighPt.x) return true; // inPt: Point on contour !\n        // continue;\n      }\n    }\n\n    return inside;\n  }\n\n  var subPaths = extractSubpaths(this.actions);\n  if (subPaths.length === 0) return [];\n  if (noHoles === true) return toShapesNoHoles(subPaths);\n  var solid,\n      tmpPath,\n      tmpShape,\n      shapes = [];\n\n  if (subPaths.length === 1) {\n    tmpPath = subPaths[0];\n    tmpShape = new THREE.Shape();\n    tmpShape.actions = tmpPath.actions;\n    tmpShape.curves = tmpPath.curves;\n    shapes.push(tmpShape);\n    return shapes;\n  }\n\n  var holesFirst = !THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());\n  holesFirst = isCCW ? !holesFirst : holesFirst; // console.log(\"Holes first\", holesFirst);\n\n  var betterShapeHoles = [];\n  var newShapes = [];\n  var newShapeHoles = [];\n  var mainIdx = 0;\n  var tmpPoints;\n  newShapes[mainIdx] = undefined;\n  newShapeHoles[mainIdx] = [];\n  var i, il;\n\n  for (i = 0, il = subPaths.length; i < il; i++) {\n    tmpPath = subPaths[i];\n    tmpPoints = tmpPath.getPoints();\n    solid = THREE.Shape.Utils.isClockWise(tmpPoints);\n    solid = isCCW ? !solid : solid;\n\n    if (solid) {\n      if (!holesFirst && newShapes[mainIdx]) mainIdx++;\n      newShapes[mainIdx] = {\n        s: new THREE.Shape(),\n        p: tmpPoints\n      };\n      newShapes[mainIdx].s.actions = tmpPath.actions;\n      newShapes[mainIdx].s.curves = tmpPath.curves;\n      if (holesFirst) mainIdx++;\n      newShapeHoles[mainIdx] = []; //console.log('cw', i);\n    } else {\n      newShapeHoles[mainIdx].push({\n        h: tmpPath,\n        p: tmpPoints[0]\n      }); //console.log('ccw', i);\n    }\n  } // only Holes? -> probably all Shapes with wrong orientation\n\n\n  if (!newShapes[0]) return toShapesNoHoles(subPaths);\n\n  if (newShapes.length > 1) {\n    var ambiguous = false;\n    var toChange = [];\n\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\n      betterShapeHoles[sIdx] = [];\n    }\n\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\n      var sho = newShapeHoles[sIdx];\n\n      for (var hIdx = 0; hIdx < sho.length; hIdx++) {\n        var ho = sho[hIdx];\n        var hole_unassigned = true;\n\n        for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx++) {\n          if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p)) {\n            if (sIdx !== s2Idx) toChange.push({\n              froms: sIdx,\n              tos: s2Idx,\n              hole: hIdx\n            });\n\n            if (hole_unassigned) {\n              hole_unassigned = false;\n              betterShapeHoles[s2Idx].push(ho);\n            } else {\n              ambiguous = true;\n            }\n          }\n        }\n\n        if (hole_unassigned) {\n          betterShapeHoles[sIdx].push(ho);\n        }\n      }\n    } // console.log(\"ambiguous: \", ambiguous);\n\n\n    if (toChange.length > 0) {\n      // console.log(\"to change: \", toChange);\n      if (!ambiguous) newShapeHoles = betterShapeHoles;\n    }\n  }\n\n  var tmpHoles, j, jl;\n\n  for (i = 0, il = newShapes.length; i < il; i++) {\n    tmpShape = newShapes[i].s;\n    shapes.push(tmpShape);\n    tmpHoles = newShapeHoles[i];\n\n    for (j = 0, jl = tmpHoles.length; j < jl; j++) {\n      tmpShape.holes.push(tmpHoles[j].h);\n    }\n  } //console.log(\"shape\", shapes);\n\n\n  return shapes;\n}; // File:src/extras/core/Shape.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\n// STEP 1 Create a path.\n// STEP 2 Turn path into shape.\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\n// STEP 3a - Extract points from each shape, turn to vertices\n// STEP 3b - Triangulate each shape, add faces.\n\n\nTHREE.Shape = function () {\n  THREE.Path.apply(this, arguments);\n  this.holes = [];\n};\n\nTHREE.Shape.prototype = Object.create(THREE.Path.prototype);\nTHREE.Shape.prototype.constructor = THREE.Shape; // Convenience method to return ExtrudeGeometry\n\nTHREE.Shape.prototype.extrude = function (options) {\n  var extruded = new THREE.ExtrudeGeometry(this, options);\n  return extruded;\n}; // Convenience method to return ShapeGeometry\n\n\nTHREE.Shape.prototype.makeGeometry = function (options) {\n  var geometry = new THREE.ShapeGeometry(this, options);\n  return geometry;\n}; // Get points of holes\n\n\nTHREE.Shape.prototype.getPointsHoles = function (divisions) {\n  var i,\n      il = this.holes.length,\n      holesPts = [];\n\n  for (i = 0; i < il; i++) {\n    holesPts[i] = this.holes[i].getTransformedPoints(divisions, this.bends);\n  }\n\n  return holesPts;\n}; // Get points of holes (spaced by regular distance)\n\n\nTHREE.Shape.prototype.getSpacedPointsHoles = function (divisions) {\n  var i,\n      il = this.holes.length,\n      holesPts = [];\n\n  for (i = 0; i < il; i++) {\n    holesPts[i] = this.holes[i].getTransformedSpacedPoints(divisions, this.bends);\n  }\n\n  return holesPts;\n}; // Get points of shape and holes (keypoints based on segments parameter)\n\n\nTHREE.Shape.prototype.extractAllPoints = function (divisions) {\n  return {\n    shape: this.getTransformedPoints(divisions),\n    holes: this.getPointsHoles(divisions)\n  };\n};\n\nTHREE.Shape.prototype.extractPoints = function (divisions) {\n  if (this.useSpacedPoints) {\n    return this.extractAllSpacedPoints(divisions);\n  }\n\n  return this.extractAllPoints(divisions);\n}; //\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\n//\n// \treturn {\n//\n// \t\tshape: this.transform( bend, divisions ),\n// \t\tholes: this.getPointsHoles( divisions, bend )\n//\n// \t};\n//\n// };\n// Get points of shape and holes (spaced by regular distance)\n\n\nTHREE.Shape.prototype.extractAllSpacedPoints = function (divisions) {\n  return {\n    shape: this.getTransformedSpacedPoints(divisions),\n    holes: this.getSpacedPointsHoles(divisions)\n  };\n};\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\n\n\nTHREE.Shape.Utils = {\n  triangulateShape: function (contour, holes) {\n    function point_in_segment_2D_colin(inSegPt1, inSegPt2, inOtherPt) {\n      // inOtherPt needs to be collinear to the inSegment\n      if (inSegPt1.x !== inSegPt2.x) {\n        if (inSegPt1.x < inSegPt2.x) {\n          return inSegPt1.x <= inOtherPt.x && inOtherPt.x <= inSegPt2.x;\n        } else {\n          return inSegPt2.x <= inOtherPt.x && inOtherPt.x <= inSegPt1.x;\n        }\n      } else {\n        if (inSegPt1.y < inSegPt2.y) {\n          return inSegPt1.y <= inOtherPt.y && inOtherPt.y <= inSegPt2.y;\n        } else {\n          return inSegPt2.y <= inOtherPt.y && inOtherPt.y <= inSegPt1.y;\n        }\n      }\n    }\n\n    function intersect_segments_2D(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs) {\n      var EPSILON = 0.0000000001;\n      var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,\n          seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\n      var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,\n          seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\n      var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\n      var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\n      var limit = seg1dy * seg2dx - seg1dx * seg2dy;\n      var perpSeg1 = seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\n\n      if (Math.abs(limit) > EPSILON) {\n        // not parallel\n        var perpSeg2;\n\n        if (limit > 0) {\n          if (perpSeg1 < 0 || perpSeg1 > limit) return [];\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\n          if (perpSeg2 < 0 || perpSeg2 > limit) return [];\n        } else {\n          if (perpSeg1 > 0 || perpSeg1 < limit) return [];\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\n          if (perpSeg2 > 0 || perpSeg2 < limit) return [];\n        } // i.e. to reduce rounding errors\n        // intersection at endpoint of segment#1?\n\n\n        if (perpSeg2 === 0) {\n          if (inExcludeAdjacentSegs && (perpSeg1 === 0 || perpSeg1 === limit)) return [];\n          return [inSeg1Pt1];\n        }\n\n        if (perpSeg2 === limit) {\n          if (inExcludeAdjacentSegs && (perpSeg1 === 0 || perpSeg1 === limit)) return [];\n          return [inSeg1Pt2];\n        } // intersection at endpoint of segment#2?\n\n\n        if (perpSeg1 === 0) return [inSeg2Pt1];\n        if (perpSeg1 === limit) return [inSeg2Pt2]; // return real intersection point\n\n        var factorSeg1 = perpSeg2 / limit;\n        return [{\n          x: inSeg1Pt1.x + factorSeg1 * seg1dx,\n          y: inSeg1Pt1.y + factorSeg1 * seg1dy\n        }];\n      } else {\n        // parallel or collinear\n        if (perpSeg1 !== 0 || seg2dy * seg1seg2dx !== seg2dx * seg1seg2dy) return []; // they are collinear or degenerate\n\n        var seg1Pt = seg1dx === 0 && seg1dy === 0; // segment1 is just a point?\n\n        var seg2Pt = seg2dx === 0 && seg2dy === 0; // segment2 is just a point?\n        // both segments are points\n\n        if (seg1Pt && seg2Pt) {\n          if (inSeg1Pt1.x !== inSeg2Pt1.x || inSeg1Pt1.y !== inSeg2Pt1.y) return []; // they are distinct  points\n\n          return [inSeg1Pt1]; // they are the same point\n        } // segment#1  is a single point\n\n\n        if (seg1Pt) {\n          if (!point_in_segment_2D_colin(inSeg2Pt1, inSeg2Pt2, inSeg1Pt1)) return []; // but not in segment#2\n\n          return [inSeg1Pt1];\n        } // segment#2  is a single point\n\n\n        if (seg2Pt) {\n          if (!point_in_segment_2D_colin(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1)) return []; // but not in segment#1\n\n          return [inSeg2Pt1];\n        } // they are collinear segments, which might overlap\n\n\n        var seg1min, seg1max, seg1minVal, seg1maxVal;\n        var seg2min, seg2max, seg2minVal, seg2maxVal;\n\n        if (seg1dx !== 0) {\n          // the segments are NOT on a vertical line\n          if (inSeg1Pt1.x < inSeg1Pt2.x) {\n            seg1min = inSeg1Pt1;\n            seg1minVal = inSeg1Pt1.x;\n            seg1max = inSeg1Pt2;\n            seg1maxVal = inSeg1Pt2.x;\n          } else {\n            seg1min = inSeg1Pt2;\n            seg1minVal = inSeg1Pt2.x;\n            seg1max = inSeg1Pt1;\n            seg1maxVal = inSeg1Pt1.x;\n          }\n\n          if (inSeg2Pt1.x < inSeg2Pt2.x) {\n            seg2min = inSeg2Pt1;\n            seg2minVal = inSeg2Pt1.x;\n            seg2max = inSeg2Pt2;\n            seg2maxVal = inSeg2Pt2.x;\n          } else {\n            seg2min = inSeg2Pt2;\n            seg2minVal = inSeg2Pt2.x;\n            seg2max = inSeg2Pt1;\n            seg2maxVal = inSeg2Pt1.x;\n          }\n        } else {\n          // the segments are on a vertical line\n          if (inSeg1Pt1.y < inSeg1Pt2.y) {\n            seg1min = inSeg1Pt1;\n            seg1minVal = inSeg1Pt1.y;\n            seg1max = inSeg1Pt2;\n            seg1maxVal = inSeg1Pt2.y;\n          } else {\n            seg1min = inSeg1Pt2;\n            seg1minVal = inSeg1Pt2.y;\n            seg1max = inSeg1Pt1;\n            seg1maxVal = inSeg1Pt1.y;\n          }\n\n          if (inSeg2Pt1.y < inSeg2Pt2.y) {\n            seg2min = inSeg2Pt1;\n            seg2minVal = inSeg2Pt1.y;\n            seg2max = inSeg2Pt2;\n            seg2maxVal = inSeg2Pt2.y;\n          } else {\n            seg2min = inSeg2Pt2;\n            seg2minVal = inSeg2Pt2.y;\n            seg2max = inSeg2Pt1;\n            seg2maxVal = inSeg2Pt1.y;\n          }\n        }\n\n        if (seg1minVal <= seg2minVal) {\n          if (seg1maxVal < seg2minVal) return [];\n\n          if (seg1maxVal === seg2minVal) {\n            if (inExcludeAdjacentSegs) return [];\n            return [seg2min];\n          }\n\n          if (seg1maxVal <= seg2maxVal) return [seg2min, seg1max];\n          return [seg2min, seg2max];\n        } else {\n          if (seg1minVal > seg2maxVal) return [];\n\n          if (seg1minVal === seg2maxVal) {\n            if (inExcludeAdjacentSegs) return [];\n            return [seg1min];\n          }\n\n          if (seg1maxVal <= seg2maxVal) return [seg1min, seg1max];\n          return [seg1min, seg2max];\n        }\n      }\n    }\n\n    function isPointInsideAngle(inVertex, inLegFromPt, inLegToPt, inOtherPt) {\n      // The order of legs is important\n      var EPSILON = 0.0000000001; // translation of all points, so that Vertex is at (0,0)\n\n      var legFromPtX = inLegFromPt.x - inVertex.x,\n          legFromPtY = inLegFromPt.y - inVertex.y;\n      var legToPtX = inLegToPt.x - inVertex.x,\n          legToPtY = inLegToPt.y - inVertex.y;\n      var otherPtX = inOtherPt.x - inVertex.x,\n          otherPtY = inOtherPt.y - inVertex.y; // main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\n\n      var from2toAngle = legFromPtX * legToPtY - legFromPtY * legToPtX;\n      var from2otherAngle = legFromPtX * otherPtY - legFromPtY * otherPtX;\n\n      if (Math.abs(from2toAngle) > EPSILON) {\n        // angle != 180 deg.\n        var other2toAngle = otherPtX * legToPtY - otherPtY * legToPtX; // console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\n\n        if (from2toAngle > 0) {\n          // main angle < 180 deg.\n          return from2otherAngle >= 0 && other2toAngle >= 0;\n        } else {\n          // main angle > 180 deg.\n          return from2otherAngle >= 0 || other2toAngle >= 0;\n        }\n      } else {\n        // angle == 180 deg.\n        // console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\n        return from2otherAngle > 0;\n      }\n    }\n\n    function removeHoles(contour, holes) {\n      var shape = contour.concat(); // work on this shape\n\n      var hole;\n\n      function isCutLineInsideAngles(inShapeIdx, inHoleIdx) {\n        // Check if hole point lies within angle around shape point\n        var lastShapeIdx = shape.length - 1;\n        var prevShapeIdx = inShapeIdx - 1;\n        if (prevShapeIdx < 0) prevShapeIdx = lastShapeIdx;\n        var nextShapeIdx = inShapeIdx + 1;\n        if (nextShapeIdx > lastShapeIdx) nextShapeIdx = 0;\n        var insideAngle = isPointInsideAngle(shape[inShapeIdx], shape[prevShapeIdx], shape[nextShapeIdx], hole[inHoleIdx]);\n\n        if (!insideAngle) {\n          // console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\n          return false;\n        } // Check if shape point lies within angle around hole point\n\n\n        var lastHoleIdx = hole.length - 1;\n        var prevHoleIdx = inHoleIdx - 1;\n        if (prevHoleIdx < 0) prevHoleIdx = lastHoleIdx;\n        var nextHoleIdx = inHoleIdx + 1;\n        if (nextHoleIdx > lastHoleIdx) nextHoleIdx = 0;\n        insideAngle = isPointInsideAngle(hole[inHoleIdx], hole[prevHoleIdx], hole[nextHoleIdx], shape[inShapeIdx]);\n\n        if (!insideAngle) {\n          // console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\n          return false;\n        }\n\n        return true;\n      }\n\n      function intersectsShapeEdge(inShapePt, inHolePt) {\n        // checks for intersections with shape edges\n        var sIdx, nextIdx, intersection;\n\n        for (sIdx = 0; sIdx < shape.length; sIdx++) {\n          nextIdx = sIdx + 1;\n          nextIdx %= shape.length;\n          intersection = intersect_segments_2D(inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true);\n          if (intersection.length > 0) return true;\n        }\n\n        return false;\n      }\n\n      var indepHoles = [];\n\n      function intersectsHoleEdge(inShapePt, inHolePt) {\n        // checks for intersections with hole edges\n        var ihIdx, chkHole, hIdx, nextIdx, intersection;\n\n        for (ihIdx = 0; ihIdx < indepHoles.length; ihIdx++) {\n          chkHole = holes[indepHoles[ihIdx]];\n\n          for (hIdx = 0; hIdx < chkHole.length; hIdx++) {\n            nextIdx = hIdx + 1;\n            nextIdx %= chkHole.length;\n            intersection = intersect_segments_2D(inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true);\n            if (intersection.length > 0) return true;\n          }\n        }\n\n        return false;\n      }\n\n      var holeIndex,\n          shapeIndex,\n          shapePt,\n          holePt,\n          holeIdx,\n          cutKey,\n          failedCuts = [],\n          tmpShape1,\n          tmpShape2,\n          tmpHole1,\n          tmpHole2;\n\n      for (var h = 0, hl = holes.length; h < hl; h++) {\n        indepHoles.push(h);\n      }\n\n      var minShapeIndex = 0;\n      var counter = indepHoles.length * 2;\n\n      while (indepHoles.length > 0) {\n        counter--;\n\n        if (counter < 0) {\n          console.log(\"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\");\n          break;\n        } // search for shape-vertex and hole-vertex,\n        // which can be connected without intersections\n\n\n        for (shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex++) {\n          shapePt = shape[shapeIndex];\n          holeIndex = -1; // search for hole which can be reached without intersections\n\n          for (var h = 0; h < indepHoles.length; h++) {\n            holeIdx = indepHoles[h]; // prevent multiple checks\n\n            cutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\n            if (failedCuts[cutKey] !== undefined) continue;\n            hole = holes[holeIdx];\n\n            for (var h2 = 0; h2 < hole.length; h2++) {\n              holePt = hole[h2];\n              if (!isCutLineInsideAngles(shapeIndex, h2)) continue;\n              if (intersectsShapeEdge(shapePt, holePt)) continue;\n              if (intersectsHoleEdge(shapePt, holePt)) continue;\n              holeIndex = h2;\n              indepHoles.splice(h, 1);\n              tmpShape1 = shape.slice(0, shapeIndex + 1);\n              tmpShape2 = shape.slice(shapeIndex);\n              tmpHole1 = hole.slice(holeIndex);\n              tmpHole2 = hole.slice(0, holeIndex + 1);\n              shape = tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);\n              minShapeIndex = shapeIndex; // Debug only, to show the selected cuts\n              // glob_CutLines.push( [ shapePt, holePt ] );\n\n              break;\n            }\n\n            if (holeIndex >= 0) break; // hole-vertex found\n\n            failedCuts[cutKey] = true; // remember failure\n          }\n\n          if (holeIndex >= 0) break; // hole-vertex found\n        }\n      }\n\n      return shape;\n      /* shape with no holes */\n    }\n\n    var i,\n        il,\n        f,\n        face,\n        key,\n        index,\n        allPointsMap = {}; // To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\n\n    var allpoints = contour.concat();\n\n    for (var h = 0, hl = holes.length; h < hl; h++) {\n      Array.prototype.push.apply(allpoints, holes[h]);\n    } //console.log( \"allpoints\",allpoints, allpoints.length );\n    // prepare all points map\n\n\n    for (i = 0, il = allpoints.length; i < il; i++) {\n      key = allpoints[i].x + \":\" + allpoints[i].y;\n\n      if (allPointsMap[key] !== undefined) {\n        console.warn(\"THREE.Shape: Duplicate point\", key);\n      }\n\n      allPointsMap[key] = i;\n    } // remove holes by cutting paths to holes and adding them to the shape\n\n\n    var shapeWithoutHoles = removeHoles(contour, holes);\n    var triangles = THREE.FontUtils.Triangulate(shapeWithoutHoles, false); // True returns indices for points of spooled shape\n    //console.log( \"triangles\",triangles, triangles.length );\n    // check all face vertices against all points map\n\n    for (i = 0, il = triangles.length; i < il; i++) {\n      face = triangles[i];\n\n      for (f = 0; f < 3; f++) {\n        key = face[f].x + \":\" + face[f].y;\n        index = allPointsMap[key];\n\n        if (index !== undefined) {\n          face[f] = index;\n        }\n      }\n    }\n\n    return triangles.concat();\n  },\n  isClockWise: function (pts) {\n    return THREE.FontUtils.Triangulate.area(pts) < 0;\n  },\n  // Bezier Curves formulas obtained from\n  // http://en.wikipedia.org/wiki/B%C3%A9zier_curve\n  // Quad Bezier Functions\n  b2p0: function (t, p) {\n    var k = 1 - t;\n    return k * k * p;\n  },\n  b2p1: function (t, p) {\n    return 2 * (1 - t) * t * p;\n  },\n  b2p2: function (t, p) {\n    return t * t * p;\n  },\n  b2: function (t, p0, p1, p2) {\n    return this.b2p0(t, p0) + this.b2p1(t, p1) + this.b2p2(t, p2);\n  },\n  // Cubic Bezier Functions\n  b3p0: function (t, p) {\n    var k = 1 - t;\n    return k * k * k * p;\n  },\n  b3p1: function (t, p) {\n    var k = 1 - t;\n    return 3 * k * k * t * p;\n  },\n  b3p2: function (t, p) {\n    var k = 1 - t;\n    return 3 * k * t * t * p;\n  },\n  b3p3: function (t, p) {\n    return t * t * t * p;\n  },\n  b3: function (t, p0, p1, p2, p3) {\n    return this.b3p0(t, p0) + this.b3p1(t, p1) + this.b3p2(t, p2) + this.b3p3(t, p3);\n  }\n}; // File:src/extras/curves/LineCurve.js\n\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\n\nTHREE.LineCurve = function (v1, v2) {\n  this.v1 = v1;\n  this.v2 = v2;\n};\n\nTHREE.LineCurve.prototype = Object.create(THREE.Curve.prototype);\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\n\nTHREE.LineCurve.prototype.getPoint = function (t) {\n  var point = this.v2.clone().sub(this.v1);\n  point.multiplyScalar(t).add(this.v1);\n  return point;\n}; // Line curve is linear, so we can overwrite default getPointAt\n\n\nTHREE.LineCurve.prototype.getPointAt = function (u) {\n  return this.getPoint(u);\n};\n\nTHREE.LineCurve.prototype.getTangent = function (t) {\n  var tangent = this.v2.clone().sub(this.v1);\n  return tangent.normalize();\n}; // File:src/extras/curves/QuadraticBezierCurve.js\n\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\n\n\nTHREE.QuadraticBezierCurve = function (v0, v1, v2) {\n  this.v0 = v0;\n  this.v1 = v1;\n  this.v2 = v2;\n};\n\nTHREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype);\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\n\nTHREE.QuadraticBezierCurve.prototype.getPoint = function (t) {\n  var vector = new THREE.Vector2();\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\n  return vector;\n};\n\nTHREE.QuadraticBezierCurve.prototype.getTangent = function (t) {\n  var vector = new THREE.Vector2();\n  vector.x = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.x, this.v1.x, this.v2.x);\n  vector.y = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.y, this.v1.y, this.v2.y); // returns unit vector\n\n  return vector.normalize();\n}; // File:src/extras/curves/CubicBezierCurve.js\n\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\n\n\nTHREE.CubicBezierCurve = function (v0, v1, v2, v3) {\n  this.v0 = v0;\n  this.v1 = v1;\n  this.v2 = v2;\n  this.v3 = v3;\n};\n\nTHREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype);\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\n\nTHREE.CubicBezierCurve.prototype.getPoint = function (t) {\n  var tx, ty;\n  tx = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\n  ty = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\n  return new THREE.Vector2(tx, ty);\n};\n\nTHREE.CubicBezierCurve.prototype.getTangent = function (t) {\n  var tx, ty;\n  tx = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\n  ty = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\n  var tangent = new THREE.Vector2(tx, ty);\n  tangent.normalize();\n  return tangent;\n}; // File:src/extras/curves/SplineCurve.js\n\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\n\n\nTHREE.SplineCurve = function (points\n/* array of Vector2 */\n) {\n  this.points = points == undefined ? [] : points;\n};\n\nTHREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype);\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\n\nTHREE.SplineCurve.prototype.getPoint = function (t) {\n  var points = this.points;\n  var point = (points.length - 1) * t;\n  var intPoint = Math.floor(point);\n  var weight = point - intPoint;\n  var point0 = points[intPoint === 0 ? intPoint : intPoint - 1];\n  var point1 = points[intPoint];\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\n  var vector = new THREE.Vector2();\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\n  return vector;\n}; // File:src/extras/curves/EllipseCurve.js\n\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\n\n\nTHREE.EllipseCurve = function (aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation) {\n  this.aX = aX;\n  this.aY = aY;\n  this.xRadius = xRadius;\n  this.yRadius = yRadius;\n  this.aStartAngle = aStartAngle;\n  this.aEndAngle = aEndAngle;\n  this.aClockwise = aClockwise;\n  this.aRotation = aRotation || 0;\n};\n\nTHREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype);\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\n\nTHREE.EllipseCurve.prototype.getPoint = function (t) {\n  var deltaAngle = this.aEndAngle - this.aStartAngle;\n  if (deltaAngle < 0) deltaAngle += Math.PI * 2;\n  if (deltaAngle > Math.PI * 2) deltaAngle -= Math.PI * 2;\n  var angle;\n\n  if (this.aClockwise === true) {\n    angle = this.aEndAngle + (1 - t) * (Math.PI * 2 - deltaAngle);\n  } else {\n    angle = this.aStartAngle + t * deltaAngle;\n  }\n\n  var x = this.aX + this.xRadius * Math.cos(angle);\n  var y = this.aY + this.yRadius * Math.sin(angle);\n\n  if (this.aRotation !== 0) {\n    var cos = Math.cos(this.aRotation);\n    var sin = Math.sin(this.aRotation);\n    var tx = x,\n        ty = y; // Rotate the point about the center of the ellipse.\n\n    x = (tx - this.aX) * cos - (ty - this.aY) * sin + this.aX;\n    y = (tx - this.aX) * sin + (ty - this.aY) * cos + this.aY;\n  }\n\n  return new THREE.Vector2(x, y);\n}; // File:src/extras/curves/ArcCurve.js\n\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\n\n\nTHREE.ArcCurve = function (aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\n  THREE.EllipseCurve.call(this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\n};\n\nTHREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype);\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve; // File:src/extras/curves/LineCurve3.js\n\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\n\nTHREE.LineCurve3 = THREE.Curve.create(function (v1, v2) {\n  this.v1 = v1;\n  this.v2 = v2;\n}, function (t) {\n  var vector = new THREE.Vector3();\n  vector.subVectors(this.v2, this.v1); // diff\n\n  vector.multiplyScalar(t);\n  vector.add(this.v1);\n  return vector;\n}); // File:src/extras/curves/QuadraticBezierCurve3.js\n\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\n\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(function (v0, v1, v2) {\n  this.v0 = v0;\n  this.v1 = v1;\n  this.v2 = v2;\n}, function (t) {\n  var vector = new THREE.Vector3();\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\n  vector.z = THREE.Shape.Utils.b2(t, this.v0.z, this.v1.z, this.v2.z);\n  return vector;\n}); // File:src/extras/curves/CubicBezierCurve3.js\n\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\n\nTHREE.CubicBezierCurve3 = THREE.Curve.create(function (v0, v1, v2, v3) {\n  this.v0 = v0;\n  this.v1 = v1;\n  this.v2 = v2;\n  this.v3 = v3;\n}, function (t) {\n  var vector = new THREE.Vector3();\n  vector.x = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\n  vector.y = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\n  vector.z = THREE.Shape.Utils.b3(t, this.v0.z, this.v1.z, this.v2.z, this.v3.z);\n  return vector;\n}); // File:src/extras/curves/SplineCurve3.js\n\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\n\nTHREE.SplineCurve3 = THREE.Curve.create(function (points\n/* array of Vector3 */\n) {\n  console.warn('THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3');\n  this.points = points == undefined ? [] : points;\n}, function (t) {\n  var points = this.points;\n  var point = (points.length - 1) * t;\n  var intPoint = Math.floor(point);\n  var weight = point - intPoint;\n  var point0 = points[intPoint == 0 ? intPoint : intPoint - 1];\n  var point1 = points[intPoint];\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\n  var vector = new THREE.Vector3();\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\n  vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\n  return vector;\n}); // File:src/extras/curves/CatmullRomCurve3.js\n\n/**\r\n * @author zz85 https://github.com/zz85\r\n *\r\n * Centripetal CatmullRom Curve - which is useful for avoiding\r\n * cusps and self-intersections in non-uniform catmull rom curves.\r\n * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\r\n *\r\n * curve.type accepts centripetal(default), chordal and catmullrom\r\n * curve.tension is used for catmullrom which defaults to 0.5\r\n */\n\nTHREE.CatmullRomCurve3 = function () {\n  var tmp = new THREE.Vector3(),\n      px = new CubicPoly(),\n      py = new CubicPoly(),\n      pz = new CubicPoly();\n  /*\r\n  Based on an optimized c++ solution in\r\n   - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/\r\n   - http://ideone.com/NoEbVM\r\n  \n  This CubicPoly class could be used for reusing some variables and calculations,\r\n  but for three.js curve use, it could be possible inlined and flatten into a single function call\r\n  which can be placed in CurveUtils.\r\n  */\n\n  function CubicPoly() {}\n  /*\r\n   * Compute coefficients for a cubic polynomial\r\n   *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3\r\n   * such that\r\n   *   p(0) = x0, p(1) = x1\r\n   *  and\r\n   *   p'(0) = t0, p'(1) = t1.\r\n   */\n\n\n  CubicPoly.prototype.init = function (x0, x1, t0, t1) {\n    this.c0 = x0;\n    this.c1 = t0;\n    this.c2 = -3 * x0 + 3 * x1 - 2 * t0 - t1;\n    this.c3 = 2 * x0 - 2 * x1 + t0 + t1;\n  };\n\n  CubicPoly.prototype.initNonuniformCatmullRom = function (x0, x1, x2, x3, dt0, dt1, dt2) {\n    // compute tangents when parameterized in [t1,t2]\n    var t1 = (x1 - x0) / dt0 - (x2 - x0) / (dt0 + dt1) + (x2 - x1) / dt1;\n    var t2 = (x2 - x1) / dt1 - (x3 - x1) / (dt1 + dt2) + (x3 - x2) / dt2; // rescale tangents for parametrization in [0,1]\n\n    t1 *= dt1;\n    t2 *= dt1; // initCubicPoly\n\n    this.init(x1, x2, t1, t2);\n  }; // standard Catmull-Rom spline: interpolate between x1 and x2 with previous/following points x1/x4\n\n\n  CubicPoly.prototype.initCatmullRom = function (x0, x1, x2, x3, tension) {\n    this.init(x1, x2, tension * (x2 - x0), tension * (x3 - x1));\n  };\n\n  CubicPoly.prototype.calc = function (t) {\n    var t2 = t * t;\n    var t3 = t2 * t;\n    return this.c0 + this.c1 * t + this.c2 * t2 + this.c3 * t3;\n  }; // Subclass Three.js curve\n\n\n  return THREE.Curve.create(function (p\n  /* array of Vector3 */\n  ) {\n    this.points = p || [];\n  }, function (t) {\n    var points = this.points,\n        point,\n        intPoint,\n        weight,\n        l;\n    l = points.length;\n    if (l < 2) console.log('duh, you need at least 2 points');\n    point = (l - 1) * t;\n    intPoint = Math.floor(point);\n    weight = point - intPoint;\n\n    if (weight === 0 && intPoint === l - 1) {\n      intPoint = l - 2;\n      weight = 1;\n    }\n\n    var p0, p1, p2, p3;\n\n    if (intPoint === 0) {\n      // extrapolate first point\n      tmp.subVectors(points[0], points[1]).add(points[0]);\n      p0 = tmp;\n    } else {\n      p0 = points[intPoint - 1];\n    }\n\n    p1 = points[intPoint];\n    p2 = points[intPoint + 1];\n\n    if (intPoint + 2 < l) {\n      p3 = points[intPoint + 2];\n    } else {\n      // extrapolate last point\n      tmp.subVectors(points[l - 1], points[l - 2]).add(points[l - 2]);\n      p3 = tmp;\n    }\n\n    if (this.type === undefined || this.type === 'centripetal' || this.type === 'chordal') {\n      // init Centripetal / Chordal Catmull-Rom\n      var pow = this.type === 'chordal' ? 0.5 : 0.25;\n      var dt0 = Math.pow(p0.distanceToSquared(p1), pow);\n      var dt1 = Math.pow(p1.distanceToSquared(p2), pow);\n      var dt2 = Math.pow(p2.distanceToSquared(p3), pow); // safety check for repeated points\n\n      if (dt1 < 1e-4) dt1 = 1.0;\n      if (dt0 < 1e-4) dt0 = dt1;\n      if (dt2 < 1e-4) dt2 = dt1;\n      px.initNonuniformCatmullRom(p0.x, p1.x, p2.x, p3.x, dt0, dt1, dt2);\n      py.initNonuniformCatmullRom(p0.y, p1.y, p2.y, p3.y, dt0, dt1, dt2);\n      pz.initNonuniformCatmullRom(p0.z, p1.z, p2.z, p3.z, dt0, dt1, dt2);\n    } else if (this.type === 'catmullrom') {\n      var tension = this.tension !== undefined ? this.tension : 0.5;\n      px.initCatmullRom(p0.x, p1.x, p2.x, p3.x, tension);\n      py.initCatmullRom(p0.y, p1.y, p2.y, p3.y, tension);\n      pz.initCatmullRom(p0.z, p1.z, p2.z, p3.z, tension);\n    }\n\n    var v = new THREE.Vector3(px.calc(weight), py.calc(weight), pz.calc(weight));\n    return v;\n  });\n}(); // File:src/extras/curves/ClosedSplineCurve3.js\n\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\n\n\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(function (points\n/* array of Vector3 */\n) {\n  this.points = points == undefined ? [] : points;\n}, function (t) {\n  var points = this.points;\n  var point = (points.length - 0) * t; // This needs to be from 0-length +1\n\n  var intPoint = Math.floor(point);\n  var weight = point - intPoint;\n  intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / points.length) + 1) * points.length;\n  var point0 = points[(intPoint - 1) % points.length];\n  var point1 = points[intPoint % points.length];\n  var point2 = points[(intPoint + 1) % points.length];\n  var point3 = points[(intPoint + 2) % points.length];\n  var vector = new THREE.Vector3();\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\n  vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\n  return vector;\n}); // File:src/extras/animation/AnimationHandler.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\n\nTHREE.AnimationHandler = {\n  LINEAR: 0,\n  CATMULLROM: 1,\n  CATMULLROM_FORWARD: 2,\n  //\n  add: function () {\n    console.warn('THREE.AnimationHandler.add() has been deprecated.');\n  },\n  get: function () {\n    console.warn('THREE.AnimationHandler.get() has been deprecated.');\n  },\n  remove: function () {\n    console.warn('THREE.AnimationHandler.remove() has been deprecated.');\n  },\n  //\n  animations: [],\n  init: function (data) {\n    if (data.initialized === true) return data; // loop through all keys\n\n    for (var h = 0; h < data.hierarchy.length; h++) {\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\n        // remove minus times\n        if (data.hierarchy[h].keys[k].time < 0) {\n          data.hierarchy[h].keys[k].time = 0;\n        } // create quaternions\n\n\n        if (data.hierarchy[h].keys[k].rot !== undefined && !(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)) {\n          var quat = data.hierarchy[h].keys[k].rot;\n          data.hierarchy[h].keys[k].rot = new THREE.Quaternion().fromArray(quat);\n        }\n      } // prepare morph target keys\n\n\n      if (data.hierarchy[h].keys.length && data.hierarchy[h].keys[0].morphTargets !== undefined) {\n        // get all used\n        var usedMorphTargets = {};\n\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\n          for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\n            var morphTargetName = data.hierarchy[h].keys[k].morphTargets[m];\n            usedMorphTargets[morphTargetName] = -1;\n          }\n        }\n\n        data.hierarchy[h].usedMorphTargets = usedMorphTargets; // set all used on all frames\n\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\n          var influences = {};\n\n          for (var morphTargetName in usedMorphTargets) {\n            for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\n              if (data.hierarchy[h].keys[k].morphTargets[m] === morphTargetName) {\n                influences[morphTargetName] = data.hierarchy[h].keys[k].morphTargetsInfluences[m];\n                break;\n              }\n            }\n\n            if (m === data.hierarchy[h].keys[k].morphTargets.length) {\n              influences[morphTargetName] = 0;\n            }\n          }\n\n          data.hierarchy[h].keys[k].morphTargetsInfluences = influences;\n        }\n      } // remove all keys that are on the same time\n\n\n      for (var k = 1; k < data.hierarchy[h].keys.length; k++) {\n        if (data.hierarchy[h].keys[k].time === data.hierarchy[h].keys[k - 1].time) {\n          data.hierarchy[h].keys.splice(k, 1);\n          k--;\n        }\n      } // set index\n\n\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\n        data.hierarchy[h].keys[k].index = k;\n      }\n    }\n\n    data.initialized = true;\n    return data;\n  },\n  parse: function (root) {\n    var parseRecurseHierarchy = function (root, hierarchy) {\n      hierarchy.push(root);\n\n      for (var c = 0; c < root.children.length; c++) parseRecurseHierarchy(root.children[c], hierarchy);\n    }; // setup hierarchy\n\n\n    var hierarchy = [];\n\n    if (root instanceof THREE.SkinnedMesh) {\n      for (var b = 0; b < root.skeleton.bones.length; b++) {\n        hierarchy.push(root.skeleton.bones[b]);\n      }\n    } else {\n      parseRecurseHierarchy(root, hierarchy);\n    }\n\n    return hierarchy;\n  },\n  play: function (animation) {\n    if (this.animations.indexOf(animation) === -1) {\n      this.animations.push(animation);\n    }\n  },\n  stop: function (animation) {\n    var index = this.animations.indexOf(animation);\n\n    if (index !== -1) {\n      this.animations.splice(index, 1);\n    }\n  },\n  update: function (deltaTimeMS) {\n    for (var i = 0; i < this.animations.length; i++) {\n      this.animations[i].resetBlendWeights();\n    }\n\n    for (var i = 0; i < this.animations.length; i++) {\n      this.animations[i].update(deltaTimeMS);\n    }\n  }\n}; // File:src/extras/animation/Animation.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.Animation = function (root, data) {\n  this.root = root;\n  this.data = THREE.AnimationHandler.init(data);\n  this.hierarchy = THREE.AnimationHandler.parse(root);\n  this.currentTime = 0;\n  this.timeScale = 1;\n  this.isPlaying = false;\n  this.loop = true;\n  this.weight = 0;\n  this.interpolationType = THREE.AnimationHandler.LINEAR;\n};\n\nTHREE.Animation.prototype = {\n  constructor: THREE.Animation,\n  keyTypes: [\"pos\", \"rot\", \"scl\"],\n  play: function (startTime, weight) {\n    this.currentTime = startTime !== undefined ? startTime : 0;\n    this.weight = weight !== undefined ? weight : 1;\n    this.isPlaying = true;\n    this.reset();\n    THREE.AnimationHandler.play(this);\n  },\n  stop: function () {\n    this.isPlaying = false;\n    THREE.AnimationHandler.stop(this);\n  },\n  reset: function () {\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\n      var object = this.hierarchy[h];\n\n      if (object.animationCache === undefined) {\n        object.animationCache = {\n          animations: {},\n          blending: {\n            positionWeight: 0.0,\n            quaternionWeight: 0.0,\n            scaleWeight: 0.0\n          }\n        };\n      }\n\n      var name = this.data.name;\n      var animations = object.animationCache.animations;\n      var animationCache = animations[name];\n\n      if (animationCache === undefined) {\n        animationCache = {\n          prevKey: {\n            pos: 0,\n            rot: 0,\n            scl: 0\n          },\n          nextKey: {\n            pos: 0,\n            rot: 0,\n            scl: 0\n          },\n          originalMatrix: object.matrix\n        };\n        animations[name] = animationCache;\n      } // Get keys to match our current time\n\n\n      for (var t = 0; t < 3; t++) {\n        var type = this.keyTypes[t];\n        var prevKey = this.data.hierarchy[h].keys[0];\n        var nextKey = this.getNextKeyWith(type, h, 1);\n\n        while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\n          prevKey = nextKey;\n          nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\n        }\n\n        animationCache.prevKey[type] = prevKey;\n        animationCache.nextKey[type] = nextKey;\n      }\n    }\n  },\n  resetBlendWeights: function () {\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\n      var object = this.hierarchy[h];\n      var animationCache = object.animationCache;\n\n      if (animationCache !== undefined) {\n        var blending = animationCache.blending;\n        blending.positionWeight = 0.0;\n        blending.quaternionWeight = 0.0;\n        blending.scaleWeight = 0.0;\n      }\n    }\n  },\n  update: function () {\n    var points = [];\n    var target = new THREE.Vector3();\n    var newVector = new THREE.Vector3();\n    var newQuat = new THREE.Quaternion(); // Catmull-Rom spline\n\n    var interpolateCatmullRom = function (points, scale) {\n      var c = [],\n          v3 = [],\n          point,\n          intPoint,\n          weight,\n          w2,\n          w3,\n          pa,\n          pb,\n          pc,\n          pd;\n      point = (points.length - 1) * scale;\n      intPoint = Math.floor(point);\n      weight = point - intPoint;\n      c[0] = intPoint === 0 ? intPoint : intPoint - 1;\n      c[1] = intPoint;\n      c[2] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\n      c[3] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\n      pa = points[c[0]];\n      pb = points[c[1]];\n      pc = points[c[2]];\n      pd = points[c[3]];\n      w2 = weight * weight;\n      w3 = weight * w2;\n      v3[0] = interpolate(pa[0], pb[0], pc[0], pd[0], weight, w2, w3);\n      v3[1] = interpolate(pa[1], pb[1], pc[1], pd[1], weight, w2, w3);\n      v3[2] = interpolate(pa[2], pb[2], pc[2], pd[2], weight, w2, w3);\n      return v3;\n    };\n\n    var interpolate = function (p0, p1, p2, p3, t, t2, t3) {\n      var v0 = (p2 - p0) * 0.5,\n          v1 = (p3 - p1) * 0.5;\n      return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\n    };\n\n    return function (delta) {\n      if (this.isPlaying === false) return;\n      this.currentTime += delta * this.timeScale;\n      if (this.weight === 0) return; //\n\n      var duration = this.data.length;\n\n      if (this.currentTime > duration || this.currentTime < 0) {\n        if (this.loop) {\n          this.currentTime %= duration;\n          if (this.currentTime < 0) this.currentTime += duration;\n          this.reset();\n        } else {\n          this.stop();\n        }\n      }\n\n      for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\n        var object = this.hierarchy[h];\n        var animationCache = object.animationCache.animations[this.data.name];\n        var blending = object.animationCache.blending; // loop through pos/rot/scl\n\n        for (var t = 0; t < 3; t++) {\n          // get keys\n          var type = this.keyTypes[t];\n          var prevKey = animationCache.prevKey[type];\n          var nextKey = animationCache.nextKey[type];\n\n          if (this.timeScale > 0 && nextKey.time <= this.currentTime || this.timeScale < 0 && prevKey.time >= this.currentTime) {\n            prevKey = this.data.hierarchy[h].keys[0];\n            nextKey = this.getNextKeyWith(type, h, 1);\n\n            while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\n              prevKey = nextKey;\n              nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\n            }\n\n            animationCache.prevKey[type] = prevKey;\n            animationCache.nextKey[type] = nextKey;\n          }\n\n          var scale = (this.currentTime - prevKey.time) / (nextKey.time - prevKey.time);\n          var prevXYZ = prevKey[type];\n          var nextXYZ = nextKey[type];\n          if (scale < 0) scale = 0;\n          if (scale > 1) scale = 1; // interpolate\n\n          if (type === \"pos\") {\n            if (this.interpolationType === THREE.AnimationHandler.LINEAR) {\n              newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\n              newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\n              newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale; // blend\n\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\n              object.position.lerp(newVector, proportionalWeight);\n              blending.positionWeight += this.weight;\n            } else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\n              points[0] = this.getPrevKeyWith(\"pos\", h, prevKey.index - 1)[\"pos\"];\n              points[1] = prevXYZ;\n              points[2] = nextXYZ;\n              points[3] = this.getNextKeyWith(\"pos\", h, nextKey.index + 1)[\"pos\"];\n              scale = scale * 0.33 + 0.33;\n              var currentPoint = interpolateCatmullRom(points, scale);\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\n              blending.positionWeight += this.weight; // blend\n\n              var vector = object.position;\n              vector.x = vector.x + (currentPoint[0] - vector.x) * proportionalWeight;\n              vector.y = vector.y + (currentPoint[1] - vector.y) * proportionalWeight;\n              vector.z = vector.z + (currentPoint[2] - vector.z) * proportionalWeight;\n\n              if (this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\n                var forwardPoint = interpolateCatmullRom(points, scale * 1.01);\n                target.set(forwardPoint[0], forwardPoint[1], forwardPoint[2]);\n                target.sub(vector);\n                target.y = 0;\n                target.normalize();\n                var angle = Math.atan2(target.x, target.z);\n                object.rotation.set(0, angle, 0);\n              }\n            }\n          } else if (type === \"rot\") {\n            THREE.Quaternion.slerp(prevXYZ, nextXYZ, newQuat, scale); // Avoid paying the cost of an additional slerp if we don't have to\n\n            if (blending.quaternionWeight === 0) {\n              object.quaternion.copy(newQuat);\n              blending.quaternionWeight = this.weight;\n            } else {\n              var proportionalWeight = this.weight / (this.weight + blending.quaternionWeight);\n              THREE.Quaternion.slerp(object.quaternion, newQuat, object.quaternion, proportionalWeight);\n              blending.quaternionWeight += this.weight;\n            }\n          } else if (type === \"scl\") {\n            newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\n            newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\n            newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\n            var proportionalWeight = this.weight / (this.weight + blending.scaleWeight);\n            object.scale.lerp(newVector, proportionalWeight);\n            blending.scaleWeight += this.weight;\n          }\n        }\n      }\n\n      return true;\n    };\n  }(),\n  getNextKeyWith: function (type, h, key) {\n    var keys = this.data.hierarchy[h].keys;\n\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\n      key = key < keys.length - 1 ? key : keys.length - 1;\n    } else {\n      key = key % keys.length;\n    }\n\n    for (; key < keys.length; key++) {\n      if (keys[key][type] !== undefined) {\n        return keys[key];\n      }\n    }\n\n    return this.data.hierarchy[h].keys[0];\n  },\n  getPrevKeyWith: function (type, h, key) {\n    var keys = this.data.hierarchy[h].keys;\n\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM || this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\n      key = key > 0 ? key : 0;\n    } else {\n      key = key >= 0 ? key : key + keys.length;\n    }\n\n    for (; key >= 0; key--) {\n      if (keys[key][type] !== undefined) {\n        return keys[key];\n      }\n    }\n\n    return this.data.hierarchy[h].keys[keys.length - 1];\n  }\n}; // File:src/extras/animation/KeyFrameAnimation.js\n\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\n\nTHREE.KeyFrameAnimation = function (data) {\n  this.root = data.node;\n  this.data = THREE.AnimationHandler.init(data);\n  this.hierarchy = THREE.AnimationHandler.parse(this.root);\n  this.currentTime = 0;\n  this.timeScale = 0.001;\n  this.isPlaying = false;\n  this.isPaused = true;\n  this.loop = true; // initialize to first keyframes\n\n  for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\n    var keys = this.data.hierarchy[h].keys,\n        sids = this.data.hierarchy[h].sids,\n        obj = this.hierarchy[h];\n\n    if (keys.length && sids) {\n      for (var s = 0; s < sids.length; s++) {\n        var sid = sids[s],\n            next = this.getNextKeyWith(sid, h, 0);\n\n        if (next) {\n          next.apply(sid);\n        }\n      }\n\n      obj.matrixAutoUpdate = false;\n      this.data.hierarchy[h].node.updateMatrix();\n      obj.matrixWorldNeedsUpdate = true;\n    }\n  }\n};\n\nTHREE.KeyFrameAnimation.prototype = {\n  constructor: THREE.KeyFrameAnimation,\n  play: function (startTime) {\n    this.currentTime = startTime !== undefined ? startTime : 0;\n\n    if (this.isPlaying === false) {\n      this.isPlaying = true; // reset key cache\n\n      var h,\n          hl = this.hierarchy.length,\n          object,\n          node;\n\n      for (h = 0; h < hl; h++) {\n        object = this.hierarchy[h];\n        node = this.data.hierarchy[h];\n\n        if (node.animationCache === undefined) {\n          node.animationCache = {};\n          node.animationCache.prevKey = null;\n          node.animationCache.nextKey = null;\n          node.animationCache.originalMatrix = object.matrix;\n        }\n\n        var keys = this.data.hierarchy[h].keys;\n\n        if (keys.length) {\n          node.animationCache.prevKey = keys[0];\n          node.animationCache.nextKey = keys[1];\n          this.startTime = Math.min(keys[0].time, this.startTime);\n          this.endTime = Math.max(keys[keys.length - 1].time, this.endTime);\n        }\n      }\n\n      this.update(0);\n    }\n\n    this.isPaused = false;\n    THREE.AnimationHandler.play(this);\n  },\n  stop: function () {\n    this.isPlaying = false;\n    this.isPaused = false;\n    THREE.AnimationHandler.stop(this); // reset JIT matrix and remove cache\n\n    for (var h = 0; h < this.data.hierarchy.length; h++) {\n      var obj = this.hierarchy[h];\n      var node = this.data.hierarchy[h];\n\n      if (node.animationCache !== undefined) {\n        var original = node.animationCache.originalMatrix;\n        original.copy(obj.matrix);\n        obj.matrix = original;\n        delete node.animationCache;\n      }\n    }\n  },\n  update: function (delta) {\n    if (this.isPlaying === false) return;\n    this.currentTime += delta * this.timeScale; //\n\n    var duration = this.data.length;\n\n    if (this.loop === true && this.currentTime > duration) {\n      this.currentTime %= duration;\n    }\n\n    this.currentTime = Math.min(this.currentTime, duration);\n\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\n      var object = this.hierarchy[h];\n      var node = this.data.hierarchy[h];\n      var keys = node.keys,\n          animationCache = node.animationCache;\n\n      if (keys.length) {\n        var prevKey = animationCache.prevKey;\n        var nextKey = animationCache.nextKey;\n\n        if (nextKey.time <= this.currentTime) {\n          while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\n            prevKey = nextKey;\n            nextKey = keys[prevKey.index + 1];\n          }\n\n          animationCache.prevKey = prevKey;\n          animationCache.nextKey = nextKey;\n        }\n\n        if (nextKey.time >= this.currentTime) {\n          prevKey.interpolate(nextKey, this.currentTime);\n        } else {\n          prevKey.interpolate(nextKey, nextKey.time);\n        }\n\n        this.data.hierarchy[h].node.updateMatrix();\n        object.matrixWorldNeedsUpdate = true;\n      }\n    }\n  },\n  getNextKeyWith: function (sid, h, key) {\n    var keys = this.data.hierarchy[h].keys;\n    key = key % keys.length;\n\n    for (; key < keys.length; key++) {\n      if (keys[key].hasTarget(sid)) {\n        return keys[key];\n      }\n    }\n\n    return keys[0];\n  },\n  getPrevKeyWith: function (sid, h, key) {\n    var keys = this.data.hierarchy[h].keys;\n    key = key >= 0 ? key : key + keys.length;\n\n    for (; key >= 0; key--) {\n      if (keys[key].hasTarget(sid)) {\n        return keys[key];\n      }\n    }\n\n    return keys[keys.length - 1];\n  }\n}; // File:src/extras/animation/MorphAnimation.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\n\nTHREE.MorphAnimation = function (mesh) {\n  this.mesh = mesh;\n  this.frames = mesh.morphTargetInfluences.length;\n  this.currentTime = 0;\n  this.duration = 1000;\n  this.loop = true;\n  this.lastFrame = 0;\n  this.currentFrame = 0;\n  this.isPlaying = false;\n};\n\nTHREE.MorphAnimation.prototype = {\n  constructor: THREE.MorphAnimation,\n  play: function () {\n    this.isPlaying = true;\n  },\n  pause: function () {\n    this.isPlaying = false;\n  },\n  update: function (delta) {\n    if (this.isPlaying === false) return;\n    this.currentTime += delta;\n\n    if (this.loop === true && this.currentTime > this.duration) {\n      this.currentTime %= this.duration;\n    }\n\n    this.currentTime = Math.min(this.currentTime, this.duration);\n    var frameTime = this.duration / this.frames;\n    var frame = Math.floor(this.currentTime / frameTime);\n    var influences = this.mesh.morphTargetInfluences;\n\n    if (frame !== this.currentFrame) {\n      influences[this.lastFrame] = 0;\n      influences[this.currentFrame] = 1;\n      influences[frame] = 0;\n      this.lastFrame = this.currentFrame;\n      this.currentFrame = frame;\n    }\n\n    var mix = this.currentTime % frameTime / frameTime;\n    influences[frame] = mix;\n    influences[this.lastFrame] = 1 - mix;\n  }\n}; // File:src/extras/geometries/BoxGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\n\nTHREE.BoxGeometry = function (width, height, depth, widthSegments, heightSegments, depthSegments) {\n  THREE.Geometry.call(this);\n  this.type = 'BoxGeometry';\n  this.parameters = {\n    width: width,\n    height: height,\n    depth: depth,\n    widthSegments: widthSegments,\n    heightSegments: heightSegments,\n    depthSegments: depthSegments\n  };\n  this.widthSegments = widthSegments || 1;\n  this.heightSegments = heightSegments || 1;\n  this.depthSegments = depthSegments || 1;\n  var scope = this;\n  var width_half = width / 2;\n  var height_half = height / 2;\n  var depth_half = depth / 2;\n  buildPlane('z', 'y', -1, -1, depth, height, width_half, 0); // px\n\n  buildPlane('z', 'y', 1, -1, depth, height, -width_half, 1); // nx\n\n  buildPlane('x', 'z', 1, 1, width, depth, height_half, 2); // py\n\n  buildPlane('x', 'z', 1, -1, width, depth, -height_half, 3); // ny\n\n  buildPlane('x', 'y', 1, -1, width, height, depth_half, 4); // pz\n\n  buildPlane('x', 'y', -1, -1, width, height, -depth_half, 5); // nz\n\n  function buildPlane(u, v, udir, vdir, width, height, depth, materialIndex) {\n    var w,\n        ix,\n        iy,\n        gridX = scope.widthSegments,\n        gridY = scope.heightSegments,\n        width_half = width / 2,\n        height_half = height / 2,\n        offset = scope.vertices.length;\n\n    if (u === 'x' && v === 'y' || u === 'y' && v === 'x') {\n      w = 'z';\n    } else if (u === 'x' && v === 'z' || u === 'z' && v === 'x') {\n      w = 'y';\n      gridY = scope.depthSegments;\n    } else if (u === 'z' && v === 'y' || u === 'y' && v === 'z') {\n      w = 'x';\n      gridX = scope.depthSegments;\n    }\n\n    var gridX1 = gridX + 1,\n        gridY1 = gridY + 1,\n        segment_width = width / gridX,\n        segment_height = height / gridY,\n        normal = new THREE.Vector3();\n    normal[w] = depth > 0 ? 1 : -1;\n\n    for (iy = 0; iy < gridY1; iy++) {\n      for (ix = 0; ix < gridX1; ix++) {\n        var vector = new THREE.Vector3();\n        vector[u] = (ix * segment_width - width_half) * udir;\n        vector[v] = (iy * segment_height - height_half) * vdir;\n        vector[w] = depth;\n        scope.vertices.push(vector);\n      }\n    }\n\n    for (iy = 0; iy < gridY; iy++) {\n      for (ix = 0; ix < gridX; ix++) {\n        var a = ix + gridX1 * iy;\n        var b = ix + gridX1 * (iy + 1);\n        var c = ix + 1 + gridX1 * (iy + 1);\n        var d = ix + 1 + gridX1 * iy;\n        var uva = new THREE.Vector2(ix / gridX, 1 - iy / gridY);\n        var uvb = new THREE.Vector2(ix / gridX, 1 - (iy + 1) / gridY);\n        var uvc = new THREE.Vector2((ix + 1) / gridX, 1 - (iy + 1) / gridY);\n        var uvd = new THREE.Vector2((ix + 1) / gridX, 1 - iy / gridY);\n        var face = new THREE.Face3(a + offset, b + offset, d + offset);\n        face.normal.copy(normal);\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\n        face.materialIndex = materialIndex;\n        scope.faces.push(face);\n        scope.faceVertexUvs[0].push([uva, uvb, uvd]);\n        face = new THREE.Face3(b + offset, c + offset, d + offset);\n        face.normal.copy(normal);\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\n        face.materialIndex = materialIndex;\n        scope.faces.push(face);\n        scope.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\n      }\n    }\n  }\n\n  this.mergeVertices();\n};\n\nTHREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\n\nTHREE.BoxGeometry.prototype.clone = function () {\n  var geometry = new THREE.BoxGeometry(this.parameters.width, this.parameters.height, this.parameters.depth, this.parameters.widthSegments, this.parameters.heightSegments, this.parameters.depthSegments);\n  return geometry;\n};\n\nTHREE.CubeGeometry = THREE.BoxGeometry; // backwards compatibility\n// File:src/extras/geometries/CircleGeometry.js\n\n/**\r\n * @author hughes\r\n */\n\nTHREE.CircleGeometry = function (radius, segments, thetaStart, thetaLength) {\n  THREE.Geometry.call(this);\n  this.type = 'CircleGeometry';\n  this.parameters = {\n    radius: radius,\n    segments: segments,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  radius = radius || 50;\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\n  var i,\n      uvs = [],\n      center = new THREE.Vector3(),\n      centerUV = new THREE.Vector2(0.5, 0.5);\n  this.vertices.push(center);\n  uvs.push(centerUV);\n\n  for (i = 0; i <= segments; i++) {\n    var vertex = new THREE.Vector3();\n    var segment = thetaStart + i / segments * thetaLength;\n    vertex.x = radius * Math.cos(segment);\n    vertex.y = radius * Math.sin(segment);\n    this.vertices.push(vertex);\n    uvs.push(new THREE.Vector2((vertex.x / radius + 1) / 2, (vertex.y / radius + 1) / 2));\n  }\n\n  var n = new THREE.Vector3(0, 0, 1);\n\n  for (i = 1; i <= segments; i++) {\n    this.faces.push(new THREE.Face3(i, i + 1, 0, [n.clone(), n.clone(), n.clone()]));\n    this.faceVertexUvs[0].push([uvs[i].clone(), uvs[i + 1].clone(), centerUV.clone()]);\n  }\n\n  this.computeFaceNormals();\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n};\n\nTHREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\n\nTHREE.CircleGeometry.prototype.clone = function () {\n  var geometry = new THREE.CircleGeometry(this.parameters.radius, this.parameters.segments, this.parameters.thetaStart, this.parameters.thetaLength);\n  return geometry;\n}; // File:src/extras/geometries/CircleBufferGeometry.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\n\n\nTHREE.CircleBufferGeometry = function (radius, segments, thetaStart, thetaLength) {\n  THREE.BufferGeometry.call(this);\n  this.type = 'CircleBufferGeometry';\n  this.parameters = {\n    radius: radius,\n    segments: segments,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  radius = radius || 50;\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\n  var vertices = segments + 2;\n  var positions = new Float32Array(vertices * 3);\n  var normals = new Float32Array(vertices * 3);\n  var uvs = new Float32Array(vertices * 2); // center data is already zero, but need to set a few extras\n\n  normals[3] = 1.0;\n  uvs[0] = 0.5;\n  uvs[1] = 0.5;\n\n  for (var s = 0, i = 3, ii = 2; s <= segments; s++, i += 3, ii += 2) {\n    var segment = thetaStart + s / segments * thetaLength;\n    positions[i] = radius * Math.cos(segment);\n    positions[i + 1] = radius * Math.sin(segment);\n    normals[i + 2] = 1; // normal z\n\n    uvs[ii] = (positions[i] / radius + 1) / 2;\n    uvs[ii + 1] = (positions[i + 1] / radius + 1) / 2;\n  }\n\n  var indices = [];\n\n  for (var i = 1; i <= segments; i++) {\n    indices.push(i);\n    indices.push(i + 1);\n    indices.push(0);\n  }\n\n  this.setIndex(new THREE.BufferAttribute(new Uint16Array(indices), 1));\n  this.addAttribute('position', new THREE.BufferAttribute(positions, 3));\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n};\n\nTHREE.CircleBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.CircleBufferGeometry.prototype.constructor = THREE.CircleBufferGeometry;\n\nTHREE.CircleBufferGeometry.prototype.clone = function () {\n  var geometry = new THREE.CircleBufferGeometry(this.parameters.radius, this.parameters.segments, this.parameters.thetaStart, this.parameters.thetaLength);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/CylinderGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.CylinderGeometry = function (radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength) {\n  THREE.Geometry.call(this);\n  this.type = 'CylinderGeometry';\n  this.parameters = {\n    radiusTop: radiusTop,\n    radiusBottom: radiusBottom,\n    height: height,\n    radialSegments: radialSegments,\n    heightSegments: heightSegments,\n    openEnded: openEnded,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  radiusTop = radiusTop !== undefined ? radiusTop : 20;\n  radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\n  height = height !== undefined ? height : 100;\n  radialSegments = radialSegments || 8;\n  heightSegments = heightSegments || 1;\n  openEnded = openEnded !== undefined ? openEnded : false;\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\n  thetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\n  var heightHalf = height / 2;\n  var x,\n      y,\n      vertices = [],\n      uvs = [];\n\n  for (y = 0; y <= heightSegments; y++) {\n    var verticesRow = [];\n    var uvsRow = [];\n    var v = y / heightSegments;\n    var radius = v * (radiusBottom - radiusTop) + radiusTop;\n\n    for (x = 0; x <= radialSegments; x++) {\n      var u = x / radialSegments;\n      var vertex = new THREE.Vector3();\n      vertex.x = radius * Math.sin(u * thetaLength + thetaStart);\n      vertex.y = -v * height + heightHalf;\n      vertex.z = radius * Math.cos(u * thetaLength + thetaStart);\n      this.vertices.push(vertex);\n      verticesRow.push(this.vertices.length - 1);\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\n    }\n\n    vertices.push(verticesRow);\n    uvs.push(uvsRow);\n  }\n\n  var tanTheta = (radiusBottom - radiusTop) / height;\n  var na, nb;\n\n  for (x = 0; x < radialSegments; x++) {\n    if (radiusTop !== 0) {\n      na = this.vertices[vertices[0][x]].clone();\n      nb = this.vertices[vertices[0][x + 1]].clone();\n    } else {\n      na = this.vertices[vertices[1][x]].clone();\n      nb = this.vertices[vertices[1][x + 1]].clone();\n    }\n\n    na.setY(Math.sqrt(na.x * na.x + na.z * na.z) * tanTheta).normalize();\n    nb.setY(Math.sqrt(nb.x * nb.x + nb.z * nb.z) * tanTheta).normalize();\n\n    for (y = 0; y < heightSegments; y++) {\n      var v1 = vertices[y][x];\n      var v2 = vertices[y + 1][x];\n      var v3 = vertices[y + 1][x + 1];\n      var v4 = vertices[y][x + 1];\n      var n1 = na.clone();\n      var n2 = na.clone();\n      var n3 = nb.clone();\n      var n4 = nb.clone();\n      var uv1 = uvs[y][x].clone();\n      var uv2 = uvs[y + 1][x].clone();\n      var uv3 = uvs[y + 1][x + 1].clone();\n      var uv4 = uvs[y][x + 1].clone();\n      this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\n      this.faceVertexUvs[0].push([uv1, uv2, uv4]);\n      this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\n      this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\n    }\n  } // top cap\n\n\n  if (openEnded === false && radiusTop > 0) {\n    this.vertices.push(new THREE.Vector3(0, heightHalf, 0));\n\n    for (x = 0; x < radialSegments; x++) {\n      var v1 = vertices[0][x];\n      var v2 = vertices[0][x + 1];\n      var v3 = this.vertices.length - 1;\n      var n1 = new THREE.Vector3(0, 1, 0);\n      var n2 = new THREE.Vector3(0, 1, 0);\n      var n3 = new THREE.Vector3(0, 1, 0);\n      var uv1 = uvs[0][x].clone();\n      var uv2 = uvs[0][x + 1].clone();\n      var uv3 = new THREE.Vector2(uv2.x, 0);\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3], undefined, 1));\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\n    }\n  } // bottom cap\n\n\n  if (openEnded === false && radiusBottom > 0) {\n    this.vertices.push(new THREE.Vector3(0, -heightHalf, 0));\n\n    for (x = 0; x < radialSegments; x++) {\n      var v1 = vertices[heightSegments][x + 1];\n      var v2 = vertices[heightSegments][x];\n      var v3 = this.vertices.length - 1;\n      var n1 = new THREE.Vector3(0, -1, 0);\n      var n2 = new THREE.Vector3(0, -1, 0);\n      var n3 = new THREE.Vector3(0, -1, 0);\n      var uv1 = uvs[heightSegments][x + 1].clone();\n      var uv2 = uvs[heightSegments][x].clone();\n      var uv3 = new THREE.Vector2(uv2.x, 1);\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3], undefined, 2));\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\n    }\n  }\n\n  this.computeFaceNormals();\n};\n\nTHREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\n\nTHREE.CylinderGeometry.prototype.clone = function () {\n  var geometry = new THREE.CylinderGeometry(this.parameters.radiusTop, this.parameters.radiusBottom, this.parameters.height, this.parameters.radialSegments, this.parameters.heightSegments, this.parameters.openEnded, this.parameters.thetaStart, this.parameters.thetaLength);\n  return geometry;\n}; // File:src/extras/geometries/EdgesGeometry.js\n\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\n\nTHREE.EdgesGeometry = function (geometry, thresholdAngle) {\n  THREE.BufferGeometry.call(this);\n  thresholdAngle = thresholdAngle !== undefined ? thresholdAngle : 1;\n  var thresholdDot = Math.cos(THREE.Math.degToRad(thresholdAngle));\n  var edge = [0, 0],\n      hash = {};\n\n  var sortFunction = function (a, b) {\n    return a - b;\n  };\n\n  var keys = ['a', 'b', 'c'];\n  var geometry2;\n\n  if (geometry instanceof THREE.BufferGeometry) {\n    geometry2 = new THREE.Geometry();\n    geometry2.fromBufferGeometry(geometry);\n  } else {\n    geometry2 = geometry.clone();\n  }\n\n  geometry2.mergeVertices();\n  geometry2.computeFaceNormals();\n  var vertices = geometry2.vertices;\n  var faces = geometry2.faces;\n\n  for (var i = 0, l = faces.length; i < l; i++) {\n    var face = faces[i];\n\n    for (var j = 0; j < 3; j++) {\n      edge[0] = face[keys[j]];\n      edge[1] = face[keys[(j + 1) % 3]];\n      edge.sort(sortFunction);\n      var key = edge.toString();\n\n      if (hash[key] === undefined) {\n        hash[key] = {\n          vert1: edge[0],\n          vert2: edge[1],\n          face1: i,\n          face2: undefined\n        };\n      } else {\n        hash[key].face2 = i;\n      }\n    }\n  }\n\n  var coords = [];\n\n  for (var key in hash) {\n    var h = hash[key];\n\n    if (h.face2 === undefined || faces[h.face1].normal.dot(faces[h.face2].normal) <= thresholdDot) {\n      var vertex = vertices[h.vert1];\n      coords.push(vertex.x);\n      coords.push(vertex.y);\n      coords.push(vertex.z);\n      vertex = vertices[h.vert2];\n      coords.push(vertex.x);\n      coords.push(vertex.y);\n      coords.push(vertex.z);\n    }\n  }\n\n  this.addAttribute('position', new THREE.BufferAttribute(new Float32Array(coords), 3));\n};\n\nTHREE.EdgesGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.EdgesGeometry.prototype.constructor = THREE.EdgesGeometry; // File:src/extras/geometries/ExtrudeGeometry.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\n\nTHREE.ExtrudeGeometry = function (shapes, options) {\n  if (typeof shapes === \"undefined\") {\n    shapes = [];\n    return;\n  }\n\n  THREE.Geometry.call(this);\n  this.type = 'ExtrudeGeometry';\n  shapes = Array.isArray(shapes) ? shapes : [shapes];\n  this.addShapeList(shapes, options);\n  this.computeFaceNormals(); // can't really use automatic vertex normals\n  // as then front and back sides get smoothed too\n  // should do separate smoothing just for sides\n  //this.computeVertexNormals();\n  //console.log( \"took\", ( Date.now() - startTime ) );\n};\n\nTHREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\n\nTHREE.ExtrudeGeometry.prototype.addShapeList = function (shapes, options) {\n  var sl = shapes.length;\n\n  for (var s = 0; s < sl; s++) {\n    var shape = shapes[s];\n    this.addShape(shape, options);\n  }\n};\n\nTHREE.ExtrudeGeometry.prototype.addShape = function (shape, options) {\n  var amount = options.amount !== undefined ? options.amount : 100;\n  var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\n\n  var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\n\n  var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\n  var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\n\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\n  var steps = options.steps !== undefined ? options.steps : 1;\n  var extrudePath = options.extrudePath;\n  var extrudePts,\n      extrudeByPath = false; // Use default WorldUVGenerator if no UV generators are specified.\n\n  var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\n  var splineTube, binormal, normal, position2;\n\n  if (extrudePath) {\n    extrudePts = extrudePath.getSpacedPoints(steps);\n    extrudeByPath = true;\n    bevelEnabled = false; // bevels not supported for path extrusion\n    // SETUP TNB variables\n    // Reuse TNB from TubeGeomtry for now.\n    // TODO1 - have a .isClosed in spline?\n\n    splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false); // console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\n\n    binormal = new THREE.Vector3();\n    normal = new THREE.Vector3();\n    position2 = new THREE.Vector3();\n  } // Safeguards if bevels are not enabled\n\n\n  if (!bevelEnabled) {\n    bevelSegments = 0;\n    bevelThickness = 0;\n    bevelSize = 0;\n  } // Variables initialization\n\n\n  var ahole, h, hl; // looping of holes\n\n  var scope = this;\n  var shapesOffset = this.vertices.length;\n  var shapePoints = shape.extractPoints(curveSegments);\n  var vertices = shapePoints.shape;\n  var holes = shapePoints.holes;\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\n\n  if (reverse) {\n    vertices = vertices.reverse(); // Maybe we should also check if holes are in the opposite direction, just to be safe ...\n\n    for (h = 0, hl = holes.length; h < hl; h++) {\n      ahole = holes[h];\n\n      if (THREE.Shape.Utils.isClockWise(ahole)) {\n        holes[h] = ahole.reverse();\n      }\n    }\n\n    reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\n  }\n\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\n  /* Vertices */\n\n  var contour = vertices; // vertices has all points but contour has only points of circumference\n\n  for (h = 0, hl = holes.length; h < hl; h++) {\n    ahole = holes[h];\n    vertices = vertices.concat(ahole);\n  }\n\n  function scalePt2(pt, vec, size) {\n    if (!vec) console.error(\"THREE.ExtrudeGeometry: vec does not exist\");\n    return vec.clone().multiplyScalar(size).add(pt);\n  }\n\n  var b,\n      bs,\n      t,\n      z,\n      vert,\n      vlen = vertices.length,\n      face,\n      flen = faces.length; // Find directions for point movement\n\n  function getBevelVec(inPt, inPrev, inNext) {\n    var EPSILON = 0.0000000001; // computes for inPt the corresponding point inPt' on a new contour\n    //   shifted by 1 unit (length of normalized vector) to the left\n    // if we walk along contour clockwise, this new contour is outside the old one\n    //\n    // inPt' is the intersection of the two lines parallel to the two\n    //  adjacent edges of inPt at a distance of 1 unit on the left side.\n\n    var v_trans_x,\n        v_trans_y,\n        shrink_by = 1; // resulting translation vector for inPt\n    // good reading for geometry algorithms (here: line-line intersection)\n    // http://geomalgorithms.com/a05-_intersect-1.html\n\n    var v_prev_x = inPt.x - inPrev.x,\n        v_prev_y = inPt.y - inPrev.y;\n    var v_next_x = inNext.x - inPt.x,\n        v_next_y = inNext.y - inPt.y;\n    var v_prev_lensq = v_prev_x * v_prev_x + v_prev_y * v_prev_y; // check for collinear edges\n\n    var collinear0 = v_prev_x * v_next_y - v_prev_y * v_next_x;\n\n    if (Math.abs(collinear0) > EPSILON) {\n      // not collinear\n      // length of vectors for normalizing\n      var v_prev_len = Math.sqrt(v_prev_lensq);\n      var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y); // shift adjacent points by unit vectors to the left\n\n      var ptPrevShift_x = inPrev.x - v_prev_y / v_prev_len;\n      var ptPrevShift_y = inPrev.y + v_prev_x / v_prev_len;\n      var ptNextShift_x = inNext.x - v_next_y / v_next_len;\n      var ptNextShift_y = inNext.y + v_next_x / v_next_len; // scaling factor for v_prev to intersection point\n\n      var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y - (ptNextShift_y - ptPrevShift_y) * v_next_x) / (v_prev_x * v_next_y - v_prev_y * v_next_x); // vector from inPt to intersection point\n\n      v_trans_x = ptPrevShift_x + v_prev_x * sf - inPt.x;\n      v_trans_y = ptPrevShift_y + v_prev_y * sf - inPt.y; // Don't normalize!, otherwise sharp corners become ugly\n      //  but prevent crazy spikes\n\n      var v_trans_lensq = v_trans_x * v_trans_x + v_trans_y * v_trans_y;\n\n      if (v_trans_lensq <= 2) {\n        return new THREE.Vector2(v_trans_x, v_trans_y);\n      } else {\n        shrink_by = Math.sqrt(v_trans_lensq / 2);\n      }\n    } else {\n      // handle special case of collinear edges\n      var direction_eq = false; // assumes: opposite\n\n      if (v_prev_x > EPSILON) {\n        if (v_next_x > EPSILON) {\n          direction_eq = true;\n        }\n      } else {\n        if (v_prev_x < -EPSILON) {\n          if (v_next_x < -EPSILON) {\n            direction_eq = true;\n          }\n        } else {\n          if (Math.sign(v_prev_y) === Math.sign(v_next_y)) {\n            direction_eq = true;\n          }\n        }\n      }\n\n      if (direction_eq) {\n        // console.log(\"Warning: lines are a straight sequence\");\n        v_trans_x = -v_prev_y;\n        v_trans_y = v_prev_x;\n        shrink_by = Math.sqrt(v_prev_lensq);\n      } else {\n        // console.log(\"Warning: lines are a straight spike\");\n        v_trans_x = v_prev_x;\n        v_trans_y = v_prev_y;\n        shrink_by = Math.sqrt(v_prev_lensq / 2);\n      }\n    }\n\n    return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);\n  }\n\n  var contourMovements = [];\n\n  for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\n    if (j === il) j = 0;\n    if (k === il) k = 0; //  (j)---(i)---(k)\n    // console.log('i,j,k', i, j , k)\n\n    contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);\n  }\n\n  var holesMovements = [],\n      oneHoleMovements,\n      verticesMovements = contourMovements.concat();\n\n  for (h = 0, hl = holes.length; h < hl; h++) {\n    ahole = holes[h];\n    oneHoleMovements = [];\n\n    for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\n      if (j === il) j = 0;\n      if (k === il) k = 0; //  (j)---(i)---(k)\n\n      oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);\n    }\n\n    holesMovements.push(oneHoleMovements);\n    verticesMovements = verticesMovements.concat(oneHoleMovements);\n  } // Loop bevelSegments, 1 for the front, 1 for the back\n\n\n  for (b = 0; b < bevelSegments; b++) {\n    //for ( b = bevelSegments; b > 0; b -- ) {\n    t = b / bevelSegments;\n    z = bevelThickness * (1 - t); //z = bevelThickness * t;\n\n    bs = bevelSize * Math.sin(t * Math.PI / 2); // curved\n    //bs = bevelSize * t; // linear\n    // contract shape\n\n    for (i = 0, il = contour.length; i < il; i++) {\n      vert = scalePt2(contour[i], contourMovements[i], bs);\n      v(vert.x, vert.y, -z);\n    } // expand holes\n\n\n    for (h = 0, hl = holes.length; h < hl; h++) {\n      ahole = holes[h];\n      oneHoleMovements = holesMovements[h];\n\n      for (i = 0, il = ahole.length; i < il; i++) {\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\n        v(vert.x, vert.y, -z);\n      }\n    }\n  }\n\n  bs = bevelSize; // Back facing vertices\n\n  for (i = 0; i < vlen; i++) {\n    vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\n\n    if (!extrudeByPath) {\n      v(vert.x, vert.y, 0);\n    } else {\n      // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\n      normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);\n      binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);\n      position2.copy(extrudePts[0]).add(normal).add(binormal);\n      v(position2.x, position2.y, position2.z);\n    }\n  } // Add stepped vertices...\n  // Including front facing vertices\n\n\n  var s;\n\n  for (s = 1; s <= steps; s++) {\n    for (i = 0; i < vlen; i++) {\n      vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\n\n      if (!extrudeByPath) {\n        v(vert.x, vert.y, amount / steps * s);\n      } else {\n        // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\n        normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);\n        binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);\n        position2.copy(extrudePts[s]).add(normal).add(binormal);\n        v(position2.x, position2.y, position2.z);\n      }\n    }\n  } // Add bevel segments planes\n  //for ( b = 1; b <= bevelSegments; b ++ ) {\n\n\n  for (b = bevelSegments - 1; b >= 0; b--) {\n    t = b / bevelSegments;\n    z = bevelThickness * (1 - t); //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\n\n    bs = bevelSize * Math.sin(t * Math.PI / 2); // contract shape\n\n    for (i = 0, il = contour.length; i < il; i++) {\n      vert = scalePt2(contour[i], contourMovements[i], bs);\n      v(vert.x, vert.y, amount + z);\n    } // expand holes\n\n\n    for (h = 0, hl = holes.length; h < hl; h++) {\n      ahole = holes[h];\n      oneHoleMovements = holesMovements[h];\n\n      for (i = 0, il = ahole.length; i < il; i++) {\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\n\n        if (!extrudeByPath) {\n          v(vert.x, vert.y, amount + z);\n        } else {\n          v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);\n        }\n      }\n    }\n  }\n  /* Faces */\n  // Top and bottom faces\n\n\n  buildLidFaces(); // Sides faces\n\n  buildSideFaces(); /////  Internal functions\n\n  function buildLidFaces() {\n    if (bevelEnabled) {\n      var layer = 0; // steps + 1\n\n      var offset = vlen * layer; // Bottom faces\n\n      for (i = 0; i < flen; i++) {\n        face = faces[i];\n        f3(face[2] + offset, face[1] + offset, face[0] + offset);\n      }\n\n      layer = steps + bevelSegments * 2;\n      offset = vlen * layer; // Top faces\n\n      for (i = 0; i < flen; i++) {\n        face = faces[i];\n        f3(face[0] + offset, face[1] + offset, face[2] + offset);\n      }\n    } else {\n      // Bottom faces\n      for (i = 0; i < flen; i++) {\n        face = faces[i];\n        f3(face[2], face[1], face[0]);\n      } // Top faces\n\n\n      for (i = 0; i < flen; i++) {\n        face = faces[i];\n        f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);\n      }\n    }\n  } // Create faces for the z-sides of the shape\n\n\n  function buildSideFaces() {\n    var layeroffset = 0;\n    sidewalls(contour, layeroffset);\n    layeroffset += contour.length;\n\n    for (h = 0, hl = holes.length; h < hl; h++) {\n      ahole = holes[h];\n      sidewalls(ahole, layeroffset); //, true\n\n      layeroffset += ahole.length;\n    }\n  }\n\n  function sidewalls(contour, layeroffset) {\n    var j, k;\n    i = contour.length;\n\n    while (--i >= 0) {\n      j = i;\n      k = i - 1;\n      if (k < 0) k = contour.length - 1; //console.log('b', i,j, i-1, k,vertices.length);\n\n      var s = 0,\n          sl = steps + bevelSegments * 2;\n\n      for (s = 0; s < sl; s++) {\n        var slen1 = vlen * s;\n        var slen2 = vlen * (s + 1);\n        var a = layeroffset + j + slen1,\n            b = layeroffset + k + slen1,\n            c = layeroffset + k + slen2,\n            d = layeroffset + j + slen2;\n        f4(a, b, c, d, contour, s, sl, j, k);\n      }\n    }\n  }\n\n  function v(x, y, z) {\n    scope.vertices.push(new THREE.Vector3(x, y, z));\n  }\n\n  function f3(a, b, c) {\n    a += shapesOffset;\n    b += shapesOffset;\n    c += shapesOffset;\n    scope.faces.push(new THREE.Face3(a, b, c));\n    var uvs = uvgen.generateTopUV(scope, a, b, c);\n    scope.faceVertexUvs[0].push(uvs);\n  }\n\n  function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {\n    a += shapesOffset;\n    b += shapesOffset;\n    c += shapesOffset;\n    d += shapesOffset;\n    scope.faces.push(new THREE.Face3(a, b, d));\n    scope.faces.push(new THREE.Face3(b, c, d));\n    var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);\n    scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);\n    scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);\n  }\n};\n\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\n  generateTopUV: function (geometry, indexA, indexB, indexC) {\n    var vertices = geometry.vertices;\n    var a = vertices[indexA];\n    var b = vertices[indexB];\n    var c = vertices[indexC];\n    return [new THREE.Vector2(a.x, a.y), new THREE.Vector2(b.x, b.y), new THREE.Vector2(c.x, c.y)];\n  },\n  generateSideWallUV: function (geometry, indexA, indexB, indexC, indexD) {\n    var vertices = geometry.vertices;\n    var a = vertices[indexA];\n    var b = vertices[indexB];\n    var c = vertices[indexC];\n    var d = vertices[indexD];\n\n    if (Math.abs(a.y - b.y) < 0.01) {\n      return [new THREE.Vector2(a.x, 1 - a.z), new THREE.Vector2(b.x, 1 - b.z), new THREE.Vector2(c.x, 1 - c.z), new THREE.Vector2(d.x, 1 - d.z)];\n    } else {\n      return [new THREE.Vector2(a.y, 1 - a.z), new THREE.Vector2(b.y, 1 - b.z), new THREE.Vector2(c.y, 1 - c.z), new THREE.Vector2(d.y, 1 - d.z)];\n    }\n  }\n}; // File:src/extras/geometries/ShapeGeometry.js\n\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\n\nTHREE.ShapeGeometry = function (shapes, options) {\n  THREE.Geometry.call(this);\n  this.type = 'ShapeGeometry';\n  if (Array.isArray(shapes) === false) shapes = [shapes];\n  this.addShapeList(shapes, options);\n  this.computeFaceNormals();\n};\n\nTHREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\n\nTHREE.ShapeGeometry.prototype.addShapeList = function (shapes, options) {\n  for (var i = 0, l = shapes.length; i < l; i++) {\n    this.addShape(shapes[i], options);\n  }\n\n  return this;\n};\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\n\n\nTHREE.ShapeGeometry.prototype.addShape = function (shape, options) {\n  if (options === undefined) options = {};\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\n  var material = options.material;\n  var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator; //\n\n  var i, l, hole;\n  var shapesOffset = this.vertices.length;\n  var shapePoints = shape.extractPoints(curveSegments);\n  var vertices = shapePoints.shape;\n  var holes = shapePoints.holes;\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\n\n  if (reverse) {\n    vertices = vertices.reverse(); // Maybe we should also check if holes are in the opposite direction, just to be safe...\n\n    for (i = 0, l = holes.length; i < l; i++) {\n      hole = holes[i];\n\n      if (THREE.Shape.Utils.isClockWise(hole)) {\n        holes[i] = hole.reverse();\n      }\n    }\n\n    reverse = false;\n  }\n\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes); // Vertices\n\n  for (i = 0, l = holes.length; i < l; i++) {\n    hole = holes[i];\n    vertices = vertices.concat(hole);\n  } //\n\n\n  var vert,\n      vlen = vertices.length;\n  var face,\n      flen = faces.length;\n\n  for (i = 0; i < vlen; i++) {\n    vert = vertices[i];\n    this.vertices.push(new THREE.Vector3(vert.x, vert.y, 0));\n  }\n\n  for (i = 0; i < flen; i++) {\n    face = faces[i];\n    var a = face[0] + shapesOffset;\n    var b = face[1] + shapesOffset;\n    var c = face[2] + shapesOffset;\n    this.faces.push(new THREE.Face3(a, b, c, null, null, material));\n    this.faceVertexUvs[0].push(uvgen.generateTopUV(this, a, b, c));\n  }\n}; // File:src/extras/geometries/LatheGeometry.js\n\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\n// points - to create a closed torus, one must use a set of points \n//    like so: [ a, b, c, d, a ], see first is the same as last.\n// segments - the number of circumference segments to create\n// phiStart - the starting radian\n// phiLength - the radian (0 to 2*PI) range of the lathed section\n//    2*pi is a closed lathe, less than 2PI is a portion.\n\n\nTHREE.LatheGeometry = function (points, segments, phiStart, phiLength) {\n  THREE.Geometry.call(this);\n  this.type = 'LatheGeometry';\n  this.parameters = {\n    points: points,\n    segments: segments,\n    phiStart: phiStart,\n    phiLength: phiLength\n  };\n  segments = segments || 12;\n  phiStart = phiStart || 0;\n  phiLength = phiLength || 2 * Math.PI;\n  var inversePointLength = 1.0 / (points.length - 1);\n  var inverseSegments = 1.0 / segments;\n\n  for (var i = 0, il = segments; i <= il; i++) {\n    var phi = phiStart + i * inverseSegments * phiLength;\n    var c = Math.cos(phi),\n        s = Math.sin(phi);\n\n    for (var j = 0, jl = points.length; j < jl; j++) {\n      var pt = points[j];\n      var vertex = new THREE.Vector3();\n      vertex.x = c * pt.x - s * pt.y;\n      vertex.y = s * pt.x + c * pt.y;\n      vertex.z = pt.z;\n      this.vertices.push(vertex);\n    }\n  }\n\n  var np = points.length;\n\n  for (var i = 0, il = segments; i < il; i++) {\n    for (var j = 0, jl = points.length - 1; j < jl; j++) {\n      var base = j + np * i;\n      var a = base;\n      var b = base + np;\n      var c = base + 1 + np;\n      var d = base + 1;\n      var u0 = i * inverseSegments;\n      var v0 = j * inversePointLength;\n      var u1 = u0 + inverseSegments;\n      var v1 = v0 + inversePointLength;\n      this.faces.push(new THREE.Face3(a, b, d));\n      this.faceVertexUvs[0].push([new THREE.Vector2(u0, v0), new THREE.Vector2(u1, v0), new THREE.Vector2(u0, v1)]);\n      this.faces.push(new THREE.Face3(b, c, d));\n      this.faceVertexUvs[0].push([new THREE.Vector2(u1, v0), new THREE.Vector2(u1, v1), new THREE.Vector2(u0, v1)]);\n    }\n  }\n\n  this.mergeVertices();\n  this.computeFaceNormals();\n  this.computeVertexNormals();\n};\n\nTHREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry; // File:src/extras/geometries/PlaneGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\n\nTHREE.PlaneGeometry = function (width, height, widthSegments, heightSegments) {\n  THREE.Geometry.call(this);\n  this.type = 'PlaneGeometry';\n  this.parameters = {\n    width: width,\n    height: height,\n    widthSegments: widthSegments,\n    heightSegments: heightSegments\n  };\n  this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width, height, widthSegments, heightSegments));\n};\n\nTHREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\n\nTHREE.PlaneGeometry.prototype.clone = function () {\n  var geometry = new THREE.PlaneGeometry(this.parameters.width, this.parameters.height, this.parameters.widthSegments, this.parameters.heightSegments);\n  return geometry;\n}; // File:src/extras/geometries/PlaneBufferGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\n\n\nTHREE.PlaneBufferGeometry = function (width, height, widthSegments, heightSegments) {\n  THREE.BufferGeometry.call(this);\n  this.type = 'PlaneBufferGeometry';\n  this.parameters = {\n    width: width,\n    height: height,\n    widthSegments: widthSegments,\n    heightSegments: heightSegments\n  };\n  var width_half = width / 2;\n  var height_half = height / 2;\n  var gridX = Math.floor(widthSegments) || 1;\n  var gridY = Math.floor(heightSegments) || 1;\n  var gridX1 = gridX + 1;\n  var gridY1 = gridY + 1;\n  var segment_width = width / gridX;\n  var segment_height = height / gridY;\n  var vertices = new Float32Array(gridX1 * gridY1 * 3);\n  var normals = new Float32Array(gridX1 * gridY1 * 3);\n  var uvs = new Float32Array(gridX1 * gridY1 * 2);\n  var offset = 0;\n  var offset2 = 0;\n\n  for (var iy = 0; iy < gridY1; iy++) {\n    var y = iy * segment_height - height_half;\n\n    for (var ix = 0; ix < gridX1; ix++) {\n      var x = ix * segment_width - width_half;\n      vertices[offset] = x;\n      vertices[offset + 1] = -y;\n      normals[offset + 2] = 1;\n      uvs[offset2] = ix / gridX;\n      uvs[offset2 + 1] = 1 - iy / gridY;\n      offset += 3;\n      offset2 += 2;\n    }\n  }\n\n  offset = 0;\n  var indices = new (vertices.length / 3 > 65535 ? Uint32Array : Uint16Array)(gridX * gridY * 6);\n\n  for (var iy = 0; iy < gridY; iy++) {\n    for (var ix = 0; ix < gridX; ix++) {\n      var a = ix + gridX1 * iy;\n      var b = ix + gridX1 * (iy + 1);\n      var c = ix + 1 + gridX1 * (iy + 1);\n      var d = ix + 1 + gridX1 * iy;\n      indices[offset] = a;\n      indices[offset + 1] = b;\n      indices[offset + 2] = d;\n      indices[offset + 3] = b;\n      indices[offset + 4] = c;\n      indices[offset + 5] = d;\n      offset += 6;\n    }\n  }\n\n  this.setIndex(new THREE.BufferAttribute(indices, 1));\n  this.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\n};\n\nTHREE.PlaneBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\n\nTHREE.PlaneBufferGeometry.prototype.clone = function () {\n  var geometry = new THREE.PlaneBufferGeometry(this.parameters.width, this.parameters.height, this.parameters.widthSegments, this.parameters.heightSegments);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/RingGeometry.js\n\n/**\r\n * @author Kaleb Murphy\r\n */\n\n\nTHREE.RingGeometry = function (innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength) {\n  THREE.Geometry.call(this);\n  this.type = 'RingGeometry';\n  this.parameters = {\n    innerRadius: innerRadius,\n    outerRadius: outerRadius,\n    thetaSegments: thetaSegments,\n    phiSegments: phiSegments,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  innerRadius = innerRadius || 0;\n  outerRadius = outerRadius || 50;\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\n  thetaSegments = thetaSegments !== undefined ? Math.max(3, thetaSegments) : 8;\n  phiSegments = phiSegments !== undefined ? Math.max(1, phiSegments) : 8;\n  var i,\n      o,\n      uvs = [],\n      radius = innerRadius,\n      radiusStep = (outerRadius - innerRadius) / phiSegments;\n\n  for (i = 0; i < phiSegments + 1; i++) {\n    // concentric circles inside ring\n    for (o = 0; o < thetaSegments + 1; o++) {\n      // number of segments per circle\n      var vertex = new THREE.Vector3();\n      var segment = thetaStart + o / thetaSegments * thetaLength;\n      vertex.x = radius * Math.cos(segment);\n      vertex.y = radius * Math.sin(segment);\n      this.vertices.push(vertex);\n      uvs.push(new THREE.Vector2((vertex.x / outerRadius + 1) / 2, (vertex.y / outerRadius + 1) / 2));\n    }\n\n    radius += radiusStep;\n  }\n\n  var n = new THREE.Vector3(0, 0, 1);\n\n  for (i = 0; i < phiSegments; i++) {\n    // concentric circles inside ring\n    var thetaSegment = i * (thetaSegments + 1);\n\n    for (o = 0; o < thetaSegments; o++) {\n      // number of segments per circle\n      var segment = o + thetaSegment;\n      var v1 = segment;\n      var v2 = segment + thetaSegments + 1;\n      var v3 = segment + thetaSegments + 2;\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\n      v1 = segment;\n      v2 = segment + thetaSegments + 2;\n      v3 = segment + 1;\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\n    }\n  }\n\n  this.computeFaceNormals();\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n};\n\nTHREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\n\nTHREE.RingGeometry.prototype.clone = function () {\n  var geometry = new THREE.RingGeometry(this.parameters.innerRadius, this.parameters.outerRadius, this.parameters.thetaSegments, this.parameters.phiSegments, this.parameters.thetaStart, this.parameters.thetaLength);\n  return geometry;\n}; // File:src/extras/geometries/SphereGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.SphereGeometry = function (radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\n  THREE.Geometry.call(this);\n  this.type = 'SphereGeometry';\n  this.parameters = {\n    radius: radius,\n    widthSegments: widthSegments,\n    heightSegments: heightSegments,\n    phiStart: phiStart,\n    phiLength: phiLength,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  this.fromBufferGeometry(new THREE.SphereBufferGeometry(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength));\n};\n\nTHREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\n\nTHREE.SphereGeometry.prototype.clone = function () {\n  var geometry = new THREE.SphereGeometry(this.parameters.radius, this.parameters.widthSegments, this.parameters.heightSegments, this.parameters.phiStart, this.parameters.phiLength, this.parameters.thetaStart, this.parameters.thetaLength);\n  return geometry;\n}; // File:src/extras/geometries/SphereBufferGeometry.js\n\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * based on THREE.SphereGeometry\r\n */\n\n\nTHREE.SphereBufferGeometry = function (radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\n  THREE.BufferGeometry.call(this);\n  this.type = 'SphereBufferGeometry';\n  this.parameters = {\n    radius: radius,\n    widthSegments: widthSegments,\n    heightSegments: heightSegments,\n    phiStart: phiStart,\n    phiLength: phiLength,\n    thetaStart: thetaStart,\n    thetaLength: thetaLength\n  };\n  radius = radius || 50;\n  widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\n  heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\n  phiStart = phiStart !== undefined ? phiStart : 0;\n  phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\n  var thetaEnd = thetaStart + thetaLength;\n  var vertexCount = (widthSegments + 1) * (heightSegments + 1);\n  var positions = new THREE.BufferAttribute(new Float32Array(vertexCount * 3), 3);\n  var normals = new THREE.BufferAttribute(new Float32Array(vertexCount * 3), 3);\n  var uvs = new THREE.BufferAttribute(new Float32Array(vertexCount * 2), 2);\n  var index = 0,\n      vertices = [],\n      normal = new THREE.Vector3();\n\n  for (var y = 0; y <= heightSegments; y++) {\n    var verticesRow = [];\n    var v = y / heightSegments;\n\n    for (var x = 0; x <= widthSegments; x++) {\n      var u = x / widthSegments;\n      var px = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\n      var py = radius * Math.cos(thetaStart + v * thetaLength);\n      var pz = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\n      normal.set(px, py, pz).normalize();\n      positions.setXYZ(index, px, py, pz);\n      normals.setXYZ(index, normal.x, normal.y, normal.z);\n      uvs.setXY(index, u, 1 - v);\n      verticesRow.push(index);\n      index++;\n    }\n\n    vertices.push(verticesRow);\n  }\n\n  var indices = [];\n\n  for (var y = 0; y < heightSegments; y++) {\n    for (var x = 0; x < widthSegments; x++) {\n      var v1 = vertices[y][x + 1];\n      var v2 = vertices[y][x];\n      var v3 = vertices[y + 1][x];\n      var v4 = vertices[y + 1][x + 1];\n      if (y !== 0 || thetaStart > 0) indices.push(v1, v2, v4);\n      if (y !== heightSegments - 1 || thetaEnd < Math.PI) indices.push(v2, v3, v4);\n    }\n  }\n\n  this.setIndex(new THREE.BufferAttribute(new Uint16Array(indices), 1));\n  this.addAttribute('position', positions);\n  this.addAttribute('normal', normals);\n  this.addAttribute('uv', uvs);\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\n};\n\nTHREE.SphereBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.SphereBufferGeometry.prototype.constructor = THREE.SphereBufferGeometry;\n\nTHREE.SphereBufferGeometry.prototype.clone = function () {\n  var geometry = new THREE.SphereBufferGeometry(this.parameters.radius, this.parameters.widthSegments, this.parameters.heightSegments, this.parameters.phiStart, this.parameters.phiLength, this.parameters.thetaStart, this.parameters.thetaLength);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/TextGeometry.js\n\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\n\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\n\n\nTHREE.TextGeometry = function (text, parameters) {\n  parameters = parameters || {};\n  var textShapes = THREE.FontUtils.generateShapes(text, parameters); // translate parameters to ExtrudeGeometry API\n\n  parameters.amount = parameters.height !== undefined ? parameters.height : 50; // defaults\n\n  if (parameters.bevelThickness === undefined) parameters.bevelThickness = 10;\n  if (parameters.bevelSize === undefined) parameters.bevelSize = 8;\n  if (parameters.bevelEnabled === undefined) parameters.bevelEnabled = false;\n  THREE.ExtrudeGeometry.call(this, textShapes, parameters);\n  this.type = 'TextGeometry';\n};\n\nTHREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype);\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry; // File:src/extras/geometries/TorusGeometry.js\n\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\n\nTHREE.TorusGeometry = function (radius, tube, radialSegments, tubularSegments, arc) {\n  THREE.Geometry.call(this);\n  this.type = 'TorusGeometry';\n  this.parameters = {\n    radius: radius,\n    tube: tube,\n    radialSegments: radialSegments,\n    tubularSegments: tubularSegments,\n    arc: arc\n  };\n  radius = radius || 100;\n  tube = tube || 40;\n  radialSegments = radialSegments || 8;\n  tubularSegments = tubularSegments || 6;\n  arc = arc || Math.PI * 2;\n  var center = new THREE.Vector3(),\n      uvs = [],\n      normals = [];\n\n  for (var j = 0; j <= radialSegments; j++) {\n    for (var i = 0; i <= tubularSegments; i++) {\n      var u = i / tubularSegments * arc;\n      var v = j / radialSegments * Math.PI * 2;\n      center.x = radius * Math.cos(u);\n      center.y = radius * Math.sin(u);\n      var vertex = new THREE.Vector3();\n      vertex.x = (radius + tube * Math.cos(v)) * Math.cos(u);\n      vertex.y = (radius + tube * Math.cos(v)) * Math.sin(u);\n      vertex.z = tube * Math.sin(v);\n      this.vertices.push(vertex);\n      uvs.push(new THREE.Vector2(i / tubularSegments, j / radialSegments));\n      normals.push(vertex.clone().sub(center).normalize());\n    }\n  }\n\n  for (var j = 1; j <= radialSegments; j++) {\n    for (var i = 1; i <= tubularSegments; i++) {\n      var a = (tubularSegments + 1) * j + i - 1;\n      var b = (tubularSegments + 1) * (j - 1) + i - 1;\n      var c = (tubularSegments + 1) * (j - 1) + i;\n      var d = (tubularSegments + 1) * j + i;\n      var face = new THREE.Face3(a, b, d, [normals[a].clone(), normals[b].clone(), normals[d].clone()]);\n      this.faces.push(face);\n      this.faceVertexUvs[0].push([uvs[a].clone(), uvs[b].clone(), uvs[d].clone()]);\n      face = new THREE.Face3(b, c, d, [normals[b].clone(), normals[c].clone(), normals[d].clone()]);\n      this.faces.push(face);\n      this.faceVertexUvs[0].push([uvs[b].clone(), uvs[c].clone(), uvs[d].clone()]);\n    }\n  }\n\n  this.computeFaceNormals();\n};\n\nTHREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\n\nTHREE.TorusGeometry.prototype.clone = function () {\n  var geometry = new THREE.TorusGeometry(this.parameters.radius, this.parameters.tube, this.parameters.radialSegments, this.parameters.tubularSegments, this.parameters.arc);\n  return geometry;\n}; // File:src/extras/geometries/TorusKnotGeometry.js\n\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\n\n\nTHREE.TorusKnotGeometry = function (radius, tube, radialSegments, tubularSegments, p, q, heightScale) {\n  THREE.Geometry.call(this);\n  this.type = 'TorusKnotGeometry';\n  this.parameters = {\n    radius: radius,\n    tube: tube,\n    radialSegments: radialSegments,\n    tubularSegments: tubularSegments,\n    p: p,\n    q: q,\n    heightScale: heightScale\n  };\n  radius = radius || 100;\n  tube = tube || 40;\n  radialSegments = radialSegments || 64;\n  tubularSegments = tubularSegments || 8;\n  p = p || 2;\n  q = q || 3;\n  heightScale = heightScale || 1;\n  var grid = new Array(radialSegments);\n  var tang = new THREE.Vector3();\n  var n = new THREE.Vector3();\n  var bitan = new THREE.Vector3();\n\n  for (var i = 0; i < radialSegments; ++i) {\n    grid[i] = new Array(tubularSegments);\n    var u = i / radialSegments * 2 * p * Math.PI;\n    var p1 = getPos(u, q, p, radius, heightScale);\n    var p2 = getPos(u + 0.01, q, p, radius, heightScale);\n    tang.subVectors(p2, p1);\n    n.addVectors(p2, p1);\n    bitan.crossVectors(tang, n);\n    n.crossVectors(bitan, tang);\n    bitan.normalize();\n    n.normalize();\n\n    for (var j = 0; j < tubularSegments; ++j) {\n      var v = j / tubularSegments * 2 * Math.PI;\n      var cx = -tube * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\n\n      var cy = tube * Math.sin(v);\n      var pos = new THREE.Vector3();\n      pos.x = p1.x + cx * n.x + cy * bitan.x;\n      pos.y = p1.y + cx * n.y + cy * bitan.y;\n      pos.z = p1.z + cx * n.z + cy * bitan.z;\n      grid[i][j] = this.vertices.push(pos) - 1;\n    }\n  }\n\n  for (var i = 0; i < radialSegments; ++i) {\n    for (var j = 0; j < tubularSegments; ++j) {\n      var ip = (i + 1) % radialSegments;\n      var jp = (j + 1) % tubularSegments;\n      var a = grid[i][j];\n      var b = grid[ip][j];\n      var c = grid[ip][jp];\n      var d = grid[i][jp];\n      var uva = new THREE.Vector2(i / radialSegments, j / tubularSegments);\n      var uvb = new THREE.Vector2((i + 1) / radialSegments, j / tubularSegments);\n      var uvc = new THREE.Vector2((i + 1) / radialSegments, (j + 1) / tubularSegments);\n      var uvd = new THREE.Vector2(i / radialSegments, (j + 1) / tubularSegments);\n      this.faces.push(new THREE.Face3(a, b, d));\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\n      this.faces.push(new THREE.Face3(b, c, d));\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\n    }\n  }\n\n  this.computeFaceNormals();\n  this.computeVertexNormals();\n\n  function getPos(u, in_q, in_p, radius, heightScale) {\n    var cu = Math.cos(u);\n    var su = Math.sin(u);\n    var quOverP = in_q / in_p * u;\n    var cs = Math.cos(quOverP);\n    var tx = radius * (2 + cs) * 0.5 * cu;\n    var ty = radius * (2 + cs) * su * 0.5;\n    var tz = heightScale * radius * Math.sin(quOverP) * 0.5;\n    return new THREE.Vector3(tx, ty, tz);\n  }\n};\n\nTHREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\n\nTHREE.TorusKnotGeometry.prototype.clone = function () {\n  var geometry = new THREE.TorusKnotGeometry(this.parameters.radius, this.parameters.tube, this.parameters.radialSegments, this.parameters.tubularSegments, this.parameters.p, this.parameters.q, this.parameters.heightScale);\n  return geometry;\n}; // File:src/extras/geometries/TubeGeometry.js\n\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\n\n\nTHREE.TubeGeometry = function (path, segments, radius, radialSegments, closed, taper) {\n  THREE.Geometry.call(this);\n  this.type = 'TubeGeometry';\n  this.parameters = {\n    path: path,\n    segments: segments,\n    radius: radius,\n    radialSegments: radialSegments,\n    closed: closed\n  };\n  segments = segments || 64;\n  radius = radius || 1;\n  radialSegments = radialSegments || 8;\n  closed = closed || false;\n  taper = taper || THREE.TubeGeometry.NoTaper;\n  var grid = [];\n  var scope = this,\n      tangent,\n      normal,\n      binormal,\n      numpoints = segments + 1,\n      u,\n      v,\n      r,\n      cx,\n      cy,\n      pos,\n      pos2 = new THREE.Vector3(),\n      i,\n      j,\n      ip,\n      jp,\n      a,\n      b,\n      c,\n      d,\n      uva,\n      uvb,\n      uvc,\n      uvd;\n  var frames = new THREE.TubeGeometry.FrenetFrames(path, segments, closed),\n      tangents = frames.tangents,\n      normals = frames.normals,\n      binormals = frames.binormals; // proxy internals\n\n  this.tangents = tangents;\n  this.normals = normals;\n  this.binormals = binormals;\n\n  function vert(x, y, z) {\n    return scope.vertices.push(new THREE.Vector3(x, y, z)) - 1;\n  } // construct the grid\n\n\n  for (i = 0; i < numpoints; i++) {\n    grid[i] = [];\n    u = i / (numpoints - 1);\n    pos = path.getPointAt(u);\n    tangent = tangents[i];\n    normal = normals[i];\n    binormal = binormals[i];\n    r = radius * taper(u);\n\n    for (j = 0; j < radialSegments; j++) {\n      v = j / radialSegments * 2 * Math.PI;\n      cx = -r * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\n\n      cy = r * Math.sin(v);\n      pos2.copy(pos);\n      pos2.x += cx * normal.x + cy * binormal.x;\n      pos2.y += cx * normal.y + cy * binormal.y;\n      pos2.z += cx * normal.z + cy * binormal.z;\n      grid[i][j] = vert(pos2.x, pos2.y, pos2.z);\n    }\n  } // construct the mesh\n\n\n  for (i = 0; i < segments; i++) {\n    for (j = 0; j < radialSegments; j++) {\n      ip = closed ? (i + 1) % segments : i + 1;\n      jp = (j + 1) % radialSegments;\n      a = grid[i][j]; // *** NOT NECESSARILY PLANAR ! ***\n\n      b = grid[ip][j];\n      c = grid[ip][jp];\n      d = grid[i][jp];\n      uva = new THREE.Vector2(i / segments, j / radialSegments);\n      uvb = new THREE.Vector2((i + 1) / segments, j / radialSegments);\n      uvc = new THREE.Vector2((i + 1) / segments, (j + 1) / radialSegments);\n      uvd = new THREE.Vector2(i / segments, (j + 1) / radialSegments);\n      this.faces.push(new THREE.Face3(a, b, d));\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\n      this.faces.push(new THREE.Face3(b, c, d));\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\n    }\n  }\n\n  this.computeFaceNormals();\n  this.computeVertexNormals();\n};\n\nTHREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\n\nTHREE.TubeGeometry.NoTaper = function (u) {\n  return 1;\n};\n\nTHREE.TubeGeometry.SinusoidalTaper = function (u) {\n  return Math.sin(Math.PI * u);\n}; // For computing of Frenet frames, exposing the tangents, normals and binormals the spline\n\n\nTHREE.TubeGeometry.FrenetFrames = function (path, segments, closed) {\n  var normal = new THREE.Vector3(),\n      tangents = [],\n      normals = [],\n      binormals = [],\n      vec = new THREE.Vector3(),\n      mat = new THREE.Matrix4(),\n      numpoints = segments + 1,\n      theta,\n      epsilon = 0.0001,\n      smallest,\n      tx,\n      ty,\n      tz,\n      i,\n      u; // expose internals\n\n  this.tangents = tangents;\n  this.normals = normals;\n  this.binormals = binormals; // compute the tangent vectors for each segment on the path\n\n  for (i = 0; i < numpoints; i++) {\n    u = i / (numpoints - 1);\n    tangents[i] = path.getTangentAt(u);\n    tangents[i].normalize();\n  }\n\n  initialNormal3();\n  /*\r\n  function initialNormal1(lastBinormal) {\r\n  \t// fixed start binormal. Has dangers of 0 vectors\r\n  \tnormals[ 0 ] = new THREE.Vector3();\r\n  \tbinormals[ 0 ] = new THREE.Vector3();\r\n  \tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n  \tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  }\r\n  \n  function initialNormal2() {\r\n  \n  \t// This uses the Frenet-Serret formula for deriving binormal\r\n  \tvar t2 = path.getTangentAt( epsilon );\r\n  \n  \tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n  \n  \tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  \n  }\r\n  */\n\n  function initialNormal3() {\n    // select an initial normal vector perpendicular to the first tangent vector,\n    // and in the direction of the smallest tangent xyz component\n    normals[0] = new THREE.Vector3();\n    binormals[0] = new THREE.Vector3();\n    smallest = Number.MAX_VALUE;\n    tx = Math.abs(tangents[0].x);\n    ty = Math.abs(tangents[0].y);\n    tz = Math.abs(tangents[0].z);\n\n    if (tx <= smallest) {\n      smallest = tx;\n      normal.set(1, 0, 0);\n    }\n\n    if (ty <= smallest) {\n      smallest = ty;\n      normal.set(0, 1, 0);\n    }\n\n    if (tz <= smallest) {\n      normal.set(0, 0, 1);\n    }\n\n    vec.crossVectors(tangents[0], normal).normalize();\n    normals[0].crossVectors(tangents[0], vec);\n    binormals[0].crossVectors(tangents[0], normals[0]);\n  } // compute the slowly-varying normal and binormal vectors for each segment on the path\n\n\n  for (i = 1; i < numpoints; i++) {\n    normals[i] = normals[i - 1].clone();\n    binormals[i] = binormals[i - 1].clone();\n    vec.crossVectors(tangents[i - 1], tangents[i]);\n\n    if (vec.length() > epsilon) {\n      vec.normalize();\n      theta = Math.acos(THREE.Math.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\n\n      normals[i].applyMatrix4(mat.makeRotationAxis(vec, theta));\n    }\n\n    binormals[i].crossVectors(tangents[i], normals[i]);\n  } // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\n\n\n  if (closed) {\n    theta = Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints - 1]), -1, 1));\n    theta /= numpoints - 1;\n\n    if (tangents[0].dot(vec.crossVectors(normals[0], normals[numpoints - 1])) > 0) {\n      theta = -theta;\n    }\n\n    for (i = 1; i < numpoints; i++) {\n      // twist a little...\n      normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i], theta * i));\n      binormals[i].crossVectors(tangents[i], normals[i]);\n    }\n  }\n}; // File:src/extras/geometries/PolyhedronGeometry.js\n\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\n\n\nTHREE.PolyhedronGeometry = function (vertices, indices, radius, detail) {\n  THREE.Geometry.call(this);\n  this.type = 'PolyhedronGeometry';\n  this.parameters = {\n    vertices: vertices,\n    indices: indices,\n    radius: radius,\n    detail: detail\n  };\n  radius = radius || 1;\n  detail = detail || 0;\n  var that = this;\n\n  for (var i = 0, l = vertices.length; i < l; i += 3) {\n    prepare(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\n  }\n\n  var p = this.vertices;\n  var faces = [];\n\n  for (var i = 0, j = 0, l = indices.length; i < l; i += 3, j++) {\n    var v1 = p[indices[i]];\n    var v2 = p[indices[i + 1]];\n    var v3 = p[indices[i + 2]];\n    faces[j] = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()], undefined, j);\n  }\n\n  var centroid = new THREE.Vector3();\n\n  for (var i = 0, l = faces.length; i < l; i++) {\n    subdivide(faces[i], detail);\n  } // Handle case when face straddles the seam\n\n\n  for (var i = 0, l = this.faceVertexUvs[0].length; i < l; i++) {\n    var uvs = this.faceVertexUvs[0][i];\n    var x0 = uvs[0].x;\n    var x1 = uvs[1].x;\n    var x2 = uvs[2].x;\n    var max = Math.max(x0, Math.max(x1, x2));\n    var min = Math.min(x0, Math.min(x1, x2));\n\n    if (max > 0.9 && min < 0.1) {\n      // 0.9 is somewhat arbitrary\n      if (x0 < 0.2) uvs[0].x += 1;\n      if (x1 < 0.2) uvs[1].x += 1;\n      if (x2 < 0.2) uvs[2].x += 1;\n    }\n  } // Apply radius\n\n\n  for (var i = 0, l = this.vertices.length; i < l; i++) {\n    this.vertices[i].multiplyScalar(radius);\n  } // Merge vertices\n\n\n  this.mergeVertices();\n  this.computeFaceNormals();\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius); // Project vector onto sphere's surface\n\n  function prepare(vector) {\n    var vertex = vector.normalize().clone();\n    vertex.index = that.vertices.push(vertex) - 1; // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\n\n    var u = azimuth(vector) / 2 / Math.PI + 0.5;\n    var v = inclination(vector) / Math.PI + 0.5;\n    vertex.uv = new THREE.Vector2(u, 1 - v);\n    return vertex;\n  } // Approximate a curved face with recursively sub-divided triangles.\n\n\n  function make(v1, v2, v3, materialIndex) {\n    var face = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()], undefined, materialIndex);\n    that.faces.push(face);\n    centroid.copy(v1).add(v2).add(v3).divideScalar(3);\n    var azi = azimuth(centroid);\n    that.faceVertexUvs[0].push([correctUV(v1.uv, v1, azi), correctUV(v2.uv, v2, azi), correctUV(v3.uv, v3, azi)]);\n  } // Analytically subdivide a face to the required detail level.\n\n\n  function subdivide(face, detail) {\n    var cols = Math.pow(2, detail);\n    var a = prepare(that.vertices[face.a]);\n    var b = prepare(that.vertices[face.b]);\n    var c = prepare(that.vertices[face.c]);\n    var v = [];\n    var materialIndex = face.materialIndex; // Construct all of the vertices for this subdivision.\n\n    for (var i = 0; i <= cols; i++) {\n      v[i] = [];\n      var aj = prepare(a.clone().lerp(c, i / cols));\n      var bj = prepare(b.clone().lerp(c, i / cols));\n      var rows = cols - i;\n\n      for (var j = 0; j <= rows; j++) {\n        if (j === 0 && i === cols) {\n          v[i][j] = aj;\n        } else {\n          v[i][j] = prepare(aj.clone().lerp(bj, j / rows));\n        }\n      }\n    } // Construct all of the faces.\n\n\n    for (var i = 0; i < cols; i++) {\n      for (var j = 0; j < 2 * (cols - i) - 1; j++) {\n        var k = Math.floor(j / 2);\n\n        if (j % 2 === 0) {\n          make(v[i][k + 1], v[i + 1][k], v[i][k], materialIndex);\n        } else {\n          make(v[i][k + 1], v[i + 1][k + 1], v[i + 1][k], materialIndex);\n        }\n      }\n    }\n  } // Angle around the Y axis, counter-clockwise when looking from above.\n\n\n  function azimuth(vector) {\n    return Math.atan2(vector.z, -vector.x);\n  } // Angle above the XZ plane.\n\n\n  function inclination(vector) {\n    return Math.atan2(-vector.y, Math.sqrt(vector.x * vector.x + vector.z * vector.z));\n  } // Texture fixing helper. Spheres have some odd behaviours.\n\n\n  function correctUV(uv, vector, azimuth) {\n    if (azimuth < 0 && uv.x === 1) uv = new THREE.Vector2(uv.x - 1, uv.y);\n    if (vector.x === 0 && vector.z === 0) uv = new THREE.Vector2(azimuth / 2 / Math.PI + 0.5, uv.y);\n    return uv.clone();\n  }\n};\n\nTHREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\n\nTHREE.PolyhedronGeometry.prototype.clone = function () {\n  var geometry = new THREE.PolyhedronGeometry(this.parameters.vertices, this.parameters.indices, this.parameters.radius, this.parameters.detail);\n  return geometry.copy(this);\n};\n\nTHREE.PolyhedronGeometry.prototype.copy = function (source) {\n  THREE.Geometry.prototype.copy.call(this, source);\n  return this;\n}; // File:src/extras/geometries/DodecahedronGeometry.js\n\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\n\n\nTHREE.DodecahedronGeometry = function (radius, detail) {\n  var t = (1 + Math.sqrt(5)) / 2;\n  var r = 1 / t;\n  var vertices = [// (1, 1, 1)\n  -1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1, // (0, 1/, )\n  0, -r, -t, 0, -r, t, 0, r, -t, 0, r, t, // (1/, , 0)\n  -r, -t, 0, -r, t, 0, r, -t, 0, r, t, 0, // (, 0, 1/)\n  -t, 0, -r, t, 0, -r, -t, 0, r, t, 0, r];\n  var indices = [3, 11, 7, 3, 7, 15, 3, 15, 13, 7, 19, 17, 7, 17, 6, 7, 6, 15, 17, 4, 8, 17, 8, 10, 17, 10, 6, 8, 0, 16, 8, 16, 2, 8, 2, 10, 0, 12, 1, 0, 1, 18, 0, 18, 16, 6, 10, 2, 6, 2, 13, 6, 13, 15, 2, 16, 18, 2, 18, 3, 2, 3, 13, 18, 1, 9, 18, 9, 11, 18, 11, 3, 4, 14, 12, 4, 12, 0, 4, 0, 8, 11, 9, 5, 11, 5, 19, 11, 19, 7, 19, 5, 14, 19, 14, 4, 19, 4, 17, 1, 12, 14, 1, 14, 5, 1, 5, 9];\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\n  this.type = 'DodecahedronGeometry';\n  this.parameters = {\n    radius: radius,\n    detail: detail\n  };\n};\n\nTHREE.DodecahedronGeometry.prototype = Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\n\nTHREE.DodecahedronGeometry.prototype.clone = function () {\n  var geometry = new THREE.DodecahedronGeometry(this.parameters.radius, this.parameters.detail);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/IcosahedronGeometry.js\n\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\n\n\nTHREE.IcosahedronGeometry = function (radius, detail) {\n  var t = (1 + Math.sqrt(5)) / 2;\n  var vertices = [-1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, 0, 0, -1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, t, 0, -1, t, 0, 1, -t, 0, -1, -t, 0, 1];\n  var indices = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11, 1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8, 3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9, 4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1];\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\n  this.type = 'IcosahedronGeometry';\n  this.parameters = {\n    radius: radius,\n    detail: detail\n  };\n};\n\nTHREE.IcosahedronGeometry.prototype = Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\n\nTHREE.IcosahedronGeometry.prototype.clone = function () {\n  var geometry = new THREE.IcosahedronGeometry(this.parameters.radius, this.parameters.detail);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/OctahedronGeometry.js\n\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\n\n\nTHREE.OctahedronGeometry = function (radius, detail) {\n  var vertices = [1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1];\n  var indices = [0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2];\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\n  this.type = 'OctahedronGeometry';\n  this.parameters = {\n    radius: radius,\n    detail: detail\n  };\n};\n\nTHREE.OctahedronGeometry.prototype = Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\n\nTHREE.OctahedronGeometry.prototype.clone = function () {\n  var geometry = new THREE.OctahedronGeometry(this.parameters.radius, this.parameters.detail);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/TetrahedronGeometry.js\n\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\n\n\nTHREE.TetrahedronGeometry = function (radius, detail) {\n  var vertices = [1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1];\n  var indices = [2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1];\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\n  this.type = 'TetrahedronGeometry';\n  this.parameters = {\n    radius: radius,\n    detail: detail\n  };\n};\n\nTHREE.TetrahedronGeometry.prototype = Object.create(THREE.PolyhedronGeometry.prototype);\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\n\nTHREE.TetrahedronGeometry.prototype.clone = function () {\n  var geometry = new THREE.TetrahedronGeometry(this.parameters.radius, this.parameters.detail);\n  geometry.copy(this);\n  return geometry;\n}; // File:src/extras/geometries/ParametricGeometry.js\n\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\n\n\nTHREE.ParametricGeometry = function (func, slices, stacks) {\n  THREE.Geometry.call(this);\n  this.type = 'ParametricGeometry';\n  this.parameters = {\n    func: func,\n    slices: slices,\n    stacks: stacks\n  };\n  var verts = this.vertices;\n  var faces = this.faces;\n  var uvs = this.faceVertexUvs[0];\n  var i, j, p;\n  var u, v;\n  var sliceCount = slices + 1;\n\n  for (i = 0; i <= stacks; i++) {\n    v = i / stacks;\n\n    for (j = 0; j <= slices; j++) {\n      u = j / slices;\n      p = func(u, v);\n      verts.push(p);\n    }\n  }\n\n  var a, b, c, d;\n  var uva, uvb, uvc, uvd;\n\n  for (i = 0; i < stacks; i++) {\n    for (j = 0; j < slices; j++) {\n      a = i * sliceCount + j;\n      b = i * sliceCount + j + 1;\n      c = (i + 1) * sliceCount + j + 1;\n      d = (i + 1) * sliceCount + j;\n      uva = new THREE.Vector2(j / slices, i / stacks);\n      uvb = new THREE.Vector2((j + 1) / slices, i / stacks);\n      uvc = new THREE.Vector2((j + 1) / slices, (i + 1) / stacks);\n      uvd = new THREE.Vector2(j / slices, (i + 1) / stacks);\n      faces.push(new THREE.Face3(a, b, d));\n      uvs.push([uva, uvb, uvd]);\n      faces.push(new THREE.Face3(b, c, d));\n      uvs.push([uvb.clone(), uvc, uvd.clone()]);\n    }\n  } // console.log(this);\n  // magic bullet\n  // var diff = this.mergeVertices();\n  // console.log('removed ', diff, ' vertices by merging');\n\n\n  this.computeFaceNormals();\n  this.computeVertexNormals();\n};\n\nTHREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype);\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry; // File:src/extras/geometries/WireframeGeometry.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.WireframeGeometry = function (geometry) {\n  THREE.BufferGeometry.call(this);\n  var edge = [0, 0],\n      hash = {};\n\n  var sortFunction = function (a, b) {\n    return a - b;\n  };\n\n  var keys = ['a', 'b', 'c'];\n\n  if (geometry instanceof THREE.Geometry) {\n    var vertices = geometry.vertices;\n    var faces = geometry.faces;\n    var numEdges = 0; // allocate maximal size\n\n    var edges = new Uint32Array(6 * faces.length);\n\n    for (var i = 0, l = faces.length; i < l; i++) {\n      var face = faces[i];\n\n      for (var j = 0; j < 3; j++) {\n        edge[0] = face[keys[j]];\n        edge[1] = face[keys[(j + 1) % 3]];\n        edge.sort(sortFunction);\n        var key = edge.toString();\n\n        if (hash[key] === undefined) {\n          edges[2 * numEdges] = edge[0];\n          edges[2 * numEdges + 1] = edge[1];\n          hash[key] = true;\n          numEdges++;\n        }\n      }\n    }\n\n    var coords = new Float32Array(numEdges * 2 * 3);\n\n    for (var i = 0, l = numEdges; i < l; i++) {\n      for (var j = 0; j < 2; j++) {\n        var vertex = vertices[edges[2 * i + j]];\n        var index = 6 * i + 3 * j;\n        coords[index + 0] = vertex.x;\n        coords[index + 1] = vertex.y;\n        coords[index + 2] = vertex.z;\n      }\n    }\n\n    this.addAttribute('position', new THREE.BufferAttribute(coords, 3));\n  } else if (geometry instanceof THREE.BufferGeometry) {\n    if (geometry.index !== null) {\n      // Indexed BufferGeometry\n      var indices = geometry.index.array;\n      var vertices = geometry.attributes.position;\n      var drawcalls = geometry.drawcalls;\n      var numEdges = 0;\n\n      if (drawcalls.length === 0) {\n        geometry.addDrawCall(0, indices.length);\n      } // allocate maximal size\n\n\n      var edges = new Uint32Array(2 * indices.length);\n\n      for (var o = 0, ol = drawcalls.length; o < ol; ++o) {\n        var drawcall = drawcalls[o];\n        var start = drawcall.start;\n        var count = drawcall.count;\n\n        for (var i = start, il = start + count; i < il; i += 3) {\n          for (var j = 0; j < 3; j++) {\n            edge[0] = indices[i + j];\n            edge[1] = indices[i + (j + 1) % 3];\n            edge.sort(sortFunction);\n            var key = edge.toString();\n\n            if (hash[key] === undefined) {\n              edges[2 * numEdges] = edge[0];\n              edges[2 * numEdges + 1] = edge[1];\n              hash[key] = true;\n              numEdges++;\n            }\n          }\n        }\n      }\n\n      var coords = new Float32Array(numEdges * 2 * 3);\n\n      for (var i = 0, l = numEdges; i < l; i++) {\n        for (var j = 0; j < 2; j++) {\n          var index = 6 * i + 3 * j;\n          var index2 = edges[2 * i + j];\n          coords[index + 0] = vertices.getX(index2);\n          coords[index + 1] = vertices.getY(index2);\n          coords[index + 2] = vertices.getZ(index2);\n        }\n      }\n\n      this.addAttribute('position', new THREE.BufferAttribute(coords, 3));\n    } else {\n      // non-indexed BufferGeometry\n      var vertices = geometry.attributes.position.array;\n      var numEdges = vertices.length / 3;\n      var numTris = numEdges / 3;\n      var coords = new Float32Array(numEdges * 2 * 3);\n\n      for (var i = 0, l = numTris; i < l; i++) {\n        for (var j = 0; j < 3; j++) {\n          var index = 18 * i + 6 * j;\n          var index1 = 9 * i + 3 * j;\n          coords[index + 0] = vertices[index1];\n          coords[index + 1] = vertices[index1 + 1];\n          coords[index + 2] = vertices[index1 + 2];\n          var index2 = 9 * i + 3 * ((j + 1) % 3);\n          coords[index + 3] = vertices[index2];\n          coords[index + 4] = vertices[index2 + 1];\n          coords[index + 5] = vertices[index2 + 2];\n        }\n      }\n\n      this.addAttribute('position', new THREE.BufferAttribute(coords, 3));\n    }\n  }\n};\n\nTHREE.WireframeGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\nTHREE.WireframeGeometry.prototype.constructor = THREE.WireframeGeometry; // File:src/extras/helpers/AxisHelper.js\n\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\nTHREE.AxisHelper = function (size) {\n  size = size || 1;\n  var vertices = new Float32Array([0, 0, 0, size, 0, 0, 0, 0, 0, 0, size, 0, 0, 0, 0, 0, 0, size]);\n  var colors = new Float32Array([1, 0, 0, 1, 0.6, 0, 0, 1, 0, 0.6, 1, 0, 0, 0, 1, 0, 0.6, 1]);\n  var geometry = new THREE.BufferGeometry();\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\n  geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));\n  var material = new THREE.LineBasicMaterial({\n    vertexColors: THREE.VertexColors\n  });\n  THREE.LineSegments.call(this, geometry, material);\n};\n\nTHREE.AxisHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper; // File:src/extras/helpers/ArrowHelper.js\n\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\n\nTHREE.ArrowHelper = function () {\n  var lineGeometry = new THREE.Geometry();\n  lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));\n  var coneGeometry = new THREE.CylinderGeometry(0, 0.5, 1, 5, 1);\n  coneGeometry.translate(0, -0.5, 0);\n  return function ArrowHelper(dir, origin, length, color, headLength, headWidth) {\n    // dir is assumed to be normalized\n    THREE.Object3D.call(this);\n    if (color === undefined) color = 0xffff00;\n    if (length === undefined) length = 1;\n    if (headLength === undefined) headLength = 0.2 * length;\n    if (headWidth === undefined) headWidth = 0.2 * headLength;\n    this.position.copy(origin);\n\n    if (headLength < length) {\n      this.line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({\n        color: color\n      }));\n      this.line.matrixAutoUpdate = false;\n      this.add(this.line);\n    }\n\n    this.cone = new THREE.Mesh(coneGeometry, new THREE.MeshBasicMaterial({\n      color: color\n    }));\n    this.cone.matrixAutoUpdate = false;\n    this.add(this.cone);\n    this.setDirection(dir);\n    this.setLength(length, headLength, headWidth);\n  };\n}();\n\nTHREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\n\nTHREE.ArrowHelper.prototype.setDirection = function () {\n  var axis = new THREE.Vector3();\n  var radians;\n  return function setDirection(dir) {\n    // dir is assumed to be normalized\n    if (dir.y > 0.99999) {\n      this.quaternion.set(0, 0, 0, 1);\n    } else if (dir.y < -0.99999) {\n      this.quaternion.set(1, 0, 0, 0);\n    } else {\n      axis.set(dir.z, 0, -dir.x).normalize();\n      radians = Math.acos(dir.y);\n      this.quaternion.setFromAxisAngle(axis, radians);\n    }\n  };\n}();\n\nTHREE.ArrowHelper.prototype.setLength = function (length, headLength, headWidth) {\n  if (headLength === undefined) headLength = 0.2 * length;\n  if (headWidth === undefined) headWidth = 0.2 * headLength;\n\n  if (headLength < length) {\n    this.line.scale.set(1, length - headLength, 1);\n    this.line.updateMatrix();\n  }\n\n  this.cone.scale.set(headWidth, headLength, headWidth);\n  this.cone.position.y = length;\n  this.cone.updateMatrix();\n};\n\nTHREE.ArrowHelper.prototype.setColor = function (color) {\n  if (this.line !== undefined) this.line.material.color.set(color);\n  this.cone.material.color.set(color);\n}; // File:src/extras/helpers/BoxHelper.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.BoxHelper = function (object) {\n  var indices = new Uint16Array([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]);\n  var positions = new Float32Array(8 * 3);\n  var geometry = new THREE.BufferGeometry();\n  geometry.setIndex(new THREE.BufferAttribute(indices, 1));\n  geometry.addAttribute('position', new THREE.BufferAttribute(positions, 3));\n  THREE.LineSegments.call(this, geometry, new THREE.LineBasicMaterial({\n    color: 0xffff00\n  }));\n\n  if (object !== undefined) {\n    this.update(object);\n  }\n};\n\nTHREE.BoxHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\n\nTHREE.BoxHelper.prototype.update = function () {\n  var box = new THREE.Box3();\n  return function (object) {\n    box.setFromObject(object);\n    if (box.empty()) return;\n    var min = box.min;\n    var max = box.max;\n    /*\r\n      5____4\r\n    1/___0/|\r\n    | 6__|_7\r\n    2/___3/\r\n    \t\t0: max.x, max.y, max.z\r\n    1: min.x, max.y, max.z\r\n    2: min.x, min.y, max.z\r\n    3: max.x, min.y, max.z\r\n    4: max.x, max.y, min.z\r\n    5: min.x, max.y, min.z\r\n    6: min.x, min.y, min.z\r\n    7: max.x, min.y, min.z\r\n    */\n\n    var position = this.geometry.attributes.position;\n    var array = position.array;\n    array[0] = max.x;\n    array[1] = max.y;\n    array[2] = max.z;\n    array[3] = min.x;\n    array[4] = max.y;\n    array[5] = max.z;\n    array[6] = min.x;\n    array[7] = min.y;\n    array[8] = max.z;\n    array[9] = max.x;\n    array[10] = min.y;\n    array[11] = max.z;\n    array[12] = max.x;\n    array[13] = max.y;\n    array[14] = min.z;\n    array[15] = min.x;\n    array[16] = max.y;\n    array[17] = min.z;\n    array[18] = min.x;\n    array[19] = min.y;\n    array[20] = min.z;\n    array[21] = max.x;\n    array[22] = min.y;\n    array[23] = min.z;\n    position.needsUpdate = true;\n    this.geometry.computeBoundingSphere();\n  };\n}(); // File:src/extras/helpers/BoundingBoxHelper.js\n\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n// a helper to show the world-axis-aligned bounding box for an object\n\n\nTHREE.BoundingBoxHelper = function (object, hex) {\n  var color = hex !== undefined ? hex : 0x888888;\n  this.object = object;\n  this.box = new THREE.Box3();\n  THREE.Mesh.call(this, new THREE.BoxGeometry(1, 1, 1), new THREE.MeshBasicMaterial({\n    color: color,\n    wireframe: true\n  }));\n};\n\nTHREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype);\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\n\nTHREE.BoundingBoxHelper.prototype.update = function () {\n  this.box.setFromObject(this.object);\n  this.box.size(this.scale);\n  this.box.center(this.position);\n}; // File:src/extras/helpers/CameraHelper.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\n\n\nTHREE.CameraHelper = function (camera) {\n  var geometry = new THREE.Geometry();\n  var material = new THREE.LineBasicMaterial({\n    color: 0xffffff,\n    vertexColors: THREE.FaceColors\n  });\n  var pointMap = {}; // colors\n\n  var hexFrustum = 0xffaa00;\n  var hexCone = 0xff0000;\n  var hexUp = 0x00aaff;\n  var hexTarget = 0xffffff;\n  var hexCross = 0x333333; // near\n\n  addLine(\"n1\", \"n2\", hexFrustum);\n  addLine(\"n2\", \"n4\", hexFrustum);\n  addLine(\"n4\", \"n3\", hexFrustum);\n  addLine(\"n3\", \"n1\", hexFrustum); // far\n\n  addLine(\"f1\", \"f2\", hexFrustum);\n  addLine(\"f2\", \"f4\", hexFrustum);\n  addLine(\"f4\", \"f3\", hexFrustum);\n  addLine(\"f3\", \"f1\", hexFrustum); // sides\n\n  addLine(\"n1\", \"f1\", hexFrustum);\n  addLine(\"n2\", \"f2\", hexFrustum);\n  addLine(\"n3\", \"f3\", hexFrustum);\n  addLine(\"n4\", \"f4\", hexFrustum); // cone\n\n  addLine(\"p\", \"n1\", hexCone);\n  addLine(\"p\", \"n2\", hexCone);\n  addLine(\"p\", \"n3\", hexCone);\n  addLine(\"p\", \"n4\", hexCone); // up\n\n  addLine(\"u1\", \"u2\", hexUp);\n  addLine(\"u2\", \"u3\", hexUp);\n  addLine(\"u3\", \"u1\", hexUp); // target\n\n  addLine(\"c\", \"t\", hexTarget);\n  addLine(\"p\", \"c\", hexCross); // cross\n\n  addLine(\"cn1\", \"cn2\", hexCross);\n  addLine(\"cn3\", \"cn4\", hexCross);\n  addLine(\"cf1\", \"cf2\", hexCross);\n  addLine(\"cf3\", \"cf4\", hexCross);\n\n  function addLine(a, b, hex) {\n    addPoint(a, hex);\n    addPoint(b, hex);\n  }\n\n  function addPoint(id, hex) {\n    geometry.vertices.push(new THREE.Vector3());\n    geometry.colors.push(new THREE.Color(hex));\n\n    if (pointMap[id] === undefined) {\n      pointMap[id] = [];\n    }\n\n    pointMap[id].push(geometry.vertices.length - 1);\n  }\n\n  THREE.LineSegments.call(this, geometry, material);\n  this.camera = camera;\n  this.matrix = camera.matrixWorld;\n  this.matrixAutoUpdate = false;\n  this.pointMap = pointMap;\n  this.update();\n};\n\nTHREE.CameraHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\n\nTHREE.CameraHelper.prototype.update = function () {\n  var geometry, pointMap;\n  var vector = new THREE.Vector3();\n  var camera = new THREE.Camera();\n\n  var setPoint = function (point, x, y, z) {\n    vector.set(x, y, z).unproject(camera);\n    var points = pointMap[point];\n\n    if (points !== undefined) {\n      for (var i = 0, il = points.length; i < il; i++) {\n        geometry.vertices[points[i]].copy(vector);\n      }\n    }\n  };\n\n  return function () {\n    geometry = this.geometry;\n    pointMap = this.pointMap;\n    var w = 1,\n        h = 1; // we need just camera projection matrix\n    // world matrix must be identity\n\n    camera.projectionMatrix.copy(this.camera.projectionMatrix); // center / target\n\n    setPoint(\"c\", 0, 0, -1);\n    setPoint(\"t\", 0, 0, 1); // near\n\n    setPoint(\"n1\", -w, -h, -1);\n    setPoint(\"n2\", w, -h, -1);\n    setPoint(\"n3\", -w, h, -1);\n    setPoint(\"n4\", w, h, -1); // far\n\n    setPoint(\"f1\", -w, -h, 1);\n    setPoint(\"f2\", w, -h, 1);\n    setPoint(\"f3\", -w, h, 1);\n    setPoint(\"f4\", w, h, 1); // up\n\n    setPoint(\"u1\", w * 0.7, h * 1.1, -1);\n    setPoint(\"u2\", -w * 0.7, h * 1.1, -1);\n    setPoint(\"u3\", 0, h * 2, -1); // cross\n\n    setPoint(\"cf1\", -w, 0, 1);\n    setPoint(\"cf2\", w, 0, 1);\n    setPoint(\"cf3\", 0, -h, 1);\n    setPoint(\"cf4\", 0, h, 1);\n    setPoint(\"cn1\", -w, 0, -1);\n    setPoint(\"cn2\", w, 0, -1);\n    setPoint(\"cn3\", 0, -h, -1);\n    setPoint(\"cn4\", 0, h, -1);\n    geometry.verticesNeedUpdate = true;\n  };\n}(); // File:src/extras/helpers/DirectionalLightHelper.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\n\n\nTHREE.DirectionalLightHelper = function (light, size) {\n  THREE.Object3D.call(this);\n  this.light = light;\n  this.light.updateMatrixWorld();\n  this.matrix = light.matrixWorld;\n  this.matrixAutoUpdate = false;\n  size = size || 1;\n  var geometry = new THREE.Geometry();\n  geometry.vertices.push(new THREE.Vector3(-size, size, 0), new THREE.Vector3(size, size, 0), new THREE.Vector3(size, -size, 0), new THREE.Vector3(-size, -size, 0), new THREE.Vector3(-size, size, 0));\n  var material = new THREE.LineBasicMaterial({\n    fog: false\n  });\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n  this.lightPlane = new THREE.Line(geometry, material);\n  this.add(this.lightPlane);\n  geometry = new THREE.Geometry();\n  geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\n  material = new THREE.LineBasicMaterial({\n    fog: false\n  });\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n  this.targetLine = new THREE.Line(geometry, material);\n  this.add(this.targetLine);\n  this.update();\n};\n\nTHREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\n\nTHREE.DirectionalLightHelper.prototype.dispose = function () {\n  this.lightPlane.geometry.dispose();\n  this.lightPlane.material.dispose();\n  this.targetLine.geometry.dispose();\n  this.targetLine.material.dispose();\n};\n\nTHREE.DirectionalLightHelper.prototype.update = function () {\n  var v1 = new THREE.Vector3();\n  var v2 = new THREE.Vector3();\n  var v3 = new THREE.Vector3();\n  return function () {\n    v1.setFromMatrixPosition(this.light.matrixWorld);\n    v2.setFromMatrixPosition(this.light.target.matrixWorld);\n    v3.subVectors(v2, v1);\n    this.lightPlane.lookAt(v3);\n    this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n    this.targetLine.geometry.vertices[1].copy(v3);\n    this.targetLine.geometry.verticesNeedUpdate = true;\n    this.targetLine.material.color.copy(this.lightPlane.material.color);\n  };\n}(); // File:src/extras/helpers/EdgesHelper.js\n\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimum angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\n\n\nTHREE.EdgesHelper = function (object, hex, thresholdAngle) {\n  var color = hex !== undefined ? hex : 0xffffff;\n  THREE.LineSegments.call(this, new THREE.EdgesGeometry(object.geometry, thresholdAngle), new THREE.LineBasicMaterial({\n    color: color\n  }));\n  this.matrix = object.matrixWorld;\n  this.matrixAutoUpdate = false;\n};\n\nTHREE.EdgesHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper; // File:src/extras/helpers/FaceNormalsHelper.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\n\nTHREE.FaceNormalsHelper = function (object, size, hex, linewidth) {\n  // FaceNormalsHelper only supports THREE.Geometry\n  this.object = object;\n  this.size = size !== undefined ? size : 1;\n  var color = hex !== undefined ? hex : 0xffff00;\n  var width = linewidth !== undefined ? linewidth : 1; //\n\n  var nNormals = 0;\n  var objGeometry = this.object.geometry;\n\n  if (objGeometry instanceof THREE.Geometry) {\n    nNormals = objGeometry.faces.length;\n  } else {\n    console.warn('THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.');\n  } //\n\n\n  var geometry = new THREE.BufferGeometry();\n  var positions = new THREE.Float32Attribute(nNormals * 2 * 3, 3);\n  geometry.addAttribute('position', positions);\n  THREE.LineSegments.call(this, geometry, new THREE.LineBasicMaterial({\n    color: color,\n    linewidth: width\n  })); //\n\n  this.matrixAutoUpdate = false;\n  this.update();\n};\n\nTHREE.FaceNormalsHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\n\nTHREE.FaceNormalsHelper.prototype.update = function () {\n  var v1 = new THREE.Vector3();\n  var v2 = new THREE.Vector3();\n  var normalMatrix = new THREE.Matrix3();\n  return function update() {\n    this.object.updateMatrixWorld(true);\n    normalMatrix.getNormalMatrix(this.object.matrixWorld);\n    var matrixWorld = this.object.matrixWorld;\n    var position = this.geometry.attributes.position; //\n\n    var objGeometry = this.object.geometry;\n    var vertices = objGeometry.vertices;\n    var faces = objGeometry.faces;\n    var idx = 0;\n\n    for (var i = 0, l = faces.length; i < l; i++) {\n      var face = faces[i];\n      var normal = face.normal;\n      v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld);\n      v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);\n      position.setXYZ(idx, v1.x, v1.y, v1.z);\n      idx = idx + 1;\n      position.setXYZ(idx, v2.x, v2.y, v2.z);\n      idx = idx + 1;\n    }\n\n    position.needsUpdate = true;\n    return this;\n  };\n}(); // File:src/extras/helpers/GridHelper.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.GridHelper = function (size, step) {\n  var geometry = new THREE.Geometry();\n  var material = new THREE.LineBasicMaterial({\n    vertexColors: THREE.VertexColors\n  });\n  this.color1 = new THREE.Color(0x444444);\n  this.color2 = new THREE.Color(0x888888);\n\n  for (var i = -size; i <= size; i += step) {\n    geometry.vertices.push(new THREE.Vector3(-size, 0, i), new THREE.Vector3(size, 0, i), new THREE.Vector3(i, 0, -size), new THREE.Vector3(i, 0, size));\n    var color = i === 0 ? this.color1 : this.color2;\n    geometry.colors.push(color, color, color, color);\n  }\n\n  THREE.LineSegments.call(this, geometry, material);\n};\n\nTHREE.GridHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\n\nTHREE.GridHelper.prototype.setColors = function (colorCenterLine, colorGrid) {\n  this.color1.set(colorCenterLine);\n  this.color2.set(colorGrid);\n  this.geometry.colorsNeedUpdate = true;\n}; // File:src/extras/helpers/HemisphereLightHelper.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.HemisphereLightHelper = function (light, sphereSize) {\n  THREE.Object3D.call(this);\n  this.light = light;\n  this.light.updateMatrixWorld();\n  this.matrix = light.matrixWorld;\n  this.matrixAutoUpdate = false;\n  this.colors = [new THREE.Color(), new THREE.Color()];\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\n  geometry.rotateX(-Math.PI / 2);\n\n  for (var i = 0, il = 8; i < il; i++) {\n    geometry.faces[i].color = this.colors[i < 4 ? 0 : 1];\n  }\n\n  var material = new THREE.MeshBasicMaterial({\n    vertexColors: THREE.FaceColors,\n    wireframe: true\n  });\n  this.lightSphere = new THREE.Mesh(geometry, material);\n  this.add(this.lightSphere);\n  this.update();\n};\n\nTHREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\n\nTHREE.HemisphereLightHelper.prototype.dispose = function () {\n  this.lightSphere.geometry.dispose();\n  this.lightSphere.material.dispose();\n};\n\nTHREE.HemisphereLightHelper.prototype.update = function () {\n  var vector = new THREE.Vector3();\n  return function () {\n    this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);\n    this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);\n    this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());\n    this.lightSphere.geometry.colorsNeedUpdate = true;\n  };\n}(); // File:src/extras/helpers/PointLightHelper.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.PointLightHelper = function (light, sphereSize) {\n  this.light = light;\n  this.light.updateMatrixWorld();\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\n  var material = new THREE.MeshBasicMaterial({\n    wireframe: true,\n    fog: false\n  });\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n  THREE.Mesh.call(this, geometry, material);\n  this.matrix = this.light.matrixWorld;\n  this.matrixAutoUpdate = false;\n  /*\r\n  var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n  var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n  \n  this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n  this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n  \n  var d = light.distance;\r\n  \n  if ( d === 0.0 ) {\r\n  \n  \tthis.lightDistance.visible = false;\r\n  \n  } else {\r\n  \n  \tthis.lightDistance.scale.set( d, d, d );\r\n  \n  }\r\n  \n  this.add( this.lightDistance );\r\n  */\n};\n\nTHREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype);\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\n\nTHREE.PointLightHelper.prototype.dispose = function () {\n  this.geometry.dispose();\n  this.material.dispose();\n};\n\nTHREE.PointLightHelper.prototype.update = function () {\n  this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n  /*\r\n  var d = this.light.distance;\r\n  \n  if ( d === 0.0 ) {\r\n  \n  \tthis.lightDistance.visible = false;\r\n  \n  } else {\r\n  \n  \tthis.lightDistance.visible = true;\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n  \n  }\r\n  */\n}; // File:src/extras/helpers/SkeletonHelper.js\n\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\n\n\nTHREE.SkeletonHelper = function (object) {\n  this.bones = this.getBoneList(object);\n  var geometry = new THREE.Geometry();\n\n  for (var i = 0; i < this.bones.length; i++) {\n    var bone = this.bones[i];\n\n    if (bone.parent instanceof THREE.Bone) {\n      geometry.vertices.push(new THREE.Vector3());\n      geometry.vertices.push(new THREE.Vector3());\n      geometry.colors.push(new THREE.Color(0, 0, 1));\n      geometry.colors.push(new THREE.Color(0, 1, 0));\n    }\n  }\n\n  geometry.dynamic = true;\n  var material = new THREE.LineBasicMaterial({\n    vertexColors: THREE.VertexColors,\n    depthTest: false,\n    depthWrite: false,\n    transparent: true\n  });\n  THREE.LineSegments.call(this, geometry, material);\n  this.root = object;\n  this.matrix = object.matrixWorld;\n  this.matrixAutoUpdate = false;\n  this.update();\n};\n\nTHREE.SkeletonHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\n\nTHREE.SkeletonHelper.prototype.getBoneList = function (object) {\n  var boneList = [];\n\n  if (object instanceof THREE.Bone) {\n    boneList.push(object);\n  }\n\n  for (var i = 0; i < object.children.length; i++) {\n    boneList.push.apply(boneList, this.getBoneList(object.children[i]));\n  }\n\n  return boneList;\n};\n\nTHREE.SkeletonHelper.prototype.update = function () {\n  var geometry = this.geometry;\n  var matrixWorldInv = new THREE.Matrix4().getInverse(this.root.matrixWorld);\n  var boneMatrix = new THREE.Matrix4();\n  var j = 0;\n\n  for (var i = 0; i < this.bones.length; i++) {\n    var bone = this.bones[i];\n\n    if (bone.parent instanceof THREE.Bone) {\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.matrixWorld);\n      geometry.vertices[j].setFromMatrixPosition(boneMatrix);\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.parent.matrixWorld);\n      geometry.vertices[j + 1].setFromMatrixPosition(boneMatrix);\n      j += 2;\n    }\n  }\n\n  geometry.verticesNeedUpdate = true;\n  geometry.computeBoundingSphere();\n}; // File:src/extras/helpers/SpotLightHelper.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\n\n\nTHREE.SpotLightHelper = function (light) {\n  THREE.Object3D.call(this);\n  this.light = light;\n  this.light.updateMatrixWorld();\n  this.matrix = light.matrixWorld;\n  this.matrixAutoUpdate = false;\n  var geometry = new THREE.CylinderGeometry(0, 1, 1, 8, 1, true);\n  geometry.translate(0, -0.5, 0);\n  geometry.rotateX(-Math.PI / 2);\n  var material = new THREE.MeshBasicMaterial({\n    wireframe: true,\n    fog: false\n  });\n  this.cone = new THREE.Mesh(geometry, material);\n  this.add(this.cone);\n  this.update();\n};\n\nTHREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\n\nTHREE.SpotLightHelper.prototype.dispose = function () {\n  this.cone.geometry.dispose();\n  this.cone.material.dispose();\n};\n\nTHREE.SpotLightHelper.prototype.update = function () {\n  var vector = new THREE.Vector3();\n  var vector2 = new THREE.Vector3();\n  return function () {\n    var coneLength = this.light.distance ? this.light.distance : 10000;\n    var coneWidth = coneLength * Math.tan(this.light.angle);\n    this.cone.scale.set(coneWidth, coneWidth, coneLength);\n    vector.setFromMatrixPosition(this.light.matrixWorld);\n    vector2.setFromMatrixPosition(this.light.target.matrixWorld);\n    this.cone.lookAt(vector2.sub(vector));\n    this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\n  };\n}(); // File:src/extras/helpers/VertexNormalsHelper.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\n\n\nTHREE.VertexNormalsHelper = function (object, size, hex, linewidth) {\n  this.object = object;\n  this.size = size !== undefined ? size : 1;\n  var color = hex !== undefined ? hex : 0xff0000;\n  var width = linewidth !== undefined ? linewidth : 1; //\n\n  var nNormals = 0;\n  var objGeometry = this.object.geometry;\n\n  if (objGeometry instanceof THREE.Geometry) {\n    nNormals = objGeometry.faces.length * 3;\n  } else if (objGeometry instanceof THREE.BufferGeometry) {\n    nNormals = objGeometry.attributes.normal.count;\n  } //\n\n\n  var geometry = new THREE.BufferGeometry();\n  var positions = new THREE.Float32Attribute(nNormals * 2 * 3, 3);\n  geometry.addAttribute('position', positions);\n  THREE.LineSegments.call(this, geometry, new THREE.LineBasicMaterial({\n    color: color,\n    linewidth: width\n  })); //\n\n  this.matrixAutoUpdate = false;\n  this.update();\n};\n\nTHREE.VertexNormalsHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\n\nTHREE.VertexNormalsHelper.prototype.update = function () {\n  var v1 = new THREE.Vector3();\n  var v2 = new THREE.Vector3();\n  var normalMatrix = new THREE.Matrix3();\n  return function update() {\n    var keys = ['a', 'b', 'c'];\n    this.object.updateMatrixWorld(true);\n    normalMatrix.getNormalMatrix(this.object.matrixWorld);\n    var matrixWorld = this.object.matrixWorld;\n    var position = this.geometry.attributes.position; //\n\n    var objGeometry = this.object.geometry;\n\n    if (objGeometry instanceof THREE.Geometry) {\n      var vertices = objGeometry.vertices;\n      var faces = objGeometry.faces;\n      var idx = 0;\n\n      for (var i = 0, l = faces.length; i < l; i++) {\n        var face = faces[i];\n\n        for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\n          var vertex = vertices[face[keys[j]]];\n          var normal = face.vertexNormals[j];\n          v1.copy(vertex).applyMatrix4(matrixWorld);\n          v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);\n          position.setXYZ(idx, v1.x, v1.y, v1.z);\n          idx = idx + 1;\n          position.setXYZ(idx, v2.x, v2.y, v2.z);\n          idx = idx + 1;\n        }\n      }\n    } else if (objGeometry instanceof THREE.BufferGeometry) {\n      var objPos = objGeometry.attributes.position;\n      var objNorm = objGeometry.attributes.normal;\n      var idx = 0; // for simplicity, ignore index and drawcalls, and render every normal\n\n      for (var j = 0, jl = objPos.count; j < jl; j++) {\n        v1.set(objPos.getX(j), objPos.getY(j), objPos.getZ(j)).applyMatrix4(matrixWorld);\n        v2.set(objNorm.getX(j), objNorm.getY(j), objNorm.getZ(j));\n        v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);\n        position.setXYZ(idx, v1.x, v1.y, v1.z);\n        idx = idx + 1;\n        position.setXYZ(idx, v2.x, v2.y, v2.z);\n        idx = idx + 1;\n      }\n    }\n\n    position.needsUpdate = true;\n    return this;\n  };\n}(); // File:src/extras/helpers/WireframeHelper.js\n\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\n\n\nTHREE.WireframeHelper = function (object, hex) {\n  var color = hex !== undefined ? hex : 0xffffff;\n  THREE.LineSegments.call(this, new THREE.WireframeGeometry(object.geometry), new THREE.LineBasicMaterial({\n    color: color\n  }));\n  this.matrix = object.matrixWorld;\n  this.matrixAutoUpdate = false;\n};\n\nTHREE.WireframeHelper.prototype = Object.create(THREE.LineSegments.prototype);\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper; // File:src/extras/objects/ImmediateRenderObject.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.ImmediateRenderObject = function () {\n  THREE.Object3D.call(this);\n\n  this.render = function (renderCallback) {};\n};\n\nTHREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype);\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject; // File:src/extras/objects/MorphBlendMesh.js\n\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\n\nTHREE.MorphBlendMesh = function (geometry, material) {\n  THREE.Mesh.call(this, geometry, material);\n  this.animationsMap = {};\n  this.animationsList = []; // prepare default animation\n  // (all frames played together in 1 second)\n\n  var numFrames = this.geometry.morphTargets.length;\n  var name = \"__default\";\n  var startFrame = 0;\n  var endFrame = numFrames - 1;\n  var fps = numFrames / 1;\n  this.createAnimation(name, startFrame, endFrame, fps);\n  this.setAnimationWeight(name, 1);\n};\n\nTHREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype);\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\n\nTHREE.MorphBlendMesh.prototype.createAnimation = function (name, start, end, fps) {\n  var animation = {\n    start: start,\n    end: end,\n    length: end - start + 1,\n    fps: fps,\n    duration: (end - start) / fps,\n    lastFrame: 0,\n    currentFrame: 0,\n    active: false,\n    time: 0,\n    direction: 1,\n    weight: 1,\n    directionBackwards: false,\n    mirroredLoop: false\n  };\n  this.animationsMap[name] = animation;\n  this.animationsList.push(animation);\n};\n\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function (fps) {\n  var pattern = /([a-z]+)_?(\\d+)/;\n  var firstAnimation,\n      frameRanges = {};\n  var geometry = this.geometry;\n\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\n    var morph = geometry.morphTargets[i];\n    var chunks = morph.name.match(pattern);\n\n    if (chunks && chunks.length > 1) {\n      var name = chunks[1];\n      if (!frameRanges[name]) frameRanges[name] = {\n        start: Infinity,\n        end: -Infinity\n      };\n      var range = frameRanges[name];\n      if (i < range.start) range.start = i;\n      if (i > range.end) range.end = i;\n      if (!firstAnimation) firstAnimation = name;\n    }\n  }\n\n  for (var name in frameRanges) {\n    var range = frameRanges[name];\n    this.createAnimation(name, range.start, range.end, fps);\n  }\n\n  this.firstAnimation = firstAnimation;\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function (name) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.direction = 1;\n    animation.directionBackwards = false;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function (name) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.direction = -1;\n    animation.directionBackwards = true;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function (name, fps) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.fps = fps;\n    animation.duration = (animation.end - animation.start) / animation.fps;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function (name, duration) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.duration = duration;\n    animation.fps = (animation.end - animation.start) / animation.duration;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function (name, weight) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.weight = weight;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function (name, time) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.time = time;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function (name) {\n  var time = 0;\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    time = animation.time;\n  }\n\n  return time;\n};\n\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function (name) {\n  var duration = -1;\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    duration = animation.duration;\n  }\n\n  return duration;\n};\n\nTHREE.MorphBlendMesh.prototype.playAnimation = function (name) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.time = 0;\n    animation.active = true;\n  } else {\n    console.warn(\"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\");\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.stopAnimation = function (name) {\n  var animation = this.animationsMap[name];\n\n  if (animation) {\n    animation.active = false;\n  }\n};\n\nTHREE.MorphBlendMesh.prototype.update = function (delta) {\n  for (var i = 0, il = this.animationsList.length; i < il; i++) {\n    var animation = this.animationsList[i];\n    if (!animation.active) continue;\n    var frameTime = animation.duration / animation.length;\n    animation.time += animation.direction * delta;\n\n    if (animation.mirroredLoop) {\n      if (animation.time > animation.duration || animation.time < 0) {\n        animation.direction *= -1;\n\n        if (animation.time > animation.duration) {\n          animation.time = animation.duration;\n          animation.directionBackwards = true;\n        }\n\n        if (animation.time < 0) {\n          animation.time = 0;\n          animation.directionBackwards = false;\n        }\n      }\n    } else {\n      animation.time = animation.time % animation.duration;\n      if (animation.time < 0) animation.time += animation.duration;\n    }\n\n    var keyframe = animation.start + THREE.Math.clamp(Math.floor(animation.time / frameTime), 0, animation.length - 1);\n    var weight = animation.weight;\n\n    if (keyframe !== animation.currentFrame) {\n      this.morphTargetInfluences[animation.lastFrame] = 0;\n      this.morphTargetInfluences[animation.currentFrame] = 1 * weight;\n      this.morphTargetInfluences[keyframe] = 0;\n      animation.lastFrame = animation.currentFrame;\n      animation.currentFrame = keyframe;\n    }\n\n    var mix = animation.time % frameTime / frameTime;\n    if (animation.directionBackwards) mix = 1 - mix;\n\n    if (animation.currentFrame !== animation.lastFrame) {\n      this.morphTargetInfluences[animation.currentFrame] = mix * weight;\n      this.morphTargetInfluences[animation.lastFrame] = (1 - mix) * weight;\n    } else {\n      this.morphTargetInfluences[animation.currentFrame] = weight;\n    }\n  }\n}; // Export the THREE object for **Node.js**, with\n// backwards-compatibility for the old `require()` API. If we're in\n// the browser, add `_` as a global object via a string identifier,\n// for Closure Compiler \"advanced\" mode.\n\n\nif (typeof exports !== 'undefined') {\n  if (typeof module !== 'undefined' && module.exports) {\n    exports = module.exports = THREE;\n  }\n\n  exports.THREE = THREE;\n} else {\n  this['THREE'] = THREE;\n}","map":{"version":3,"names":["self","THREE","REVISION","define","amd","exports","module","requestAnimationFrame","undefined","cancelAnimationFrame","lastTime","vendors","x","length","setTimeout","callback","currTime","Date","now","timeToCall","Math","max","id","clearTimeout","sign","Function","prototype","name","Object","defineProperty","get","toString","match","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","AdditiveBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","NeverDepth","AlwaysDepth","LessDepth","LessEqualDepth","EqualDepth","GreaterEqualDepth","GreaterDepth","NotEqualDepth","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","RepeatWrapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","console","error","projectVector","vector","camera","warn","project","unprojectVector","unproject","pickingRay","CanvasRenderer","domElement","document","createElement","clear","render","setClearColor","setSize","Color","color","arguments","setRGB","set","constructor","r","g","b","value","copy","setHex","setStyle","hex","floor","setHSL","hue2rgb","p","q","t","h","s","l","euclideanModulo","clamp","style","parseAlpha","strAlpha","alpha","parseFloat","m","exec","components","min","parseInt","size","charAt","ColorKeywords","clone","copyGammaToLinear","gammaFactor","pow","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","sqrt","getHex","getHexString","slice","getHSL","optionalTarget","hsl","hue","saturation","lightness","delta","getStyle","offsetHSL","add","addColors","color1","color2","addScalar","multiply","multiplyScalar","lerp","equals","c","fromArray","array","toArray","offset","Quaternion","y","z","w","_x","_y","_z","_w","onChangeCallback","quaternion","setFromEuler","euler","update","Euler","Error","c1","cos","c2","c3","s1","sin","s2","s3","order","setFromAxisAngle","axis","angle","halfAngle","setFromRotationMatrix","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","Vector3","dot","abs","crossVectors","normalize","inverse","conjugate","v","lengthSq","multiplyQuaternions","a","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","slerp","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","index","getComponent","addVectors","addScaledVector","sub","subVectors","subScalar","divide","divideScalar","scalar","invScalar","clampScalar","minVal","maxVal","ceil","round","roundToZero","negate","lengthManhattan","distanceTo","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyEuler","applyAxisAngle","applyMatrix3","e","applyMatrix4","applyProjection","d","qx","qy","qz","qw","ix","iy","iz","iw","matrix","Matrix4","multiplyMatrices","projectionMatrix","getInverse","matrixWorld","transformDirection","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","normal","angleTo","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","setFromMatrixPosition","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","PI","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","asin","atan2","setFromQuaternion","makeRotationFromQuaternion","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","start","end","line","center","result","distanceSq","distance","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","Infinity","setFromPoints","points","makeEmpty","i","il","expandByPoint","setFromCenterAndSize","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","object","scope","updateMatrixWorld","traverse","node","geometry","Geometry","vertices","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","radius","Matrix3","Float32Array","n11","n12","n13","n21","n22","n23","n31","n32","n33","identity","multiplyVector3Array","applyToVector3Array","j","applyToBuffer","buffer","getX","getY","getZ","setXYZ","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","extractRotation","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","lookAt","eye","target","up","n","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","setPosition","rotateX","rotateY","rotateZ","rotateByAxis","scale","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","position","decompose","invSX","invSY","invSZ","makeFrustum","left","right","bottom","top","near","far","makePerspective","fov","aspect","ymax","tan","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","direction","ray","recast","directionDistance","distanceSqToPoint","distanceSqToSegment","segCenter","segDir","diff","v0","optionalPointOnRay","optionalPointOnSegment","segExtent","a01","b0","b1","s0","sqrDist","extDet","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","boundingSphere","computeBoundingSphere","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","split","uuid","Array","rnd","random","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","low","high","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","radians","isPowerOfTwo","nextPowerOfTwo","Spline","v3","intPoint","weight","w2","w3","pa","pb","pc","pd","initFromArray","getPoint","k","interpolate","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","oldPosition","tmpVec","chunkLengths","totalLength","chunks","total","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","push","t2","t3","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","Clock","autoStart","startTime","oldTime","elapsedTime","running","performance","stop","getElapsedTime","getDelta","newTime","EventDispatcher","apply","addEventListener","hasEventListener","removeEventListener","dispatchEvent","type","listener","_listeners","listeners","indexOf","listenerArray","splice","event","call","Raycaster","params","Mesh","Line","LOD","Points","threshold","Sprite","defineProperties","PointCloud","descSort","intersectObject","raycaster","intersects","recursive","visible","raycast","children","linePrecision","setFromCamera","PerspectiveCamera","OrthographicCamera","sort","intersectObjects","objects","isArray","Object3D","Object3DIdCount","parent","DefaultUp","rotation","onRotationChange","onQuaternionChange","enumerable","modelViewMatrix","rotationAutoUpdate","matrixAutoUpdate","DefaultMatrixAutoUpdate","matrixWorldNeedsUpdate","castShadow","receiveShadow","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","renderDepth","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","translateX","translateY","translateZ","localToWorld","worldToLocal","remove","getChildByName","getObjectByName","getObjectById","getObjectByProperty","child","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","updateMatrix","force","toJSON","meta","isRootObject","data","geometries","materials","textures","images","metadata","version","generator","JSON","stringify","output","extractFromCache","cache","values","key","source","parse","Face3","materialIndex","vertexNormals","vertexColors","Face4","BufferAttribute","dynamic","updateRange","count","needsUpdate","setDynamic","copyAt","index1","index2","copyArray","copyColorsArray","colors","copyIndicesArray","indices","copyVector2sArray","vectors","copyVector3sArray","copyVector4sArray","getW","setXY","setXYZW","Int8Attribute","Int8Array","Uint8Attribute","Uint8Array","Uint8ClampedAttribute","Uint8ClampedArray","Int16Attribute","Int16Array","Uint16Attribute","Uint16Array","Int32Attribute","Int32Array","Uint32Attribute","Uint32Array","Float32Attribute","Float64Attribute","Float64Array","DynamicBufferAttribute","InstancedBufferAttribute","meshPerAttribute","create","InterleavedBuffer","stride","InstancedInterleavedBuffer","InterleavedBufferAttribute","interleavedBuffer","GeometryIdCount","faces","faceVertexUvs","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","boundingBox","verticesNeedUpdate","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","face","jl","computeBoundingBox","obj","fromBufferGeometry","normals","uvs","uv","uvs2","uv2","tempNormals","tempUVs","tempUVs2","addFace","groups","group","computeFaceNormals","cb","ab","fl","vA","vB","vC","computeVertexNormals","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","dstNormalsFace","dstNormalsVertex","faceNormal","computeTangents","computeLineDistances","merge","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mesh","mergeVertices","verticesMap","unique","changes","precisionPoints","precision","faceIndicesToRemove","dupIndex","idx","parameters","normalsHash","colorsHash","uvsHash","hasMaterial","hasFaceUv","hasFaceVertexUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","setBit","getUvIndex","getNormalIndex","getColorIndex","enabled","hash","uvsCopy","kl","dispose","DirectGeometry","computeGroups","fromGeometry","hasFaceVertexUv2","morphTargetsLength","morphTargetsPosition","morphNormalsLength","morphTargetsNormal","hasSkinIndices","hasSkinWeights","vertexUvs","morphTarget","morphNormal","morphAttributes","drawRange","addIndex","setIndex","getIndex","addAttribute","getAttribute","removeAttribute","drawcalls","offsets","addDrawCall","indexOffset","addGroup","clearDrawCalls","clearGroups","setDrawRange","updateFromObject","direct","__directGeometry","lineDistance","fromDirectGeometry","TypeArray","bb","isNaN","pA","pB","pC","normalizeNormals","computeOffsets","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","MaxIndex","InstancedBufferGeometry","maxInstancedCount","instances","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","format","magFilter","minFilter","updateCubeMap","renderer","scene","generateMipmaps","activeCubeFace","setRenderTarget","zoom","updateProjectionMatrix","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","width","height","Light","AmbientLight","DirectionalLight","intensity","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","HemisphereLight","skyColor","groundColor","PointLight","decay","SpotLight","exponent","shadowCameraFov","Cache","files","file","Loader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","extractUrlBase","url","parts","pop","initMaterials","texturePath","createMaterial","imageLoader","ImageLoader","nearest_pow2","log","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","fullPath","texture","loader","Handlers","load","Texture","setCrossOrigin","image","canvas","context","getContext","drawImage","wrapS","wrapT","wrapMap","rgb2hex","rgb","mtype","mpars","shading","toLowerCase","blending","transparent","opacity","depthTest","depthWrite","flipSided","side","doubleSided","wireframe","colorDiffuse","DbgColor","colorEmissive","emissive","colorSpecular","specular","specularCoef","shininess","transparency","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapAO","mapAORepeat","mapAOOffset","mapAOWrap","mapAOAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","material","DbgName","handlers","regex","test","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","request","XMLHttpRequest","open","response","itemEnd","itemError","responseType","withCredentials","send","itemStart","setResponseType","setWithCredentials","src","JSONLoader","statusDomElement","_statusDomElement","text","json","setTexturePath","parseModel","parseSkin","parseMorphing","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","influencesPerVertex","bones","animation","animations","dstVertices","srcVertices","cl","dstColors","srcColors","LoadingManager","isLoading","itemsLoaded","itemsTotal","onStart","BufferGeometryLoader","typedArray","MaterialLoader","setTextures","getTexture","uniforms","vertexShader","fragmentShader","alphaTest","wireframeLinewidth","sizeAttenuation","map","alphaMap","bumpMap","normalMap","displacementMap","displacementScale","displacementBias","specularMap","envMap","combine","reflectivity","lightMap","lightMapIntensity","aoMap","aoMapIntensity","ObjectLoader","substring","lastIndexOf","parseGeometries","parseImages","parseTextures","parseMaterials","parseObject","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","BoxGeometry","depth","depthSegments","CircleBufferGeometry","segments","thetaStart","thetaLength","CircleGeometry","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","SphereGeometry","phiStart","phiLength","SphereBufferGeometry","DodecahedronGeometry","detail","IcosahedronGeometry","OctahedronGeometry","TetrahedronGeometry","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","TextGeometry","loadImage","path","parseConstant","mapping","getGeometry","getMaterial","Scene","mode","Group","levels","level","addLevel","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","loaded","loadTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","depthFunc","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","overdraw","_needsUpdate","setValues","newValue","currentValue","Number","wrapAround","boolean","wrapRGB","LineBasicMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","MeshBasicMaterial","refractionRatio","wireframeLinecap","wireframeLinejoin","skinning","MeshLambertMaterial","MeshPhongMaterial","metal","emissiveMap","MeshDepthMaterial","MeshNormalMaterial","MultiMaterial","MeshFaceMaterial","PointsMaterial","PointCloudMaterial","ParticleBasicMaterial","ParticleSystemMaterial","ShaderMaterial","defines","lights","derivatives","defaultAttributeValues","index0AttributeName","UniformsUtils","RawShaderMaterial","SpriteMaterial","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","getDataURL","toDataURL","transformUv","CanvasTexture","CubeTexture","VideoTexture","video","readyState","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","localThresholdSq","testPoint","rayPointDistanceSq","intersectPoint","distanceToRay","ParticleSystem","LineSegments","precisionSq","vStart","vEnd","interSegment","interRay","step","distSq","faceIndex","nbVertices","LineStrip","LinePieces","updateMorphTargets","morphTargetBase","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","tempA","tempB","tempC","uvA","uvB","uvC","barycoord","intersectionPoint","intersectionPointWorld","uvIntersection","uv1","uv3","isFaceMaterial","faceMaterial","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","pos","rotq","scl","normalizeSkinWeights","bind","skeleton","sw","MorphAnimMesh","duration","mirroredLoop","time","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","label","setAnimationLabel","playAnimation","fps","updateAnimation","frameTime","keyframe","influences","mix","interpolateTargets","getObjectForDistance","matrixPosition","guessSizeSq","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","aomap","lightmap","emissivemap","bumpmap","normalmap","displacementmap","shadowmap","ShaderLib","WebGLRenderer","_canvas","_context","_width","_height","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","opaqueObjects","opaqueObjectsLastIndex","transparentObjects","transparentObjectsLastIndex","opaqueImmediateObjects","opaqueImmediateObjectsLastIndex","transparentImmediateObjects","transparentImmediateObjectsLastIndex","sprites","autoClear","autoClearColor","autoClearDepth","autoClearStencil","sortObjects","gammaInput","gammaOutput","maxMorphTargets","maxMorphNormals","autoScaleCubemaps","_this","_currentProgram","_currentFramebuffer","_currentMaterialId","_currentGeometryProgram","_currentCamera","_usedTextureUnits","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","_frustum","_projScreenMatrix","_vector3","_direction","_lightsNeedUpdate","_lights","ambient","directional","distances","decays","spot","directions","anglesCos","exponents","hemi","skyColors","groundColors","_infoMemory","_infoRender","calls","info","memory","programs","_gl","onContextLost","extensions","WebGLExtensions","capabilities","WebGLCapabilities","state","WebGLState","paramThreeToGL","properties","WebGLProperties","WebGLObjects","programCache","WebGLPrograms","bufferRenderer","WebGLBufferRenderer","indexedBufferRenderer","WebGLIndexedBufferRenderer","glClearColor","clearColor","setDefaultGLState","init","viewport","resetGLState","reset","WebGLShadowMap","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","getContextAttributes","forceContextLoss","loseContext","getMaxAnisotropy","extension","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","getSize","updateStyle","setViewport","setScissor","scissor","enableScissorTest","setScissorTest","getClearColor","getClearAlpha","setClearAlpha","bits","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearDepth","clearStencil","clearTarget","preventDefault","onTextureDispose","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","onMaterialDispose","deallocateMaterial","textureProperties","__image__webglTextureCube","deleteTexture","__webglInit","__webglTexture","delete","renderTargetProperties","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","releaseMaterialProgramReference","programInfo","program","releaseProgram","renderBufferImmediate","initAttributes","buffers","hasPositions","createBuffer","hasNormals","hasUvs","hasColors","getAttributes","bindBuffer","ARRAY_BUFFER","bufferData","positionArray","DYNAMIC_DRAW","enableAttribute","vertexAttribPointer","FLOAT","normalArray","nx","ny","nz","uvArray","colorArray","disableUnusedAttributes","drawArrays","TRIANGLES","renderBufferDirect","setMaterial","setProgram","updateBuffers","geometryProgram","activeInfluences","numericalSort","getUniforms","uniform1fv","getWireframeAttribute","setupVertexAttributes","ELEMENT_ARRAY_BUFFER","getAttributeBuffer","setLineWidth","setMode","LINES","renderInstances","lineWidth","LINE_STRIP","POINTS","startIndex","geometryAttributes","programAttributes","materialDefaultAttributeValues","programAttribute","geometryAttribute","BYTES_PER_ELEMENT","vertexAttribDivisorANGLE","vertexAttrib2fv","vertexAttrib3fv","vertexAttrib4fv","vertexAttrib1fv","painterSortStable","reversePainterSortStable","forceClear","projectObject","renderObjects","renderObjectsImmediate","setBlending","updateRenderTargetMipmap","setDepthTest","setDepthWrite","setColorWrite","pushImmediateRenderItem","pushRenderItem","renderItem","ImmediateRenderObject","groupMaterial","renderList","initMaterial","materialProperties","getParameters","code","getProgramCode","programChange","shaderID","shader","__webglShader","acquireProgram","numSupportedMorphTargets","numSupportedMorphNormals","uniformsList","uniformLocations","location","setMaterialFaces","setDepthFunc","setPolygonOffset","enable","CULL_FACE","disable","setFlipSided","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","useProgram","uniformMatrix4fv","logarithmicDepthBuffer","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","floatVertexTextures","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","setupLights","refreshUniformsLights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","mNear","mFar","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","diffuse","uvScaleMap","offsetRepeat","flipEnvMap","totalSize","psColor","fogColor","fogNear","fogFar","fogDensity","ambientLightColor","directionalLightColor","directionalLightDirection","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDistance","spotLightDirection","spotLightAngleCos","spotLightExponent","spotLightDecay","hemisphereLightSkyColor","hemisphereLightGroundColor","hemisphereLightDirection","light","uniformMatrix3fv","maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","i3","i4","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","pointCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","setFaceCulling","cullFace","frontFaceDirection","frontFace","CW","CCW","BACK","FRONT","FRONT_AND_BACK","setTextureParameters","textureType","isImagePowerOfTwo","texParameteri","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","uploadTexture","slot","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","pixelStorei","UNPACK_FLIP_Y_WEBGL","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","clampToMaxSize","maxTextureSize","glFormat","glType","mipmap","texImage2D","getCompressedTextureFormats","compressedTexImage2D","generateMipmap","__version","complete","maxSize","TEXTURE_CUBE_MAP","isCompressed","isDataTexture","cubeImage","maxCubemapSize","TEXTURE_CUBE_MAP_POSITIVE_X","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","RGBA","UNSIGNED_BYTE","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","supportsVertexTextures","vertexTextures","supportsInstancedArrays","addPrePlugin","addPostPlugin","updateShadowMap","shadowMapEnabled","shadowMapType","shadowMapCullFace","shadowMapDebug","debug","options","drawArraysInstancedANGLE","drawElements","drawElementsInstancedANGLE","gl","getExtension","getMaxPrecision","getShaderPrecisionFormat","VERTEX_SHADER","HIGH_FLOAT","FRAGMENT_SHADER","MEDIUM_FLOAT","MAX_TEXTURE_IMAGE_UNITS","maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","maxAttributes","MAX_VERTEX_ATTRIBS","maxVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","maxVaryings","MAX_VARYING_VECTORS","maxFragmentUniforms","MAX_FRAGMENT_UNIFORM_VECTORS","floatFragmentTextures","_maxPrecision","WebGLGeometries","onGeometryDispose","buffergeometry","_bufferGeometry","deleteAttributes","property","deleteAttribute","__webglBuffer","deleteBuffer","removeAttributeBuffer","updateAttribute","bufferType","attributeProperties","updateBuffer","usage","STATIC_DRAW","bufferSubData","subarray","edges","checkEdge","list","WebGLProgram","programIdCount","generateDefines","fetchUniformLocations","identifiers","getProgramParameter","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","suffixPos","substr","fetchAttributeLocations","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","filterEmptyLine","string","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","gammaFactorDefine","customDefines","createProgram","prefixVertex","prefixFragment","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","maxBones","flatShading","filter","useFog","fogExp","vertexGlsl","fragmentGlsl","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLog","getProgramInfoLog","vertexLog","getShaderInfoLog","fragmentLog","runnable","haveDiagnostics","LINK_STATUS","getError","VALIDATE_STATUS","diagnostics","prefix","deleteShader","cachedUniforms","cachedAttributes","destroy","deleteProgram","usedTimes","shaderIDs","parameterNames","allocateBones","nVertexUniforms","nVertexMatrices","allocateLights","dirLights","pointLights","spotLights","hemiLights","allocateShadows","maxLightCount","envMapMode","parameterName","pl","addLineNumbers","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","_renderer","_objects","_state","_min","_max","_matrixPosition","_renderList","depthShader","depthUniforms","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","BLEND","shadowFilter","pars","cameraHelper","CameraHelper","getDepthMaterial","clearAlpha","useMorphing","useSkinning","depthMaterial","customDepthMaterial","newAttributes","enabledAttributes","compressedTextureFormats","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthFunc","currentDepthWrite","currentColorWrite","currentFlipSided","currentLineWidth","currentPolygonOffsetFactor","currentPolygonOffsetUnits","currentTextureSlot","currentBoundTextures","DEPTH_TEST","LEQUAL","blendFunc","enableVertexAttribArray","disableVertexAttribArray","formats","COMPRESSED_TEXTURE_FORMATS","blendEquationSeparate","blendFuncSeparate","NEVER","ALWAYS","LESS","EQUAL","GEQUAL","GREATER","NOTEQUAL","depthMask","colorMask","factor","units","POLYGON_OFFSET_FILL","scissorTest","SCISSOR_TEST","webglSlot","webglType","webglTexture","boundTexture","flares","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","sprite","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","fillStyle","fillRect","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","ImageUtils","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","getImageData","imageData","createImageData","ly","uy","lx","ux","num_points","putImageData","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","String","fontPaths","Path","ret","extractGlyphPoints","paths","pts","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","glyph","glyphs","o","_cachedOutline","moveTo","lineTo","quadraticCurveTo","Shape","Utils","bezierCurveTo","b3","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","typeface_js","_typeface_js","Audio","createBufferSource","onended","onEnded","gain","createGain","connect","destination","panner","createPanner","autoplay","playbackRate","isPlaying","onload","decodeAudioData","play","loop","pause","currentTime","disconnect","setFilter","getFilter","setPlaybackRate","getPlaybackRate","setLoop","getLoop","setRefDistance","refDistance","getRefDistance","setRolloffFactor","rolloffFactor","getRolloffFactor","setVolume","getVolume","AudioListener","window","AudioContext","webkitAudioContext","orientation","setOrientation","Curve","getPointAt","getUtoTmapping","getPoints","getSpacedPoints","lengths","getLengths","__arcLengthDivisions","cacheArcLengths","current","last","sum","updateArcLengths","arcLengths","targetArcLength","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","curve","checkConnection","closePath","startPoint","endPoint","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createPointsGeometry","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","bounds","oldX","oldY","xNorm","pathPt","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","aRotation","EllipseCurve","lastPoint","closedPath","useSpacedPoints","item","spts","concat","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","betterShapeHoles","newShapes","newShapeHoles","mainIdx","tmpPoints","ambiguous","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","limit","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","indepHoles","intersectsHoleEdge","ihIdx","chkHole","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","failedCuts","tmpShape1","tmpShape2","tmpHole1","tmpHole2","hl","minShapeIndex","counter","h2","allPointsMap","allpoints","shapeWithoutHoles","triangles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","tangent","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","CatmullRomCurve3","CubicPoly","pz","x1","c0","initNonuniformCatmullRom","x3","dt0","dt1","dt2","initCatmullRom","tension","calc","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","initialized","hierarchy","keys","rot","quat","usedMorphTargets","morphTargetName","morphTargetsInfluences","root","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","frames","lastFrame","currentFrame","frame","width_half","height_half","depth_half","buildPlane","udir","vdir","gridX","gridY","gridX1","gridY1","segment_width","segment_height","uva","uvb","uvc","uvd","CubeGeometry","centerUV","segment","ii","heightHalf","verticesRow","uvsRow","tanTheta","na","nb","v4","n1","n2","n3","n4","uv4","EdgesGeometry","thresholdAngle","thresholdDot","edge","sortFunction","vert1","vert2","face1","face2","addShapeList","addShape","amount","bevelThickness","bevelSize","bevelSegments","bevelEnabled","steps","extrudePath","extrudePts","extrudeByPath","uvgen","UVGenerator","WorldUVGenerator","splineTube","binormal","position2","TubeGeometry","FrenetFrames","ahole","shapesOffset","shapePoints","reverse","scalePt2","pt","bs","vert","flen","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","collinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","contourMovements","holesMovements","oneHoleMovements","verticesMovements","binormals","buildLidFaces","buildSideFaces","layer","f3","layeroffset","sidewalls","slen1","slen2","f4","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","generateSideWallUV","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","base","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","radiusStep","thetaSegment","thetaEnd","vertexCount","textShapes","grid","tang","bitan","getPos","ip","jp","in_q","in_p","cu","su","quOverP","cs","tz","closed","taper","NoTaper","numpoints","pos2","tangents","SinusoidalTaper","mat","smallest","initialNormal3","MAX_VALUE","PolyhedronGeometry","that","prepare","centroid","subdivide","azimuth","inclination","make","azi","correctUV","cols","aj","bj","rows","ParametricGeometry","func","slices","stacks","sliceCount","WireframeGeometry","numEdges","ol","drawcall","numTris","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","dir","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","addLine","addPoint","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","FaceNormalsHelper","nNormals","objGeometry","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","objPos","objNorm","WireframeHelper","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation"],"sources":["/home/crow/Scrivania/AF2/newFrontEnd/node_modules/stl-viewer/node_modules/three/three.js"],"sourcesContent":["var self = self || {};// File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = { REVISION: '72' };\r\n\r\n//\r\n\r\nif ( typeof define === 'function' && define.amd ) {\r\n\r\n\t\tdefine( 'three', THREE );\r\n\r\n} else if ( 'undefined' !== typeof exports && 'undefined' !== typeof module ) {\r\n\r\n\t\tmodule.exports = THREE;\r\n\r\n}\r\n\r\n\r\n// polyfills\r\n\r\nif ( self.requestAnimationFrame === undefined || self.cancelAnimationFrame === undefined ) {\r\n\r\n\t// Missing in Android stock browser.\r\n\r\n\t( function () {\r\n\r\n\t\tvar lastTime = 0;\r\n\t\tvar vendors = [ 'ms', 'moz', 'webkit', 'o' ];\r\n\r\n\t\tfor ( var x = 0; x < vendors.length && ! self.requestAnimationFrame; ++ x ) {\r\n\r\n\t\t\tself.requestAnimationFrame = self[ vendors[ x ] + 'RequestAnimationFrame' ];\r\n\t\t\tself.cancelAnimationFrame = self[ vendors[ x ] + 'CancelAnimationFrame' ] || self[ vendors[ x ] + 'CancelRequestAnimationFrame' ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( self.requestAnimationFrame === undefined && self.setTimeout !== undefined ) {\r\n\r\n\t\t\tself.requestAnimationFrame = function ( callback ) {\r\n\r\n\t\t\t\tvar currTime = Date.now(), timeToCall = Math.max( 0, 16 - ( currTime - lastTime ) );\r\n\t\t\t\tvar id = self.setTimeout( function () {\r\n\r\n\t\t\t\t\tcallback( currTime + timeToCall );\r\n\r\n\t\t\t\t}, timeToCall );\r\n\t\t\t\tlastTime = currTime + timeToCall;\r\n\t\t\t\treturn id;\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tif ( self.cancelAnimationFrame === undefined && self.clearTimeout !== undefined ) {\r\n\r\n\t\t\tself.cancelAnimationFrame = function ( id ) {\r\n\r\n\t\t\t\tself.clearTimeout( id );\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t}() );\r\n\r\n}\r\n\r\nif ( Math.sign === undefined ) {\r\n\r\n\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n\tMath.sign = function ( x ) {\r\n\r\n\t\treturn ( x < 0 ) ? - 1 : ( x > 0 ) ? 1 : + x;\r\n\r\n\t};\r\n\r\n}\r\n\r\nif ( Function.prototype.name === undefined && Object.defineProperty !== undefined ) {\r\n\r\n\t// Missing in IE9-11.\r\n\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name\r\n\r\n\tObject.defineProperty( Function.prototype, 'name', {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\treturn this.toString().match( /^\\s*function\\s*(\\S*)\\s*\\(/ )[ 1 ];\r\n\r\n\t\t}\r\n\r\n\t} );\r\n\r\n}\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2 };\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n// mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n// depth modes\r\n\r\nTHREE.NeverDepth = 0;\r\nTHREE.AlwaysDepth = 1;\r\nTHREE.LessDepth = 2;\r\nTHREE.LessEqualDepth = 3;\r\nTHREE.EqualDepth = 4;\r\nTHREE.GreaterEqualDepth = 5;\r\nTHREE.GreaterDepth = 6;\r\nTHREE.NotEqualDepth = 7;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function () {\r\n\r\n\tconsole.error( 'THREE.Projector has been moved to /examples/js/renderers/Projector.js.' );\r\n\r\n\tthis.projectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .projectVector() is now vector.project().' );\r\n\t\tvector.project( camera );\r\n\r\n\t};\r\n\r\n\tthis.unprojectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );\r\n\t\tvector.unproject( camera );\r\n\r\n\t};\r\n\r\n\tthis.pickingRay = function ( vector, camera ) {\r\n\r\n\t\tconsole.error( 'THREE.Projector: .pickingRay() is now raycaster.setFromCamera().' );\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function () {\r\n\r\n\tconsole.error( 'THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js' );\r\n\r\n\tthis.domElement = document.createElement( 'canvas' );\r\n\tthis.clear = function () {};\r\n\tthis.render = function () {};\r\n\tthis.setClearColor = function () {};\r\n\tthis.setSize = function () {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function ( color ) {\r\n\r\n\tif ( arguments.length === 3 ) {\r\n\r\n\t\treturn this.setRGB( arguments[ 0 ], arguments[ 1 ], arguments[ 2 ] );\r\n\r\n\t}\r\n\r\n\treturn this.set( color );\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n\tconstructor: THREE.Color,\r\n\r\n\tr: 1, g: 1, b: 1,\r\n\r\n\tset: function ( value ) {\r\n\r\n\t\tif ( value instanceof THREE.Color ) {\r\n\r\n\t\t\tthis.copy( value );\r\n\r\n\t\t} else if ( typeof value === 'number' ) {\r\n\r\n\t\t\tthis.setHex( value );\r\n\r\n\t\t} else if ( typeof value === 'string' ) {\r\n\r\n\t\t\tthis.setStyle( value );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetHex: function ( hex ) {\r\n\r\n\t\thex = Math.floor( hex );\r\n\r\n\t\tthis.r = ( hex >> 16 & 255 ) / 255;\r\n\t\tthis.g = ( hex >> 8 & 255 ) / 255;\r\n\t\tthis.b = ( hex & 255 ) / 255;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetRGB: function ( r, g, b ) {\r\n\r\n\t\tthis.r = r;\r\n\t\tthis.g = g;\r\n\t\tthis.b = b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetHSL: function () {\r\n\r\n\t\tfunction hue2rgb ( p, q, t ) {\r\n\r\n\t\t\tif ( t < 0 ) t += 1;\r\n\t\t\tif ( t > 1 ) t -= 1;\r\n\t\t\tif ( t < 1 / 6 ) return p + ( q - p ) * 6 * t;\r\n\t\t\tif ( t < 1 / 2 ) return q;\r\n\t\t\tif ( t < 2 / 3 ) return p + ( q - p ) * 6 * ( 2 / 3 - t );\r\n\t\t\treturn p;\r\n\r\n\t\t}\r\n\r\n\t\treturn function ( h, s, l ) {\r\n\r\n\t\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\t\t\th = THREE.Math.euclideanModulo( h, 1 );\r\n\t\t\ts = THREE.Math.clamp( s, 0, 1 );\r\n\t\t\tl = THREE.Math.clamp( l, 0, 1 );\r\n\r\n\t\t\tif ( s === 0 ) {\r\n\r\n\t\t\t\tthis.r = this.g = this.b = l;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar p = l <= 0.5 ? l * ( 1 + s ) : l + s - ( l * s );\r\n\t\t\t\tvar q = ( 2 * l ) - p;\r\n\r\n\t\t\t\tthis.r = hue2rgb( q, p, h + 1 / 3 );\r\n\t\t\t\tthis.g = hue2rgb( q, p, h );\r\n\t\t\t\tthis.b = hue2rgb( q, p, h - 1 / 3 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetStyle: function ( style ) {\r\n\r\n\t\tvar parseAlpha = function ( strAlpha ) {\r\n\r\n\t\t\tvar alpha = parseFloat( strAlpha );\r\n\r\n\t\t\tif ( alpha < 1 ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Color: Alpha component of color ' + style + ' will be ignored.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn alpha;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tvar m;\r\n\r\n\t\tif ( m = /^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec( style ) ) {\r\n\r\n\t\t\t// rgb / hsl\r\n\r\n\t\t\tvar color;\r\n\t\t\tvar name = m[ 1 ];\r\n\t\t\tvar components = m[ 2 ];\r\n\r\n\t\t\tswitch ( name ) {\r\n\r\n\t\t\t\tcase 'rgb':\r\n\r\n\t\t\t\t\tif ( color = /^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgb(255,0,0)\r\n\t\t\t\t\t\tthis.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( color = /^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgb(100%,0%,0%)\r\n\t\t\t\t\t\tthis.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'rgba':\r\n\r\n\t\t\t\t\tif ( color = /^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgba(255,0,0,0.5)\r\n\t\t\t\t\t\tthis.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tparseAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( color = /^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgba(100%,0%,0%,0.5)\r\n\t\t\t\t\t\tthis.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tparseAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'hsl':\r\n\r\n\t\t\t\t\tif ( color = /^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// hsl(120,50%,50%)\r\n\t\t\t\t\t\tvar h = parseFloat( color[ 1 ] );\r\n\t\t\t\t\t\tvar s = parseInt( color[ 2 ], 10 ) / 100;\r\n\t\t\t\t\t\tvar l = parseInt( color[ 3 ], 10 ) / 100;\r\n\r\n\t\t\t\t\t\treturn this.setHSL( h, s, l );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'hsla':\r\n\r\n\t\t\t\t\tif ( color = /^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*([0-9]*\\.?[0-9]+)\\s*$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// hsla(120,50%,50%,0.5)\r\n\t\t\t\t\t\tvar h = parseFloat( color[ 1 ] );\r\n\t\t\t\t\t\tvar s = parseInt( color[ 2 ], 10 ) / 100;\r\n\t\t\t\t\t\tvar l = parseInt( color[ 3 ], 10 ) / 100;\r\n\t\t\t\t\t\tparseAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this.setHSL( h, s, l );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( m = /^\\#([A-Fa-f0-9]+)$/.exec( style ) ) {\r\n\r\n\t\t\t// hex color\r\n\r\n\t\t\tvar hex = m[ 1 ];\r\n\t\t\tvar size = hex.length;\r\n\r\n\t\t\tif ( size === 3 ) {\r\n\r\n\t\t\t\t// #ff0\r\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 0 ), 16 ) / 255;\r\n\t\t\t\tthis.g = parseInt( hex.charAt( 1 ) + hex.charAt( 1 ), 16 ) / 255;\r\n\t\t\t\tthis.b = parseInt( hex.charAt( 2 ) + hex.charAt( 2 ), 16 ) / 255;\r\n\r\n\t\t\t\treturn this;\r\n\r\n\t\t\t} else if ( size === 6 ) {\r\n\r\n\t\t\t\t// #ff0000\r\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 1 ), 16 ) / 255;\r\n\t\t\t\tthis.g = parseInt( hex.charAt( 2 ) + hex.charAt( 3 ), 16 ) / 255;\r\n\t\t\t\tthis.b = parseInt( hex.charAt( 4 ) + hex.charAt( 5 ), 16 ) / 255;\r\n\r\n\t\t\t\treturn this;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( style && style.length > 0 ) {\r\n\r\n\t\t\t// color keywords\r\n\t\t\tvar hex = THREE.ColorKeywords[ style ];\r\n\r\n\t\t\tif ( hex !== undefined ) {\r\n\r\n\t\t\t\t// red\r\n\t\t\t\tthis.setHex( hex );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// unknown color\r\n\t\t\t\tconsole.warn( 'THREE.Color: Unknown color ' + style );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this.r, this.g, this.b );\r\n\r\n\t},\r\n\r\n\tcopy: function ( color ) {\r\n\r\n\t\tthis.r = color.r;\r\n\t\tthis.g = color.g;\r\n\t\tthis.b = color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyGammaToLinear: function ( color, gammaFactor ) {\r\n\r\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\r\n\r\n\t\tthis.r = Math.pow( color.r, gammaFactor );\r\n\t\tthis.g = Math.pow( color.g, gammaFactor );\r\n\t\tthis.b = Math.pow( color.b, gammaFactor );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyLinearToGamma: function ( color, gammaFactor ) {\r\n\r\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\r\n\r\n\t\tvar safeInverse = ( gammaFactor > 0 ) ? ( 1.0 / gammaFactor ) : 1.0;\r\n\r\n\t\tthis.r = Math.pow( color.r, safeInverse );\r\n\t\tthis.g = Math.pow( color.g, safeInverse );\r\n\t\tthis.b = Math.pow( color.b, safeInverse );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconvertGammaToLinear: function () {\r\n\r\n\t\tvar r = this.r, g = this.g, b = this.b;\r\n\r\n\t\tthis.r = r * r;\r\n\t\tthis.g = g * g;\r\n\t\tthis.b = b * b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconvertLinearToGamma: function () {\r\n\r\n\t\tthis.r = Math.sqrt( this.r );\r\n\t\tthis.g = Math.sqrt( this.g );\r\n\t\tthis.b = Math.sqrt( this.b );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetHex: function () {\r\n\r\n\t\treturn ( this.r * 255 ) << 16 ^ ( this.g * 255 ) << 8 ^ ( this.b * 255 ) << 0;\r\n\r\n\t},\r\n\r\n\tgetHexString: function () {\r\n\r\n\t\treturn ( '000000' + this.getHex().toString( 16 ) ).slice( - 6 );\r\n\r\n\t},\r\n\r\n\tgetHSL: function ( optionalTarget ) {\r\n\r\n\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\r\n\t\tvar hsl = optionalTarget || { h: 0, s: 0, l: 0 };\r\n\r\n\t\tvar r = this.r, g = this.g, b = this.b;\r\n\r\n\t\tvar max = Math.max( r, g, b );\r\n\t\tvar min = Math.min( r, g, b );\r\n\r\n\t\tvar hue, saturation;\r\n\t\tvar lightness = ( min + max ) / 2.0;\r\n\r\n\t\tif ( min === max ) {\r\n\r\n\t\t\thue = 0;\r\n\t\t\tsaturation = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar delta = max - min;\r\n\r\n\t\t\tsaturation = lightness <= 0.5 ? delta / ( max + min ) : delta / ( 2 - max - min );\r\n\r\n\t\t\tswitch ( max ) {\r\n\r\n\t\t\t\tcase r: hue = ( g - b ) / delta + ( g < b ? 6 : 0 ); break;\r\n\t\t\t\tcase g: hue = ( b - r ) / delta + 2; break;\r\n\t\t\t\tcase b: hue = ( r - g ) / delta + 4; break;\r\n\r\n\t\t\t}\r\n\r\n\t\t\thue /= 6;\r\n\r\n\t\t}\r\n\r\n\t\thsl.h = hue;\r\n\t\thsl.s = saturation;\r\n\t\thsl.l = lightness;\r\n\r\n\t\treturn hsl;\r\n\r\n\t},\r\n\r\n\tgetStyle: function () {\r\n\r\n\t\treturn 'rgb(' + ( ( this.r * 255 ) | 0 ) + ',' + ( ( this.g * 255 ) | 0 ) + ',' + ( ( this.b * 255 ) | 0 ) + ')';\r\n\r\n\t},\r\n\r\n\toffsetHSL: function ( h, s, l ) {\r\n\r\n\t\tvar hsl = this.getHSL();\r\n\r\n\t\thsl.h += h; hsl.s += s; hsl.l += l;\r\n\r\n\t\tthis.setHSL( hsl.h, hsl.s, hsl.l );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( color ) {\r\n\r\n\t\tthis.r += color.r;\r\n\t\tthis.g += color.g;\r\n\t\tthis.b += color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddColors: function ( color1, color2 ) {\r\n\r\n\t\tthis.r = color1.r + color2.r;\r\n\t\tthis.g = color1.g + color2.g;\r\n\t\tthis.b = color1.b + color2.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.r += s;\r\n\t\tthis.g += s;\r\n\t\tthis.b += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( color ) {\r\n\r\n\t\tthis.r *= color.r;\r\n\t\tthis.g *= color.g;\r\n\t\tthis.b *= color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tthis.r *= s;\r\n\t\tthis.g *= s;\r\n\t\tthis.b *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( color, alpha ) {\r\n\r\n\t\tthis.r += ( color.r - this.r ) * alpha;\r\n\t\tthis.g += ( color.g - this.g ) * alpha;\r\n\t\tthis.b += ( color.b - this.b ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( c ) {\r\n\r\n\t\treturn ( c.r === this.r ) && ( c.g === this.g ) && ( c.b === this.b );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.r = array[ 0 ];\r\n\t\tthis.g = array[ 1 ];\r\n\t\tthis.b = array[ 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.r;\r\n\t\tarray[ offset + 1 ] = this.g;\r\n\t\tarray[ offset + 2 ] = this.b;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = { 'aliceblue': 0xF0F8FF, 'antiquewhite': 0xFAEBD7, 'aqua': 0x00FFFF, 'aquamarine': 0x7FFFD4, 'azure': 0xF0FFFF,\r\n'beige': 0xF5F5DC, 'bisque': 0xFFE4C4, 'black': 0x000000, 'blanchedalmond': 0xFFEBCD, 'blue': 0x0000FF, 'blueviolet': 0x8A2BE2,\r\n'brown': 0xA52A2A, 'burlywood': 0xDEB887, 'cadetblue': 0x5F9EA0, 'chartreuse': 0x7FFF00, 'chocolate': 0xD2691E, 'coral': 0xFF7F50,\r\n'cornflowerblue': 0x6495ED, 'cornsilk': 0xFFF8DC, 'crimson': 0xDC143C, 'cyan': 0x00FFFF, 'darkblue': 0x00008B, 'darkcyan': 0x008B8B,\r\n'darkgoldenrod': 0xB8860B, 'darkgray': 0xA9A9A9, 'darkgreen': 0x006400, 'darkgrey': 0xA9A9A9, 'darkkhaki': 0xBDB76B, 'darkmagenta': 0x8B008B,\r\n'darkolivegreen': 0x556B2F, 'darkorange': 0xFF8C00, 'darkorchid': 0x9932CC, 'darkred': 0x8B0000, 'darksalmon': 0xE9967A, 'darkseagreen': 0x8FBC8F,\r\n'darkslateblue': 0x483D8B, 'darkslategray': 0x2F4F4F, 'darkslategrey': 0x2F4F4F, 'darkturquoise': 0x00CED1, 'darkviolet': 0x9400D3,\r\n'deeppink': 0xFF1493, 'deepskyblue': 0x00BFFF, 'dimgray': 0x696969, 'dimgrey': 0x696969, 'dodgerblue': 0x1E90FF, 'firebrick': 0xB22222,\r\n'floralwhite': 0xFFFAF0, 'forestgreen': 0x228B22, 'fuchsia': 0xFF00FF, 'gainsboro': 0xDCDCDC, 'ghostwhite': 0xF8F8FF, 'gold': 0xFFD700,\r\n'goldenrod': 0xDAA520, 'gray': 0x808080, 'green': 0x008000, 'greenyellow': 0xADFF2F, 'grey': 0x808080, 'honeydew': 0xF0FFF0, 'hotpink': 0xFF69B4,\r\n'indianred': 0xCD5C5C, 'indigo': 0x4B0082, 'ivory': 0xFFFFF0, 'khaki': 0xF0E68C, 'lavender': 0xE6E6FA, 'lavenderblush': 0xFFF0F5, 'lawngreen': 0x7CFC00,\r\n'lemonchiffon': 0xFFFACD, 'lightblue': 0xADD8E6, 'lightcoral': 0xF08080, 'lightcyan': 0xE0FFFF, 'lightgoldenrodyellow': 0xFAFAD2, 'lightgray': 0xD3D3D3,\r\n'lightgreen': 0x90EE90, 'lightgrey': 0xD3D3D3, 'lightpink': 0xFFB6C1, 'lightsalmon': 0xFFA07A, 'lightseagreen': 0x20B2AA, 'lightskyblue': 0x87CEFA,\r\n'lightslategray': 0x778899, 'lightslategrey': 0x778899, 'lightsteelblue': 0xB0C4DE, 'lightyellow': 0xFFFFE0, 'lime': 0x00FF00, 'limegreen': 0x32CD32,\r\n'linen': 0xFAF0E6, 'magenta': 0xFF00FF, 'maroon': 0x800000, 'mediumaquamarine': 0x66CDAA, 'mediumblue': 0x0000CD, 'mediumorchid': 0xBA55D3,\r\n'mediumpurple': 0x9370DB, 'mediumseagreen': 0x3CB371, 'mediumslateblue': 0x7B68EE, 'mediumspringgreen': 0x00FA9A, 'mediumturquoise': 0x48D1CC,\r\n'mediumvioletred': 0xC71585, 'midnightblue': 0x191970, 'mintcream': 0xF5FFFA, 'mistyrose': 0xFFE4E1, 'moccasin': 0xFFE4B5, 'navajowhite': 0xFFDEAD,\r\n'navy': 0x000080, 'oldlace': 0xFDF5E6, 'olive': 0x808000, 'olivedrab': 0x6B8E23, 'orange': 0xFFA500, 'orangered': 0xFF4500, 'orchid': 0xDA70D6,\r\n'palegoldenrod': 0xEEE8AA, 'palegreen': 0x98FB98, 'paleturquoise': 0xAFEEEE, 'palevioletred': 0xDB7093, 'papayawhip': 0xFFEFD5, 'peachpuff': 0xFFDAB9,\r\n'peru': 0xCD853F, 'pink': 0xFFC0CB, 'plum': 0xDDA0DD, 'powderblue': 0xB0E0E6, 'purple': 0x800080, 'red': 0xFF0000, 'rosybrown': 0xBC8F8F,\r\n'royalblue': 0x4169E1, 'saddlebrown': 0x8B4513, 'salmon': 0xFA8072, 'sandybrown': 0xF4A460, 'seagreen': 0x2E8B57, 'seashell': 0xFFF5EE,\r\n'sienna': 0xA0522D, 'silver': 0xC0C0C0, 'skyblue': 0x87CEEB, 'slateblue': 0x6A5ACD, 'slategray': 0x708090, 'slategrey': 0x708090, 'snow': 0xFFFAFA,\r\n'springgreen': 0x00FF7F, 'steelblue': 0x4682B4, 'tan': 0xD2B48C, 'teal': 0x008080, 'thistle': 0xD8BFD8, 'tomato': 0xFF6347, 'turquoise': 0x40E0D0,\r\n'violet': 0xEE82EE, 'wheat': 0xF5DEB3, 'white': 0xFFFFFF, 'whitesmoke': 0xF5F5F5, 'yellow': 0xFFFF00, 'yellowgreen': 0x9ACD32 };\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function ( x, y, z, w ) {\r\n\r\n\tthis._x = x || 0;\r\n\tthis._y = y || 0;\r\n\tthis._z = z || 0;\r\n\tthis._w = ( w !== undefined ) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n\tconstructor: THREE.Quaternion,\r\n\r\n\tget x () {\r\n\r\n\t\treturn this._x;\r\n\r\n\t},\r\n\r\n\tset x ( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget y () {\r\n\r\n\t\treturn this._y;\r\n\r\n\t},\r\n\r\n\tset y ( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget z () {\r\n\r\n\t\treturn this._z;\r\n\r\n\t},\r\n\r\n\tset z ( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget w () {\r\n\r\n\t\treturn this._w;\r\n\r\n\t},\r\n\r\n\tset w ( value ) {\r\n\r\n\t\tthis._w = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tset: function ( x, y, z, w ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._w = w;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this._x, this._y, this._z, this._w );\r\n\r\n\t},\r\n\r\n\tcopy: function ( quaternion ) {\r\n\r\n\t\tthis._x = quaternion.x;\r\n\t\tthis._y = quaternion.y;\r\n\t\tthis._z = quaternion.z;\r\n\t\tthis._w = quaternion.w;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromEuler: function ( euler, update ) {\r\n\r\n\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\t// http://www.mathworks.com/matlabcentral/fileexchange/\r\n\t\t// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n\t\t//\tcontent/SpinCalc.m\r\n\r\n\t\tvar c1 = Math.cos( euler._x / 2 );\r\n\t\tvar c2 = Math.cos( euler._y / 2 );\r\n\t\tvar c3 = Math.cos( euler._z / 2 );\r\n\t\tvar s1 = Math.sin( euler._x / 2 );\r\n\t\tvar s2 = Math.sin( euler._y / 2 );\r\n\t\tvar s3 = Math.sin( euler._z / 2 );\r\n\r\n\t\tvar order = euler.order;\r\n\r\n\t\tif ( order === 'XYZ' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( order === 'YXZ' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t} else if ( order === 'ZXY' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( order === 'ZYX' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t} else if ( order === 'YZX' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( order === 'XZY' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t}\r\n\r\n\t\tif ( update !== false ) this.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromAxisAngle: function ( axis, angle ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tvar halfAngle = angle / 2, s = Math.sin( halfAngle );\r\n\r\n\t\tthis._x = axis.x * s;\r\n\t\tthis._y = axis.y * s;\r\n\t\tthis._z = axis.z * s;\r\n\t\tthis._w = Math.cos( halfAngle );\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromRotationMatrix: function ( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar te = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ],\r\n\r\n\t\t\ttrace = m11 + m22 + m33,\r\n\t\t\ts;\r\n\r\n\t\tif ( trace > 0 ) {\r\n\r\n\t\t\ts = 0.5 / Math.sqrt( trace + 1.0 );\r\n\r\n\t\t\tthis._w = 0.25 / s;\r\n\t\t\tthis._x = ( m32 - m23 ) * s;\r\n\t\t\tthis._y = ( m13 - m31 ) * s;\r\n\t\t\tthis._z = ( m21 - m12 ) * s;\r\n\r\n\t\t} else if ( m11 > m22 && m11 > m33 ) {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );\r\n\r\n\t\t\tthis._w = ( m32 - m23 ) / s;\r\n\t\t\tthis._x = 0.25 * s;\r\n\t\t\tthis._y = ( m12 + m21 ) / s;\r\n\t\t\tthis._z = ( m13 + m31 ) / s;\r\n\r\n\t\t} else if ( m22 > m33 ) {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );\r\n\r\n\t\t\tthis._w = ( m13 - m31 ) / s;\r\n\t\t\tthis._x = ( m12 + m21 ) / s;\r\n\t\t\tthis._y = 0.25 * s;\r\n\t\t\tthis._z = ( m23 + m32 ) / s;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );\r\n\r\n\t\t\tthis._w = ( m21 - m12 ) / s;\r\n\t\t\tthis._x = ( m13 + m31 ) / s;\r\n\t\t\tthis._y = ( m23 + m32 ) / s;\r\n\t\t\tthis._z = 0.25 * s;\r\n\r\n\t\t}\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromUnitVectors: function () {\r\n\r\n\t\t// http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n\t\t// assumes direction vectors vFrom and vTo are normalized\r\n\r\n\t\tvar v1, r;\r\n\r\n\t\tvar EPS = 0.000001;\r\n\r\n\t\treturn function ( vFrom, vTo ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tr = vFrom.dot( vTo ) + 1;\r\n\r\n\t\t\tif ( r < EPS ) {\r\n\r\n\t\t\t\tr = 0;\r\n\r\n\t\t\t\tif ( Math.abs( vFrom.x ) > Math.abs( vFrom.z ) ) {\r\n\r\n\t\t\t\t\tv1.set( - vFrom.y, vFrom.x, 0 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv1.set( 0, - vFrom.z, vFrom.y );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tv1.crossVectors( vFrom, vTo );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._x = v1.x;\r\n\t\t\tthis._y = v1.y;\r\n\t\t\tthis._z = v1.z;\r\n\t\t\tthis._w = r;\r\n\r\n\t\t\tthis.normalize();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tinverse: function () {\r\n\r\n\t\tthis.conjugate().normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconjugate: function () {\r\n\r\n\t\tthis._x *= - 1;\r\n\t\tthis._y *= - 1;\r\n\t\tthis._z *= - 1;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\tvar l = this.length();\r\n\r\n\t\tif ( l === 0 ) {\r\n\r\n\t\t\tthis._x = 0;\r\n\t\t\tthis._y = 0;\r\n\t\t\tthis._z = 0;\r\n\t\t\tthis._w = 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tl = 1 / l;\r\n\r\n\t\t\tthis._x = this._x * l;\r\n\t\t\tthis._y = this._y * l;\r\n\t\t\tthis._z = this._z * l;\r\n\t\t\tthis._w = this._w * l;\r\n\r\n\t\t}\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( q, p ) {\r\n\r\n\t\tif ( p !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.' );\r\n\t\t\treturn this.multiplyQuaternions( q, p );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyQuaternions( this, q );\r\n\r\n\t},\r\n\r\n\tmultiplyQuaternions: function ( a, b ) {\r\n\r\n\t\t// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n\t\tvar qax = a._x, qay = a._y, qaz = a._z, qaw = a._w;\r\n\t\tvar qbx = b._x, qby = b._y, qbz = b._z, qbw = b._w;\r\n\r\n\t\tthis._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n\t\tthis._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n\t\tthis._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n\t\tthis._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tconsole.warn( 'THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.' );\r\n\t\treturn vector.applyQuaternion( this );\r\n\r\n\t},\r\n\r\n\tslerp: function ( qb, t ) {\r\n\r\n\t\tif ( t === 0 ) return this;\r\n\t\tif ( t === 1 ) return this.copy( qb );\r\n\r\n\t\tvar x = this._x, y = this._y, z = this._z, w = this._w;\r\n\r\n\t\t// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n\t\tvar cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n\t\tif ( cosHalfTheta < 0 ) {\r\n\r\n\t\t\tthis._w = - qb._w;\r\n\t\t\tthis._x = - qb._x;\r\n\t\t\tthis._y = - qb._y;\r\n\t\t\tthis._z = - qb._z;\r\n\r\n\t\t\tcosHalfTheta = - cosHalfTheta;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.copy( qb );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cosHalfTheta >= 1.0 ) {\r\n\r\n\t\t\tthis._w = w;\r\n\t\t\tthis._x = x;\r\n\t\t\tthis._y = y;\r\n\t\t\tthis._z = z;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tvar halfTheta = Math.acos( cosHalfTheta );\r\n\t\tvar sinHalfTheta = Math.sqrt( 1.0 - cosHalfTheta * cosHalfTheta );\r\n\r\n\t\tif ( Math.abs( sinHalfTheta ) < 0.001 ) {\r\n\r\n\t\t\tthis._w = 0.5 * ( w + this._w );\r\n\t\t\tthis._x = 0.5 * ( x + this._x );\r\n\t\t\tthis._y = 0.5 * ( y + this._y );\r\n\t\t\tthis._z = 0.5 * ( z + this._z );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tvar ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,\r\n\t\tratioB = Math.sin( t * halfTheta ) / sinHalfTheta;\r\n\r\n\t\tthis._w = ( w * ratioA + this._w * ratioB );\r\n\t\tthis._x = ( x * ratioA + this._x * ratioB );\r\n\t\tthis._y = ( y * ratioA + this._y * ratioB );\r\n\t\tthis._z = ( z * ratioA + this._z * ratioB );\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( quaternion ) {\r\n\r\n\t\treturn ( quaternion._x === this._x ) && ( quaternion._y === this._y ) && ( quaternion._z === this._z ) && ( quaternion._w === this._w );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis._x = array[ offset ];\r\n\t\tthis._y = array[ offset + 1 ];\r\n\t\tthis._z = array[ offset + 2 ];\r\n\t\tthis._w = array[ offset + 3 ];\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._w;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tonChange: function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tonChangeCallback: function () {}\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function ( qa, qb, qm, t ) {\r\n\r\n\treturn qm.copy( qa ).slerp( qb, t );\r\n\r\n};\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function ( x, y ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n\tconstructor: THREE.Vector2,\r\n\r\n\tset: function ( x, y ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this.x, this.y );\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScaledVector: function ( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( v ) {\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tthis.x *= s;\r\n\t\tthis.y *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivide: function ( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclampScalar: function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function clampScalar( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector2();\r\n\t\t\t\tmax = new THREE.Vector2();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tfloor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tround: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\troundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y );\r\n\r\n\t},\r\n\r\n\tlengthManhattan: function() {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tdistanceTo: function ( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t},\r\n\r\n\tdistanceToSquared: function ( v ) {\r\n\r\n\t\tvar dx = this.x - v.x, dy = this.y - v.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function ( x, y, z ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\tthis.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n\tconstructor: THREE.Vector3,\r\n\r\n\tset: function ( x, y, z ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this.x, this.y, this.z );\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScaledVector: function ( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\t\tthis.z += v.z * s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );\r\n\t\t\treturn this.multiplyVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\t\tthis.z *= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x * b.x;\r\n\t\tthis.y = a.y * b.y;\r\n\t\tthis.z = a.z * b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyEuler: function () {\r\n\r\n\t\tvar quaternion;\r\n\r\n\t\treturn function applyEuler( euler ) {\r\n\r\n\t\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( quaternion === undefined ) quaternion = new THREE.Quaternion();\r\n\r\n\t\t\tthis.applyQuaternion( quaternion.setFromEuler( euler ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyAxisAngle: function () {\r\n\r\n\t\tvar quaternion;\r\n\r\n\t\treturn function applyAxisAngle( axis, angle ) {\r\n\r\n\t\t\tif ( quaternion === undefined ) quaternion = new THREE.Quaternion();\r\n\r\n\t\t\tthis.applyQuaternion( quaternion.setFromAxisAngle( axis, angle ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyMatrix3: function ( m ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ] * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ] * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 5 ] * y + e[ 8 ] * z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ];\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ];\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyProjection: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 projection matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\t\tvar d = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] ); // perspective divide\r\n\r\n\t\tthis.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ] ) * d;\r\n\t\tthis.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ] ) * d;\r\n\t\tthis.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * d;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyQuaternion: function ( q ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\r\n\t\tvar qx = q.x;\r\n\t\tvar qy = q.y;\r\n\t\tvar qz = q.z;\r\n\t\tvar qw = q.w;\r\n\r\n\t\t// calculate quat * vector\r\n\r\n\t\tvar ix =  qw * x + qy * z - qz * y;\r\n\t\tvar iy =  qw * y + qz * x - qx * z;\r\n\t\tvar iz =  qw * z + qx * y - qy * x;\r\n\t\tvar iw = - qx * x - qy * y - qz * z;\r\n\r\n\t\t// calculate result * inverse quat\r\n\r\n\t\tthis.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\r\n\t\tthis.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\r\n\t\tthis.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tproject: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function project( camera ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\r\n\t\t\tmatrix.multiplyMatrices( camera.projectionMatrix, matrix.getInverse( camera.matrixWorld ) );\r\n\t\t\treturn this.applyProjection( matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tunproject: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function unproject( camera ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\r\n\t\t\tmatrix.multiplyMatrices( camera.matrixWorld, matrix.getInverse( camera.projectionMatrix ) );\r\n\t\t\treturn this.applyProjection( matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttransformDirection: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\t\t// vector interpreted as a direction\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\r\n\r\n\t\tthis.normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivide: function ( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\t\tthis.z /= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\t\t\tthis.z *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\t\t\tthis.z = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z > v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < min.z ) {\r\n\r\n\t\t\tthis.z = min.z;\r\n\r\n\t\t} else if ( this.z > max.z ) {\r\n\r\n\t\t\tthis.z = max.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclampScalar: function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function clampScalar( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector3();\r\n\t\t\t\tmax = new THREE.Vector3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tfloor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tround: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\troundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n\r\n\t},\r\n\r\n\tlengthManhattan: function () {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength  ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcross: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );\r\n\t\t\treturn this.crossVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tthis.x = y * v.z - z * v.y;\r\n\t\tthis.y = z * v.x - x * v.z;\r\n\t\tthis.z = x * v.y - y * v.x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcrossVectors: function ( a, b ) {\r\n\r\n\t\tvar ax = a.x, ay = a.y, az = a.z;\r\n\t\tvar bx = b.x, by = b.y, bz = b.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tprojectOnVector: function () {\r\n\r\n\t\tvar v1, dot;\r\n\r\n\t\treturn function projectOnVector( vector ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tv1.copy( vector ).normalize();\r\n\r\n\t\t\tdot = this.dot( v1 );\r\n\r\n\t\t\treturn this.copy( v1 ).multiplyScalar( dot );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tprojectOnPlane: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function projectOnPlane( planeNormal ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tv1.copy( this ).projectOnVector( planeNormal );\r\n\r\n\t\t\treturn this.sub( v1 );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\treflect: function () {\r\n\r\n\t\t// reflect incident vector off plane orthogonal to normal\r\n\t\t// normal is assumed to have unit length\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function reflect( normal ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\treturn this.sub( v1.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tangleTo: function ( v ) {\r\n\r\n\t\tvar theta = this.dot( v ) / ( this.length() * v.length() );\r\n\r\n\t\t// clamp, to handle numerical problems\r\n\r\n\t\treturn Math.acos( THREE.Math.clamp( theta, - 1, 1 ) );\r\n\r\n\t},\r\n\r\n\tdistanceTo: function ( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t},\r\n\r\n\tdistanceToSquared: function ( v ) {\r\n\r\n\t\tvar dx = this.x - v.x;\r\n\t\tvar dy = this.y - v.y;\r\n\t\tvar dz = this.z - v.z;\r\n\r\n\t\treturn dx * dx + dy * dy + dz * dz;\r\n\r\n\t},\r\n\r\n\tsetEulerFromRotationMatrix: function ( m, order ) {\r\n\r\n\t\tconsole.error( 'THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.' );\r\n\r\n\t},\r\n\r\n\tsetEulerFromQuaternion: function ( q, order ) {\r\n\r\n\t\tconsole.error( 'THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.' );\r\n\r\n\t},\r\n\r\n\tgetPositionFromMatrix: function ( m ) {\r\n\r\n\t\tconsole.warn( 'THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().' );\r\n\r\n\t\treturn this.setFromMatrixPosition( m );\r\n\r\n\t},\r\n\r\n\tgetScaleFromMatrix: function ( m ) {\r\n\r\n\t\tconsole.warn( 'THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().' );\r\n\r\n\t\treturn this.setFromMatrixScale( m );\r\n\r\n\t},\r\n\r\n\tgetColumnFromMatrix: function ( index, matrix ) {\r\n\r\n\t\tconsole.warn( 'THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().' );\r\n\r\n\t\treturn this.setFromMatrixColumn( index, matrix );\r\n\r\n\t},\r\n\r\n\tsetFromMatrixPosition: function ( m ) {\r\n\r\n\t\tthis.x = m.elements[ 12 ];\r\n\t\tthis.y = m.elements[ 13 ];\r\n\t\tthis.z = m.elements[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromMatrixScale: function ( m ) {\r\n\r\n\t\tvar sx = this.set( m.elements[ 0 ], m.elements[ 1 ], m.elements[ 2 ] ).length();\r\n\t\tvar sy = this.set( m.elements[ 4 ], m.elements[ 5 ], m.elements[ 6 ] ).length();\r\n\t\tvar sz = this.set( m.elements[ 8 ], m.elements[ 9 ], m.elements[ 10 ] ).length();\r\n\r\n\t\tthis.x = sx;\r\n\t\tthis.y = sy;\r\n\t\tthis.z = sz;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromMatrixColumn: function ( index, matrix ) {\r\n\r\n\t\tvar offset = index * 4;\r\n\r\n\t\tvar me = matrix.elements;\r\n\r\n\t\tthis.x = me[ offset ];\r\n\t\tthis.y = me[ offset + 1 ];\r\n\t\tthis.z = me[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\t\tthis.z = attribute.array[ index + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function ( x, y, z, w ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\tthis.z = z || 0;\r\n\tthis.w = ( w !== undefined ) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n\tconstructor: THREE.Vector4,\r\n\r\n\tset: function ( x, y, z, w ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetW: function ( w ) {\r\n\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tcase 3: this.w = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tcase 3: return this.w;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this.x, this.y, this.z, this.w );\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\t\tthis.w = ( v.w !== undefined ) ? v.w : 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\t\tthis.w += v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\t\tthis.w += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\t\tthis.w = a.w + b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScaledVector: function ( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\t\tthis.z += v.z * s;\r\n\t\tthis.w += v.w * s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\t\tthis.w -= v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\t\tthis.w -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\t\tthis.w = a.w - b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\t\tthis.w *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( m ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\t\tvar w = this.w;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] * w;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] * w;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] * w;\r\n\t\tthis.w = e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] * w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\t\t\tthis.z *= invScalar;\r\n\t\t\tthis.w *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\t\t\tthis.z = 0;\r\n\t\t\tthis.w = 1;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetAxisAngleFromQuaternion: function ( q ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n\t\t// q is assumed to be normalized\r\n\r\n\t\tthis.w = 2 * Math.acos( q.w );\r\n\r\n\t\tvar s = Math.sqrt( 1 - q.w * q.w );\r\n\r\n\t\tif ( s < 0.0001 ) {\r\n\r\n\t\t\t this.x = 1;\r\n\t\t\t this.y = 0;\r\n\t\t\t this.z = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t this.x = q.x / s;\r\n\t\t\t this.y = q.y / s;\r\n\t\t\t this.z = q.z / s;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetAxisAngleFromRotationMatrix: function ( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar angle, x, y, z,\t\t// variables for result\r\n\t\t\tepsilon = 0.01,\t\t// margin to allow for rounding errors\r\n\t\t\tepsilon2 = 0.1,\t\t// margin to distinguish between 0 and 180 degrees\r\n\r\n\t\t\tte = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\tif ( ( Math.abs( m12 - m21 ) < epsilon )\r\n\t\t   && ( Math.abs( m13 - m31 ) < epsilon )\r\n\t\t   && ( Math.abs( m23 - m32 ) < epsilon ) ) {\r\n\r\n\t\t\t// singularity found\r\n\t\t\t// first check for identity matrix which must have +1 for all terms\r\n\t\t\t// in leading diagonal and zero in other terms\r\n\r\n\t\t\tif ( ( Math.abs( m12 + m21 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m13 + m31 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m23 + m32 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m11 + m22 + m33 - 3 ) < epsilon2 ) ) {\r\n\r\n\t\t\t\t// this singularity is identity matrix so angle = 0\r\n\r\n\t\t\t\tthis.set( 1, 0, 0, 0 );\r\n\r\n\t\t\t\treturn this; // zero angle, arbitrary axis\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// otherwise this singularity is angle = 180\r\n\r\n\t\t\tangle = Math.PI;\r\n\r\n\t\t\tvar xx = ( m11 + 1 ) / 2;\r\n\t\t\tvar yy = ( m22 + 1 ) / 2;\r\n\t\t\tvar zz = ( m33 + 1 ) / 2;\r\n\t\t\tvar xy = ( m12 + m21 ) / 4;\r\n\t\t\tvar xz = ( m13 + m31 ) / 4;\r\n\t\t\tvar yz = ( m23 + m32 ) / 4;\r\n\r\n\t\t\tif ( ( xx > yy ) && ( xx > zz ) ) {\r\n\r\n\t\t\t\t// m11 is the largest diagonal term\r\n\r\n\t\t\t\tif ( xx < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tx = Math.sqrt( xx );\r\n\t\t\t\t\ty = xy / x;\r\n\t\t\t\t\tz = xz / x;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( yy > zz ) {\r\n\r\n\t\t\t\t// m22 is the largest diagonal term\r\n\r\n\t\t\t\tif ( yy < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ty = Math.sqrt( yy );\r\n\t\t\t\t\tx = xy / y;\r\n\t\t\t\t\tz = yz / y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// m33 is the largest diagonal term so base result on this\r\n\r\n\t\t\t\tif ( zz < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tz = Math.sqrt( zz );\r\n\t\t\t\t\tx = xz / z;\r\n\t\t\t\t\ty = yz / z;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.set( x, y, z, angle );\r\n\r\n\t\t\treturn this; // return 180 deg rotation\r\n\r\n\t\t}\r\n\r\n\t\t// as we have reached here there are no singularities so we can handle normally\r\n\r\n\t\tvar s = Math.sqrt( ( m32 - m23 ) * ( m32 - m23 )\r\n\t\t\t\t\t\t  + ( m13 - m31 ) * ( m13 - m31 )\r\n\t\t\t\t\t\t  + ( m21 - m12 ) * ( m21 - m12 ) ); // used to normalize\r\n\r\n\t\tif ( Math.abs( s ) < 0.001 ) s = 1;\r\n\r\n\t\t// prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n\t\t// caught by singularity test above, but I've left it in just in case\r\n\r\n\t\tthis.x = ( m32 - m23 ) / s;\r\n\t\tthis.y = ( m13 - m31 ) / s;\r\n\t\tthis.z = ( m21 - m12 ) / s;\r\n\t\tthis.w = Math.acos( ( m11 + m22 + m33 - 1 ) / 2 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z > v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w > v.w ) {\r\n\r\n\t\t\tthis.w = v.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w < v.w ) {\r\n\r\n\t\t\tthis.w = v.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < min.z ) {\r\n\r\n\t\t\tthis.z = min.z;\r\n\r\n\t\t} else if ( this.z > max.z ) {\r\n\r\n\t\t\tthis.z = max.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w < min.w ) {\r\n\r\n\t\t\tthis.w = min.w;\r\n\r\n\t\t} else if ( this.w > max.w ) {\r\n\r\n\t\t\tthis.w = max.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclampScalar: function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function clampScalar( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector4();\r\n\t\t\t\tmax = new THREE.Vector4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal, minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal, maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tfloor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\t\tthis.w = Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\t\tthis.w = Math.ceil( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tround: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\t\tthis.w = Math.round( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\troundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\t\tthis.w = ( this.w < 0 ) ? Math.ceil( this.w ) : Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\t\tthis.w = - this.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n\t},\r\n\r\n\tlengthManhattan: function () {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z ) + Math.abs( this.w );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\t\tthis.w += ( v.w - this.w ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) && ( v.w === this.w ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\t\tthis.w = array[ offset + 3 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\t\tarray[ offset + 3 ] = this.w;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\t\tthis.z = attribute.array[ index + 2 ];\r\n\t\tthis.w = attribute.array[ index + 3 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function ( x, y, z, order ) {\r\n\r\n\tthis._x = x || 0;\r\n\tthis._y = y || 0;\r\n\tthis._z = z || 0;\r\n\tthis._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = [ 'XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX' ];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n\tconstructor: THREE.Euler,\r\n\r\n\tget x () {\r\n\r\n\t\treturn this._x;\r\n\r\n\t},\r\n\r\n\tset x ( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget y () {\r\n\r\n\t\treturn this._y;\r\n\r\n\t},\r\n\r\n\tset y ( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget z () {\r\n\r\n\t\treturn this._z;\r\n\r\n\t},\r\n\r\n\tset z ( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget order () {\r\n\r\n\t\treturn this._order;\r\n\r\n\t},\r\n\r\n\tset order ( value ) {\r\n\r\n\t\tthis._order = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tset: function ( x, y, z, order ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._order = order || this._order;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor( this._x, this._y, this._z, this._order);\r\n\r\n\t},\r\n\r\n\tcopy: function ( euler ) {\r\n\r\n\t\tthis._x = euler._x;\r\n\t\tthis._y = euler._y;\r\n\t\tthis._z = euler._z;\r\n\t\tthis._order = euler._order;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromRotationMatrix: function ( m, order, update ) {\r\n\r\n\t\tvar clamp = THREE.Math.clamp;\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar te = m.elements;\r\n\t\tvar m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ];\r\n\t\tvar m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ];\r\n\t\tvar m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\torder = order || this._order;\r\n\r\n\t\tif ( order === 'XYZ' ) {\r\n\r\n\t\t\tthis._y = Math.asin( clamp( m13, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m13 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\tthis._z = Math.atan2( - m12, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'YXZ' ) {\r\n\r\n\t\t\tthis._x = Math.asin( - clamp( m23, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m23 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\t\t\t\tthis._z = Math.atan2( m21, m22 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'ZXY' ) {\r\n\r\n\t\t\tthis._x = Math.asin( clamp( m32, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m32 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._y = Math.atan2( - m31, m33 );\r\n\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._y = 0;\r\n\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'ZYX' ) {\r\n\r\n\t\t\tthis._y = Math.asin( - clamp( m31, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m31 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m33 );\r\n\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'YZX' ) {\r\n\r\n\t\t\tthis._z = Math.asin( clamp( m21, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m21 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m22 );\r\n\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'XZY' ) {\r\n\r\n\t\t\tthis._z = Math.asin( - clamp( m12, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m12 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\tthis._y = Math.atan2( m13, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\tthis._y = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order )\r\n\r\n\t\t}\r\n\r\n\t\tthis._order = order;\r\n\r\n\t\tif ( update !== false ) this.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromQuaternion: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function ( q, order, update ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\t\t\tmatrix.makeRotationFromQuaternion( q );\r\n\t\t\tthis.setFromRotationMatrix( matrix, order, update );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetFromVector3: function ( v, order ) {\r\n\r\n\t\treturn this.set( v.x, v.y, v.z, order || this._order );\r\n\r\n\t},\r\n\r\n\treorder: function () {\r\n\r\n\t\t// WARNING: this discards revolution information -bhouston\r\n\r\n\t\tvar q = new THREE.Quaternion();\r\n\r\n\t\treturn function ( newOrder ) {\r\n\r\n\t\t\tq.setFromEuler( this );\r\n\t\t\tthis.setFromQuaternion( q, newOrder );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tequals: function ( euler ) {\r\n\r\n\t\treturn ( euler._x === this._x ) && ( euler._y === this._y ) && ( euler._z === this._z ) && ( euler._order === this._order );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis._x = array[ 0 ];\r\n\t\tthis._y = array[ 1 ];\r\n\t\tthis._z = array[ 2 ];\r\n\t\tif ( array[ 3 ] !== undefined ) this._order = array[ 3 ];\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._order;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\ttoVector3: function ( optionalResult ) {\r\n\r\n\t\tif ( optionalResult ) {\r\n\r\n\t\t\treturn optionalResult.set( this._x, this._y, this._z );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn new THREE.Vector3( this._x, this._y, this._z );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tonChange: function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tonChangeCallback: function () {}\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function ( start, end ) {\r\n\r\n\tthis.start = ( start !== undefined ) ? start : new THREE.Vector3();\r\n\tthis.end = ( end !== undefined ) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n\tconstructor: THREE.Line3,\r\n\r\n\tset: function ( start, end ) {\r\n\r\n\t\tthis.start.copy( start );\r\n\t\tthis.end.copy( end );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( line ) {\r\n\r\n\t\tthis.start.copy( line.start );\r\n\t\tthis.end.copy( line.end );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.start, this.end ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tdelta: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.subVectors( this.end, this.start );\r\n\r\n\t},\r\n\r\n\tdistanceSq: function () {\r\n\r\n\t\treturn this.start.distanceToSquared( this.end );\r\n\r\n\t},\r\n\r\n\tdistance: function () {\r\n\r\n\t\treturn this.start.distanceTo( this.end );\r\n\r\n\t},\r\n\r\n\tat: function ( t, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n\t},\r\n\r\n\tclosestPointToPointParameter: function () {\r\n\r\n\t\tvar startP = new THREE.Vector3();\r\n\t\tvar startEnd = new THREE.Vector3();\r\n\r\n\t\treturn function ( point, clampToLine ) {\r\n\r\n\t\t\tstartP.subVectors( point, this.start );\r\n\t\t\tstartEnd.subVectors( this.end, this.start );\r\n\r\n\t\t\tvar startEnd2 = startEnd.dot( startEnd );\r\n\t\t\tvar startEnd_startP = startEnd.dot( startP );\r\n\r\n\t\t\tvar t = startEnd_startP / startEnd2;\r\n\r\n\t\t\tif ( clampToLine ) {\r\n\r\n\t\t\t\tt = THREE.Math.clamp( t, 0, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn t;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclosestPointToPoint: function ( point, clampToLine, optionalTarget ) {\r\n\r\n\t\tvar t = this.closestPointToPointParameter( point, clampToLine );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( matrix ) {\r\n\r\n\t\tthis.start.applyMatrix4( matrix );\r\n\t\tthis.end.applyMatrix4( matrix );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( line ) {\r\n\r\n\t\treturn line.start.equals( this.start ) && line.end.equals( this.end );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function ( min, max ) {\r\n\r\n\tthis.min = ( min !== undefined ) ? min : new THREE.Vector2( Infinity, Infinity );\r\n\tthis.max = ( max !== undefined ) ? max : new THREE.Vector2( - Infinity, - Infinity );\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n\tconstructor: THREE.Box2,\r\n\r\n\tset: function ( min, max ) {\r\n\r\n\t\tthis.min.copy( min );\r\n\t\tthis.max.copy( max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPoints: function ( points ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.expandByPoint( points[ i ] )\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCenterAndSize: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector2();\r\n\r\n\t\treturn function ( center, size ) {\r\n\r\n\t\t\tvar halfSize = v1.copy( size ).multiplyScalar( 0.5 );\r\n\t\t\tthis.min.copy( center ).sub( halfSize );\r\n\t\t\tthis.max.copy( center ).add( halfSize );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\t\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( box ) {\r\n\r\n\t\tthis.min.copy( box.min );\r\n\t\tthis.max.copy( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeEmpty: function () {\r\n\r\n\t\tthis.min.x = this.min.y = Infinity;\r\n\t\tthis.max.x = this.max.y = - Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y );\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tsize: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.subVectors( this.max, this.min );\r\n\r\n\t},\r\n\r\n\texpandByPoint: function ( point ) {\r\n\r\n\t\tthis.min.min( point );\r\n\t\tthis.max.max( point );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByVector: function ( vector ) {\r\n\r\n\t\tthis.min.sub( vector );\r\n\t\tthis.max.add( vector );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByScalar: function ( scalar ) {\r\n\r\n\t\tthis.min.addScalar( - scalar );\r\n\t\tthis.max.addScalar( scalar );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tif ( point.x < this.min.x || point.x > this.max.x ||\r\n\t\t     point.y < this.min.y || point.y > this.max.y ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tcontainsBox: function ( box ) {\r\n\r\n\t\tif ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&\r\n\t\t     ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tgetParameter: function ( point, optionalTarget ) {\r\n\r\n\t\t// This can potentially have a divide by zero if the box\r\n\t\t// has a size dimension of 0.\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\r\n\t\treturn result.set(\r\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\r\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y )\r\n\t\t);\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function ( box ) {\r\n\r\n\t\t// using 6 splitting planes to rule out intersections.\r\n\r\n\t\tif ( box.max.x < this.min.x || box.min.x > this.max.x ||\r\n\t\t     box.max.y < this.min.y || box.min.y > this.max.y ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.copy( point ).clamp( this.min, this.max );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector2();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar clampedPoint = v1.copy( point ).clamp( this.min, this.max );\r\n\t\t\treturn clampedPoint.sub( point ).length();\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersect: function ( box ) {\r\n\r\n\t\tthis.min.max( box.min );\r\n\t\tthis.max.min( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tunion: function ( box ) {\r\n\r\n\t\tthis.min.min( box.min );\r\n\t\tthis.max.max( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.min.add( offset );\r\n\t\tthis.max.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( box ) {\r\n\r\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function ( min, max ) {\r\n\r\n\tthis.min = ( min !== undefined ) ? min : new THREE.Vector3( Infinity, Infinity, Infinity );\r\n\tthis.max = ( max !== undefined ) ? max : new THREE.Vector3( - Infinity, - Infinity, - Infinity );\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n\tconstructor: THREE.Box3,\r\n\r\n\tset: function ( min, max ) {\r\n\r\n\t\tthis.min.copy( min );\r\n\t\tthis.max.copy( max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPoints: function ( points ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.expandByPoint( points[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCenterAndSize: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( center, size ) {\r\n\r\n\t\t\tvar halfSize = v1.copy( size ).multiplyScalar( 0.5 );\r\n\r\n\t\t\tthis.min.copy( center ).sub( halfSize );\r\n\t\t\tthis.max.copy( center ).add( halfSize );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetFromObject: function () {\r\n\r\n\t\t// Computes the world-axis-aligned bounding box of an object (including its children),\r\n\t\t// accounting for both the object's, and children's, world transforms\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( object ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tobject.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.makeEmpty();\r\n\r\n\t\t\tobject.traverse( function ( node ) {\r\n\r\n\t\t\t\tvar geometry = node.geometry;\r\n\r\n\t\t\t\tif ( geometry !== undefined ) {\r\n\r\n\t\t\t\t\tif ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\t\tvar vertices = geometry.vertices;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tv1.copy( vertices[ i ] );\r\n\r\n\t\t\t\t\t\t\tv1.applyMatrix4( node.matrixWorld );\r\n\r\n\t\t\t\t\t\t\tscope.expandByPoint( v1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( geometry instanceof THREE.BufferGeometry && geometry.attributes[ 'position' ] !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar positions = geometry.attributes[ 'position' ].array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\tv1.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\tv1.applyMatrix4( node.matrixWorld );\r\n\r\n\t\t\t\t\t\t\tscope.expandByPoint( v1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( box ) {\r\n\r\n\t\tthis.min.copy( box.min );\r\n\t\tthis.max.copy( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeEmpty: function () {\r\n\r\n\t\tthis.min.x = this.min.y = this.min.z = Infinity;\r\n\t\tthis.max.x = this.max.y = this.max.z = - Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y ) || ( this.max.z < this.min.z );\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tsize: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.subVectors( this.max, this.min );\r\n\r\n\t},\r\n\r\n\texpandByPoint: function ( point ) {\r\n\r\n\t\tthis.min.min( point );\r\n\t\tthis.max.max( point );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByVector: function ( vector ) {\r\n\r\n\t\tthis.min.sub( vector );\r\n\t\tthis.max.add( vector );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByScalar: function ( scalar ) {\r\n\r\n\t\tthis.min.addScalar( - scalar );\r\n\t\tthis.max.addScalar( scalar );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tif ( point.x < this.min.x || point.x > this.max.x ||\r\n\t\t     point.y < this.min.y || point.y > this.max.y ||\r\n\t\t     point.z < this.min.z || point.z > this.max.z ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tcontainsBox: function ( box ) {\r\n\r\n\t\tif ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&\r\n\t\t\t ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) &&\r\n\t\t\t ( this.min.z <= box.min.z ) && ( box.max.z <= this.max.z ) ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tgetParameter: function ( point, optionalTarget ) {\r\n\r\n\t\t// This can potentially have a divide by zero if the box\r\n\t\t// has a size dimension of 0.\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn result.set(\r\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\r\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y ),\r\n\t\t\t( point.z - this.min.z ) / ( this.max.z - this.min.z )\r\n\t\t);\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function ( box ) {\r\n\r\n\t\t// using 6 splitting planes to rule out intersections.\r\n\r\n\t\tif ( box.max.x < this.min.x || box.min.x > this.max.x ||\r\n\t\t     box.max.y < this.min.y || box.min.y > this.max.y ||\r\n\t\t     box.max.z < this.min.z || box.min.z > this.max.z ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( point ).clamp( this.min, this.max );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar clampedPoint = v1.copy( point ).clamp( this.min, this.max );\r\n\t\t\treturn clampedPoint.sub( point ).length();\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tgetBoundingSphere: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Sphere();\r\n\r\n\t\t\tresult.center = this.center();\r\n\t\t\tresult.radius = this.size( v1 ).length() * 0.5;\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersect: function ( box ) {\r\n\r\n\t\tthis.min.max( box.min );\r\n\t\tthis.max.min( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tunion: function ( box ) {\r\n\r\n\t\tthis.min.min( box.min );\r\n\t\tthis.max.max( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function () {\r\n\r\n\t\tvar points = [\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3()\r\n\t\t];\r\n\r\n\t\treturn function ( matrix ) {\r\n\r\n\t\t\t// NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n\t\t\tpoints[ 0 ].set( this.min.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 000\r\n\t\t\tpoints[ 1 ].set( this.min.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 001\r\n\t\t\tpoints[ 2 ].set( this.min.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 010\r\n\t\t\tpoints[ 3 ].set( this.min.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 011\r\n\t\t\tpoints[ 4 ].set( this.max.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 100\r\n\t\t\tpoints[ 5 ].set( this.max.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 101\r\n\t\t\tpoints[ 6 ].set( this.max.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 110\r\n\t\t\tpoints[ 7 ].set( this.max.x, this.max.y, this.max.z ).applyMatrix4( matrix );  // 111\r\n\r\n\t\t\tthis.makeEmpty();\r\n\t\t\tthis.setFromPoints( points );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.min.add( offset );\r\n\t\tthis.max.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( box ) {\r\n\r\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function () {\r\n\r\n\tthis.elements = new Float32Array( [\r\n\r\n\t\t1, 0, 0,\r\n\t\t0, 1, 0,\r\n\t\t0, 0, 1\r\n\r\n\t] );\r\n\r\n\tif ( arguments.length > 0 ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n\tconstructor: THREE.Matrix3,\r\n\r\n\tset: function ( n11, n12, n13, n21, n22, n23, n31, n32, n33 ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 3 ] = n12; te[ 6 ] = n13;\r\n\t\tte[ 1 ] = n21; te[ 4 ] = n22; te[ 7 ] = n23;\r\n\t\tte[ 2 ] = n31; te[ 5 ] = n32; te[ 8 ] = n33;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tidentity: function () {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().fromArray( this.elements );\r\n\r\n\t},\r\n\r\n\tcopy: function ( m ) {\r\n\r\n\t\tvar me = m.elements;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tme[ 0 ], me[ 3 ], me[ 6 ],\r\n\t\t\tme[ 1 ], me[ 4 ], me[ 7 ],\r\n\t\t\tme[ 2 ], me[ 5 ], me[ 8 ]\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix3( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector3Array: function ( a ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );\r\n\t\treturn this.applyToVector3Array( a );\r\n\r\n\t},\r\n\r\n\tapplyToVector3Array: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function ( array, offset, length ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = array.length;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i += 3, j += 3 ) {\r\n\r\n\t\t\t\tv1.fromArray( array, j );\r\n\t\t\t\tv1.applyMatrix3( this );\r\n\t\t\t\tv1.toArray( array, j );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyToBuffer: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function applyToBuffer( buffer, offset, length ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = buffer.length / buffer.itemSize;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i ++, j ++ ) {\r\n\r\n\t\t\t\tv1.x = buffer.getX( j );\r\n\t\t\t\tv1.y = buffer.getY( j );\r\n\t\t\t\tv1.z = buffer.getZ( j );\r\n\r\n\t\t\t\tv1.applyMatrix3( this );\r\n\r\n\t\t\t\tbuffer.setXYZ( v1.x, v1.y, v1.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn buffer;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 3 ] *= s; te[ 6 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 4 ] *= s; te[ 7 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 5 ] *= s; te[ 8 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdeterminant: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar a = te[ 0 ], b = te[ 1 ], c = te[ 2 ],\r\n\t\t\td = te[ 3 ], e = te[ 4 ], f = te[ 5 ],\r\n\t\t\tg = te[ 6 ], h = te[ 7 ], i = te[ 8 ];\r\n\r\n\t\treturn a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n\t},\r\n\r\n\tgetInverse: function ( matrix, throwOnInvertible ) {\r\n\r\n\t\t// input: THREE.Matrix4\r\n\t\t// ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n\t\tvar me = matrix.elements;\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] =   me[ 10 ] * me[ 5 ] - me[ 6 ] * me[ 9 ];\r\n\t\tte[ 1 ] = - me[ 10 ] * me[ 1 ] + me[ 2 ] * me[ 9 ];\r\n\t\tte[ 2 ] =   me[ 6 ] * me[ 1 ] - me[ 2 ] * me[ 5 ];\r\n\t\tte[ 3 ] = - me[ 10 ] * me[ 4 ] + me[ 6 ] * me[ 8 ];\r\n\t\tte[ 4 ] =   me[ 10 ] * me[ 0 ] - me[ 2 ] * me[ 8 ];\r\n\t\tte[ 5 ] = - me[ 6 ] * me[ 0 ] + me[ 2 ] * me[ 4 ];\r\n\t\tte[ 6 ] =   me[ 9 ] * me[ 4 ] - me[ 5 ] * me[ 8 ];\r\n\t\tte[ 7 ] = - me[ 9 ] * me[ 0 ] + me[ 1 ] * me[ 8 ];\r\n\t\tte[ 8 ] =   me[ 5 ] * me[ 0 ] - me[ 1 ] * me[ 4 ];\r\n\r\n\t\tvar det = me[ 0 ] * te[ 0 ] + me[ 1 ] * te[ 3 ] + me[ 2 ] * te[ 6 ];\r\n\r\n\t\t// no inverse\r\n\r\n\t\tif ( det === 0 ) {\r\n\r\n\t\t\tvar msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n\t\t\tif ( throwOnInvertible || false ) {\r\n\r\n\t\t\t\tthrow new Error( msg );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( msg );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.identity();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tthis.multiplyScalar( 1.0 / det );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranspose: function () {\r\n\r\n\t\tvar tmp, m = this.elements;\r\n\r\n\t\ttmp = m[ 1 ]; m[ 1 ] = m[ 3 ]; m[ 3 ] = tmp;\r\n\t\ttmp = m[ 2 ]; m[ 2 ] = m[ 6 ]; m[ 6 ] = tmp;\r\n\t\ttmp = m[ 5 ]; m[ 5 ] = m[ 7 ]; m[ 7 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tflattenToArrayOffset: function ( array, offset ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tarray[ offset ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\t\tarray[ offset + 8 ]  = te[ 8 ];\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tgetNormalMatrix: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4\r\n\r\n\t\tthis.getInverse( m ).transpose();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttransposeIntoArray: function ( r ) {\r\n\r\n\t\tvar m = this.elements;\r\n\r\n\t\tr[ 0 ] = m[ 0 ];\r\n\t\tr[ 1 ] = m[ 3 ];\r\n\t\tr[ 2 ] = m[ 6 ];\r\n\t\tr[ 3 ] = m[ 1 ];\r\n\t\tr[ 4 ] = m[ 4 ];\r\n\t\tr[ 5 ] = m[ 7 ];\r\n\t\tr[ 6 ] = m[ 2 ];\r\n\t\tr[ 7 ] = m[ 5 ];\r\n\t\tr[ 8 ] = m[ 8 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.elements.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\treturn [\r\n\t\t\tte[ 0 ], te[ 1 ], te[ 2 ],\r\n\t\t\tte[ 3 ], te[ 4 ], te[ 5 ],\r\n\t\t\tte[ 6 ], te[ 7 ], te[ 8 ]\r\n\t\t];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function () {\r\n\r\n\tthis.elements = new Float32Array( [\r\n\r\n\t\t1, 0, 0, 0,\r\n\t\t0, 1, 0, 0,\r\n\t\t0, 0, 1, 0,\r\n\t\t0, 0, 0, 1\r\n\r\n\t] );\r\n\r\n\tif ( arguments.length > 0 ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n\tconstructor: THREE.Matrix4,\r\n\r\n\tset: function ( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 4 ] = n12; te[ 8 ] = n13; te[ 12 ] = n14;\r\n\t\tte[ 1 ] = n21; te[ 5 ] = n22; te[ 9 ] = n23; te[ 13 ] = n24;\r\n\t\tte[ 2 ] = n31; te[ 6 ] = n32; te[ 10 ] = n33; te[ 14 ] = n34;\r\n\t\tte[ 3 ] = n41; te[ 7 ] = n42; te[ 11 ] = n43; te[ 15 ] = n44;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tidentity: function () {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Matrix4().fromArray( this.elements );\r\n\r\n\t},\r\n\r\n\tcopy: function ( m ) {\r\n\r\n\t\tthis.elements.set( m.elements );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractPosition: function ( m ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().' );\r\n\t\treturn this.copyPosition( m );\r\n\r\n\t},\r\n\r\n\tcopyPosition: function ( m ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar me = m.elements;\r\n\r\n\t\tte[ 12 ] = me[ 12 ];\r\n\t\tte[ 13 ] = me[ 13 ];\r\n\t\tte[ 14 ] = me[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractBasis: function ( xAxis, yAxis, zAxis ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\txAxis.set( te[ 0 ], te[ 1 ], te[ 2 ] );\r\n\t\tyAxis.set( te[ 4 ], te[ 5 ], te[ 6 ] );\r\n\t\tzAxis.set( te[ 8 ], te[ 9 ], te[ 10 ] );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeBasis: function ( xAxis, yAxis, zAxis ) {\r\n\r\n\t\tthis.set(\r\n\t\t\txAxis.x, yAxis.x, zAxis.x, 0,\r\n\t\t\txAxis.y, yAxis.y, zAxis.y, 0,\r\n\t\t\txAxis.z, yAxis.z, zAxis.z, 0,\r\n\t\t\t0,       0,       0,       1\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractRotation: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function ( m ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tvar te = this.elements;\r\n\t\t\tvar me = m.elements;\r\n\r\n\t\t\tvar scaleX = 1 / v1.set( me[ 0 ], me[ 1 ], me[ 2 ] ).length();\r\n\t\t\tvar scaleY = 1 / v1.set( me[ 4 ], me[ 5 ], me[ 6 ] ).length();\r\n\t\t\tvar scaleZ = 1 / v1.set( me[ 8 ], me[ 9 ], me[ 10 ] ).length();\r\n\r\n\t\t\tte[ 0 ] = me[ 0 ] * scaleX;\r\n\t\t\tte[ 1 ] = me[ 1 ] * scaleX;\r\n\t\t\tte[ 2 ] = me[ 2 ] * scaleX;\r\n\r\n\t\t\tte[ 4 ] = me[ 4 ] * scaleY;\r\n\t\t\tte[ 5 ] = me[ 5 ] * scaleY;\r\n\t\t\tte[ 6 ] = me[ 6 ] * scaleY;\r\n\r\n\t\t\tte[ 8 ] = me[ 8 ] * scaleZ;\r\n\t\t\tte[ 9 ] = me[ 9 ] * scaleZ;\r\n\t\t\tte[ 10 ] = me[ 10 ] * scaleZ;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmakeRotationFromEuler: function ( euler ) {\r\n\r\n\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar x = euler.x, y = euler.y, z = euler.z;\r\n\t\tvar a = Math.cos( x ), b = Math.sin( x );\r\n\t\tvar c = Math.cos( y ), d = Math.sin( y );\r\n\t\tvar e = Math.cos( z ), f = Math.sin( z );\r\n\r\n\t\tif ( euler.order === 'XYZ' ) {\r\n\r\n\t\t\tvar ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - c * f;\r\n\t\t\tte[ 8 ] = d;\r\n\r\n\t\t\tte[ 1 ] = af + be * d;\r\n\t\t\tte[ 5 ] = ae - bf * d;\r\n\t\t\tte[ 9 ] = - b * c;\r\n\r\n\t\t\tte[ 2 ] = bf - ae * d;\r\n\t\t\tte[ 6 ] = be + af * d;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YXZ' ) {\r\n\r\n\t\t\tvar ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce + df * b;\r\n\t\t\tte[ 4 ] = de * b - cf;\r\n\t\t\tte[ 8 ] = a * d;\r\n\r\n\t\t\tte[ 1 ] = a * f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b;\r\n\r\n\t\t\tte[ 2 ] = cf * b - de;\r\n\t\t\tte[ 6 ] = df + ce * b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZXY' ) {\r\n\r\n\t\t\tvar ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce - df * b;\r\n\t\t\tte[ 4 ] = - a * f;\r\n\t\t\tte[ 8 ] = de + cf * b;\r\n\r\n\t\t\tte[ 1 ] = cf + de * b;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = df - ce * b;\r\n\r\n\t\t\tte[ 2 ] = - a * d;\r\n\t\t\tte[ 6 ] = b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZYX' ) {\r\n\r\n\t\t\tvar ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = be * d - af;\r\n\t\t\tte[ 8 ] = ae * d + bf;\r\n\r\n\t\t\tte[ 1 ] = c * f;\r\n\t\t\tte[ 5 ] = bf * d + ae;\r\n\t\t\tte[ 9 ] = af * d - be;\r\n\r\n\t\t\tte[ 2 ] = - d;\r\n\t\t\tte[ 6 ] = b * c;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YZX' ) {\r\n\r\n\t\t\tvar ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = bd - ac * f;\r\n\t\t\tte[ 8 ] = bc * f + ad;\r\n\r\n\t\t\tte[ 1 ] = f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b * e;\r\n\r\n\t\t\tte[ 2 ] = - d * e;\r\n\t\t\tte[ 6 ] = ad * f + bc;\r\n\t\t\tte[ 10 ] = ac - bd * f;\r\n\r\n\t\t} else if ( euler.order === 'XZY' ) {\r\n\r\n\t\t\tvar ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - f;\r\n\t\t\tte[ 8 ] = d * e;\r\n\r\n\t\t\tte[ 1 ] = ac * f + bd;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = ad * f - bc;\r\n\r\n\t\t\tte[ 2 ] = bc * f - ad;\r\n\t\t\tte[ 6 ] = b * e;\r\n\t\t\tte[ 10 ] = bd * f + ac;\r\n\r\n\t\t}\r\n\r\n\t\t// last column\r\n\t\tte[ 3 ] = 0;\r\n\t\tte[ 7 ] = 0;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\t// bottom row\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetRotationFromQuaternion: function ( q ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().' );\r\n\r\n\t\treturn this.makeRotationFromQuaternion( q );\r\n\r\n\t},\r\n\r\n\tmakeRotationFromQuaternion: function ( q ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar x = q.x, y = q.y, z = q.z, w = q.w;\r\n\t\tvar x2 = x + x, y2 = y + y, z2 = z + z;\r\n\t\tvar xx = x * x2, xy = x * y2, xz = x * z2;\r\n\t\tvar yy = y * y2, yz = y * z2, zz = z * z2;\r\n\t\tvar wx = w * x2, wy = w * y2, wz = w * z2;\r\n\r\n\t\tte[ 0 ] = 1 - ( yy + zz );\r\n\t\tte[ 4 ] = xy - wz;\r\n\t\tte[ 8 ] = xz + wy;\r\n\r\n\t\tte[ 1 ] = xy + wz;\r\n\t\tte[ 5 ] = 1 - ( xx + zz );\r\n\t\tte[ 9 ] = yz - wx;\r\n\r\n\t\tte[ 2 ] = xz - wy;\r\n\t\tte[ 6 ] = yz + wx;\r\n\t\tte[ 10 ] = 1 - ( xx + yy );\r\n\r\n\t\t// last column\r\n\t\tte[ 3 ] = 0;\r\n\t\tte[ 7 ] = 0;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\t// bottom row\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlookAt: function () {\r\n\r\n\t\tvar x, y, z;\r\n\r\n\t\treturn function ( eye, target, up ) {\r\n\r\n\t\t\tif ( x === undefined ) x = new THREE.Vector3();\r\n\t\t\tif ( y === undefined ) y = new THREE.Vector3();\r\n\t\t\tif ( z === undefined ) z = new THREE.Vector3();\r\n\r\n\t\t\tvar te = this.elements;\r\n\r\n\t\t\tz.subVectors( eye, target ).normalize();\r\n\r\n\t\t\tif ( z.length() === 0 ) {\r\n\r\n\t\t\t\tz.z = 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tx.crossVectors( up, z ).normalize();\r\n\r\n\t\t\tif ( x.length() === 0 ) {\r\n\r\n\t\t\t\tz.x += 0.0001;\r\n\t\t\t\tx.crossVectors( up, z ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t\ty.crossVectors( z, x );\r\n\r\n\r\n\t\t\tte[ 0 ] = x.x; te[ 4 ] = y.x; te[ 8 ] = z.x;\r\n\t\t\tte[ 1 ] = x.y; te[ 5 ] = y.y; te[ 9 ] = z.y;\r\n\t\t\tte[ 2 ] = x.z; te[ 6 ] = y.z; te[ 10 ] = z.z;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmultiply: function ( m, n ) {\r\n\r\n\t\tif ( n !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.' );\r\n\t\t\treturn this.multiplyMatrices( m, n );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyMatrices( this, m );\r\n\r\n\t},\r\n\r\n\tmultiplyMatrices: function ( a, b ) {\r\n\r\n\t\tvar ae = a.elements;\r\n\t\tvar be = b.elements;\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar a11 = ae[ 0 ], a12 = ae[ 4 ], a13 = ae[ 8 ], a14 = ae[ 12 ];\r\n\t\tvar a21 = ae[ 1 ], a22 = ae[ 5 ], a23 = ae[ 9 ], a24 = ae[ 13 ];\r\n\t\tvar a31 = ae[ 2 ], a32 = ae[ 6 ], a33 = ae[ 10 ], a34 = ae[ 14 ];\r\n\t\tvar a41 = ae[ 3 ], a42 = ae[ 7 ], a43 = ae[ 11 ], a44 = ae[ 15 ];\r\n\r\n\t\tvar b11 = be[ 0 ], b12 = be[ 4 ], b13 = be[ 8 ], b14 = be[ 12 ];\r\n\t\tvar b21 = be[ 1 ], b22 = be[ 5 ], b23 = be[ 9 ], b24 = be[ 13 ];\r\n\t\tvar b31 = be[ 2 ], b32 = be[ 6 ], b33 = be[ 10 ], b34 = be[ 14 ];\r\n\t\tvar b41 = be[ 3 ], b42 = be[ 7 ], b43 = be[ 11 ], b44 = be[ 15 ];\r\n\r\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n\t\tte[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n\t\tte[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n\t\tte[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n\t\tte[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n\t\tte[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n\t\tte[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n\t\tte[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n\t\tte[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n\t\tte[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n\t\tte[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\t\tte[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\t\tte[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\t\tte[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyToArray: function ( a, b, r ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tthis.multiplyMatrices( a, b );\r\n\r\n\t\tr[ 0 ] = te[ 0 ]; r[ 1 ] = te[ 1 ]; r[ 2 ] = te[ 2 ]; r[ 3 ] = te[ 3 ];\r\n\t\tr[ 4 ] = te[ 4 ]; r[ 5 ] = te[ 5 ]; r[ 6 ] = te[ 6 ]; r[ 7 ] = te[ 7 ];\r\n\t\tr[ 8 ]  = te[ 8 ]; r[ 9 ]  = te[ 9 ]; r[ 10 ] = te[ 10 ]; r[ 11 ] = te[ 11 ];\r\n\t\tr[ 12 ] = te[ 12 ]; r[ 13 ] = te[ 13 ]; r[ 14 ] = te[ 14 ]; r[ 15 ] = te[ 15 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 4 ] *= s; te[ 8 ] *= s; te[ 12 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 5 ] *= s; te[ 9 ] *= s; te[ 13 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 6 ] *= s; te[ 10 ] *= s; te[ 14 ] *= s;\r\n\t\tte[ 3 ] *= s; te[ 7 ] *= s; te[ 11 ] *= s; te[ 15 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.' );\r\n\t\treturn vector.applyProjection( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector4: function ( vector ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix4( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector3Array: function ( a ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );\r\n\t\treturn this.applyToVector3Array( a );\r\n\r\n\t},\r\n\r\n\tapplyToVector3Array: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function ( array, offset, length ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = array.length;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i += 3, j += 3 ) {\r\n\r\n\t\t\t\tv1.fromArray( array, j );\r\n\t\t\t\tv1.applyMatrix4( this );\r\n\t\t\t\tv1.toArray( array, j );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyToBuffer: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function applyToBuffer( buffer, offset, length ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = buffer.length / buffer.itemSize;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i ++, j ++ ) {\r\n\r\n\t\t\t\tv1.x = buffer.getX( j );\r\n\t\t\t\tv1.y = buffer.getY( j );\r\n\t\t\t\tv1.z = buffer.getZ( j );\r\n\r\n\t\t\t\tv1.applyMatrix4( this );\r\n\r\n\t\t\t\tbuffer.setXYZ( v1.x, v1.y, v1.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn buffer;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateAxis: function ( v ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.' );\r\n\r\n\t\tv.transformDirection( this );\r\n\r\n\t},\r\n\r\n\tcrossVector: function ( vector ) {\r\n\r\n\t\tconsole.warn( 'THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix4( this );\r\n\r\n\t},\r\n\r\n\tdeterminant: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar n11 = te[ 0 ], n12 = te[ 4 ], n13 = te[ 8 ], n14 = te[ 12 ];\r\n\t\tvar n21 = te[ 1 ], n22 = te[ 5 ], n23 = te[ 9 ], n24 = te[ 13 ];\r\n\t\tvar n31 = te[ 2 ], n32 = te[ 6 ], n33 = te[ 10 ], n34 = te[ 14 ];\r\n\t\tvar n41 = te[ 3 ], n42 = te[ 7 ], n43 = te[ 11 ], n44 = te[ 15 ];\r\n\r\n\t\t//TODO: make this more efficient\r\n\t\t//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n\t\treturn (\r\n\t\t\tn41 * (\r\n\t\t\t\t+ n14 * n23 * n32\r\n\t\t\t\t - n13 * n24 * n32\r\n\t\t\t\t - n14 * n22 * n33\r\n\t\t\t\t + n12 * n24 * n33\r\n\t\t\t\t + n13 * n22 * n34\r\n\t\t\t\t - n12 * n23 * n34\r\n\t\t\t) +\r\n\t\t\tn42 * (\r\n\t\t\t\t+ n11 * n23 * n34\r\n\t\t\t\t - n11 * n24 * n33\r\n\t\t\t\t + n14 * n21 * n33\r\n\t\t\t\t - n13 * n21 * n34\r\n\t\t\t\t + n13 * n24 * n31\r\n\t\t\t\t - n14 * n23 * n31\r\n\t\t\t) +\r\n\t\t\tn43 * (\r\n\t\t\t\t+ n11 * n24 * n32\r\n\t\t\t\t - n11 * n22 * n34\r\n\t\t\t\t - n14 * n21 * n32\r\n\t\t\t\t + n12 * n21 * n34\r\n\t\t\t\t + n14 * n22 * n31\r\n\t\t\t\t - n12 * n24 * n31\r\n\t\t\t) +\r\n\t\t\tn44 * (\r\n\t\t\t\t- n13 * n22 * n31\r\n\t\t\t\t - n11 * n23 * n32\r\n\t\t\t\t + n11 * n22 * n33\r\n\t\t\t\t + n13 * n21 * n32\r\n\t\t\t\t - n12 * n21 * n33\r\n\t\t\t\t + n12 * n23 * n31\r\n\t\t\t)\r\n\r\n\t\t);\r\n\r\n\t},\r\n\r\n\ttranspose: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar tmp;\r\n\r\n\t\ttmp = te[ 1 ]; te[ 1 ] = te[ 4 ]; te[ 4 ] = tmp;\r\n\t\ttmp = te[ 2 ]; te[ 2 ] = te[ 8 ]; te[ 8 ] = tmp;\r\n\t\ttmp = te[ 6 ]; te[ 6 ] = te[ 9 ]; te[ 9 ] = tmp;\r\n\r\n\t\ttmp = te[ 3 ]; te[ 3 ] = te[ 12 ]; te[ 12 ] = tmp;\r\n\t\ttmp = te[ 7 ]; te[ 7 ] = te[ 13 ]; te[ 13 ] = tmp;\r\n\t\ttmp = te[ 11 ]; te[ 11 ] = te[ 14 ]; te[ 14 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tflattenToArrayOffset: function ( array, offset ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tarray[ offset ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\r\n\t\tarray[ offset + 8 ]  = te[ 8 ];\r\n\t\tarray[ offset + 9 ]  = te[ 9 ];\r\n\t\tarray[ offset + 10 ] = te[ 10 ];\r\n\t\tarray[ offset + 11 ] = te[ 11 ];\r\n\r\n\t\tarray[ offset + 12 ] = te[ 12 ];\r\n\t\tarray[ offset + 13 ] = te[ 13 ];\r\n\t\tarray[ offset + 14 ] = te[ 14 ];\r\n\t\tarray[ offset + 15 ] = te[ 15 ];\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\t\t\tconsole.warn( 'THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.' );\r\n\r\n\t\t\tvar te = this.elements;\r\n\t\t\treturn v1.set( te[ 12 ], te[ 13 ], te[ 14 ] );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetPosition: function ( v ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 12 ] = v.x;\r\n\t\tte[ 13 ] = v.y;\r\n\t\tte[ 14 ] = v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetInverse: function ( m, throwOnInvertible ) {\r\n\r\n\t\t// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n\t\tvar te = this.elements;\r\n\t\tvar me = m.elements;\r\n\r\n\t\tvar n11 = me[ 0 ], n12 = me[ 4 ], n13 = me[ 8 ], n14 = me[ 12 ];\r\n\t\tvar n21 = me[ 1 ], n22 = me[ 5 ], n23 = me[ 9 ], n24 = me[ 13 ];\r\n\t\tvar n31 = me[ 2 ], n32 = me[ 6 ], n33 = me[ 10 ], n34 = me[ 14 ];\r\n\t\tvar n41 = me[ 3 ], n42 = me[ 7 ], n43 = me[ 11 ], n44 = me[ 15 ];\r\n\r\n\t\tte[ 0 ] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n\t\tte[ 4 ] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n\t\tte[ 8 ] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n\t\tte[ 12 ] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n\t\tte[ 1 ] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n\t\tte[ 5 ] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n\t\tte[ 9 ] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n\t\tte[ 13 ] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n\t\tte[ 2 ] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n\t\tte[ 6 ] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n\t\tte[ 10 ] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n\t\tte[ 14 ] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n\t\tte[ 3 ] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n\t\tte[ 7 ] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n\t\tte[ 11 ] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n\t\tte[ 15 ] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n\t\tvar det = n11 * te[ 0 ] + n21 * te[ 4 ] + n31 * te[ 8 ] + n41 * te[ 12 ];\r\n\r\n\t\tif ( det === 0 ) {\r\n\r\n\t\t\tvar msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n\t\t\tif ( throwOnInvertible || false ) {\r\n\r\n\t\t\t\tthrow new Error( msg );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( msg );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.identity();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tthis.multiplyScalar( 1 / det );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( v ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: .translate() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateX: function ( angle ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: .rotateX() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateY: function ( angle ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: .rotateY() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateZ: function ( angle ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: .rotateZ() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateByAxis: function ( axis, angle ) {\r\n\r\n\t\tconsole.error( 'THREE.Matrix4: .rotateByAxis() has been removed.' );\r\n\r\n\t},\r\n\r\n\tscale: function ( v ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar x = v.x, y = v.y, z = v.z;\r\n\r\n\t\tte[ 0 ] *= x; te[ 4 ] *= y; te[ 8 ] *= z;\r\n\t\tte[ 1 ] *= x; te[ 5 ] *= y; te[ 9 ] *= z;\r\n\t\tte[ 2 ] *= x; te[ 6 ] *= y; te[ 10 ] *= z;\r\n\t\tte[ 3 ] *= x; te[ 7 ] *= y; te[ 11 ] *= z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetMaxScaleOnAxis: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar scaleXSq = te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] + te[ 2 ] * te[ 2 ];\r\n\t\tvar scaleYSq = te[ 4 ] * te[ 4 ] + te[ 5 ] * te[ 5 ] + te[ 6 ] * te[ 6 ];\r\n\t\tvar scaleZSq = te[ 8 ] * te[ 8 ] + te[ 9 ] * te[ 9 ] + te[ 10 ] * te[ 10 ];\r\n\r\n\t\treturn Math.sqrt( Math.max( scaleXSq, Math.max( scaleYSq, scaleZSq ) ) );\r\n\r\n\t},\r\n\r\n\tmakeTranslation: function ( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, x,\r\n\t\t\t0, 1, 0, y,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationX: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0,  0, 0,\r\n\t\t\t0, c, - s, 0,\r\n\t\t\t0, s,  c, 0,\r\n\t\t\t0, 0,  0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationY: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t c, 0, s, 0,\r\n\t\t\t 0, 1, 0, 0,\r\n\t\t\t- s, 0, c, 0,\r\n\t\t\t 0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationZ: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tc, - s, 0, 0,\r\n\t\t\ts,  c, 0, 0,\r\n\t\t\t0,  0, 1, 0,\r\n\t\t\t0,  0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationAxis: function ( axis, angle ) {\r\n\r\n\t\t// Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n\t\tvar c = Math.cos( angle );\r\n\t\tvar s = Math.sin( angle );\r\n\t\tvar t = 1 - c;\r\n\t\tvar x = axis.x, y = axis.y, z = axis.z;\r\n\t\tvar tx = t * x, ty = t * y;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\ttx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n\t\t\ttx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n\t\t\ttx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\t return this;\r\n\r\n\t},\r\n\r\n\tmakeScale: function ( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tx, 0, 0, 0,\r\n\t\t\t0, y, 0, 0,\r\n\t\t\t0, 0, z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcompose: function ( position, quaternion, scale ) {\r\n\r\n\t\tthis.makeRotationFromQuaternion( quaternion );\r\n\t\tthis.scale( scale );\r\n\t\tthis.setPosition( position );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdecompose: function () {\r\n\r\n\t\tvar vector, matrix;\r\n\r\n\t\treturn function ( position, quaternion, scale ) {\r\n\r\n\t\t\tif ( vector === undefined ) vector = new THREE.Vector3();\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\r\n\t\t\tvar te = this.elements;\r\n\r\n\t\t\tvar sx = vector.set( te[ 0 ], te[ 1 ], te[ 2 ] ).length();\r\n\t\t\tvar sy = vector.set( te[ 4 ], te[ 5 ], te[ 6 ] ).length();\r\n\t\t\tvar sz = vector.set( te[ 8 ], te[ 9 ], te[ 10 ] ).length();\r\n\r\n\t\t\t// if determine is negative, we need to invert one scale\r\n\t\t\tvar det = this.determinant();\r\n\t\t\tif ( det < 0 ) {\r\n\r\n\t\t\t\tsx = - sx;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tposition.x = te[ 12 ];\r\n\t\t\tposition.y = te[ 13 ];\r\n\t\t\tposition.z = te[ 14 ];\r\n\r\n\t\t\t// scale the rotation part\r\n\r\n\t\t\tmatrix.elements.set( this.elements ); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n\t\t\tvar invSX = 1 / sx;\r\n\t\t\tvar invSY = 1 / sy;\r\n\t\t\tvar invSZ = 1 / sz;\r\n\r\n\t\t\tmatrix.elements[ 0 ] *= invSX;\r\n\t\t\tmatrix.elements[ 1 ] *= invSX;\r\n\t\t\tmatrix.elements[ 2 ] *= invSX;\r\n\r\n\t\t\tmatrix.elements[ 4 ] *= invSY;\r\n\t\t\tmatrix.elements[ 5 ] *= invSY;\r\n\t\t\tmatrix.elements[ 6 ] *= invSY;\r\n\r\n\t\t\tmatrix.elements[ 8 ] *= invSZ;\r\n\t\t\tmatrix.elements[ 9 ] *= invSZ;\r\n\t\t\tmatrix.elements[ 10 ] *= invSZ;\r\n\r\n\t\t\tquaternion.setFromRotationMatrix( matrix );\r\n\r\n\t\t\tscale.x = sx;\r\n\t\t\tscale.y = sy;\r\n\t\t\tscale.z = sz;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmakeFrustum: function ( left, right, bottom, top, near, far ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar x = 2 * near / ( right - left );\r\n\t\tvar y = 2 * near / ( top - bottom );\r\n\r\n\t\tvar a = ( right + left ) / ( right - left );\r\n\t\tvar b = ( top + bottom ) / ( top - bottom );\r\n\t\tvar c = - ( far + near ) / ( far - near );\r\n\t\tvar d = - 2 * far * near / ( far - near );\r\n\r\n\t\tte[ 0 ] = x;\tte[ 4 ] = 0;\tte[ 8 ] = a;\tte[ 12 ] = 0;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = y;\tte[ 9 ] = b;\tte[ 13 ] = 0;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = c;\tte[ 14 ] = d;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = - 1;\tte[ 15 ] = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakePerspective: function ( fov, aspect, near, far ) {\r\n\r\n\t\tvar ymax = near * Math.tan( THREE.Math.degToRad( fov * 0.5 ) );\r\n\t\tvar ymin = - ymax;\r\n\t\tvar xmin = ymin * aspect;\r\n\t\tvar xmax = ymax * aspect;\r\n\r\n\t\treturn this.makeFrustum( xmin, xmax, ymin, ymax, near, far );\r\n\r\n\t},\r\n\r\n\tmakeOrthographic: function ( left, right, top, bottom, near, far ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar w = right - left;\r\n\t\tvar h = top - bottom;\r\n\t\tvar p = far - near;\r\n\r\n\t\tvar x = ( right + left ) / w;\r\n\t\tvar y = ( top + bottom ) / h;\r\n\t\tvar z = ( far + near ) / p;\r\n\r\n\t\tte[ 0 ] = 2 / w;\tte[ 4 ] = 0;\tte[ 8 ] = 0;\tte[ 12 ] = - x;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = 2 / h;\tte[ 9 ] = 0;\tte[ 13 ] = - y;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = - 2 / p;\tte[ 14 ] = - z;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = 0;\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( matrix ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar me = matrix.elements;\r\n\r\n\t\tfor ( var i = 0; i < 16; i ++ ) {\r\n\r\n\t\t\tif ( te[ i ] !== me[ i ] ) return false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.elements.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\treturn [\r\n\t\t\tte[ 0 ], te[ 1 ], te[ 2 ], te[ 3 ],\r\n\t\t\tte[ 4 ], te[ 5 ], te[ 6 ], te[ 7 ],\r\n\t\t\tte[ 8 ], te[ 9 ], te[ 10 ], te[ 11 ],\r\n\t\t\tte[ 12 ], te[ 13 ], te[ 14 ], te[ 15 ]\r\n\t\t];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function ( origin, direction ) {\r\n\r\n\tthis.origin = ( origin !== undefined ) ? origin : new THREE.Vector3();\r\n\tthis.direction = ( direction !== undefined ) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n\tconstructor: THREE.Ray,\r\n\r\n\tset: function ( origin, direction ) {\r\n\r\n\t\tthis.origin.copy( origin );\r\n\t\tthis.direction.copy( direction );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( ray ) {\r\n\r\n\t\tthis.origin.copy( ray.origin );\r\n\t\tthis.direction.copy( ray.direction );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tat: function ( t, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn result.copy( this.direction ).multiplyScalar( t ).add( this.origin );\r\n\r\n\t},\r\n\r\n\trecast: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( t ) {\r\n\r\n\t\t\tthis.origin.copy( this.at( t, v1 ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclosestPointToPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\tresult.subVectors( point, this.origin );\r\n\t\tvar directionDistance = result.dot( this.direction );\r\n\r\n\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\treturn result.copy( this.origin );\r\n\r\n\t\t}\r\n\r\n\t\treturn result.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function ( point ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceSqToPoint( point ) );\r\n\r\n\t},\r\n\r\n\tdistanceSqToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar directionDistance = v1.subVectors( point, this.origin ).dot( this.direction );\r\n\r\n\t\t\t// point behind the ray\r\n\r\n\t\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\t\treturn this.origin.distanceToSquared( point );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tv1.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t\t\treturn v1.distanceToSquared( point );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tdistanceSqToSegment: function () {\r\n\r\n\t\tvar segCenter = new THREE.Vector3();\r\n\t\tvar segDir = new THREE.Vector3();\r\n\t\tvar diff = new THREE.Vector3();\r\n\r\n\t\treturn function ( v0, v1, optionalPointOnRay, optionalPointOnSegment ) {\r\n\r\n\t\t\t// from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n\t\t\t// It returns the min distance between the ray and the segment\r\n\t\t\t// defined by v0 and v1\r\n\t\t\t// It can also set two optional targets :\r\n\t\t\t// - The closest point on the ray\r\n\t\t\t// - The closest point on the segment\r\n\r\n\t\t\tsegCenter.copy( v0 ).add( v1 ).multiplyScalar( 0.5 );\r\n\t\t\tsegDir.copy( v1 ).sub( v0 ).normalize();\r\n\t\t\tdiff.copy( this.origin ).sub( segCenter );\r\n\r\n\t\t\tvar segExtent = v0.distanceTo( v1 ) * 0.5;\r\n\t\t\tvar a01 = - this.direction.dot( segDir );\r\n\t\t\tvar b0 = diff.dot( this.direction );\r\n\t\t\tvar b1 = - diff.dot( segDir );\r\n\t\t\tvar c = diff.lengthSq();\r\n\t\t\tvar det = Math.abs( 1 - a01 * a01 );\r\n\t\t\tvar s0, s1, sqrDist, extDet;\r\n\r\n\t\t\tif ( det > 0 ) {\r\n\r\n\t\t\t\t// The ray and segment are not parallel.\r\n\r\n\t\t\t\ts0 = a01 * b1 - b0;\r\n\t\t\t\ts1 = a01 * b0 - b1;\r\n\t\t\t\textDet = segExtent * det;\r\n\r\n\t\t\t\tif ( s0 >= 0 ) {\r\n\r\n\t\t\t\t\tif ( s1 >= - extDet ) {\r\n\r\n\t\t\t\t\t\tif ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t\t\t// region 0\r\n\t\t\t\t\t\t\t// Minimum at interior points of ray and segment.\r\n\r\n\t\t\t\t\t\t\tvar invDet = 1 / det;\r\n\t\t\t\t\t\t\ts0 *= invDet;\r\n\t\t\t\t\t\t\ts1 *= invDet;\r\n\t\t\t\t\t\t\tsqrDist = s0 * ( s0 + a01 * s1 + 2 * b0 ) + s1 * ( a01 * s0 + s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t// region 1\r\n\r\n\t\t\t\t\t\t\ts1 = segExtent;\r\n\t\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// region 5\r\n\r\n\t\t\t\t\t\ts1 = - segExtent;\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( s1 <= - extDet ) {\r\n\r\n\t\t\t\t\t\t// region 4\r\n\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( - a01 * segExtent + b0 ) );\r\n\t\t\t\t\t\ts1 = ( s0 > 0 ) ? - segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t} else if ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t\t// region 3\r\n\r\n\t\t\t\t\t\ts0 = 0;\r\n\t\t\t\t\t\ts1 = Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// region 2\r\n\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * segExtent + b0 ) );\r\n\t\t\t\t\t\ts1 = ( s0 > 0 ) ? segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Ray and segment are parallel.\r\n\r\n\t\t\t\ts1 = ( a01 > 0 ) ? - segExtent : segExtent;\r\n\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( optionalPointOnRay ) {\r\n\r\n\t\t\t\toptionalPointOnRay.copy( this.direction ).multiplyScalar( s0 ).add( this.origin );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( optionalPointOnSegment ) {\r\n\r\n\t\t\t\toptionalPointOnSegment.copy( segDir ).multiplyScalar( s1 ).add( segCenter );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn sqrDist;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tisIntersectionSphere: function ( sphere ) {\r\n\r\n\t\treturn this.distanceToPoint( sphere.center ) <= sphere.radius;\r\n\r\n\t},\r\n\r\n\tintersectSphere: function () {\r\n\r\n\t\t// from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( sphere, optionalTarget ) {\r\n\r\n\t\t\tv1.subVectors( sphere.center, this.origin );\r\n\r\n\t\t\tvar tca = v1.dot( this.direction );\r\n\r\n\t\t\tvar d2 = v1.dot( v1 ) - tca * tca;\r\n\r\n\t\t\tvar radius2 = sphere.radius * sphere.radius;\r\n\r\n\t\t\tif ( d2 > radius2 ) return null;\r\n\r\n\t\t\tvar thc = Math.sqrt( radius2 - d2 );\r\n\r\n\t\t\t// t0 = first intersect point - entrance on front of sphere\r\n\t\t\tvar t0 = tca - thc;\r\n\r\n\t\t\t// t1 = second intersect point - exit point on back of sphere\r\n\t\t\tvar t1 = tca + thc;\r\n\r\n\t\t\t// test to see if both t0 and t1 are behind the ray - if so, return null\r\n\t\t\tif ( t0 < 0 && t1 < 0 ) return null;\r\n\r\n\t\t\t// test to see if t0 is behind the ray:\r\n\t\t\t// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n\t\t\t// in order to always return an intersect point that is in front of the ray.\r\n\t\t\tif ( t0 < 0 ) return this.at( t1, optionalTarget );\r\n\r\n\t\t\t// else t0 is in front of the ray, so return the first collision point scaled by t0\r\n\t\t\treturn this.at( t0, optionalTarget );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tisIntersectionPlane: function ( plane ) {\r\n\r\n\t\t// check if the ray lies on the plane first\r\n\r\n\t\tvar distToPoint = plane.distanceToPoint( this.origin );\r\n\r\n\t\tif ( distToPoint === 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\tvar denominator = plane.normal.dot( this.direction );\r\n\r\n\t\tif ( denominator * distToPoint < 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\t// ray origin is behind the plane (and is pointing behind it)\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tdistanceToPlane: function ( plane ) {\r\n\r\n\t\tvar denominator = plane.normal.dot( this.direction );\r\n\t\tif ( denominator === 0 ) {\r\n\r\n\t\t\t// line is coplanar, return origin\r\n\t\t\tif ( plane.distanceToPoint( this.origin ) === 0 ) {\r\n\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;\r\n\r\n\t\t// Return if the ray never intersects the plane\r\n\r\n\t\treturn t >= 0 ? t :  null;\r\n\r\n\t},\r\n\r\n\tintersectPlane: function ( plane, optionalTarget ) {\r\n\r\n\t\tvar t = this.distanceToPlane( plane );\r\n\r\n\t\tif ( t === null ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.at( t, optionalTarget );\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function () {\r\n\r\n\t\tvar v = new THREE.Vector3();\r\n\r\n\t\treturn function ( box ) {\r\n\r\n\t\t\treturn this.intersectBox( box, v ) !== null;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersectBox: function ( box, optionalTarget ) {\r\n\r\n\t\t// http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n\t\tvar tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n\t\tvar invdirx = 1 / this.direction.x,\r\n\t\t\tinvdiry = 1 / this.direction.y,\r\n\t\t\tinvdirz = 1 / this.direction.z;\r\n\r\n\t\tvar origin = this.origin;\r\n\r\n\t\tif ( invdirx >= 0 ) {\r\n\r\n\t\t\ttmin = ( box.min.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.max.x - origin.x ) * invdirx;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttmin = ( box.max.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.min.x - origin.x ) * invdirx;\r\n\r\n\t\t}\r\n\r\n\t\tif ( invdiry >= 0 ) {\r\n\r\n\t\t\ttymin = ( box.min.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.max.y - origin.y ) * invdiry;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttymin = ( box.max.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.min.y - origin.y ) * invdiry;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tymax ) || ( tymin > tmax ) ) return null;\r\n\r\n\t\t// These lines also handle the case where tmin or tmax is NaN\r\n\t\t// (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n\t\tif ( tymin > tmin || tmin !== tmin ) tmin = tymin;\r\n\r\n\t\tif ( tymax < tmax || tmax !== tmax ) tmax = tymax;\r\n\r\n\t\tif ( invdirz >= 0 ) {\r\n\r\n\t\t\ttzmin = ( box.min.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.max.z - origin.z ) * invdirz;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttzmin = ( box.max.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.min.z - origin.z ) * invdirz;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tzmax ) || ( tzmin > tmax ) ) return null;\r\n\r\n\t\tif ( tzmin > tmin || tmin !== tmin ) tmin = tzmin;\r\n\r\n\t\tif ( tzmax < tmax || tmax !== tmax ) tmax = tzmax;\r\n\r\n\t\t//return point closest to the ray (positive side)\r\n\r\n\t\tif ( tmax < 0 ) return null;\r\n\r\n\t\treturn this.at( tmin >= 0 ? tmin : tmax, optionalTarget );\r\n\r\n\t},\r\n\r\n\tintersectTriangle: function () {\r\n\r\n\t\t// Compute the offset origin, edges, and normal.\r\n\t\tvar diff = new THREE.Vector3();\r\n\t\tvar edge1 = new THREE.Vector3();\r\n\t\tvar edge2 = new THREE.Vector3();\r\n\t\tvar normal = new THREE.Vector3();\r\n\r\n\t\treturn function ( a, b, c, backfaceCulling, optionalTarget ) {\r\n\r\n\t\t\t// from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n\t\t\tedge1.subVectors( b, a );\r\n\t\t\tedge2.subVectors( c, a );\r\n\t\t\tnormal.crossVectors( edge1, edge2 );\r\n\r\n\t\t\t// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n\t\t\t// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n\t\t\t//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n\t\t\t//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n\t\t\t//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n\t\t\tvar DdN = this.direction.dot( normal );\r\n\t\t\tvar sign;\r\n\r\n\t\t\tif ( DdN > 0 ) {\r\n\r\n\t\t\t\tif ( backfaceCulling ) return null;\r\n\t\t\t\tsign = 1;\r\n\r\n\t\t\t} else if ( DdN < 0 ) {\r\n\r\n\t\t\t\tsign = - 1;\r\n\t\t\t\tDdN = - DdN;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdiff.subVectors( this.origin, a );\r\n\t\t\tvar DdQxE2 = sign * this.direction.dot( edge2.crossVectors( diff, edge2 ) );\r\n\r\n\t\t\t// b1 < 0, no intersection\r\n\t\t\tif ( DdQxE2 < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar DdE1xQ = sign * this.direction.dot( edge1.cross( diff ) );\r\n\r\n\t\t\t// b2 < 0, no intersection\r\n\t\t\tif ( DdE1xQ < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// b1+b2 > 1, no intersection\r\n\t\t\tif ( DdQxE2 + DdE1xQ > DdN ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Line intersects triangle, check if ray does.\r\n\t\t\tvar QdN = - sign * diff.dot( normal );\r\n\r\n\t\t\t// t < 0, no intersection\r\n\t\t\tif ( QdN < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Ray intersects triangle.\r\n\t\t\treturn this.at( QdN / DdN, optionalTarget );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyMatrix4: function ( matrix4 ) {\r\n\r\n\t\tthis.direction.add( this.origin ).applyMatrix4( matrix4 );\r\n\t\tthis.origin.applyMatrix4( matrix4 );\r\n\t\tthis.direction.sub( this.origin );\r\n\t\tthis.direction.normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( ray ) {\r\n\r\n\t\treturn ray.origin.equals( this.origin ) && ray.direction.equals( this.direction );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function ( center, radius ) {\r\n\r\n\tthis.center = ( center !== undefined ) ? center : new THREE.Vector3();\r\n\tthis.radius = ( radius !== undefined ) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n\tconstructor: THREE.Sphere,\r\n\r\n\tset: function ( center, radius ) {\r\n\r\n\t\tthis.center.copy( center );\r\n\t\tthis.radius = radius;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPoints: function () {\r\n\r\n\t\tvar box = new THREE.Box3();\r\n\r\n\t\treturn function ( points, optionalCenter ) {\r\n\r\n\t\t\tvar center = this.center;\r\n\r\n\t\t\tif ( optionalCenter !== undefined ) {\r\n\r\n\t\t\t\tcenter.copy( optionalCenter );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbox.setFromPoints( points ).center( center );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar maxRadiusSq = 0;\r\n\r\n\t\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( points[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( sphere ) {\r\n\r\n\t\tthis.center.copy( sphere.center );\r\n\t\tthis.radius = sphere.radius;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\treturn ( this.radius <= 0 );\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\treturn ( point.distanceToSquared( this.center ) <= ( this.radius * this.radius ) );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function ( point ) {\r\n\r\n\t\treturn ( point.distanceTo( this.center ) - this.radius );\r\n\r\n\t},\r\n\r\n\tintersectsSphere: function ( sphere ) {\r\n\r\n\t\tvar radiusSum = this.radius + sphere.radius;\r\n\r\n\t\treturn sphere.center.distanceToSquared( this.center ) <= ( radiusSum * radiusSum );\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar deltaLengthSq = this.center.distanceToSquared( point );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\tresult.copy( point );\r\n\r\n\t\tif ( deltaLengthSq > ( this.radius * this.radius ) ) {\r\n\r\n\t\t\tresult.sub( this.center ).normalize();\r\n\t\t\tresult.multiplyScalar( this.radius ).add( this.center );\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t},\r\n\r\n\tgetBoundingBox: function ( optionalTarget ) {\r\n\r\n\t\tvar box = optionalTarget || new THREE.Box3();\r\n\r\n\t\tbox.set( this.center, this.center );\r\n\t\tbox.expandByScalar( this.radius );\r\n\r\n\t\treturn box;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( matrix ) {\r\n\r\n\t\tthis.center.applyMatrix4( matrix );\r\n\t\tthis.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.center.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( sphere ) {\r\n\r\n\t\treturn sphere.center.equals( this.center ) && ( sphere.radius === this.radius );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function ( p0, p1, p2, p3, p4, p5 ) {\r\n\r\n\tthis.planes = [\r\n\r\n\t\t( p0 !== undefined ) ? p0 : new THREE.Plane(),\r\n\t\t( p1 !== undefined ) ? p1 : new THREE.Plane(),\r\n\t\t( p2 !== undefined ) ? p2 : new THREE.Plane(),\r\n\t\t( p3 !== undefined ) ? p3 : new THREE.Plane(),\r\n\t\t( p4 !== undefined ) ? p4 : new THREE.Plane(),\r\n\t\t( p5 !== undefined ) ? p5 : new THREE.Plane()\r\n\r\n\t];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n\tconstructor: THREE.Frustum,\r\n\r\n\tset: function ( p0, p1, p2, p3, p4, p5 ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tplanes[ 0 ].copy( p0 );\r\n\t\tplanes[ 1 ].copy( p1 );\r\n\t\tplanes[ 2 ].copy( p2 );\r\n\t\tplanes[ 3 ].copy( p3 );\r\n\t\tplanes[ 4 ].copy( p4 );\r\n\t\tplanes[ 5 ].copy( p5 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( frustum ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tplanes[ i ].copy( frustum.planes[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromMatrix: function ( m ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\t\tvar me = m.elements;\r\n\t\tvar me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];\r\n\t\tvar me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];\r\n\t\tvar me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];\r\n\t\tvar me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];\r\n\r\n\t\tplanes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();\r\n\t\tplanes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();\r\n\t\tplanes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();\r\n\t\tplanes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();\r\n\t\tplanes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();\r\n\t\tplanes[ 5 ].setComponents( me3 + me2, me7 + me6, me11 + me10, me15 + me14 ).normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tintersectsObject: function () {\r\n\r\n\t\tvar sphere = new THREE.Sphere();\r\n\r\n\t\treturn function ( object ) {\r\n\r\n\t\t\tvar geometry = object.geometry;\r\n\r\n\t\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t\tsphere.copy( geometry.boundingSphere );\r\n\t\t\tsphere.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\treturn this.intersectsSphere( sphere );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersectsSphere: function ( sphere ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\t\tvar center = sphere.center;\r\n\t\tvar negRadius = - sphere.radius;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tvar distance = planes[ i ].distanceToPoint( center );\r\n\r\n\t\t\tif ( distance < negRadius ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tintersectsBox: function () {\r\n\r\n\t\tvar p1 = new THREE.Vector3(),\r\n\t\t\tp2 = new THREE.Vector3();\r\n\r\n\t\treturn function ( box ) {\r\n\r\n\t\t\tvar planes = this.planes;\r\n\r\n\t\t\tfor ( var i = 0; i < 6 ; i ++ ) {\r\n\r\n\t\t\t\tvar plane = planes[ i ];\r\n\r\n\t\t\t\tp1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n\t\t\t\tp2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n\t\t\t\tp1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n\t\t\t\tp2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n\t\t\t\tp1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n\t\t\t\tp2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n\t\t\t\tvar d1 = plane.distanceToPoint( p1 );\r\n\t\t\t\tvar d2 = plane.distanceToPoint( p2 );\r\n\r\n\t\t\t\t// if both outside plane, no intersection\r\n\r\n\t\t\t\tif ( d1 < 0 && d2 < 0 ) {\r\n\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tif ( planes[ i ].distanceToPoint( point ) < 0 ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function ( normal, constant ) {\r\n\r\n\tthis.normal = ( normal !== undefined ) ? normal : new THREE.Vector3( 1, 0, 0 );\r\n\tthis.constant = ( constant !== undefined ) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n\tconstructor: THREE.Plane,\r\n\r\n\tset: function ( normal, constant ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = constant;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponents: function ( x, y, z, w ) {\r\n\r\n\t\tthis.normal.set( x, y, z );\r\n\t\tthis.constant = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromNormalAndCoplanarPoint: function ( normal, point ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = - point.dot( this.normal );\t// must be this.normal, not normal, as this.normal is normalized\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCoplanarPoints: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\t\tvar v2 = new THREE.Vector3();\r\n\r\n\t\treturn function ( a, b, c ) {\r\n\r\n\t\t\tvar normal = v1.subVectors( c, b ).cross( v2.subVectors( a, b ) ).normalize();\r\n\r\n\t\t\t// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n\t\t\tthis.setFromNormalAndCoplanarPoint( normal, a );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( plane ) {\r\n\r\n\t\tthis.normal.copy( plane.normal );\r\n\t\tthis.constant = plane.constant;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\t// Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n\t\tvar inverseNormalLength = 1.0 / this.normal.length();\r\n\t\tthis.normal.multiplyScalar( inverseNormalLength );\r\n\t\tthis.constant *= inverseNormalLength;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.constant *= - 1;\r\n\t\tthis.normal.negate();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function ( point ) {\r\n\r\n\t\treturn this.normal.dot( point ) + this.constant;\r\n\r\n\t},\r\n\r\n\tdistanceToSphere: function ( sphere ) {\r\n\r\n\t\treturn this.distanceToPoint( sphere.center ) - sphere.radius;\r\n\r\n\t},\r\n\r\n\tprojectPoint: function ( point, optionalTarget ) {\r\n\r\n\t\treturn this.orthoPoint( point, optionalTarget ).sub( point ).negate();\r\n\r\n\t},\r\n\r\n\torthoPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar perpendicularMagnitude = this.distanceToPoint( point );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( this.normal ).multiplyScalar( perpendicularMagnitude );\r\n\r\n\t},\r\n\r\n\tisIntersectionLine: function ( line ) {\r\n\r\n\t\t// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n\t\tvar startSign = this.distanceToPoint( line.start );\r\n\t\tvar endSign = this.distanceToPoint( line.end );\r\n\r\n\t\treturn ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );\r\n\r\n\t},\r\n\r\n\tintersectLine: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( line, optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tvar direction = line.delta( v1 );\r\n\r\n\t\t\tvar denominator = this.normal.dot( direction );\r\n\r\n\t\t\tif ( denominator === 0 ) {\r\n\r\n\t\t\t\t// line is coplanar, return origin\r\n\t\t\t\tif ( this.distanceToPoint( line.start ) === 0 ) {\r\n\r\n\t\t\t\t\treturn result.copy( line.start );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Unsure if this is the correct method to handle this case.\r\n\t\t\t\treturn undefined;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;\r\n\r\n\t\t\tif ( t < 0 || t > 1 ) {\r\n\r\n\t\t\t\treturn undefined;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn result.copy( direction ).multiplyScalar( t ).add( line.start );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tcoplanarPoint: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( this.normal ).multiplyScalar( - this.constant );\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\t\tvar v2 = new THREE.Vector3();\r\n\t\tvar m1 = new THREE.Matrix3();\r\n\r\n\t\treturn function ( matrix, optionalNormalMatrix ) {\r\n\r\n\t\t\t// compute new normal based on theory here:\r\n\t\t\t// http://www.songho.ca/opengl/gl_normaltransform.html\r\n\t\t\tvar normalMatrix = optionalNormalMatrix || m1.getNormalMatrix( matrix );\r\n\t\t\tvar newNormal = v1.copy( this.normal ).applyMatrix3( normalMatrix );\r\n\r\n\t\t\tvar newCoplanarPoint = this.coplanarPoint( v2 );\r\n\t\t\tnewCoplanarPoint.applyMatrix4( matrix );\r\n\r\n\t\t\tthis.setFromNormalAndCoplanarPoint( newNormal, newCoplanarPoint );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.constant = this.constant - offset.dot( this.normal );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( plane ) {\r\n\r\n\t\treturn plane.normal.equals( this.normal ) && ( plane.constant === this.constant );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n\tgenerateUUID: function () {\r\n\r\n\t\t// http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n\t\tvar chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split( '' );\r\n\t\tvar uuid = new Array( 36 );\r\n\t\tvar rnd = 0, r;\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tfor ( var i = 0; i < 36; i ++ ) {\r\n\r\n\t\t\t\tif ( i === 8 || i === 13 || i === 18 || i === 23 ) {\r\n\r\n\t\t\t\t\tuuid[ i ] = '-';\r\n\r\n\t\t\t\t} else if ( i === 14 ) {\r\n\r\n\t\t\t\t\tuuid[ i ] = '4';\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( rnd <= 0x02 ) rnd = 0x2000000 + ( Math.random() * 0x1000000 ) | 0;\r\n\t\t\t\t\tr = rnd & 0xf;\r\n\t\t\t\t\trnd = rnd >> 4;\r\n\t\t\t\t\tuuid[ i ] = chars[ ( i === 19 ) ? ( r & 0x3 ) | 0x8 : r ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn uuid.join( '' );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\t// Clamp value to range <a, b>\r\n\r\n\tclamp: function ( x, a, b ) {\r\n\r\n\t\treturn ( x < a ) ? a : ( ( x > b ) ? b : x );\r\n\r\n\t},\r\n\r\n\t// Clamp value to range <a, inf)\r\n\r\n\tclampBottom: function ( x, a ) {\r\n\r\n\t\treturn x < a ? a : x;\r\n\r\n\t},\r\n\r\n\t// compute euclidian modulo of m % n\r\n\t// https://en.wikipedia.org/wiki/Modulo_operation\r\n\r\n\teuclideanModulo: function ( n, m ) {\r\n\r\n\t\treturn ( ( n % m ) + m ) % m;\r\n\r\n\t},\r\n\r\n\t// Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n\tmapLinear: function ( x, a1, a2, b1, b2 ) {\r\n\r\n\t\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\r\n\r\n\t},\r\n\r\n\t// http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n\tsmoothstep: function ( x, min, max ) {\r\n\r\n\t\tif ( x <= min ) return 0;\r\n\t\tif ( x >= max ) return 1;\r\n\r\n\t\tx = ( x - min ) / ( max - min );\r\n\r\n\t\treturn x * x * ( 3 - 2 * x );\r\n\r\n\t},\r\n\r\n\tsmootherstep: function ( x, min, max ) {\r\n\r\n\t\tif ( x <= min ) return 0;\r\n\t\tif ( x >= max ) return 1;\r\n\r\n\t\tx = ( x - min ) / ( max - min );\r\n\r\n\t\treturn x * x * x * ( x * ( x * 6 - 15 ) + 10 );\r\n\r\n\t},\r\n\r\n\t// Random float from <0, 1> with 16 bits of randomness\r\n\t// (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n\trandom16: function () {\r\n\r\n\t\treturn ( 65280 * Math.random() + 255 * Math.random() ) / 65535;\r\n\r\n\t},\r\n\r\n\t// Random integer from <low, high> interval\r\n\r\n\trandInt: function ( low, high ) {\r\n\r\n\t\treturn low + Math.floor( Math.random() * ( high - low + 1 ) );\r\n\r\n\t},\r\n\r\n\t// Random float from <low, high> interval\r\n\r\n\trandFloat: function ( low, high ) {\r\n\r\n\t\treturn low + Math.random() * ( high - low );\r\n\r\n\t},\r\n\r\n\t// Random float from <-range/2, range/2> interval\r\n\r\n\trandFloatSpread: function ( range ) {\r\n\r\n\t\treturn range * ( 0.5 - Math.random() );\r\n\r\n\t},\r\n\r\n\tdegToRad: function () {\r\n\r\n\t\tvar degreeToRadiansFactor = Math.PI / 180;\r\n\r\n\t\treturn function ( degrees ) {\r\n\r\n\t\t\treturn degrees * degreeToRadiansFactor;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tradToDeg: function () {\r\n\r\n\t\tvar radianToDegreesFactor = 180 / Math.PI;\r\n\r\n\t\treturn function ( radians ) {\r\n\r\n\t\t\treturn radians * radianToDegreesFactor;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tisPowerOfTwo: function ( value ) {\r\n\r\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\r\n\r\n\t},\r\n\r\n\tnextPowerOfTwo: function ( value ) {\r\n\r\n\t\tvalue --;\r\n\t\tvalue |= value >> 1;\r\n\t\tvalue |= value >> 2;\r\n\t\tvalue |= value >> 4;\r\n\t\tvalue |= value >> 8;\r\n\t\tvalue |= value >> 16;\r\n\t\tvalue ++;\r\n\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function ( points ) {\r\n\r\n\tthis.points = points;\r\n\r\n\tvar c = [], v3 = { x: 0, y: 0, z: 0 },\r\n\tpoint, intPoint, weight, w2, w3,\r\n\tpa, pb, pc, pd;\r\n\r\n\tthis.initFromArray = function ( a ) {\r\n\r\n\t\tthis.points = [];\r\n\r\n\t\tfor ( var i = 0; i < a.length; i ++ ) {\r\n\r\n\t\t\tthis.points[ i ] = { x: a[ i ][ 0 ], y: a[ i ][ 1 ], z: a[ i ][ 2 ] };\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.getPoint = function ( k ) {\r\n\r\n\t\tpoint = ( this.points.length - 1 ) * k;\r\n\t\tintPoint = Math.floor( point );\r\n\t\tweight = point - intPoint;\r\n\r\n\t\tc[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;\r\n\t\tc[ 1 ] = intPoint;\r\n\t\tc[ 2 ] = intPoint  > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n\t\tc[ 3 ] = intPoint  > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n\t\tpa = this.points[ c[ 0 ] ];\r\n\t\tpb = this.points[ c[ 1 ] ];\r\n\t\tpc = this.points[ c[ 2 ] ];\r\n\t\tpd = this.points[ c[ 3 ] ];\r\n\r\n\t\tw2 = weight * weight;\r\n\t\tw3 = weight * w2;\r\n\r\n\t\tv3.x = interpolate( pa.x, pb.x, pc.x, pd.x, weight, w2, w3 );\r\n\t\tv3.y = interpolate( pa.y, pb.y, pc.y, pd.y, weight, w2, w3 );\r\n\t\tv3.z = interpolate( pa.z, pb.z, pc.z, pd.z, weight, w2, w3 );\r\n\r\n\t\treturn v3;\r\n\r\n\t};\r\n\r\n\tthis.getControlPointsArray = function () {\r\n\r\n\t\tvar i, p, l = this.points.length,\r\n\t\t\tcoords = [];\r\n\r\n\t\tfor ( i = 0; i < l; i ++ ) {\r\n\r\n\t\t\tp = this.points[ i ];\r\n\t\t\tcoords[ i ] = [ p.x, p.y, p.z ];\r\n\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\r\n\t};\r\n\r\n\t// approximate length by summing linear segments\r\n\r\n\tthis.getLength = function ( nSubDivisions ) {\r\n\r\n\t\tvar i, index, nSamples, position,\r\n\t\t\tpoint = 0, intPoint = 0, oldIntPoint = 0,\r\n\t\t\toldPosition = new THREE.Vector3(),\r\n\t\t\ttmpVec = new THREE.Vector3(),\r\n\t\t\tchunkLengths = [],\r\n\t\t\ttotalLength = 0;\r\n\r\n\t\t// first point has 0 length\r\n\r\n\t\tchunkLengths[ 0 ] = 0;\r\n\r\n\t\tif ( ! nSubDivisions ) nSubDivisions = 100;\r\n\r\n\t\tnSamples = this.points.length * nSubDivisions;\r\n\r\n\t\toldPosition.copy( this.points[ 0 ] );\r\n\r\n\t\tfor ( i = 1; i < nSamples; i ++ ) {\r\n\r\n\t\t\tindex = i / nSamples;\r\n\r\n\t\t\tposition = this.getPoint( index );\r\n\t\t\ttmpVec.copy( position );\r\n\r\n\t\t\ttotalLength += tmpVec.distanceTo( oldPosition );\r\n\r\n\t\t\toldPosition.copy( position );\r\n\r\n\t\t\tpoint = ( this.points.length - 1 ) * index;\r\n\t\t\tintPoint = Math.floor( point );\r\n\r\n\t\t\tif ( intPoint !== oldIntPoint ) {\r\n\r\n\t\t\t\tchunkLengths[ intPoint ] = totalLength;\r\n\t\t\t\toldIntPoint = intPoint;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// last point ends with total length\r\n\r\n\t\tchunkLengths[ chunkLengths.length ] = totalLength;\r\n\r\n\t\treturn { chunks: chunkLengths, total: totalLength };\r\n\r\n\t};\r\n\r\n\tthis.reparametrizeByArcLength = function ( samplingCoef ) {\r\n\r\n\t\tvar i, j,\r\n\t\t\tindex, indexCurrent, indexNext,\r\n\t\t\trealDistance,\r\n\t\t\tsampling, position,\r\n\t\t\tnewpoints = [],\r\n\t\t\ttmpVec = new THREE.Vector3(),\r\n\t\t\tsl = this.getLength();\r\n\r\n\t\tnewpoints.push( tmpVec.copy( this.points[ 0 ] ).clone() );\r\n\r\n\t\tfor ( i = 1; i < this.points.length; i ++ ) {\r\n\r\n\t\t\t//tmpVec.copy( this.points[ i - 1 ] );\r\n\t\t\t//linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n\t\t\trealDistance = sl.chunks[ i ] - sl.chunks[ i - 1 ];\r\n\r\n\t\t\tsampling = Math.ceil( samplingCoef * realDistance / sl.total );\r\n\r\n\t\t\tindexCurrent = ( i - 1 ) / ( this.points.length - 1 );\r\n\t\t\tindexNext = i / ( this.points.length - 1 );\r\n\r\n\t\t\tfor ( j = 1; j < sampling - 1; j ++ ) {\r\n\r\n\t\t\t\tindex = indexCurrent + j * ( 1 / sampling ) * ( indexNext - indexCurrent );\r\n\r\n\t\t\t\tposition = this.getPoint( index );\r\n\t\t\t\tnewpoints.push( tmpVec.copy( position ).clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnewpoints.push( tmpVec.copy( this.points[ i ] ).clone() );\r\n\r\n\t\t}\r\n\r\n\t\tthis.points = newpoints;\r\n\r\n\t};\r\n\r\n\t// Catmull-Rom\r\n\r\n\tfunction interpolate( p0, p1, p2, p3, t, t2, t3 ) {\r\n\r\n\t\tvar v0 = ( p2 - p0 ) * 0.5,\r\n\t\t\tv1 = ( p3 - p1 ) * 0.5;\r\n\r\n\t\treturn ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function ( a, b, c ) {\r\n\r\n\tthis.a = ( a !== undefined ) ? a : new THREE.Vector3();\r\n\tthis.b = ( b !== undefined ) ? b : new THREE.Vector3();\r\n\tthis.c = ( c !== undefined ) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function () {\r\n\r\n\tvar v0 = new THREE.Vector3();\r\n\r\n\treturn function ( a, b, c, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tresult.subVectors( c, b );\r\n\t\tv0.subVectors( a, b );\r\n\t\tresult.cross( v0 );\r\n\r\n\t\tvar resultLengthSq = result.lengthSq();\r\n\t\tif ( resultLengthSq > 0 ) {\r\n\r\n\t\t\treturn result.multiplyScalar( 1 / Math.sqrt( resultLengthSq ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn result.set( 0, 0, 0 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycentric coordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function () {\r\n\r\n\tvar v0 = new THREE.Vector3();\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\r\n\treturn function ( point, a, b, c, optionalTarget ) {\r\n\r\n\t\tv0.subVectors( c, a );\r\n\t\tv1.subVectors( b, a );\r\n\t\tv2.subVectors( point, a );\r\n\r\n\t\tvar dot00 = v0.dot( v0 );\r\n\t\tvar dot01 = v0.dot( v1 );\r\n\t\tvar dot02 = v0.dot( v2 );\r\n\t\tvar dot11 = v1.dot( v1 );\r\n\t\tvar dot12 = v1.dot( v2 );\r\n\r\n\t\tvar denom = ( dot00 * dot11 - dot01 * dot01 );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t// collinear or singular triangle\r\n\t\tif ( denom === 0 ) {\r\n\r\n\t\t\t// arbitrary location outside of triangle?\r\n\t\t\t// not sure if this is the best idea, maybe should be returning undefined\r\n\t\t\treturn result.set( - 2, - 1, - 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvar invDenom = 1 / denom;\r\n\t\tvar u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;\r\n\t\tvar v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;\r\n\r\n\t\t// barycentric coordinates must always sum to 1\r\n\t\treturn result.set( 1 - u - v, v, u );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\r\n\treturn function ( point, a, b, c ) {\r\n\r\n\t\tvar result = THREE.Triangle.barycoordFromPoint( point, a, b, c, v1 );\r\n\r\n\t\treturn ( result.x >= 0 ) && ( result.y >= 0 ) && ( ( result.x + result.y ) <= 1 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n\tconstructor: THREE.Triangle,\r\n\r\n\tset: function ( a, b, c ) {\r\n\r\n\t\tthis.a.copy( a );\r\n\t\tthis.b.copy( b );\r\n\t\tthis.c.copy( c );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPointsAndIndices: function ( points, i0, i1, i2 ) {\r\n\r\n\t\tthis.a.copy( points[ i0 ] );\r\n\t\tthis.b.copy( points[ i1 ] );\r\n\t\tthis.c.copy( points[ i2 ] );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( triangle ) {\r\n\r\n\t\tthis.a.copy( triangle.a );\r\n\t\tthis.b.copy( triangle.b );\r\n\t\tthis.c.copy( triangle.c );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tarea: function () {\r\n\r\n\t\tvar v0 = new THREE.Vector3();\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tv0.subVectors( this.c, this.b );\r\n\t\t\tv1.subVectors( this.a, this.b );\r\n\r\n\t\t\treturn v0.cross( v1 ).length() * 0.5;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmidpoint: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.a, this.b ).add( this.c ).multiplyScalar( 1 / 3 );\r\n\r\n\t},\r\n\r\n\tnormal: function ( optionalTarget ) {\r\n\r\n\t\treturn THREE.Triangle.normal( this.a, this.b, this.c, optionalTarget );\r\n\r\n\t},\r\n\r\n\tplane: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Plane();\r\n\r\n\t\treturn result.setFromCoplanarPoints( this.a, this.b, this.c );\r\n\r\n\t},\r\n\r\n\tbarycoordFromPoint: function ( point, optionalTarget ) {\r\n\r\n\t\treturn THREE.Triangle.barycoordFromPoint( point, this.a, this.b, this.c, optionalTarget );\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\treturn THREE.Triangle.containsPoint( point, this.a, this.b, this.c );\r\n\r\n\t},\r\n\r\n\tequals: function ( triangle ) {\r\n\r\n\t\treturn triangle.a.equals( this.a ) && triangle.b.equals( this.b ) && triangle.c.equals( this.c );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function ( autoStart ) {\r\n\r\n\tthis.autoStart = ( autoStart !== undefined ) ? autoStart : true;\r\n\r\n\tthis.startTime = 0;\r\n\tthis.oldTime = 0;\r\n\tthis.elapsedTime = 0;\r\n\r\n\tthis.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n\tconstructor: THREE.Clock,\r\n\r\n\tstart: function () {\r\n\r\n\t\tthis.startTime = self.performance !== undefined && self.performance.now !== undefined\r\n\t\t\t\t\t ? self.performance.now()\r\n\t\t\t\t\t : Date.now();\r\n\r\n\t\tthis.oldTime = this.startTime;\r\n\t\tthis.running = true;\r\n\r\n\t},\r\n\r\n\tstop: function () {\r\n\r\n\t\tthis.getElapsedTime();\r\n\t\tthis.running = false;\r\n\r\n\t},\r\n\r\n\tgetElapsedTime: function () {\r\n\r\n\t\tthis.getDelta();\r\n\t\treturn this.elapsedTime;\r\n\r\n\t},\r\n\r\n\tgetDelta: function () {\r\n\r\n\t\tvar diff = 0;\r\n\r\n\t\tif ( this.autoStart && ! this.running ) {\r\n\r\n\t\t\tthis.start();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.running ) {\r\n\r\n\t\t\tvar newTime = self.performance !== undefined && self.performance.now !== undefined\r\n\t\t\t\t\t ? self.performance.now()\r\n\t\t\t\t\t : Date.now();\r\n\r\n\t\t\tdiff = 0.001 * ( newTime - this.oldTime );\r\n\t\t\tthis.oldTime = newTime;\r\n\r\n\t\t\tthis.elapsedTime += diff;\r\n\r\n\t\t}\r\n\r\n\t\treturn diff;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function () {};\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n\tconstructor: THREE.EventDispatcher,\r\n\r\n\tapply: function ( object ) {\r\n\r\n\t\tobject.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n\t\tobject.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n\t\tobject.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n\t\tobject.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n\t},\r\n\r\n\taddEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) this._listeners = {};\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] === undefined ) {\r\n\r\n\t\t\tlisteners[ type ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tif ( listeners[ type ].indexOf( listener ) === - 1 ) {\r\n\r\n\t\t\tlisteners[ type ].push( listener );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\thasEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return false;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tremoveEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tvar index = listenerArray.indexOf( listener );\r\n\r\n\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\tlistenerArray.splice( index, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tdispatchEvent: function ( event ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ event.type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tevent.target = this;\r\n\r\n\t\t\tvar array = [];\r\n\t\t\tvar length = listenerArray.length;\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ] = listenerArray[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ].call( this, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n( function ( THREE ) {\r\n\r\n\tTHREE.Raycaster = function ( origin, direction, near, far ) {\r\n\r\n\t\tthis.ray = new THREE.Ray( origin, direction );\r\n\t\t// direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n\t\tthis.near = near || 0;\r\n\t\tthis.far = far || Infinity;\r\n\r\n\t\tthis.params = {\r\n\t\t\tMesh: {},\r\n\t\t\tLine: {},\r\n\t\t\tLOD: {},\r\n\t\t\tPoints: { threshold: 1 },\r\n\t\t\tSprite: {}\r\n\t\t};\r\n\r\n\t\tObject.defineProperties( this.params, {\r\n\t\t\tPointCloud: {\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\tconsole.warn( 'THREE.Raycaster: params.PointCloud has been renamed to params.Points.' );\r\n\t\t\t\t\treturn this.Points;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\tfunction descSort( a, b ) {\r\n\r\n\t\treturn a.distance - b.distance;\r\n\r\n\t}\r\n\r\n\tvar intersectObject = function ( object, raycaster, intersects, recursive ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tobject.raycast( raycaster, intersects );\r\n\r\n\t\tif ( recursive === true ) {\r\n\r\n\t\t\tvar children = object.children;\r\n\r\n\t\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tintersectObject( children[ i ], raycaster, intersects, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tTHREE.Raycaster.prototype = {\r\n\r\n\t\tconstructor: THREE.Raycaster,\r\n\r\n\t\tlinePrecision: 1,\r\n\r\n\t\tset: function ( origin, direction ) {\r\n\r\n\t\t\t// direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n\t\t\tthis.ray.set( origin, direction );\r\n\r\n\t\t},\r\n\r\n\t\tsetFromCamera: function ( coords, camera ) {\r\n\r\n\t\t\tif ( camera instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\t\tthis.ray.origin.setFromMatrixPosition( camera.matrixWorld );\r\n\t\t\t\tthis.ray.direction.set( coords.x, coords.y, 0.5 ).unproject( camera ).sub( this.ray.origin ).normalize();\r\n\r\n\t\t\t} else if ( camera instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\t\tthis.ray.origin.set( coords.x, coords.y, - 1 ).unproject( camera );\r\n\t\t\t\tthis.ray.direction.set( 0, 0, - 1 ).transformDirection( camera.matrixWorld );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.Raycaster: Unsupported camera type.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tintersectObject: function ( object, recursive ) {\r\n\r\n\t\t\tvar intersects = [];\r\n\r\n\t\t\tintersectObject( object, this, intersects, recursive );\r\n\r\n\t\t\tintersects.sort( descSort );\r\n\r\n\t\t\treturn intersects;\r\n\r\n\t\t},\r\n\r\n\t\tintersectObjects: function ( objects, recursive ) {\r\n\r\n\t\t\tvar intersects = [];\r\n\r\n\t\t\tif ( Array.isArray( objects ) === false ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Raycaster.intersectObjects: objects is not an Array.' );\r\n\t\t\t\treturn intersects;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, l = objects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tintersectObject( objects[ i ], this, intersects, recursive );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tintersects.sort( descSort );\r\n\r\n\t\t\treturn intersects;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}( THREE ) );\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author elephantatwork / www.elephantatwork.ch\r\n */\r\n\r\nTHREE.Object3D = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.Object3DIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Object3D';\r\n\r\n\tthis.parent = null;\r\n\tthis.children = [];\r\n\r\n\tthis.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n\tvar position = new THREE.Vector3();\r\n\tvar rotation = new THREE.Euler();\r\n\tvar quaternion = new THREE.Quaternion();\r\n\tvar scale = new THREE.Vector3( 1, 1, 1 );\r\n\r\n\tvar onRotationChange = function () {\r\n\r\n\t\tquaternion.setFromEuler( rotation, false );\r\n\r\n\t};\r\n\r\n\tvar onQuaternionChange = function () {\r\n\r\n\t\trotation.setFromQuaternion( quaternion, undefined, false );\r\n\r\n\t};\r\n\r\n\trotation.onChange( onRotationChange );\r\n\tquaternion.onChange( onQuaternionChange );\r\n\r\n\tObject.defineProperties( this, {\r\n\t\tposition: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: position\r\n\t\t},\r\n\t\trotation: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: rotation\r\n\t\t},\r\n\t\tquaternion: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: quaternion\r\n\t\t},\r\n\t\tscale: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: scale\r\n\t\t},\r\n\t\tmodelViewMatrix: {\r\n\t\t\tvalue: new THREE.Matrix4()\r\n\t\t},\r\n\t\tnormalMatrix: {\r\n\t\t\tvalue: new THREE.Matrix3()\r\n\t\t}\r\n\t} );\r\n\r\n\tthis.rotationAutoUpdate = true;\r\n\r\n\tthis.matrix = new THREE.Matrix4();\r\n\tthis.matrixWorld = new THREE.Matrix4();\r\n\r\n\tthis.matrixAutoUpdate = THREE.Object3D.DefaultMatrixAutoUpdate;\r\n\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\tthis.visible = true;\r\n\r\n\tthis.castShadow = false;\r\n\tthis.receiveShadow = false;\r\n\r\n\tthis.frustumCulled = true;\r\n\tthis.renderOrder = 0;\r\n\r\n\tthis.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3( 0, 1, 0 );\r\nTHREE.Object3D.DefaultMatrixAutoUpdate = true;\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n\tconstructor: THREE.Object3D,\r\n\r\n\tget eulerOrder () {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );\r\n\r\n\t\treturn this.rotation.order;\r\n\r\n\t},\r\n\r\n\tset eulerOrder ( value ) {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );\r\n\r\n\t\tthis.rotation.order = value;\r\n\r\n\t},\r\n\r\n\tget useQuaternion () {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );\r\n\r\n\t},\r\n\r\n\tset useQuaternion ( value ) {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );\r\n\r\n\t},\r\n\r\n\tset renderDepth ( value ) {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.' );\r\n\r\n\t},\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tthis.matrix.multiplyMatrices( matrix, this.matrix );\r\n\r\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\r\n\r\n\t},\r\n\r\n\tsetRotationFromAxisAngle: function ( axis, angle ) {\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tthis.quaternion.setFromAxisAngle( axis, angle );\r\n\r\n\t},\r\n\r\n\tsetRotationFromEuler: function ( euler ) {\r\n\r\n\t\tthis.quaternion.setFromEuler( euler, true );\r\n\r\n\t},\r\n\r\n\tsetRotationFromMatrix: function ( m ) {\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( m );\r\n\r\n\t},\r\n\r\n\tsetRotationFromQuaternion: function ( q ) {\r\n\r\n\t\t// assumes q is normalized\r\n\r\n\t\tthis.quaternion.copy( q );\r\n\r\n\t},\r\n\r\n\trotateOnAxis: function () {\r\n\r\n\t\t// rotate object on axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\tvar q1 = new THREE.Quaternion();\r\n\r\n\t\treturn function ( axis, angle ) {\r\n\r\n\t\t\tq1.setFromAxisAngle( axis, angle );\r\n\r\n\t\t\tthis.quaternion.multiply( q1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateX: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 1, 0, 0 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateY: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateZ: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateOnAxis: function () {\r\n\r\n\t\t// translate object by distance along axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( axis, distance ) {\r\n\r\n\t\t\tv1.copy( axis ).applyQuaternion( this.quaternion );\r\n\r\n\t\t\tthis.position.add( v1.multiplyScalar( distance ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( distance, axis ) {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.' );\r\n\t\treturn this.translateOnAxis( axis, distance );\r\n\r\n\t},\r\n\r\n\ttranslateX: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 1, 0, 0 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateY: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateZ: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlocalToWorld: function ( vector ) {\r\n\r\n\t\treturn vector.applyMatrix4( this.matrixWorld );\r\n\r\n\t},\r\n\r\n\tworldToLocal: function () {\r\n\r\n\t\tvar m1 = new THREE.Matrix4();\r\n\r\n\t\treturn function ( vector ) {\r\n\r\n\t\t\treturn vector.applyMatrix4( m1.getInverse( this.matrixWorld ) );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlookAt: function () {\r\n\r\n\t\t// This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n\t\tvar m1 = new THREE.Matrix4();\r\n\r\n\t\treturn function ( vector ) {\r\n\r\n\t\t\tm1.lookAt( vector, this.position, this.up );\r\n\r\n\t\t\tthis.quaternion.setFromRotationMatrix( m1 );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tadd: function ( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( var i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.add( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tif ( object === this ) {\r\n\r\n\t\t\tconsole.error( \"THREE.Object3D.add: object can't be added as a child of itself.\", object );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tif ( object instanceof THREE.Object3D ) {\r\n\r\n\t\t\tif ( object.parent !== null ) {\r\n\r\n\t\t\t\tobject.parent.remove( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.parent = this;\r\n\t\t\tobject.dispatchEvent( { type: 'added' } );\r\n\r\n\t\t\tthis.children.push( object );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( \"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tremove: function ( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( var i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.remove( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar index = this.children.indexOf( object );\r\n\r\n\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\tobject.parent = null;\r\n\r\n\t\t\tobject.dispatchEvent( { type: 'removed' } );\r\n\r\n\t\t\tthis.children.splice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetChildByName: function ( name ) {\r\n\r\n\t\tconsole.warn( 'THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().' );\r\n\t\treturn this.getObjectByName( name );\r\n\r\n\t},\r\n\r\n\tgetObjectById: function ( id ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'id', id );\r\n\r\n\t},\r\n\r\n\tgetObjectByName: function ( name ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'name', name );\r\n\r\n\t},\r\n\r\n\tgetObjectByProperty: function ( name, value ) {\r\n\r\n\t\tif ( this[ name ] === value ) return this;\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar child = this.children[ i ];\r\n\t\t\tvar object = child.getObjectByProperty( name, value );\r\n\r\n\t\t\tif ( object !== undefined ) {\r\n\r\n\t\t\t\treturn object;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\r\n\t},\r\n\r\n\tgetWorldPosition: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\treturn result.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t},\r\n\r\n\tgetWorldQuaternion: function () {\r\n\r\n\t\tvar position = new THREE.Vector3();\r\n\t\tvar scale = new THREE.Vector3();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Quaternion();\r\n\r\n\t\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.matrixWorld.decompose( position, result, scale );\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tgetWorldRotation: function () {\r\n\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Euler();\r\n\r\n\t\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\t\treturn result.setFromQuaternion( quaternion, this.rotation.order, false );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tgetWorldScale: function () {\r\n\r\n\t\tvar position = new THREE.Vector3();\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.matrixWorld.decompose( position, quaternion, result );\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tgetWorldDirection: function () {\r\n\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\t\treturn result.set( 0, 0, 1 ).applyQuaternion( quaternion );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\traycast: function () {},\r\n\r\n\ttraverse: function ( callback ) {\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tvar children = this.children;\r\n\r\n\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tchildren[ i ].traverse( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttraverseVisible: function ( callback ) {\r\n\r\n\t\tif ( this.visible === false ) return;\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tvar children = this.children;\r\n\r\n\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tchildren[ i ].traverseVisible( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttraverseAncestors: function ( callback ) {\r\n\r\n\t\tvar parent = this.parent;\r\n\r\n\t\tif ( parent !== null ) {\r\n\r\n\t\t\tcallback( parent );\r\n\r\n\t\t\tparent.traverseAncestors( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdateMatrix: function () {\r\n\r\n\t\tthis.matrix.compose( this.position, this.quaternion, this.scale );\r\n\r\n\t\tthis.matrixWorldNeedsUpdate = true;\r\n\r\n\t},\r\n\r\n\tupdateMatrixWorld: function ( force ) {\r\n\r\n\t\tif ( this.matrixAutoUpdate === true ) this.updateMatrix();\r\n\r\n\t\tif ( this.matrixWorldNeedsUpdate === true || force === true ) {\r\n\r\n\t\t\tif ( this.parent === null ) {\r\n\r\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\t\tforce = true;\r\n\r\n\t\t}\r\n\r\n\t\t// update children\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.children[ i ].updateMatrixWorld( force );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttoJSON: function ( meta ) {\r\n\r\n\t\tvar isRootObject = ( meta === undefined );\r\n\r\n\t\tvar data = {};\r\n\r\n\t\t// meta is a hash used to collect geometries, materials.\r\n\t\t// not providing it implies that this is the root object\r\n\t\t// being serialized.\r\n\t\tif ( isRootObject ) {\r\n\r\n\t\t\t// initialize meta obj\r\n\t\t\tmeta = {\r\n\t\t\t\tgeometries: {},\r\n\t\t\t\tmaterials: {},\r\n\t\t\t\ttextures: {},\r\n\t\t\t\timages: {}\r\n\t\t\t};\r\n\r\n\t\t\tdata.metadata = {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Object',\r\n\t\t\t\tgenerator: 'Object3D.toJSON'\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\t// standard Object3D serialization\r\n\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) data.userData = this.userData;\r\n\t\tif ( this.visible !== true ) data.visible = this.visible;\r\n\r\n\t\tdata.matrix = this.matrix.toArray();\r\n\r\n\t\tif ( this.children.length > 0 ) {\r\n\r\n\t\t\tdata.children = [];\r\n\r\n\t\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\r\n\t\t\t\tdata.children.push( this.children[ i ].toJSON( meta ).object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar output = {};\r\n\r\n\t\tif ( isRootObject ) {\r\n\r\n\t\t\tvar geometries = extractFromCache( meta.geometries );\r\n\t\t\tvar materials = extractFromCache( meta.materials );\r\n\t\t\tvar textures = extractFromCache( meta.textures );\r\n\t\t\tvar images = extractFromCache( meta.images );\r\n\r\n\t\t\tif ( geometries.length > 0 ) output.geometries = geometries;\r\n\t\t\tif ( materials.length > 0 ) output.materials = materials;\r\n\t\t\tif ( textures.length > 0 ) output.textures = textures;\r\n\t\t\tif ( images.length > 0 ) output.images = images;\r\n\r\n\t\t}\r\n\r\n\t\toutput.object = data;\r\n\r\n\t\treturn output;\r\n\r\n\t\t// extract data from the cache hash\r\n\t\t// remove metadata on each item\r\n\t\t// and return as array\r\n\t\tfunction extractFromCache ( cache ) {\r\n\r\n\t\t\tvar values = [];\r\n\t\t\tfor ( var key in cache ) {\r\n\r\n\t\t\t\tvar data = cache[ key ];\r\n\t\t\t\tdelete data.metadata;\r\n\t\t\t\tvalues.push( data );\r\n\r\n\t\t\t}\r\n\t\t\treturn values;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tclone: function ( recursive ) {\r\n\r\n\t\treturn new this.constructor().copy( this, recursive );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source, recursive ) {\r\n\r\n\t\tif ( recursive === undefined ) recursive = true;\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\tthis.up.copy( source.up );\r\n\r\n\t\tthis.position.copy( source.position );\r\n\t\tthis.quaternion.copy( source.quaternion );\r\n\t\tthis.scale.copy( source.scale );\r\n\r\n\t\tthis.rotationAutoUpdate = source.rotationAutoUpdate;\r\n\r\n\t\tthis.matrix.copy( source.matrix );\r\n\t\tthis.matrixWorld.copy( source.matrixWorld );\r\n\r\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\r\n\t\tthis.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\r\n\r\n\t\tthis.visible = source.visible;\r\n\r\n\t\tthis.castShadow = source.castShadow;\r\n\t\tthis.receiveShadow = source.receiveShadow;\r\n\r\n\t\tthis.frustumCulled = source.frustumCulled;\r\n\t\tthis.renderOrder = source.renderOrder;\r\n\r\n\t\tthis.userData = JSON.parse( JSON.stringify( source.userData ) );\r\n\r\n\t\tif ( recursive === true ) {\r\n\r\n\t\t\tfor ( var i = 0; i < source.children.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = source.children[ i ];\r\n\t\t\t\tthis.add( child.clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Object3D.prototype );\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function ( a, b, c, normal, color, materialIndex ) {\r\n\r\n\tthis.a = a;\r\n\tthis.b = b;\r\n\tthis.c = c;\r\n\r\n\tthis.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n\tthis.vertexNormals = Array.isArray( normal ) ? normal : [];\r\n\r\n\tthis.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n\tthis.vertexColors = Array.isArray( color ) ? color : [];\r\n\r\n\tthis.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n\tconstructor: THREE.Face3,\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.a = source.a;\r\n\t\tthis.b = source.b;\r\n\t\tthis.c = source.c;\r\n\r\n\t\tthis.normal.copy( source.normal );\r\n\t\tthis.color.copy( source.color );\r\n\r\n\t\tthis.materialIndex = source.materialIndex;\r\n\r\n\t\tfor ( var i = 0, il = source.vertexNormals.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.vertexNormals[ i ] = source.vertexNormals[ i ].clone();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = source.vertexColors.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.vertexColors[ i ] = source.vertexColors[ i ].clone();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function ( a, b, c, d, normal, color, materialIndex ) {\r\n\r\n\tconsole.warn( 'THREE.Face4 has been removed. A THREE.Face3 will be created instead.' );\r\n\treturn new THREE.Face3( a, b, c, normal, color, materialIndex );\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function ( array, itemSize ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.array = array;\r\n\tthis.itemSize = itemSize;\r\n\r\n\tthis.dynamic = false;\r\n\tthis.updateRange = { offset: 0, count: - 1 };\r\n\r\n\tthis.version = 0;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n\tconstructor: THREE.BufferAttribute,\r\n\r\n\tget length() {\r\n\r\n\t\tconsole.warn( 'THREE.BufferAttribute: .length has been deprecated. Please use .count.' );\r\n\t\treturn this.array.length;\r\n\r\n\t},\r\n\r\n\tget count() {\r\n\r\n\t\treturn this.array.length / this.itemSize;\r\n\r\n\t},\r\n\r\n\tset needsUpdate( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t},\r\n\r\n\tsetDynamic: function ( value ) {\r\n\r\n\t\tthis.dynamic = value;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.array = new source.array.constructor( source.array );\r\n\t\tthis.itemSize = source.itemSize;\r\n\r\n\t\tthis.dynamic = source.dynamic;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyAt: function ( index1, attribute, index2 ) {\r\n\r\n\t\tindex1 *= this.itemSize;\r\n\t\tindex2 *= attribute.itemSize;\r\n\r\n\t\tfor ( var i = 0, l = this.itemSize; i < l; i ++ ) {\r\n\r\n\t\t\tthis.array[ index1 + i ] = attribute.array[ index2 + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyArray: function ( array ) {\r\n\r\n\t\tthis.array.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyColorsArray: function ( colors ) {\r\n\r\n\t\tvar array = this.array, offset = 0;\r\n\r\n\t\tfor ( var i = 0, l = colors.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar color = colors[ i ];\r\n\r\n\t\t\tif ( color === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyColorsArray(): color is undefined', i );\r\n\t\t\t\tcolor = new THREE.Color();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = color.r;\r\n\t\t\tarray[ offset ++ ] = color.g;\r\n\t\t\tarray[ offset ++ ] = color.b;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyIndicesArray: function ( indices ) {\r\n\r\n\t\tvar array = this.array, offset = 0;\r\n\r\n\t\tfor ( var i = 0, l = indices.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar index = indices[ i ];\r\n\r\n\t\t\tarray[ offset ++ ] = index.a;\r\n\t\t\tarray[ offset ++ ] = index.b;\r\n\t\t\tarray[ offset ++ ] = index.c;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyVector2sArray: function ( vectors ) {\r\n\r\n\t\tvar array = this.array, offset = 0;\r\n\r\n\t\tfor ( var i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector2sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new THREE.Vector2();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyVector3sArray: function ( vectors ) {\r\n\r\n\t\tvar array = this.array, offset = 0;\r\n\r\n\t\tfor ( var i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector3sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new THREE.Vector3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\t\t\tarray[ offset ++ ] = vector.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyVector4sArray: function ( vectors ) {\r\n\r\n\t\tvar array = this.array, offset = 0;\r\n\r\n\t\tfor ( var i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector4sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new THREE.Vector4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\t\t\tarray[ offset ++ ] = vector.z;\r\n\t\t\tarray[ offset ++ ] = vector.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tset: function ( value, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.array.set( value, offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetX: function ( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize ];\r\n\r\n\t},\r\n\r\n\tsetX: function ( index, x ) {\r\n\r\n\t\tthis.array[ index * this.itemSize ] = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetY: function ( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 1 ];\r\n\r\n\t},\r\n\r\n\tsetY: function ( index, y ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetZ: function ( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 2 ];\r\n\r\n\t},\r\n\r\n\tsetZ: function ( index, z ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetW: function ( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 3 ];\r\n\r\n\t},\r\n\r\n\tsetW: function ( index, w ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXY: function ( index, x, y ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZ: function ( index, x, y, z ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZW: function ( index, x, y, z, w ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\t\tthis.array[ index + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Int8Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Uint8Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Uint8ClampedArray( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Int16Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Uint16Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Int32Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Uint32Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Float32Array( array ), itemSize );\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function ( array, itemSize ) {\r\n\r\n\treturn new THREE.BufferAttribute( new Float64Array( array ), itemSize );\r\n\r\n};\r\n\r\n\r\n// Deprecated\r\n\r\nTHREE.DynamicBufferAttribute = function ( array, itemSize ) {\r\n\r\n\tconsole.warn( 'THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.' );\r\n\treturn new THREE.BufferAttribute( array, itemSize ).setDynamic( true );\r\n\r\n};\r\n\r\n// File:src/core/InstancedBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.InstancedBufferAttribute = function ( array, itemSize, meshPerAttribute ) {\r\n\r\n\tTHREE.BufferAttribute.call( this, array, itemSize );\r\n\r\n\tthis.meshPerAttribute = meshPerAttribute || 1;\r\n\r\n};\r\n\r\nTHREE.InstancedBufferAttribute.prototype = Object.create( THREE.BufferAttribute.prototype );\r\nTHREE.InstancedBufferAttribute.prototype.constructor = THREE.InstancedBufferAttribute;\r\n\r\nTHREE.InstancedBufferAttribute.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.BufferAttribute.prototype.copy.call( this, source );\r\n\r\n\tthis.meshPerAttribute = source.meshPerAttribute;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/core/InterleavedBuffer.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.InterleavedBuffer = function ( array, stride ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.array = array;\r\n\tthis.stride = stride;\r\n\r\n\tthis.dynamic = false;\r\n\tthis.updateRange = { offset: 0, count: - 1 };\r\n\r\n\tthis.version = 0;\r\n\r\n};\r\n\r\nTHREE.InterleavedBuffer.prototype = {\r\n\r\n\tconstructor: THREE.InterleavedBuffer,\r\n\r\n\tget length () {\r\n\r\n\t\treturn this.array.length;\r\n\r\n\t},\r\n\r\n\tget count () {\r\n\r\n\t\treturn this.array.length / this.stride;\r\n\r\n\t},\r\n\r\n\tset needsUpdate( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t},\r\n\r\n\tsetDynamic: function ( value ) {\r\n\r\n\t\tthis.dynamic = value;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.array = new source.array.constructor( source.array );\r\n\t\tthis.stride = source.stride;\r\n\t\tthis.dynamic = source.dynamic;\r\n\r\n\t},\r\n\r\n\tcopyAt: function ( index1, attribute, index2 ) {\r\n\r\n\t\tindex1 *= this.stride;\r\n\t\tindex2 *= attribute.stride;\r\n\r\n\t\tfor ( var i = 0, l = this.stride; i < l; i ++ ) {\r\n\r\n\t\t\tthis.array[ index1 + i ] = attribute.array[ index2 + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tset: function ( value, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.array.set( value, offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/InstancedInterleavedBuffer.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.InstancedInterleavedBuffer = function ( array, stride, meshPerAttribute ) {\r\n\r\n\tTHREE.InterleavedBuffer.call( this, array, stride );\r\n\r\n\tthis.meshPerAttribute = meshPerAttribute || 1;\r\n\r\n};\r\n\r\nTHREE.InstancedInterleavedBuffer.prototype = Object.create( THREE.InterleavedBuffer.prototype );\r\nTHREE.InstancedInterleavedBuffer.prototype.constructor = THREE.InstancedInterleavedBuffer;\r\n\r\nTHREE.InstancedInterleavedBuffer.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.InterleavedBuffer.prototype.copy.call( this, source );\r\n\r\n\tthis.meshPerAttribute = source.meshPerAttribute;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/core/InterleavedBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.InterleavedBufferAttribute = function ( interleavedBuffer, itemSize, offset ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.data = interleavedBuffer;\r\n\tthis.itemSize = itemSize;\r\n\tthis.offset = offset;\r\n\r\n};\r\n\r\n\r\nTHREE.InterleavedBufferAttribute.prototype = {\r\n\r\n\tconstructor: THREE.InterleavedBufferAttribute,\r\n\r\n\tget length() {\r\n\r\n\t\tconsole.warn( 'THREE.BufferAttribute: .length has been deprecated. Please use .count.' );\r\n\t\treturn this.array.length;\r\n\r\n\t},\r\n\r\n\tget count() {\r\n\r\n\t\treturn this.data.array.length / this.data.stride;\r\n\r\n\t},\r\n\r\n\tsetX: function ( index, x ) {\r\n\r\n\t\tthis.data.array[ index * this.data.stride + this.offset ] = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( index, y ) {\r\n\r\n\t\tthis.data.array[ index * this.data.stride + this.offset + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( index, z ) {\r\n\r\n\t\tthis.data.array[ index * this.data.stride + this.offset + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetW: function ( index, w ) {\r\n\r\n\t\tthis.data.array[ index * this.data.stride + this.offset + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetX: function ( index ) {\r\n\r\n\t\treturn this.data.array[ index * this.data.stride + this.offset ];\r\n\r\n\t},\r\n\r\n\tgetY: function ( index ) {\r\n\r\n\t\treturn this.data.array[ index * this.data.stride + this.offset + 1 ];\r\n\r\n\t},\r\n\r\n\tgetZ: function ( index ) {\r\n\r\n\t\treturn this.data.array[ index * this.data.stride + this.offset + 2 ];\r\n\r\n\t},\r\n\r\n\tgetW: function ( index ) {\r\n\r\n\t\treturn this.data.array[ index * this.data.stride + this.offset + 3 ];\r\n\r\n\t},\r\n\r\n\tsetXY: function ( index, x, y ) {\r\n\r\n\t\tindex = index * this.data.stride + this.offset;\r\n\r\n\t\tthis.data.array[ index + 0 ] = x;\r\n\t\tthis.data.array[ index + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZ: function ( index, x, y, z ) {\r\n\r\n\t\tindex = index * this.data.stride + this.offset;\r\n\r\n\t\tthis.data.array[ index + 0 ] = x;\r\n\t\tthis.data.array[ index + 1 ] = y;\r\n\t\tthis.data.array[ index + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZW: function ( index, x, y, z, w ) {\r\n\r\n\t\tindex = index * this.data.stride + this.offset;\r\n\r\n\t\tthis.data.array[ index + 0 ] = x;\r\n\t\tthis.data.array[ index + 1 ] = y;\r\n\t\tthis.data.array[ index + 2 ] = z;\r\n\t\tthis.data.array[ index + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Geometry';\r\n\r\n\tthis.vertices = [];\r\n\tthis.colors = [];\r\n\tthis.faces = [];\r\n\tthis.faceVertexUvs = [ [] ];\r\n\r\n\tthis.morphTargets = [];\r\n\tthis.morphColors = [];\r\n\tthis.morphNormals = [];\r\n\r\n\tthis.skinWeights = [];\r\n\tthis.skinIndices = [];\r\n\r\n\tthis.lineDistances = [];\r\n\r\n\tthis.boundingBox = null;\r\n\tthis.boundingSphere = null;\r\n\r\n\t// update flags\r\n\r\n\tthis.verticesNeedUpdate = false;\r\n\tthis.elementsNeedUpdate = false;\r\n\tthis.uvsNeedUpdate = false;\r\n\tthis.normalsNeedUpdate = false;\r\n\tthis.colorsNeedUpdate = false;\r\n\tthis.lineDistancesNeedUpdate = false;\r\n\tthis.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n\tconstructor: THREE.Geometry,\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tvar normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\tfor ( var i = 0, il = this.vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar vertex = this.vertices[ i ];\r\n\t\t\tvertex.applyMatrix4( matrix );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ i ];\r\n\t\t\tface.normal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\tfor ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tface.vertexNormals[ j ].applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t\tthis.verticesNeedUpdate = true;\r\n\t\tthis.normalsNeedUpdate = true;\r\n\r\n\t},\r\n\r\n\trotateX: function () {\r\n\r\n\t\t// rotate geometry around world x-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateX( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationX( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateY: function () {\r\n\r\n\t\t// rotate geometry around world y-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateY( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationY( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateZ: function () {\r\n\r\n\t\t// rotate geometry around world z-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateZ( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationZ( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function () {\r\n\r\n\t\t// translate geometry\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function translate( x, y, z ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeTranslation( x, y, z );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tscale: function () {\r\n\r\n\t\t// scale geometry\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function scale( x, y, z ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeScale( x, y, z );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlookAt: function () {\r\n\r\n\t\tvar obj;\r\n\r\n\t\treturn function lookAt( vector ) {\r\n\r\n\t\t\tif ( obj === undefined ) obj = new THREE.Object3D();\r\n\r\n\t\t\tobj.lookAt( vector );\r\n\r\n\t\t\tobj.updateMatrix();\r\n\r\n\t\t\tthis.applyMatrix( obj.matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tfromBufferGeometry: function ( geometry ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar indices = geometry.index !== null ? geometry.index.array : undefined;\r\n\t\tvar attributes = geometry.attributes;\r\n\r\n\t\tvar vertices = attributes.position.array;\r\n\t\tvar normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n\t\tvar colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n\t\tvar uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\t\tvar uvs2 = attributes.uv2 !== undefined ? attributes.uv2.array : undefined;\r\n\r\n\t\tif ( uvs2 !== undefined ) this.faceVertexUvs[ 1 ] = [];\r\n\r\n\t\tvar tempNormals = [];\r\n\t\tvar tempUVs = [];\r\n\t\tvar tempUVs2 = [];\r\n\r\n\t\tfor ( var i = 0, j = 0, k = 0; i < vertices.length; i += 3, j += 2, k += 4 ) {\r\n\r\n\t\t\tscope.vertices.push( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );\r\n\r\n\t\t\tif ( normals !== undefined ) {\r\n\r\n\t\t\t\ttempNormals.push( new THREE.Vector3( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( colors !== undefined ) {\r\n\r\n\t\t\t\tscope.colors.push( new THREE.Color( colors[ i ], colors[ i + 1 ], colors[ i + 2 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uvs !== undefined ) {\r\n\r\n\t\t\t\ttempUVs.push( new THREE.Vector2( uvs[ j ], uvs[ j + 1 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uvs2 !== undefined ) {\r\n\r\n\t\t\t\ttempUVs2.push( new THREE.Vector2( uvs2[ j ], uvs2[ j + 1 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar addFace = function ( a, b, c ) {\r\n\r\n\t\t\tvar vertexNormals = normals !== undefined ? [ tempNormals[ a ].clone(), tempNormals[ b ].clone(), tempNormals[ c ].clone() ] : [];\r\n\t\t\tvar vertexColors = colors !== undefined ? [ scope.colors[ a ].clone(), scope.colors[ b ].clone(), scope.colors[ c ].clone() ] : [];\r\n\r\n\t\t\tvar face = new THREE.Face3( a, b, c, vertexNormals, vertexColors );\r\n\r\n\t\t\tscope.faces.push( face );\r\n\r\n\t\t\tif ( uvs !== undefined ) {\r\n\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ tempUVs[ a ].clone(), tempUVs[ b ].clone(), tempUVs[ c ].clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uvs2 !== undefined ) {\r\n\r\n\t\t\t\tscope.faceVertexUvs[ 1 ].push( [ tempUVs2[ a ].clone(), tempUVs2[ b ].clone(), tempUVs2[ c ].clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tif ( indices !== undefined ) {\r\n\r\n\t\t\tvar groups = geometry.groups;\r\n\r\n\t\t\tif ( groups.length > 0 ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < groups.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar group = groups[ i ];\r\n\r\n\t\t\t\t\tvar start = group.start;\r\n\t\t\t\t\tvar count = group.count;\r\n\r\n\t\t\t\t\tfor ( var j = start, jl = start + count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\taddFace( indices[ j ], indices[ j + 1 ], indices[ j + 2 ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tfor ( var i = 0; i < indices.length; i += 3 ) {\r\n\r\n\t\t\t\t\taddFace( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( var i = 0; i < vertices.length / 3; i += 3 ) {\r\n\r\n\t\t\t\taddFace( i, i + 1, i + 2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.computeFaceNormals();\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcenter: function () {\r\n\r\n\t\tthis.computeBoundingBox();\r\n\r\n\t\tvar offset = this.boundingBox.center().negate();\r\n\r\n\t\tthis.translate( offset.x, offset.y, offset.z );\r\n\r\n\t\treturn offset;\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\tthis.computeBoundingSphere();\r\n\r\n\t\tvar center = this.boundingSphere.center;\r\n\t\tvar radius = this.boundingSphere.radius;\r\n\r\n\t\tvar s = radius === 0 ? 1 : 1.0 / radius;\r\n\r\n\t\tvar matrix = new THREE.Matrix4();\r\n\t\tmatrix.set(\r\n\t\t\ts, 0, 0, - s * center.x,\r\n\t\t\t0, s, 0, - s * center.y,\r\n\t\t\t0, 0, s, - s * center.z,\r\n\t\t\t0, 0, 0, 1\r\n\t\t);\r\n\r\n\t\tthis.applyMatrix( matrix );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcomputeFaceNormals: function () {\r\n\r\n\t\tvar cb = new THREE.Vector3(), ab = new THREE.Vector3();\r\n\r\n\t\tfor ( var f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ f ];\r\n\r\n\t\t\tvar vA = this.vertices[ face.a ];\r\n\t\t\tvar vB = this.vertices[ face.b ];\r\n\t\t\tvar vC = this.vertices[ face.c ];\r\n\r\n\t\t\tcb.subVectors( vC, vB );\r\n\t\t\tab.subVectors( vA, vB );\r\n\t\t\tcb.cross( ab );\r\n\r\n\t\t\tcb.normalize();\r\n\r\n\t\t\tface.normal.copy( cb );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeVertexNormals: function ( areaWeighted ) {\r\n\r\n\t\tvar v, vl, f, fl, face, vertices;\r\n\r\n\t\tvertices = new Array( this.vertices.length );\r\n\r\n\t\tfor ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\tvertices[ v ] = new THREE.Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tif ( areaWeighted ) {\r\n\r\n\t\t\t// vertex normals weighted by triangle areas\r\n\t\t\t// http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n\t\t\tvar vA, vB, vC;\r\n\t\t\tvar cb = new THREE.Vector3(), ab = new THREE.Vector3();\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tvA = this.vertices[ face.a ];\r\n\t\t\t\tvB = this.vertices[ face.b ];\r\n\t\t\t\tvC = this.vertices[ face.c ];\r\n\r\n\t\t\t\tcb.subVectors( vC, vB );\r\n\t\t\t\tab.subVectors( vA, vB );\r\n\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\tvertices[ face.a ].add( cb );\r\n\t\t\t\tvertices[ face.b ].add( cb );\r\n\t\t\t\tvertices[ face.c ].add( cb );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tvertices[ face.a ].add( face.normal );\r\n\t\t\t\tvertices[ face.b ].add( face.normal );\r\n\t\t\t\tvertices[ face.c ].add( face.normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\tvertices[ v ].normalize();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tvar vertexNormals = face.vertexNormals;\r\n\r\n\t\t\tif ( vertexNormals.length === 3 ) {\r\n\r\n\t\t\t\tvertexNormals[ 0 ].copy( vertices[ face.a ] );\r\n\t\t\t\tvertexNormals[ 1 ].copy( vertices[ face.b ] );\r\n\t\t\t\tvertexNormals[ 2 ].copy( vertices[ face.c ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvertexNormals[ 0 ] = vertices[ face.a ].clone();\r\n\t\t\t\tvertexNormals[ 1 ] = vertices[ face.b ].clone();\r\n\t\t\t\tvertexNormals[ 2 ] = vertices[ face.c ].clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeMorphNormals: function () {\r\n\r\n\t\tvar i, il, f, fl, face;\r\n\r\n\t\t// save original normals\r\n\t\t// - create temp variables on first access\r\n\t\t//   otherwise just copy (for faster repeated calls)\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tif ( ! face.__originalFaceNormal ) {\r\n\r\n\t\t\t\tface.__originalFaceNormal = face.normal.clone();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tface.__originalFaceNormal.copy( face.normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! face.__originalVertexNormals ) face.__originalVertexNormals = [];\r\n\r\n\t\t\tfor ( i = 0, il = face.vertexNormals.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tif ( ! face.__originalVertexNormals[ i ] ) {\r\n\r\n\t\t\t\t\tface.__originalVertexNormals[ i ] = face.vertexNormals[ i ].clone();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tface.__originalVertexNormals[ i ].copy( face.vertexNormals[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// use temp geometry to compute face and vertex normals for each morph\r\n\r\n\t\tvar tmpGeo = new THREE.Geometry();\r\n\t\ttmpGeo.faces = this.faces;\r\n\r\n\t\tfor ( i = 0, il = this.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\t\t// create on first access\r\n\r\n\t\t\tif ( ! this.morphNormals[ i ] ) {\r\n\r\n\t\t\t\tthis.morphNormals[ i ] = {};\r\n\t\t\t\tthis.morphNormals[ i ].faceNormals = [];\r\n\t\t\t\tthis.morphNormals[ i ].vertexNormals = [];\r\n\r\n\t\t\t\tvar dstNormalsFace = this.morphNormals[ i ].faceNormals;\r\n\t\t\t\tvar dstNormalsVertex = this.morphNormals[ i ].vertexNormals;\r\n\r\n\t\t\t\tvar faceNormal, vertexNormals;\r\n\r\n\t\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\tfaceNormal = new THREE.Vector3();\r\n\t\t\t\t\tvertexNormals = { a: new THREE.Vector3(), b: new THREE.Vector3(), c: new THREE.Vector3() };\r\n\r\n\t\t\t\t\tdstNormalsFace.push( faceNormal );\r\n\t\t\t\t\tdstNormalsVertex.push( vertexNormals );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar morphNormals = this.morphNormals[ i ];\r\n\r\n\t\t\t// set vertices to morph target\r\n\r\n\t\t\ttmpGeo.vertices = this.morphTargets[ i ].vertices;\r\n\r\n\t\t\t// compute morph normals\r\n\r\n\t\t\ttmpGeo.computeFaceNormals();\r\n\t\t\ttmpGeo.computeVertexNormals();\r\n\r\n\t\t\t// store morph normals\r\n\r\n\t\t\tvar faceNormal, vertexNormals;\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tfaceNormal = morphNormals.faceNormals[ f ];\r\n\t\t\t\tvertexNormals = morphNormals.vertexNormals[ f ];\r\n\r\n\t\t\t\tfaceNormal.copy( face.normal );\r\n\r\n\t\t\t\tvertexNormals.a.copy( face.vertexNormals[ 0 ] );\r\n\t\t\t\tvertexNormals.b.copy( face.vertexNormals[ 1 ] );\r\n\t\t\t\tvertexNormals.c.copy( face.vertexNormals[ 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore original normals\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tface.normal = face.__originalFaceNormal;\r\n\t\t\tface.vertexNormals = face.__originalVertexNormals;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeTangents: function () {\r\n\r\n\t\tconsole.warn( 'THREE.Geometry: .computeTangents() has been removed.' );\r\n\r\n\t},\r\n\r\n\tcomputeLineDistances: function () {\r\n\r\n\t\tvar d = 0;\r\n\t\tvar vertices = this.vertices;\r\n\r\n\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tif ( i > 0 ) {\r\n\r\n\t\t\t\td += vertices[ i ].distanceTo( vertices[ i - 1 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.lineDistances[ i ] = d;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeBoundingBox: function () {\r\n\r\n\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\tthis.boundingBox = new THREE.Box3();\r\n\r\n\t\t}\r\n\r\n\t\tthis.boundingBox.setFromPoints( this.vertices );\r\n\r\n\t},\r\n\r\n\tcomputeBoundingSphere: function () {\r\n\r\n\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\tthis.boundingSphere = new THREE.Sphere();\r\n\r\n\t\t}\r\n\r\n\t\tthis.boundingSphere.setFromPoints( this.vertices );\r\n\r\n\t},\r\n\r\n\tmerge: function ( geometry, matrix, materialIndexOffset ) {\r\n\r\n\t\tif ( geometry instanceof THREE.Geometry === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar normalMatrix,\r\n\t\tvertexOffset = this.vertices.length,\r\n\t\tvertices1 = this.vertices,\r\n\t\tvertices2 = geometry.vertices,\r\n\t\tfaces1 = this.faces,\r\n\t\tfaces2 = geometry.faces,\r\n\t\tuvs1 = this.faceVertexUvs[ 0 ],\r\n\t\tuvs2 = geometry.faceVertexUvs[ 0 ];\r\n\r\n\t\tif ( materialIndexOffset === undefined ) materialIndexOffset = 0;\r\n\r\n\t\tif ( matrix !== undefined ) {\r\n\r\n\t\t\tnormalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\t}\r\n\r\n\t\t// vertices\r\n\r\n\t\tfor ( var i = 0, il = vertices2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar vertex = vertices2[ i ];\r\n\r\n\t\t\tvar vertexCopy = vertex.clone();\r\n\r\n\t\t\tif ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );\r\n\r\n\t\t\tvertices1.push( vertexCopy );\r\n\r\n\t\t}\r\n\r\n\t\t// faces\r\n\r\n\t\tfor ( i = 0, il = faces2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar face = faces2[ i ], faceCopy, normal, color,\r\n\t\t\tfaceVertexNormals = face.vertexNormals,\r\n\t\t\tfaceVertexColors = face.vertexColors;\r\n\r\n\t\t\tfaceCopy = new THREE.Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );\r\n\t\t\tfaceCopy.normal.copy( face.normal );\r\n\r\n\t\t\tif ( normalMatrix !== undefined ) {\r\n\r\n\t\t\t\tfaceCopy.normal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tnormal = faceVertexNormals[ j ].clone();\r\n\r\n\t\t\t\tif ( normalMatrix !== undefined ) {\r\n\r\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfaceCopy.vertexNormals.push( normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfaceCopy.color.copy( face.color );\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tcolor = faceVertexColors[ j ];\r\n\t\t\t\tfaceCopy.vertexColors.push( color.clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfaceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n\t\t\tfaces1.push( faceCopy );\r\n\r\n\t\t}\r\n\r\n\t\t// uvs\r\n\r\n\t\tfor ( i = 0, il = uvs2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar uv = uvs2[ i ], uvCopy = [];\r\n\r\n\t\t\tif ( uv === undefined ) {\r\n\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = uv.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tuvCopy.push( uv[ j ].clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuvs1.push( uvCopy );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tmergeMesh: function ( mesh ) {\r\n\r\n\t\tif ( mesh instanceof THREE.Mesh === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tmesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n\t\tthis.merge( mesh.geometry, mesh.matrix );\r\n\r\n\t},\r\n\r\n\t/*\r\n\t * Checks for duplicate vertices with hashmap.\r\n\t * Duplicated vertices are removed\r\n\t * and faces' vertices are updated.\r\n\t */\r\n\r\n\tmergeVertices: function () {\r\n\r\n\t\tvar verticesMap = {}; // Hashmap for looking up vertices by position coordinates (and making sure they are unique)\r\n\t\tvar unique = [], changes = [];\r\n\r\n\t\tvar v, key;\r\n\t\tvar precisionPoints = 4; // number of decimal points, e.g. 4 for epsilon of 0.0001\r\n\t\tvar precision = Math.pow( 10, precisionPoints );\r\n\t\tvar i, il, face;\r\n\t\tvar indices, j, jl;\r\n\r\n\t\tfor ( i = 0, il = this.vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tv = this.vertices[ i ];\r\n\t\t\tkey = Math.round( v.x * precision ) + '_' + Math.round( v.y * precision ) + '_' + Math.round( v.z * precision );\r\n\r\n\t\t\tif ( verticesMap[ key ] === undefined ) {\r\n\r\n\t\t\t\tverticesMap[ key ] = i;\r\n\t\t\t\tunique.push( this.vertices[ i ] );\r\n\t\t\t\tchanges[ i ] = unique.length - 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n\t\t\t\tchanges[ i ] = changes[ verticesMap[ key ] ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\t// if faces are completely degenerate after merging vertices, we\r\n\t\t// have to remove them from the geometry.\r\n\t\tvar faceIndicesToRemove = [];\r\n\r\n\t\tfor ( i = 0, il = this.faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tface = this.faces[ i ];\r\n\r\n\t\t\tface.a = changes[ face.a ];\r\n\t\t\tface.b = changes[ face.b ];\r\n\t\t\tface.c = changes[ face.c ];\r\n\r\n\t\t\tindices = [ face.a, face.b, face.c ];\r\n\r\n\t\t\tvar dupIndex = - 1;\r\n\r\n\t\t\t// if any duplicate vertices are found in a Face3\r\n\t\t\t// we have to remove the face as nothing can be saved\r\n\t\t\tfor ( var n = 0; n < 3; n ++ ) {\r\n\r\n\t\t\t\tif ( indices[ n ] === indices[ ( n + 1 ) % 3 ] ) {\r\n\r\n\t\t\t\t\tdupIndex = n;\r\n\t\t\t\t\tfaceIndicesToRemove.push( i );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( i = faceIndicesToRemove.length - 1; i >= 0; i -- ) {\r\n\r\n\t\t\tvar idx = faceIndicesToRemove[ i ];\r\n\r\n\t\t\tthis.faces.splice( idx, 1 );\r\n\r\n\t\t\tfor ( j = 0, jl = this.faceVertexUvs.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tthis.faceVertexUvs[ j ].splice( idx, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Use unique set of vertices\r\n\r\n\t\tvar diff = this.vertices.length - unique.length;\r\n\t\tthis.vertices = unique;\r\n\t\treturn diff;\r\n\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar data = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Geometry',\r\n\t\t\t\tgenerator: 'Geometry.toJSON'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// standard Geometry serialization\r\n\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\r\n\t\tif ( this.parameters !== undefined ) {\r\n\r\n\t\t\tvar parameters = this.parameters;\r\n\r\n\t\t\tfor ( var key in parameters ) {\r\n\r\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tvar vertices = [];\r\n\r\n\t\tfor ( var i = 0; i < this.vertices.length; i ++ ) {\r\n\r\n\t\t\tvar vertex = this.vertices[ i ];\r\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\r\n\r\n\t\t}\r\n\r\n\t\tvar faces = [];\r\n\t\tvar normals = [];\r\n\t\tvar normalsHash = {};\r\n\t\tvar colors = [];\r\n\t\tvar colorsHash = {};\r\n\t\tvar uvs = [];\r\n\t\tvar uvsHash = {};\r\n\r\n\t\tfor ( var i = 0; i < this.faces.length; i ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ i ];\r\n\r\n\t\t\tvar hasMaterial = false; // face.materialIndex !== undefined;\r\n\t\t\tvar hasFaceUv = false; // deprecated\r\n\t\t\tvar hasFaceVertexUv = this.faceVertexUvs[ 0 ][ i ] !== undefined;\r\n\t\t\tvar hasFaceNormal = face.normal.length() > 0;\r\n\t\t\tvar hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n\t\t\tvar hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n\t\t\tvar hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n\t\t\tvar faceType = 0;\r\n\r\n\t\t\tfaceType = setBit( faceType, 0, 0 );\r\n\t\t\tfaceType = setBit( faceType, 1, hasMaterial );\r\n\t\t\tfaceType = setBit( faceType, 2, hasFaceUv );\r\n\t\t\tfaceType = setBit( faceType, 3, hasFaceVertexUv );\r\n\t\t\tfaceType = setBit( faceType, 4, hasFaceNormal );\r\n\t\t\tfaceType = setBit( faceType, 5, hasFaceVertexNormal );\r\n\t\t\tfaceType = setBit( faceType, 6, hasFaceColor );\r\n\t\t\tfaceType = setBit( faceType, 7, hasFaceVertexColor );\r\n\r\n\t\t\tfaces.push( faceType );\r\n\t\t\tfaces.push( face.a, face.b, face.c );\r\n\r\n\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\tvar faceVertexUvs = this.faceVertexUvs[ 0 ][ i ];\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 0 ] ),\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 1 ] ),\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\tfaces.push( getNormalIndex( face.normal ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\tvar vertexNormals = face.vertexNormals;\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 0 ] ),\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 1 ] ),\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\tfaces.push( getColorIndex( face.color ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\tvar vertexColors = face.vertexColors;\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 0 ] ),\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 1 ] ),\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction setBit( value, position, enabled ) {\r\n\r\n\t\t\treturn enabled ? value | ( 1 << position ) : value & ( ~ ( 1 << position ) );\r\n\r\n\t\t}\r\n\r\n\t\tfunction getNormalIndex( normal ) {\r\n\r\n\t\t\tvar hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n\t\t\tif ( normalsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn normalsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnormalsHash[ hash ] = normals.length / 3;\r\n\t\t\tnormals.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\treturn normalsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\tfunction getColorIndex( color ) {\r\n\r\n\t\t\tvar hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n\t\t\tif ( colorsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn colorsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcolorsHash[ hash ] = colors.length;\r\n\t\t\tcolors.push( color.getHex() );\r\n\r\n\t\t\treturn colorsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\tfunction getUvIndex( uv ) {\r\n\r\n\t\t\tvar hash = uv.x.toString() + uv.y.toString();\r\n\r\n\t\t\tif ( uvsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn uvsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuvsHash[ hash ] = uvs.length / 2;\r\n\t\t\tuvs.push( uv.x, uv.y );\r\n\r\n\t\t\treturn uvsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\tdata.data = {};\r\n\r\n\t\tdata.data.vertices = vertices;\r\n\t\tdata.data.normals = normals;\r\n\t\tif ( colors.length > 0 ) data.data.colors = colors;\r\n\t\tif ( uvs.length > 0 ) data.data.uvs = [ uvs ]; // temporal backward compatibility\r\n\t\tdata.data.faces = faces;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.vertices = [];\r\n\t\tthis.faces = [];\r\n\t\tthis.faceVertexUvs = [ [] ];\r\n\r\n\t\tvar vertices = source.vertices;\r\n\r\n\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.vertices.push( vertices[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\tvar faces = source.faces;\r\n\r\n\t\tfor ( var i = 0, il = faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.faces.push( faces[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = source.faceVertexUvs.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar faceVertexUvs = source.faceVertexUvs[ i ];\r\n\r\n\t\t\tif ( this.faceVertexUvs[ i ] === undefined ) {\r\n\r\n\t\t\t\tthis.faceVertexUvs[ i ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexUvs.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tvar uvs = faceVertexUvs[ j ], uvsCopy = [];\r\n\r\n\t\t\t\tfor ( var k = 0, kl = uvs.length; k < kl; k ++ ) {\r\n\r\n\t\t\t\t\tvar uv = uvs[ k ];\r\n\r\n\t\t\t\t\tuvsCopy.push( uv.clone() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.faceVertexUvs[ i ].push( uvsCopy );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Geometry.prototype );\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/core/DirectGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DirectGeometry = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'DirectGeometry';\r\n\r\n\tthis.indices = [];\r\n\tthis.vertices = [];\r\n\tthis.normals = [];\r\n\tthis.colors = [];\r\n\tthis.uvs = [];\r\n\tthis.uvs2 = [];\r\n\r\n\tthis.groups = [];\r\n\r\n\tthis.morphTargets = {};\r\n\r\n\tthis.skinWeights = [];\r\n\tthis.skinIndices = [];\r\n\r\n\t// this.lineDistances = [];\r\n\r\n\tthis.boundingBox = null;\r\n\tthis.boundingSphere = null;\r\n\r\n\t// update flags\r\n\r\n\tthis.verticesNeedUpdate = false;\r\n\tthis.normalsNeedUpdate = false;\r\n\tthis.colorsNeedUpdate = false;\r\n\tthis.uvsNeedUpdate = false;\r\n\tthis.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.DirectGeometry.prototype = {\r\n\r\n\tconstructor: THREE.DirectGeometry,\r\n\r\n\tcomputeBoundingBox: THREE.Geometry.prototype.computeBoundingBox,\r\n\tcomputeBoundingSphere: THREE.Geometry.prototype.computeBoundingSphere,\r\n\r\n\tcomputeFaceNormals: function () {\r\n\r\n\t\tconsole.warn( 'THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.' );\r\n\r\n\t},\r\n\r\n\tcomputeVertexNormals: function () {\r\n\r\n\t\tconsole.warn( 'THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.' );\r\n\r\n\t},\r\n\r\n\tcomputeGroups: function ( geometry ) {\r\n\r\n\t\tvar group;\r\n\t\tvar groups = [];\r\n\t\tvar materialIndex;\r\n\r\n\t\tvar faces = geometry.faces;\r\n\r\n\t\tfor ( var i = 0; i < faces.length; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\t// materials\r\n\r\n\t\t\tif ( face.materialIndex !== materialIndex ) {\r\n\r\n\t\t\t\tmaterialIndex = face.materialIndex;\r\n\r\n\t\t\t\tif ( group !== undefined ) {\r\n\r\n\t\t\t\t\tgroup.count = ( i * 3 ) - group.start;\r\n\t\t\t\t\tgroups.push( group );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgroup = {\r\n\t\t\t\t\tstart: i * 3,\r\n\t\t\t\t\tmaterialIndex: materialIndex\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( group !== undefined ) {\r\n\r\n\t\t\tgroup.count = ( i * 3 ) - group.start;\r\n\t\t\tgroups.push( group );\r\n\r\n\t\t}\r\n\r\n\t\tthis.groups = groups;\r\n\r\n\t},\r\n\r\n\tfromGeometry: function ( geometry ) {\r\n\r\n\t\tvar faces = geometry.faces;\r\n\t\tvar vertices = geometry.vertices;\r\n\t\tvar faceVertexUvs = geometry.faceVertexUvs;\r\n\r\n\t\tvar hasFaceVertexUv = faceVertexUvs[ 0 ] && faceVertexUvs[ 0 ].length > 0;\r\n\t\tvar hasFaceVertexUv2 = faceVertexUvs[ 1 ] && faceVertexUvs[ 1 ].length > 0;\r\n\r\n\t\t// morphs\r\n\r\n\t\tvar morphTargets = geometry.morphTargets;\r\n\t\tvar morphTargetsLength = morphTargets.length;\r\n\r\n\t\tif ( morphTargetsLength > 0 ) {\r\n\r\n\t\t\tvar morphTargetsPosition = [];\r\n\r\n\t\t\tfor ( var i = 0; i < morphTargetsLength; i ++ ) {\r\n\r\n\t\t\t\tmorphTargetsPosition[ i ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.morphTargets.position = morphTargetsPosition;\r\n\r\n\t\t}\r\n\r\n\t\tvar morphNormals = geometry.morphNormals;\r\n\t\tvar morphNormalsLength = morphNormals.length;\r\n\r\n\t\tif ( morphNormalsLength > 0 ) {\r\n\r\n\t\t\tvar morphTargetsNormal = [];\r\n\r\n\t\t\tfor ( var i = 0; i < morphNormalsLength; i ++ ) {\r\n\r\n\t\t\t\tmorphTargetsNormal[ i ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.morphTargets.normal = morphTargetsNormal;\r\n\r\n\t\t}\r\n\r\n\t\t// skins\r\n\r\n\t\tvar skinIndices = geometry.skinIndices;\r\n\t\tvar skinWeights = geometry.skinWeights;\r\n\r\n\t\tvar hasSkinIndices = skinIndices.length === vertices.length;\r\n\t\tvar hasSkinWeights = skinWeights.length === vertices.length;\r\n\r\n\t\t//\r\n\r\n\t\tfor ( var i = 0; i < faces.length; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tthis.vertices.push( vertices[ face.a ], vertices[ face.b ], vertices[ face.c ] );\r\n\r\n\t\t\tvar vertexNormals = face.vertexNormals;\r\n\r\n\t\t\tif ( vertexNormals.length === 3 ) {\r\n\r\n\t\t\t\tthis.normals.push( vertexNormals[ 0 ], vertexNormals[ 1 ], vertexNormals[ 2 ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar normal = face.normal;\r\n\r\n\t\t\t\tthis.normals.push( normal, normal, normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar vertexColors = face.vertexColors;\r\n\r\n\t\t\tif ( vertexColors.length === 3 ) {\r\n\r\n\t\t\t\tthis.colors.push( vertexColors[ 0 ], vertexColors[ 1 ], vertexColors[ 2 ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar color = face.color;\r\n\r\n\t\t\t\tthis.colors.push( color, color, color );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexUv === true ) {\r\n\r\n\t\t\t\tvar vertexUvs = faceVertexUvs[ 0 ][ i ];\r\n\r\n\t\t\t\tif ( vertexUvs !== undefined ) {\r\n\r\n\t\t\t\t\tthis.uvs.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ', i );\r\n\r\n\t\t\t\t\tthis.uvs.push( new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexUv2 === true ) {\r\n\r\n\t\t\t\tvar vertexUvs = faceVertexUvs[ 1 ][ i ];\r\n\r\n\t\t\t\tif ( vertexUvs !== undefined ) {\r\n\r\n\t\t\t\t\tthis.uvs2.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ', i );\r\n\r\n\t\t\t\t\tthis.uvs2.push( new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// morphs\r\n\r\n\t\t\tfor ( var j = 0; j < morphTargetsLength; j ++ ) {\r\n\r\n\t\t\t\tvar morphTarget = morphTargets[ j ].vertices;\r\n\r\n\t\t\t\tmorphTargetsPosition[ j ].push( morphTarget[ face.a ], morphTarget[ face.b ], morphTarget[ face.c ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0; j < morphNormalsLength; j ++ ) {\r\n\r\n\t\t\t\tvar morphNormal = morphNormals[ j ].vertexNormals[ i ];\r\n\r\n\t\t\t\tmorphTargetsNormal[ j ].push( morphNormal.a, morphNormal.b, morphNormal.c );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// skins\r\n\r\n\t\t\tif ( hasSkinIndices ) {\r\n\r\n\t\t\t\tthis.skinIndices.push( skinIndices[ face.a ], skinIndices[ face.b ], skinIndices[ face.c ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasSkinWeights ) {\r\n\r\n\t\t\t\tthis.skinWeights.push( skinWeights[ face.a ], skinWeights[ face.b ], skinWeights[ face.c ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.computeGroups( geometry );\r\n\r\n\t\tthis.verticesNeedUpdate = geometry.verticesNeedUpdate;\r\n\t\tthis.normalsNeedUpdate = geometry.normalsNeedUpdate;\r\n\t\tthis.colorsNeedUpdate = geometry.colorsNeedUpdate;\r\n\t\tthis.uvsNeedUpdate = geometry.uvsNeedUpdate;\r\n\t\tthis.groupsNeedUpdate = geometry.groupsNeedUpdate;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.DirectGeometry.prototype );\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'BufferGeometry';\r\n\r\n\tthis.index = null;\r\n\tthis.attributes = {};\r\n\r\n\tthis.morphAttributes = {};\r\n\r\n\tthis.groups = [];\r\n\r\n\tthis.boundingBox = null;\r\n\tthis.boundingSphere = null;\r\n\r\n\tthis.drawRange = { start: 0, count: Infinity };\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n\tconstructor: THREE.BufferGeometry,\r\n\r\n\taddIndex: function ( index ) {\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().' );\r\n\t\tthis.setIndex( index );\r\n\r\n\t},\r\n\r\n\tgetIndex: function () {\r\n\r\n\t\treturn this.index;\r\n\r\n\t},\r\n\r\n\tsetIndex: function ( index ) {\r\n\r\n\t\tthis.index = index;\r\n\r\n\t},\r\n\r\n\taddAttribute: function ( name, attribute ) {\r\n\r\n\t\tif ( attribute instanceof THREE.BufferAttribute === false && attribute instanceof THREE.InterleavedBufferAttribute === false ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).' );\r\n\r\n\t\t\tthis.addAttribute( name, new THREE.BufferAttribute( arguments[ 1 ], arguments[ 2 ] ) );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( name === 'index' ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.' );\r\n\t\t\tthis.setIndex( attribute );\r\n\r\n\t\t}\r\n\r\n\t\tthis.attributes[ name ] = attribute;\r\n\r\n\t},\r\n\r\n\tgetAttribute: function ( name ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t},\r\n\r\n\tremoveAttribute: function ( name ) {\r\n\r\n\t\tdelete this.attributes[ name ];\r\n\r\n\t},\r\n\r\n\tget drawcalls() {\r\n\r\n\t\tconsole.error( 'THREE.BufferGeometry: .drawcalls has been renamed to .groups.' );\r\n\t\treturn this.groups;\r\n\r\n\t},\r\n\r\n\tget offsets() {\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .offsets has been renamed to .groups.' );\r\n\t\treturn this.groups;\r\n\r\n\t},\r\n\r\n\taddDrawCall: function ( start, count, indexOffset ) {\r\n\r\n\t\tif ( indexOffset !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.' );\r\n\r\n\t\t}\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .addDrawCall() is now .addGroup().' );\r\n\t\tthis.addGroup( start, count );\r\n\r\n\t},\r\n\r\n\tclearDrawCalls: function () {\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().' );\r\n\t\tthis.clearGroups();\r\n\r\n\t},\r\n\r\n\taddGroup: function ( start, count, materialIndex ) {\r\n\r\n\t\tthis.groups.push( {\r\n\r\n\t\t\tstart: start,\r\n\t\t\tcount: count,\r\n\t\t\tmaterialIndex: materialIndex !== undefined ? materialIndex : 0\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\tclearGroups: function () {\r\n\r\n\t\tthis.groups = [];\r\n\r\n\t},\r\n\r\n\tsetDrawRange: function ( start, count ) {\r\n\r\n\t\tthis.drawRange.start = start;\r\n\t\tthis.drawRange.count = count;\r\n\r\n\t},\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tvar position = this.attributes.position;\r\n\r\n\t\tif ( position !== undefined ) {\r\n\r\n\t\t\tmatrix.applyToVector3Array( position.array );\r\n\t\t\tposition.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tvar normal = this.attributes.normal;\r\n\r\n\t\tif ( normal !== undefined ) {\r\n\r\n\t\t\tvar normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\t\tnormalMatrix.applyToVector3Array( normal.array );\r\n\t\t\tnormal.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\trotateX: function () {\r\n\r\n\t\t// rotate geometry around world x-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateX( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationX( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateY: function () {\r\n\r\n\t\t// rotate geometry around world y-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateY( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationY( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateZ: function () {\r\n\r\n\t\t// rotate geometry around world z-axis\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function rotateZ( angle ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeRotationZ( angle );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function () {\r\n\r\n\t\t// translate geometry\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function translate( x, y, z ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeTranslation( x, y, z );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tscale: function () {\r\n\r\n\t\t// scale geometry\r\n\r\n\t\tvar m1;\r\n\r\n\t\treturn function scale( x, y, z ) {\r\n\r\n\t\t\tif ( m1 === undefined ) m1 = new THREE.Matrix4();\r\n\r\n\t\t\tm1.makeScale( x, y, z );\r\n\r\n\t\t\tthis.applyMatrix( m1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlookAt: function () {\r\n\r\n\t\tvar obj;\r\n\r\n\t\treturn function lookAt( vector ) {\r\n\r\n\t\t\tif ( obj === undefined ) obj = new THREE.Object3D();\r\n\r\n\t\t\tobj.lookAt( vector );\r\n\r\n\t\t\tobj.updateMatrix();\r\n\r\n\t\t\tthis.applyMatrix( obj.matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcenter: function () {\r\n\r\n\t\tthis.computeBoundingBox();\r\n\r\n\t\tvar offset = this.boundingBox.center().negate();\r\n\r\n\t\tthis.translate( offset.x, offset.y, offset.z );\r\n\r\n\t\treturn offset;\r\n\r\n\t},\r\n\r\n\tsetFromObject: function ( object ) {\r\n\r\n\t\t// console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tif ( object instanceof THREE.Points || object instanceof THREE.Line ) {\r\n\r\n\t\t\tvar positions = new THREE.Float32Attribute( geometry.vertices.length * 3, 3 );\r\n\t\t\tvar colors = new THREE.Float32Attribute( geometry.colors.length * 3, 3 );\r\n\r\n\t\t\tthis.addAttribute( 'position', positions.copyVector3sArray( geometry.vertices ) );\r\n\t\t\tthis.addAttribute( 'color', colors.copyColorsArray( geometry.colors ) );\r\n\r\n\t\t\tif ( geometry.lineDistances && geometry.lineDistances.length === geometry.vertices.length ) {\r\n\r\n\t\t\t\tvar lineDistances = new THREE.Float32Attribute( geometry.lineDistances.length, 1 );\r\n\r\n\t\t\t\tthis.addAttribute( 'lineDistance',  lineDistances.copyArray( geometry.lineDistances ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometry.boundingSphere !== null ) {\r\n\r\n\t\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\t\tthis.boundingBox = geometry.boundingBox.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\tif ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\tthis.fromGeometry( geometry );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tupdateFromObject: function ( object ) {\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\tvar direct = geometry.__directGeometry;\r\n\r\n\t\t\tif ( direct === undefined ) {\r\n\r\n\t\t\t\treturn this.fromGeometry( geometry );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdirect.verticesNeedUpdate = geometry.verticesNeedUpdate;\r\n\t\t\tdirect.normalsNeedUpdate = geometry.normalsNeedUpdate;\r\n\t\t\tdirect.colorsNeedUpdate = geometry.colorsNeedUpdate;\r\n\t\t\tdirect.uvsNeedUpdate = geometry.uvsNeedUpdate;\r\n\t\t\tdirect.groupsNeedUpdate = geometry.groupsNeedUpdate;\r\n\r\n\t\t\tgeometry.verticesNeedUpdate = false;\r\n\t\t\tgeometry.normalsNeedUpdate = false;\r\n\t\t\tgeometry.colorsNeedUpdate = false;\r\n\t\t\tgeometry.uvsNeedUpdate = false;\r\n\t\t\tgeometry.groupsNeedUpdate = false;\r\n\r\n\t\t\tgeometry = direct;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.verticesNeedUpdate === true ) {\r\n\r\n\t\t\tvar attribute = this.attributes.position;\r\n\r\n\t\t\tif ( attribute !== undefined ) {\r\n\r\n\t\t\t\tattribute.copyVector3sArray( geometry.vertices );\r\n\t\t\t\tattribute.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.verticesNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.normalsNeedUpdate === true ) {\r\n\r\n\t\t\tvar attribute = this.attributes.normal;\r\n\r\n\t\t\tif ( attribute !== undefined ) {\r\n\r\n\t\t\t\tattribute.copyVector3sArray( geometry.normals );\r\n\t\t\t\tattribute.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.normalsNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.colorsNeedUpdate === true ) {\r\n\r\n\t\t\tvar attribute = this.attributes.color;\r\n\r\n\t\t\tif ( attribute !== undefined ) {\r\n\r\n\t\t\t\tattribute.copyColorsArray( geometry.colors );\r\n\t\t\t\tattribute.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.colorsNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.lineDistancesNeedUpdate ) {\r\n\r\n\t\t\tvar attribute = this.attributes.lineDistance;\r\n\r\n\t\t\tif ( attribute !== undefined ) {\r\n\r\n\t\t\t\tattribute.copyArray( geometry.lineDistances );\r\n\t\t\t\tattribute.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.lineDistancesNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.groupsNeedUpdate ) {\r\n\r\n\t\t\tgeometry.computeGroups( object.geometry );\r\n\t\t\tthis.groups = geometry.groups;\r\n\r\n\t\t\tgeometry.groupsNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tfromGeometry: function ( geometry ) {\r\n\r\n\t\tgeometry.__directGeometry = new THREE.DirectGeometry().fromGeometry( geometry );\r\n\r\n\t\treturn this.fromDirectGeometry( geometry.__directGeometry );\r\n\r\n\t},\r\n\r\n\tfromDirectGeometry: function ( geometry ) {\r\n\r\n\t\tvar positions = new Float32Array( geometry.vertices.length * 3 );\r\n\t\tthis.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ).copyVector3sArray( geometry.vertices ) );\r\n\r\n\t\tif ( geometry.normals.length > 0 ) {\r\n\r\n\t\t\tvar normals = new Float32Array( geometry.normals.length * 3 );\r\n\t\t\tthis.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ).copyVector3sArray( geometry.normals ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.colors.length > 0 ) {\r\n\r\n\t\t\tvar colors = new Float32Array( geometry.colors.length * 3 );\r\n\t\t\tthis.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ).copyColorsArray( geometry.colors ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.uvs.length > 0 ) {\r\n\r\n\t\t\tvar uvs = new Float32Array( geometry.uvs.length * 2 );\r\n\t\t\tthis.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ).copyVector2sArray( geometry.uvs ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.uvs2.length > 0 ) {\r\n\r\n\t\t\tvar uvs2 = new Float32Array( geometry.uvs2.length * 2 );\r\n\t\t\tthis.addAttribute( 'uv2', new THREE.BufferAttribute( uvs2, 2 ).copyVector2sArray( geometry.uvs2 ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.indices.length > 0 ) {\r\n\r\n\t\t\tvar TypeArray = geometry.vertices.length > 65535 ? Uint32Array : Uint16Array;\r\n\t\t\tvar indices = new TypeArray( geometry.indices.length * 3 );\r\n\t\t\tthis.setIndex( new THREE.BufferAttribute( indices, 1 ).copyIndicesArray( geometry.indices ) );\r\n\r\n\t\t}\r\n\r\n\t\t// groups\r\n\r\n\t\tthis.groups = geometry.groups;\r\n\r\n\t\t// morphs\r\n\r\n\t\tfor ( var name in geometry.morphTargets ) {\r\n\r\n\t\t\tvar array = [];\r\n\t\t\tvar morphTargets = geometry.morphTargets[ name ];\r\n\r\n\t\t\tfor ( var i = 0, l = morphTargets.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar morphTarget = morphTargets[ i ];\r\n\r\n\t\t\t\tvar attribute = new THREE.Float32Attribute( morphTarget.length * 3, 3 );\r\n\r\n\t\t\t\tarray.push( attribute.copyVector3sArray( morphTarget ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.morphAttributes[ name ] = array;\r\n\r\n\t\t}\r\n\r\n\t\t// skinning\r\n\r\n\t\tif ( geometry.skinIndices.length > 0 ) {\r\n\r\n\t\t\tvar skinIndices = new THREE.Float32Attribute( geometry.skinIndices.length * 4, 4 );\r\n\t\t\tthis.addAttribute( 'skinIndex', skinIndices.copyVector4sArray( geometry.skinIndices ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.skinWeights.length > 0 ) {\r\n\r\n\t\t\tvar skinWeights = new THREE.Float32Attribute( geometry.skinWeights.length * 4, 4 );\r\n\t\t\tthis.addAttribute( 'skinWeight', skinWeights.copyVector4sArray( geometry.skinWeights ) );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( geometry.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcomputeBoundingBox: function () {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\t\tthis.boundingBox = new THREE.Box3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar positions = this.attributes.position.array;\r\n\r\n\t\t\tif ( positions ) {\r\n\r\n\t\t\t\tvar bb = this.boundingBox;\r\n\t\t\t\tbb.makeEmpty();\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.fromArray( positions, i );\r\n\t\t\t\t\tbb.expandByPoint( vector );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( positions === undefined || positions.length === 0 ) {\r\n\r\n\t\t\t\tthis.boundingBox.min.set( 0, 0, 0 );\r\n\t\t\t\tthis.boundingBox.max.set( 0, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( isNaN( this.boundingBox.min.x ) || isNaN( this.boundingBox.min.y ) || isNaN( this.boundingBox.min.z ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.', this );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcomputeBoundingSphere: function () {\r\n\r\n\t\tvar box = new THREE.Box3();\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\t\tthis.boundingSphere = new THREE.Sphere();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar positions = this.attributes.position.array;\r\n\r\n\t\t\tif ( positions ) {\r\n\r\n\t\t\t\tbox.makeEmpty();\r\n\r\n\t\t\t\tvar center = this.boundingSphere.center;\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.fromArray( positions, i );\r\n\t\t\t\t\tbox.expandByPoint( vector );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbox.center( center );\r\n\r\n\t\t\t\t// hoping to find a boundingSphere with a radius smaller than the\r\n\t\t\t\t// boundingSphere of the boundingBox: sqrt(3) smaller in the best case\r\n\r\n\t\t\t\tvar maxRadiusSq = 0;\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.fromArray( positions, i );\r\n\t\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( vector ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.', this );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcomputeFaceNormals: function () {\r\n\r\n\t\t// backwards compatibility\r\n\r\n\t},\r\n\r\n\tcomputeVertexNormals: function () {\r\n\r\n\t\tvar index = this.index;\r\n\t\tvar attributes = this.attributes;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\tif ( attributes.position ) {\r\n\r\n\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\tif ( attributes.normal === undefined ) {\r\n\r\n\t\t\t\tthis.addAttribute( 'normal', new THREE.BufferAttribute( new Float32Array( positions.length ), 3 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// reset existing normals to zero\r\n\r\n\t\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\t\tfor ( var i = 0, il = normals.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnormals[ i ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\tvar vA, vB, vC,\r\n\r\n\t\t\tpA = new THREE.Vector3(),\r\n\t\t\tpB = new THREE.Vector3(),\r\n\t\t\tpC = new THREE.Vector3(),\r\n\r\n\t\t\tcb = new THREE.Vector3(),\r\n\t\t\tab = new THREE.Vector3();\r\n\r\n\t\t\t// indexed elements\r\n\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\tvar indices = index.array;\r\n\r\n\t\t\t\tif ( groups.length === 0 ) {\r\n\r\n\t\t\t\t\tthis.addGroup( 0, indices.length );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var j = 0, jl = groups.length; j < jl; ++ j ) {\r\n\r\n\t\t\t\t\tvar group = groups[ j ];\r\n\r\n\t\t\t\t\tvar start = group.start;\r\n\t\t\t\t\tvar count = group.count;\r\n\r\n\t\t\t\t\tfor ( var i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\tvA = indices[ i + 0 ] * 3;\r\n\t\t\t\t\t\tvB = indices[ i + 1 ] * 3;\r\n\t\t\t\t\t\tvC = indices[ i + 2 ] * 3;\r\n\r\n\t\t\t\t\t\tpA.fromArray( positions, vA );\r\n\t\t\t\t\t\tpB.fromArray( positions, vB );\r\n\t\t\t\t\t\tpC.fromArray( positions, vC );\r\n\r\n\t\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\t\tnormals[ vA ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vA + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vA + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t\tnormals[ vB ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vB + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vB + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t\tnormals[ vC ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vC + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vC + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed elements (unconnected triangle soup)\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 9 ) {\r\n\r\n\t\t\t\t\tpA.fromArray( positions, i );\r\n\t\t\t\t\tpB.fromArray( positions, i + 3 );\r\n\t\t\t\t\tpC.fromArray( positions, i + 6 );\r\n\r\n\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\tnormals[ i ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 1 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 2 ] = cb.z;\r\n\r\n\t\t\t\t\tnormals[ i + 3 ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 4 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 5 ] = cb.z;\r\n\r\n\t\t\t\t\tnormals[ i + 6 ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 7 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 8 ] = cb.z;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.normalizeNormals();\r\n\r\n\t\t\tattributes.normal.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeTangents: function () {\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .computeTangents() has been removed.' );\r\n\r\n\t},\r\n\r\n\tcomputeOffsets: function ( size ) {\r\n\r\n\t\tconsole.warn( 'THREE.BufferGeometry: .computeOffsets() has been removed.')\r\n\r\n\t},\r\n\r\n\tmerge: function ( geometry, offset ) {\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tvar attributes = this.attributes;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tif ( geometry.attributes[ key ] === undefined ) continue;\r\n\r\n\t\t\tvar attribute1 = attributes[ key ];\r\n\t\t\tvar attributeArray1 = attribute1.array;\r\n\r\n\t\t\tvar attribute2 = geometry.attributes[ key ];\r\n\t\t\tvar attributeArray2 = attribute2.array;\r\n\r\n\t\t\tvar attributeSize = attribute2.itemSize;\r\n\r\n\t\t\tfor ( var i = 0, j = attributeSize * offset; i < attributeArray2.length; i ++, j ++ ) {\r\n\r\n\t\t\t\tattributeArray1[ j ] = attributeArray2[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnormalizeNormals: function () {\r\n\r\n\t\tvar normals = this.attributes.normal.array;\r\n\r\n\t\tvar x, y, z, n;\r\n\r\n\t\tfor ( var i = 0, il = normals.length; i < il; i += 3 ) {\r\n\r\n\t\t\tx = normals[ i ];\r\n\t\t\ty = normals[ i + 1 ];\r\n\t\t\tz = normals[ i + 2 ];\r\n\r\n\t\t\tn = 1.0 / Math.sqrt( x * x + y * y + z * z );\r\n\r\n\t\t\tnormals[ i ] *= n;\r\n\t\t\tnormals[ i + 1 ] *= n;\r\n\t\t\tnormals[ i + 2 ] *= n;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar data = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'BufferGeometry',\r\n\t\t\t\tgenerator: 'BufferGeometry.toJSON'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// standard BufferGeometry serialization\r\n\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\r\n\t\tif ( this.parameters !== undefined ) {\r\n\r\n\t\t\tvar parameters = this.parameters;\r\n\r\n\t\t\tfor ( var key in parameters ) {\r\n\r\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\tdata.data = { attributes: {} };\r\n\r\n\t\tvar index = this.index;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tvar array = Array.prototype.slice.call( index.array );\r\n\r\n\t\t\tdata.data.index = {\r\n\t\t\t\ttype: index.array.constructor.name,\r\n\t\t\t\tarray: array\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tvar attributes = this.attributes;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ key ];\r\n\r\n\t\t\tvar array = Array.prototype.slice.call( attribute.array );\r\n\r\n\t\t\tdata.data.attributes[ key ] = {\r\n\t\t\t\titemSize: attribute.itemSize,\r\n\t\t\t\ttype: attribute.array.constructor.name,\r\n\t\t\t\tarray: array\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tvar groups = this.groups;\r\n\r\n\t\tif ( groups.length > 0 ) {\r\n\r\n\t\t\tdata.data.groups = JSON.parse( JSON.stringify( groups ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar boundingSphere = this.boundingSphere;\r\n\r\n\t\tif ( boundingSphere !== null ) {\r\n\r\n\t\t\tdata.data.boundingSphere = {\r\n\t\t\t\tcenter: boundingSphere.center.toArray(),\r\n\t\t\t\tradius: boundingSphere.radius\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tvar index = source.index;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tthis.setIndex( index.clone() );\r\n\r\n\t\t}\r\n\r\n\t\tvar attributes = source.attributes;\r\n\r\n\t\tfor ( var name in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ name ];\r\n\t\t\tthis.addAttribute( name, attribute.clone() );\r\n\r\n\t\t}\r\n\r\n\t\tvar groups = source.groups;\r\n\r\n\t\tfor ( var i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar group = groups[ i ];\r\n\t\t\tthis.addGroup( group.start, group.count );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.BufferGeometry.prototype );\r\n\r\nTHREE.BufferGeometry.MaxIndex = 65535;\r\n\r\n// File:src/core/InstancedBufferGeometry.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.InstancedBufferGeometry = function () {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthis.type = 'InstancedBufferGeometry';\r\n\tthis.maxInstancedCount = undefined;\r\n\r\n};\r\n\r\nTHREE.InstancedBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.InstancedBufferGeometry.prototype.constructor = THREE.InstancedBufferGeometry;\r\n\r\nTHREE.InstancedBufferGeometry.prototype.addGroup = function ( start, count, instances ) {\r\n\r\n\tthis.groups.push( {\r\n\r\n\t\tstart: start,\r\n\t\tcount: count,\r\n\t\tinstances: instances\r\n\r\n\t} );\r\n\r\n};\r\n\r\nTHREE.InstancedBufferGeometry.prototype.copy = function ( source ) {\r\n\r\n\tvar index = source.index;\r\n\r\n\tif ( index !== null ) {\r\n\r\n\t\tthis.setIndex( index.clone() );\r\n\r\n\t}\r\n\r\n\tvar attributes = source.attributes;\r\n\r\n\tfor ( var name in attributes ) {\r\n\r\n\t\tvar attribute = attributes[ name ];\r\n\t\tthis.addAttribute( name, attribute.clone() );\r\n\r\n\t}\r\n\r\n\tvar groups = source.groups;\r\n\r\n\tfor ( var i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\tvar group = groups[ i ];\r\n\t\tthis.addGroup( group.start, group.count, group.instances );\r\n\r\n\t}\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.InstancedBufferGeometry.prototype );\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.Camera = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Camera';\r\n\r\n\tthis.matrixWorldInverse = new THREE.Matrix4();\r\n\tthis.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function () {\r\n\r\n\tvar quaternion = new THREE.Quaternion();\r\n\r\n\treturn function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\treturn result.set( 0, 0, - 1 ).applyQuaternion( quaternion );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function () {\r\n\r\n\t// This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n\tvar m1 = new THREE.Matrix4();\r\n\r\n\treturn function ( vector ) {\r\n\r\n\t\tm1.lookAt( this.position, vector, this.up );\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( m1 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function () {\r\n\r\n\treturn new this.constructor().copy( this );\r\n\r\n};\r\n\r\nTHREE.Camera.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Object3D.prototype.copy.call( this, source );\r\n\r\n\tthis.matrixWorldInverse.copy( source.matrixWorldInverse );\r\n\tthis.projectionMatrix.copy( source.projectionMatrix );\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function ( near, far, cubeResolution ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'CubeCamera';\r\n\r\n\tvar fov = 90, aspect = 1;\r\n\r\n\tvar cameraPX = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPX.up.set( 0, - 1, 0 );\r\n\tcameraPX.lookAt( new THREE.Vector3( 1, 0, 0 ) );\r\n\tthis.add( cameraPX );\r\n\r\n\tvar cameraNX = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNX.up.set( 0, - 1, 0 );\r\n\tcameraNX.lookAt( new THREE.Vector3( - 1, 0, 0 ) );\r\n\tthis.add( cameraNX );\r\n\r\n\tvar cameraPY = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPY.up.set( 0, 0, 1 );\r\n\tcameraPY.lookAt( new THREE.Vector3( 0, 1, 0 ) );\r\n\tthis.add( cameraPY );\r\n\r\n\tvar cameraNY = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNY.up.set( 0, 0, - 1 );\r\n\tcameraNY.lookAt( new THREE.Vector3( 0, - 1, 0 ) );\r\n\tthis.add( cameraNY );\r\n\r\n\tvar cameraPZ = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPZ.up.set( 0, - 1, 0 );\r\n\tcameraPZ.lookAt( new THREE.Vector3( 0, 0, 1 ) );\r\n\tthis.add( cameraPZ );\r\n\r\n\tvar cameraNZ = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNZ.up.set( 0, - 1, 0 );\r\n\tcameraNZ.lookAt( new THREE.Vector3( 0, 0, - 1 ) );\r\n\tthis.add( cameraNZ );\r\n\r\n\tthis.renderTarget = new THREE.WebGLRenderTargetCube( cubeResolution, cubeResolution, { format: THREE.RGBFormat, magFilter: THREE.LinearFilter, minFilter: THREE.LinearFilter } );\r\n\r\n\tthis.updateCubeMap = function ( renderer, scene ) {\r\n\r\n\t\tif ( this.parent === null ) this.updateMatrixWorld();\r\n\r\n\t\tvar renderTarget = this.renderTarget;\r\n\t\tvar generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n\t\trenderTarget.generateMipmaps = false;\r\n\r\n\t\trenderTarget.activeCubeFace = 0;\r\n\t\trenderer.render( scene, cameraPX, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 1;\r\n\t\trenderer.render( scene, cameraNX, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 2;\r\n\t\trenderer.render( scene, cameraPY, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 3;\r\n\t\trenderer.render( scene, cameraNY, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 4;\r\n\t\trenderer.render( scene, cameraPZ, renderTarget );\r\n\r\n\t\trenderTarget.generateMipmaps = generateMipmaps;\r\n\r\n\t\trenderTarget.activeCubeFace = 5;\r\n\t\trenderer.render( scene, cameraNZ, renderTarget );\r\n\r\n\t\trenderer.setRenderTarget( null );\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function ( left, right, top, bottom, near, far ) {\r\n\r\n\tTHREE.Camera.call( this );\r\n\r\n\tthis.type = 'OrthographicCamera';\r\n\r\n\tthis.zoom = 1;\r\n\r\n\tthis.left = left;\r\n\tthis.right = right;\r\n\tthis.top = top;\r\n\tthis.bottom = bottom;\r\n\r\n\tthis.near = ( near !== undefined ) ? near : 0.1;\r\n\tthis.far = ( far !== undefined ) ? far : 2000;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create( THREE.Camera.prototype );\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function () {\r\n\r\n\tvar dx = ( this.right - this.left ) / ( 2 * this.zoom );\r\n\tvar dy = ( this.top - this.bottom ) / ( 2 * this.zoom );\r\n\tvar cx = ( this.right + this.left ) / 2;\r\n\tvar cy = ( this.top + this.bottom ) / 2;\r\n\r\n\tthis.projectionMatrix.makeOrthographic( cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far );\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.copy = function ( source ) {\r\n\t\r\n\tTHREE.Camera.prototype.copy.call( this, source );\r\n\t\r\n\tthis.left = source.left;\r\n\tthis.right = source.right;\r\n\tthis.top = source.top;\r\n\tthis.bottom = source.bottom;\r\n\tthis.near = source.near;\r\n\tthis.far = source.far;\r\n\t\r\n\tthis.zoom = source.zoom;\r\n\t\r\n\treturn this;\r\n\t\t\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.zoom = this.zoom;\r\n\tdata.object.left = this.left;\r\n\tdata.object.right = this.right;\r\n\tdata.object.top = this.top;\r\n\tdata.object.bottom = this.bottom;\r\n\tdata.object.near = this.near;\r\n\tdata.object.far = this.far;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function ( fov, aspect, near, far ) {\r\n\r\n\tTHREE.Camera.call( this );\r\n\r\n\tthis.type = 'PerspectiveCamera';\r\n\r\n\tthis.zoom = 1;\r\n\r\n\tthis.fov = fov !== undefined ? fov : 50;\r\n\tthis.aspect = aspect !== undefined ? aspect : 1;\r\n\tthis.near = near !== undefined ? near : 0.1;\r\n\tthis.far = far !== undefined ? far : 2000;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create( THREE.Camera.prototype );\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (full-frame) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function ( focalLength, frameHeight ) {\r\n\r\n\tif ( frameHeight === undefined ) frameHeight = 24;\r\n\r\n\tthis.fov = 2 * THREE.Math.radToDeg( Math.atan( frameHeight / ( focalLength * 2 ) ) );\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function ( fullWidth, fullHeight, x, y, width, height ) {\r\n\r\n\tthis.fullWidth = fullWidth;\r\n\tthis.fullHeight = fullHeight;\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\tthis.width = width;\r\n\tthis.height = height;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function () {\r\n\r\n\tvar fov = THREE.Math.radToDeg( 2 * Math.atan( Math.tan( THREE.Math.degToRad( this.fov ) * 0.5 ) / this.zoom ) );\r\n\r\n\tif ( this.fullWidth ) {\r\n\r\n\t\tvar aspect = this.fullWidth / this.fullHeight;\r\n\t\tvar top = Math.tan( THREE.Math.degToRad( fov * 0.5 ) ) * this.near;\r\n\t\tvar bottom = - top;\r\n\t\tvar left = aspect * bottom;\r\n\t\tvar right = aspect * top;\r\n\t\tvar width = Math.abs( right - left );\r\n\t\tvar height = Math.abs( top - bottom );\r\n\r\n\t\tthis.projectionMatrix.makeFrustum(\r\n\t\t\tleft + this.x * width / this.fullWidth,\r\n\t\t\tleft + ( this.x + this.width ) * width / this.fullWidth,\r\n\t\t\ttop - ( this.y + this.height ) * height / this.fullHeight,\r\n\t\t\ttop - this.y * height / this.fullHeight,\r\n\t\t\tthis.near,\r\n\t\t\tthis.far\r\n\t\t);\r\n\r\n\t} else {\r\n\r\n\t\tthis.projectionMatrix.makePerspective( fov, this.aspect, this.near, this.far );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.copy = function ( source ) {\r\n\t\r\n\tTHREE.Camera.prototype.copy.call( this, source );\r\n\t\r\n\tthis.fov = source.fov;\r\n\tthis.aspect = source.aspect;\r\n\tthis.near = source.near;\r\n\tthis.far = source.far;\r\n\t\r\n\tthis.zoom = source.zoom;\r\n\t\r\n\treturn this;\r\n\t\t\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.zoom = this.zoom;\r\n\tdata.object.fov = this.fov;\r\n\tdata.object.aspect = this.aspect;\r\n\tdata.object.near = this.near;\r\n\tdata.object.far = this.far;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function ( color ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Light';\r\n\r\n\tthis.color = new THREE.Color( color );\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.copy = function ( source ) {\r\n\t\r\n\tTHREE.Object3D.prototype.copy.call( this, source );\r\n\t\r\n\tthis.color.copy( source.color );\r\n\t\r\n\treturn this;\r\n\r\n};\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function ( color ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.color = this.color.getHex();\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function ( color, intensity ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'DirectionalLight';\r\n\r\n\tthis.position.set( 0, 1, 0 );\r\n\tthis.updateMatrix();\r\n\r\n\tthis.target = new THREE.Object3D();\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\r\n\tthis.castShadow = false;\r\n\tthis.onlyShadow = false;\r\n\r\n\tthis.shadowCameraNear = 50;\r\n\tthis.shadowCameraFar = 5000;\r\n\r\n\tthis.shadowCameraLeft = - 500;\r\n\tthis.shadowCameraRight = 500;\r\n\tthis.shadowCameraTop = 500;\r\n\tthis.shadowCameraBottom = - 500;\r\n\r\n\tthis.shadowCameraVisible = false;\r\n\r\n\tthis.shadowBias = 0;\r\n\tthis.shadowDarkness = 0.5;\r\n\r\n\tthis.shadowMapWidth = 512;\r\n\tthis.shadowMapHeight = 512;\r\n\r\n\tthis.shadowMap = null;\r\n\tthis.shadowMapSize = null;\r\n\tthis.shadowCamera = null;\r\n\tthis.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Light.prototype.copy.call( this, source );\r\n\r\n\tthis.intensity = source.intensity;\r\n\tthis.target = source.target.clone();\r\n\r\n\tthis.castShadow = source.castShadow;\r\n\tthis.onlyShadow = source.onlyShadow;\r\n\r\n\tthis.shadowCameraNear = source.shadowCameraNear;\r\n\tthis.shadowCameraFar = source.shadowCameraFar;\r\n\r\n\tthis.shadowCameraLeft = source.shadowCameraLeft;\r\n\tthis.shadowCameraRight = source.shadowCameraRight;\r\n\tthis.shadowCameraTop = source.shadowCameraTop;\r\n\tthis.shadowCameraBottom = source.shadowCameraBottom;\r\n\r\n\tthis.shadowCameraVisible = source.shadowCameraVisible;\r\n\r\n\tthis.shadowBias = source.shadowBias;\r\n\tthis.shadowDarkness = source.shadowDarkness;\r\n\r\n\tthis.shadowMapWidth = source.shadowMapWidth;\r\n\tthis.shadowMapHeight = source.shadowMapHeight;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.color = this.color.getHex();\r\n\tdata.object.intensity = this.intensity;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function ( skyColor, groundColor, intensity ) {\r\n\r\n\tTHREE.Light.call( this, skyColor );\r\n\r\n\tthis.type = 'HemisphereLight';\r\n\r\n\tthis.position.set( 0, 1, 0 );\r\n\tthis.updateMatrix();\r\n\r\n\tthis.groundColor = new THREE.Color( groundColor );\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Light.prototype.copy.call( this, source );\r\n\r\n\tthis.groundColor.copy( source.groundColor );\r\n\tthis.intensity = source.intensity;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.color = this.color.getHex();\r\n\tdata.object.groundColor = this.groundColor.getHex();\r\n\tdata.object.intensity = this.intensity;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function ( color, intensity, distance, decay ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'PointLight';\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\tthis.distance = ( distance !== undefined ) ? distance : 0;\r\n\tthis.decay = ( decay !== undefined ) ? decay : 1;\t// for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Light.prototype.copy.call( this, source );\r\n\r\n\tthis.intensity = source.intensity;\r\n\tthis.distance = source.distance;\r\n\tthis.decay = source.decay;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.color = this.color.getHex();\r\n\tdata.object.intensity = this.intensity;\r\n\tdata.object.distance = this.distance;\r\n\tdata.object.decay = this.decay;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function ( color, intensity, distance, angle, exponent, decay ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'SpotLight';\r\n\r\n\tthis.position.set( 0, 1, 0 );\r\n\tthis.updateMatrix();\r\n\r\n\tthis.target = new THREE.Object3D();\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\tthis.distance = ( distance !== undefined ) ? distance : 0;\r\n\tthis.angle = ( angle !== undefined ) ? angle : Math.PI / 3;\r\n\tthis.exponent = ( exponent !== undefined ) ? exponent : 10;\r\n\tthis.decay = ( decay !== undefined ) ? decay : 1;\t// for physically correct lights, should be 2.\r\n\r\n\tthis.castShadow = false;\r\n\tthis.onlyShadow = false;\r\n\r\n\tthis.shadowCameraNear = 50;\r\n\tthis.shadowCameraFar = 5000;\r\n\tthis.shadowCameraFov = 50;\r\n\r\n\tthis.shadowCameraVisible = false;\r\n\r\n\tthis.shadowBias = 0;\r\n\tthis.shadowDarkness = 0.5;\r\n\r\n\tthis.shadowMapWidth = 512;\r\n\tthis.shadowMapHeight = 512;\r\n\r\n\tthis.shadowMap = null;\r\n\tthis.shadowMapSize = null;\r\n\tthis.shadowCamera = null;\r\n\tthis.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Light.prototype.copy.call( this, source );\r\n\r\n\tthis.intensity = source.intensity;\r\n\tthis.distance = source.distance;\r\n\tthis.angle = source.angle;\r\n\tthis.exponent = source.exponent;\r\n\tthis.decay = source.decay;\r\n\r\n\tthis.target = source.target.clone();\r\n\r\n\tthis.castShadow = source.castShadow;\r\n\tthis.onlyShadow = source.onlyShadow;\r\n\r\n\tthis.shadowCameraNear = source.shadowCameraNear;\r\n\tthis.shadowCameraFar = source.shadowCameraFar;\r\n\tthis.shadowCameraFov = source.shadowCameraFov;\r\n\r\n\tthis.shadowCameraVisible = source.shadowCameraVisible;\r\n\r\n\tthis.shadowBias = source.shadowBias;\r\n\tthis.shadowDarkness = source.shadowDarkness;\r\n\r\n\tthis.shadowMapWidth = source.shadowMapWidth;\r\n\tthis.shadowMapHeight = source.shadowMapHeight;\r\n\r\n\treturn this;\r\n}\r\n\r\nTHREE.SpotLight.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.color = this.color.getHex();\r\n\tdata.object.intensity = this.intensity;\r\n\tdata.object.distance = this.distance;\r\n\tdata.object.angle = this.angle;\r\n\tdata.object.exponent = this.exponent;\r\n\tdata.object.decay = this.decay;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n\tenabled: false,\r\n\r\n\tfiles: {},\r\n\r\n\tadd: function ( key, file ) {\r\n\r\n\t\tif ( this.enabled === false ) return;\r\n\r\n\t\t// console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n\t\tthis.files[ key ] = file;\r\n\r\n\t},\r\n\r\n\tget: function ( key ) {\r\n\r\n\t\tif ( this.enabled === false ) return;\r\n\r\n\t\t// console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n\t\treturn this.files[ key ];\r\n\r\n\t},\r\n\r\n\tremove: function ( key ) {\r\n\r\n\t\tdelete this.files[ key ];\r\n\r\n\t},\r\n\r\n\tclear: function () {\r\n\r\n\t\tthis.files = {};\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function () {\r\n\r\n\tthis.onLoadStart = function () {};\r\n\tthis.onLoadProgress = function () {};\r\n\tthis.onLoadComplete = function () {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n\tconstructor: THREE.Loader,\r\n\r\n\tcrossOrigin: undefined,\r\n\r\n\textractUrlBase: function ( url ) {\r\n\r\n\t\tvar parts = url.split( '/' );\r\n\r\n\t\tif ( parts.length === 1 ) return './';\r\n\r\n\t\tparts.pop();\r\n\r\n\t\treturn parts.join( '/' ) + '/';\r\n\r\n\t},\r\n\r\n\tinitMaterials: function ( materials, texturePath, crossOrigin ) {\r\n\r\n\t\tvar array = [];\r\n\r\n\t\tfor ( var i = 0; i < materials.length; ++ i ) {\r\n\r\n\t\t\tarray[ i ] = this.createMaterial( materials[ i ], texturePath, crossOrigin );\r\n\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tcreateMaterial: ( function () {\r\n\r\n\t\tvar imageLoader;\r\n\r\n\t\treturn function createMaterial( m, texturePath, crossOrigin ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tif ( crossOrigin === undefined && scope.crossOrigin !== undefined ) crossOrigin = scope.crossOrigin;\r\n\r\n\t\t\tif ( imageLoader === undefined ) imageLoader = new THREE.ImageLoader();\r\n\r\n\t\t\tfunction nearest_pow2( n ) {\r\n\r\n\t\t\t\tvar l = Math.log( n ) / Math.LN2;\r\n\t\t\t\treturn Math.pow( 2, Math.round(  l ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction create_texture( where, name, sourceFile, repeat, offset, wrap, anisotropy ) {\r\n\r\n\t\t\t\tvar fullPath = texturePath + sourceFile;\r\n\r\n\t\t\t\tvar texture;\r\n\r\n\t\t\t\tvar loader = THREE.Loader.Handlers.get( fullPath );\r\n\r\n\t\t\t\tif ( loader !== null ) {\r\n\r\n\t\t\t\t\ttexture = loader.load( fullPath );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttexture = new THREE.Texture();\r\n\r\n\t\t\t\t\tloader = imageLoader;\r\n\t\t\t\t\tloader.setCrossOrigin( crossOrigin );\r\n\t\t\t\t\tloader.load( fullPath, function ( image ) {\r\n\r\n\t\t\t\t\t\tif ( THREE.Math.isPowerOfTwo( image.width ) === false ||\r\n\t\t\t\t\t\t\tTHREE.Math.isPowerOfTwo( image.height ) === false ) {\r\n\r\n\t\t\t\t\t\t\tvar width = nearest_pow2( image.width );\r\n\t\t\t\t\t\t\tvar height = nearest_pow2( image.height );\r\n\r\n\t\t\t\t\t\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\t\t\t\t\t\tcanvas.width = width;\r\n\t\t\t\t\t\t\tcanvas.height = height;\r\n\r\n\t\t\t\t\t\t\tvar context = canvas.getContext( '2d' );\r\n\t\t\t\t\t\t\tcontext.drawImage( image, 0, 0, width, height );\r\n\r\n\t\t\t\t\t\t\ttexture.image = canvas;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\ttexture.image = image;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.sourceFile = sourceFile;\r\n\r\n\t\t\t\tif ( repeat ) {\r\n\r\n\t\t\t\t\ttexture.repeat.set( repeat[ 0 ], repeat[ 1 ] );\r\n\r\n\t\t\t\t\tif ( repeat[ 0 ] !== 1 ) texture.wrapS = THREE.RepeatWrapping;\r\n\t\t\t\t\tif ( repeat[ 1 ] !== 1 ) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( offset ) {\r\n\r\n\t\t\t\t\ttexture.offset.set( offset[ 0 ], offset[ 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( wrap ) {\r\n\r\n\t\t\t\t\tvar wrapMap = {\r\n\t\t\t\t\t\t'repeat': THREE.RepeatWrapping,\r\n\t\t\t\t\t\t'mirror': THREE.MirroredRepeatWrapping\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif ( wrapMap[ wrap[ 0 ] ] !== undefined ) texture.wrapS = wrapMap[ wrap[ 0 ] ];\r\n\t\t\t\t\tif ( wrapMap[ wrap[ 1 ] ] !== undefined ) texture.wrapT = wrapMap[ wrap[ 1 ] ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( anisotropy ) {\r\n\r\n\t\t\t\t\ttexture.anisotropy = anisotropy;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhere[ name ] = texture;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction rgb2hex( rgb ) {\r\n\r\n\t\t\t\treturn ( rgb[ 0 ] * 255 << 16 ) + ( rgb[ 1 ] * 255 << 8 ) + rgb[ 2 ] * 255;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// defaults\r\n\r\n\t\t\tvar mtype = 'MeshLambertMaterial';\r\n\t\t\tvar mpars = {};\r\n\r\n\t\t\t// parameters from model file\r\n\r\n\t\t\tif ( m.shading ) {\r\n\r\n\t\t\t\tvar shading = m.shading.toLowerCase();\r\n\r\n\t\t\t\tif ( shading === 'phong' ) mtype = 'MeshPhongMaterial';\r\n\t\t\t\telse if ( shading === 'basic' ) mtype = 'MeshBasicMaterial';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.blending !== undefined && THREE[ m.blending ] !== undefined ) {\r\n\r\n\t\t\t\tmpars.blending = THREE[ m.blending ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.transparent !== undefined ) {\r\n\r\n\t\t\t\tmpars.transparent = m.transparent;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.opacity !== undefined && m.opacity < 1.0 ) {\r\n\r\n\t\t\t\tmpars.transparent = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.depthTest !== undefined ) {\r\n\r\n\t\t\t\tmpars.depthTest = m.depthTest;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.depthWrite !== undefined ) {\r\n\r\n\t\t\t\tmpars.depthWrite = m.depthWrite;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.visible !== undefined ) {\r\n\r\n\t\t\t\tmpars.visible = m.visible;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.flipSided !== undefined ) {\r\n\r\n\t\t\t\tmpars.side = THREE.BackSide;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.doubleSided !== undefined ) {\r\n\r\n\t\t\t\tmpars.side = THREE.DoubleSide;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.wireframe !== undefined ) {\r\n\r\n\t\t\t\tmpars.wireframe = m.wireframe;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.vertexColors !== undefined ) {\r\n\r\n\t\t\t\tif ( m.vertexColors === 'face' ) {\r\n\r\n\t\t\t\t\tmpars.vertexColors = THREE.FaceColors;\r\n\r\n\t\t\t\t} else if ( m.vertexColors ) {\r\n\r\n\t\t\t\t\tmpars.vertexColors = THREE.VertexColors;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// colors\r\n\r\n\t\t\tif ( m.colorDiffuse ) {\r\n\r\n\t\t\t\tmpars.color = rgb2hex( m.colorDiffuse );\r\n\r\n\t\t\t} else if ( m.DbgColor ) {\r\n\r\n\t\t\t\tmpars.color = m.DbgColor;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.colorEmissive ) {\r\n\r\n\t\t\t\tmpars.emissive = rgb2hex( m.colorEmissive );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( mtype === 'MeshPhongMaterial' ) {\r\n\r\n\t\t\t\tif ( m.colorSpecular ) {\r\n\r\n\t\t\t\t\tmpars.specular = rgb2hex( m.colorSpecular );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.specularCoef ) {\r\n\r\n\t\t\t\t\tmpars.shininess = m.specularCoef;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// modifiers\r\n\r\n\t\t\tif ( m.transparency !== undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Loader: transparency has been renamed to opacity' );\r\n\t\t\t\tm.opacity = m.transparency;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.opacity !== undefined ) {\r\n\r\n\t\t\t\tmpars.opacity = m.opacity;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// textures\r\n\r\n\t\t\tif ( texturePath ) {\r\n\r\n\t\t\t\tif ( m.mapDiffuse ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapLight ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapAO ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'aoMap', m.mapAO, m.mapAORepeat, m.mapAOOffset, m.mapAOWrap, m.mapAOAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapBump ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapNormal ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapSpecular ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( m.mapAlpha ) {\r\n\r\n\t\t\t\t\tcreate_texture( mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( m.mapBumpScale ) {\r\n\r\n\t\t\t\tmpars.bumpScale = m.mapBumpScale;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( m.mapNormalFactor ) {\r\n\r\n\t\t\t\tmpars.normalScale = new THREE.Vector2( m.mapNormalFactor, m.mapNormalFactor );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar material = new THREE[ mtype ]( mpars );\r\n\r\n\t\t\tif ( m.DbgName !== undefined ) material.name = m.DbgName;\r\n\r\n\t\t\treturn material;\r\n\r\n\t\t};\r\n\r\n\t} )()\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n\thandlers: [],\r\n\r\n\tadd: function ( regex, loader ) {\r\n\r\n\t\tthis.handlers.push( regex, loader );\r\n\r\n\t},\r\n\r\n\tget: function ( file ) {\r\n\r\n\t\tfor ( var i = 0, l = this.handlers.length; i < l; i += 2 ) {\r\n\r\n\t\t\tvar regex = this.handlers[ i ];\r\n\t\t\tvar loader  = this.handlers[ i + 1 ];\r\n\r\n\t\t\tif ( regex.test( file ) ) {\r\n\r\n\t\t\t\treturn loader;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n\tconstructor: THREE.XHRLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar cached = THREE.Cache.get( url );\r\n\r\n\t\tif ( cached !== undefined ) {\r\n\r\n\t\t\tif ( onLoad ) {\r\n\r\n\t\t\t\tsetTimeout( function () {\r\n\r\n\t\t\t\t\tonLoad( cached );\r\n\r\n\t\t\t\t}, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn cached;\r\n\r\n\t\t}\r\n\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open( 'GET', url, true );\r\n\r\n\t\trequest.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\tTHREE.Cache.add( url, this.response );\r\n\r\n\t\t\tif ( onLoad ) onLoad( this.response );\r\n\r\n\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( onProgress !== undefined ) {\r\n\r\n\t\t\trequest.addEventListener( 'progress', function ( event ) {\r\n\r\n\t\t\t\tonProgress( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\trequest.addEventListener( 'error', function ( event ) {\r\n\r\n\t\t\tif ( onError ) onError( event );\r\n\r\n\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( this.crossOrigin !== undefined ) request.crossOrigin = this.crossOrigin;\r\n\t\tif ( this.responseType !== undefined ) request.responseType = this.responseType;\r\n\t\tif ( this.withCredentials !== undefined ) request.withCredentials = this.withCredentials;\r\n\r\n\t\trequest.send( null );\r\n\r\n\t\tscope.manager.itemStart( url );\r\n\r\n\t\treturn request;\r\n\r\n\t},\r\n\r\n\tsetResponseType: function ( value ) {\r\n\r\n\t\tthis.responseType = value;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tsetWithCredentials: function ( value ) {\r\n\r\n\t\tthis.withCredentials = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n\tconstructor: THREE.ImageLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar cached = THREE.Cache.get( url );\r\n\r\n\t\tif ( cached !== undefined ) {\r\n\r\n\t\t\tif ( onLoad ) {\r\n\r\n\t\t\t\tsetTimeout( function () {\r\n\r\n\t\t\t\t\tonLoad( cached );\r\n\r\n\t\t\t\t}, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn cached;\r\n\r\n\t\t}\r\n\r\n\t\tvar image = document.createElement( 'img' );\r\n\r\n\t\timage.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\tTHREE.Cache.add( url, this );\r\n\r\n\t\t\tif ( onLoad ) onLoad( this );\r\n\r\n\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( onProgress !== undefined ) {\r\n\r\n\t\t\timage.addEventListener( 'progress', function ( event ) {\r\n\r\n\t\t\t\tonProgress( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\timage.addEventListener( 'error', function ( event ) {\r\n\r\n\t\t\tif ( onError ) onError( event );\r\n\r\n\t\t\tscope.manager.itemError( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( this.crossOrigin !== undefined ) image.crossOrigin = this.crossOrigin;\r\n\r\n\t\tscope.manager.itemStart( url );\r\n\r\n\t\timage.src = url;\r\n\r\n\t\treturn image;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function ( manager ) {\r\n\r\n\tif ( typeof manager === 'boolean' ) {\r\n\r\n\t\tconsole.warn( 'THREE.JSONLoader: showStatus parameter has been removed from constructor.' );\r\n\t\tmanager = undefined;\r\n\r\n\t}\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\tthis.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = {\r\n\r\n\tconstructor: THREE.JSONLoader,\r\n\r\n\t// Deprecated\r\n\t\r\n\tget statusDomElement () {\r\n\r\n\t\tif ( this._statusDomElement === undefined ) {\r\n\r\n\t\t\tthis._statusDomElement = document.createElement( 'div' );\r\n\r\n\t\t}\r\n\r\n\t\tconsole.warn( 'THREE.JSONLoader: .statusDomElement has been removed.' );\r\n\t\treturn this._statusDomElement;\r\n\r\n\t},\r\n\r\n\tload: function( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar texturePath = this.texturePath && ( typeof this.texturePath === \"string\" ) ? this.texturePath : THREE.Loader.prototype.extractUrlBase( url );\r\n\r\n\t\tvar loader = new THREE.XHRLoader( this.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.setWithCredentials( this.withCredentials );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tvar json = JSON.parse( text );\r\n\t\t\tvar metadata = json.metadata;\r\n\r\n\t\t\tif ( metadata !== undefined ) {\r\n\r\n\t\t\t\tif ( metadata.type === 'object' ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( metadata.type === 'scene' ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.JSONLoader: ' + url + ' should be loaded with THREE.SceneLoader instead.' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar object = scope.parse( json, texturePath );\r\n\t\t\tonLoad( object.geometry, object.materials );\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tsetTexturePath: function ( value ) {\r\n\r\n\t\tthis.texturePath = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json, texturePath ) {\r\n\r\n\t\tvar geometry = new THREE.Geometry(),\r\n\t\tscale = ( json.scale !== undefined ) ? 1.0 / json.scale : 1.0;\r\n\r\n\t\tparseModel( scale );\r\n\r\n\t\tparseSkin();\r\n\t\tparseMorphing( scale );\r\n\r\n\t\tgeometry.computeFaceNormals();\r\n\t\tgeometry.computeBoundingSphere();\r\n\r\n\t\tfunction parseModel( scale ) {\r\n\r\n\t\t\tfunction isBitSet( value, position ) {\r\n\r\n\t\t\t\treturn value & ( 1 << position );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar i, j, fi,\r\n\r\n\t\t\toffset, zLength,\r\n\r\n\t\tcolorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n\t\t\ttype,\r\n\t\t\tisQuad,\r\n\t\t\thasMaterial,\r\n\t\t\thasFaceVertexUv,\r\n\t\t\thasFaceNormal, hasFaceVertexNormal,\r\n\t\t\thasFaceColor, hasFaceVertexColor,\r\n\r\n\t\tvertex, face, faceA, faceB, hex, normal,\r\n\r\n\t\t\tuvLayer, uv, u, v,\r\n\r\n\t\t\tfaces = json.faces,\r\n\t\t\tvertices = json.vertices,\r\n\t\t\tnormals = json.normals,\r\n\t\t\tcolors = json.colors,\r\n\r\n\t\t\tnUvLayers = 0;\r\n\r\n\t\t\tif ( json.uvs !== undefined ) {\r\n\r\n\t\t\t\t// disregard empty arrays\r\n\r\n\t\t\t\tfor ( i = 0; i < json.uvs.length; i ++ ) {\r\n\r\n\t\t\t\t\tif ( json.uvs[ i ].length ) nUvLayers ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\t\tgeometry.faceVertexUvs[ i ] = [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\toffset = 0;\r\n\t\t\tzLength = vertices.length;\r\n\r\n\t\t\twhile ( offset < zLength ) {\r\n\r\n\t\t\t\tvertex = new THREE.Vector3();\r\n\r\n\t\t\t\tvertex.x = vertices[ offset ++ ] * scale;\r\n\t\t\t\tvertex.y = vertices[ offset ++ ] * scale;\r\n\t\t\t\tvertex.z = vertices[ offset ++ ] * scale;\r\n\r\n\t\t\t\tgeometry.vertices.push( vertex );\r\n\r\n\t\t\t}\r\n\r\n\t\t\toffset = 0;\r\n\t\t\tzLength = faces.length;\r\n\r\n\t\t\twhile ( offset < zLength ) {\r\n\r\n\t\t\t\ttype = faces[ offset ++ ];\r\n\r\n\r\n\t\t\t\tisQuad              = isBitSet( type, 0 );\r\n\t\t\t\thasMaterial         = isBitSet( type, 1 );\r\n\t\t\t\thasFaceVertexUv     = isBitSet( type, 3 );\r\n\t\t\t\thasFaceNormal       = isBitSet( type, 4 );\r\n\t\t\t\thasFaceVertexNormal = isBitSet( type, 5 );\r\n\t\t\t\thasFaceColor\t     = isBitSet( type, 6 );\r\n\t\t\t\thasFaceVertexColor  = isBitSet( type, 7 );\r\n\r\n\t\t\t\t// console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n\t\t\t\tif ( isQuad ) {\r\n\r\n\t\t\t\t\tfaceA = new THREE.Face3();\r\n\t\t\t\t\tfaceA.a = faces[ offset ];\r\n\t\t\t\t\tfaceA.b = faces[ offset + 1 ];\r\n\t\t\t\t\tfaceA.c = faces[ offset + 3 ];\r\n\r\n\t\t\t\t\tfaceB = new THREE.Face3();\r\n\t\t\t\t\tfaceB.a = faces[ offset + 1 ];\r\n\t\t\t\t\tfaceB.b = faces[ offset + 2 ];\r\n\t\t\t\t\tfaceB.c = faces[ offset + 3 ];\r\n\r\n\t\t\t\t\toffset += 4;\r\n\r\n\t\t\t\t\tif ( hasMaterial ) {\r\n\r\n\t\t\t\t\t\tmaterialIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\tfaceA.materialIndex = materialIndex;\r\n\t\t\t\t\t\tfaceB.materialIndex = materialIndex;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// to get face <=> uv index correspondence\r\n\r\n\t\t\t\t\tfi = geometry.faces.length;\r\n\r\n\t\t\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tuvLayer = json.uvs[ i ];\r\n\r\n\t\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ] = [];\r\n\t\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi + 1 ] = [];\r\n\r\n\t\t\t\t\t\t\tfor ( j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tuvIndex = faces[ offset ++ ];\r\n\r\n\t\t\t\t\t\t\t\tu = uvLayer[ uvIndex * 2 ];\r\n\t\t\t\t\t\t\t\tv = uvLayer[ uvIndex * 2 + 1 ];\r\n\r\n\t\t\t\t\t\t\t\tuv = new THREE.Vector2( u, v );\r\n\r\n\t\t\t\t\t\t\t\tif ( j !== 2 ) geometry.faceVertexUvs[ i ][ fi ].push( uv );\r\n\t\t\t\t\t\t\t\tif ( j !== 0 ) geometry.faceVertexUvs[ i ][ fi + 1 ].push( uv );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\tfaceA.normal.set(\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tfaceB.normal.copy( faceA.normal );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\t\tnormal = new THREE.Vector3(\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t\t);\r\n\r\n\r\n\t\t\t\t\t\t\tif ( i !== 2 ) faceA.vertexNormals.push( normal );\r\n\t\t\t\t\t\t\tif ( i !== 0 ) faceB.vertexNormals.push( normal );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\thex = colors[ colorIndex ];\r\n\r\n\t\t\t\t\t\tfaceA.color.setHex( hex );\r\n\t\t\t\t\t\tfaceB.color.setHex( hex );\r\n\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\t\thex = colors[ colorIndex ];\r\n\r\n\t\t\t\t\t\t\tif ( i !== 2 ) faceA.vertexColors.push( new THREE.Color( hex ) );\r\n\t\t\t\t\t\t\tif ( i !== 0 ) faceB.vertexColors.push( new THREE.Color( hex ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgeometry.faces.push( faceA );\r\n\t\t\t\t\tgeometry.faces.push( faceB );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tface = new THREE.Face3();\r\n\t\t\t\t\tface.a = faces[ offset ++ ];\r\n\t\t\t\t\tface.b = faces[ offset ++ ];\r\n\t\t\t\t\tface.c = faces[ offset ++ ];\r\n\r\n\t\t\t\t\tif ( hasMaterial ) {\r\n\r\n\t\t\t\t\t\tmaterialIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// to get face <=> uv index correspondence\r\n\r\n\t\t\t\t\tfi = geometry.faces.length;\r\n\r\n\t\t\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tuvLayer = json.uvs[ i ];\r\n\r\n\t\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ] = [];\r\n\r\n\t\t\t\t\t\t\tfor ( j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tuvIndex = faces[ offset ++ ];\r\n\r\n\t\t\t\t\t\t\t\tu = uvLayer[ uvIndex * 2 ];\r\n\t\t\t\t\t\t\t\tv = uvLayer[ uvIndex * 2 + 1 ];\r\n\r\n\t\t\t\t\t\t\t\tuv = new THREE.Vector2( u, v );\r\n\r\n\t\t\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ].push( uv );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\tface.normal.set(\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\t\tnormal = new THREE.Vector3(\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tface.vertexNormals.push( normal );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\tface.color.setHex( colors[ colorIndex ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\t\tface.vertexColors.push( new THREE.Color( colors[ colorIndex ] ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgeometry.faces.push( face );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tfunction parseSkin() {\r\n\r\n\t\t\tvar influencesPerVertex = ( json.influencesPerVertex !== undefined ) ? json.influencesPerVertex : 2;\r\n\r\n\t\t\tif ( json.skinWeights ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex ) {\r\n\r\n\t\t\t\t\tvar x =                               json.skinWeights[ i ];\r\n\t\t\t\t\tvar y = ( influencesPerVertex > 1 ) ? json.skinWeights[ i + 1 ] : 0;\r\n\t\t\t\t\tvar z = ( influencesPerVertex > 2 ) ? json.skinWeights[ i + 2 ] : 0;\r\n\t\t\t\t\tvar w = ( influencesPerVertex > 3 ) ? json.skinWeights[ i + 3 ] : 0;\r\n\r\n\t\t\t\t\tgeometry.skinWeights.push( new THREE.Vector4( x, y, z, w ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.skinIndices ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex ) {\r\n\r\n\t\t\t\t\tvar a =                               json.skinIndices[ i ];\r\n\t\t\t\t\tvar b = ( influencesPerVertex > 1 ) ? json.skinIndices[ i + 1 ] : 0;\r\n\t\t\t\t\tvar c = ( influencesPerVertex > 2 ) ? json.skinIndices[ i + 2 ] : 0;\r\n\t\t\t\t\tvar d = ( influencesPerVertex > 3 ) ? json.skinIndices[ i + 3 ] : 0;\r\n\r\n\t\t\t\t\tgeometry.skinIndices.push( new THREE.Vector4( a, b, c, d ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.bones = json.bones;\r\n\r\n\t\t\tif ( geometry.bones && geometry.bones.length > 0 && ( geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length ) ) {\r\n\r\n\t\t\t\tconsole.warn( 'When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n\t\t\t\t\tgeometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.' );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// could change this to json.animations[0] or remove completely\r\n\r\n\t\t\tgeometry.animation = json.animation;\r\n\t\t\tgeometry.animations = json.animations;\r\n\r\n\t\t};\r\n\r\n\t\tfunction parseMorphing( scale ) {\r\n\r\n\t\t\tif ( json.morphTargets !== undefined ) {\r\n\r\n\t\t\t\tvar i, l, v, vl, dstVertices, srcVertices;\r\n\r\n\t\t\t\tfor ( i = 0, l = json.morphTargets.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tgeometry.morphTargets[ i ] = {};\r\n\t\t\t\t\tgeometry.morphTargets[ i ].name = json.morphTargets[ i ].name;\r\n\t\t\t\t\tgeometry.morphTargets[ i ].vertices = [];\r\n\r\n\t\t\t\t\tdstVertices = geometry.morphTargets[ i ].vertices;\r\n\t\t\t\t\tsrcVertices = json.morphTargets[ i ].vertices;\r\n\r\n\t\t\t\t\tfor ( v = 0, vl = srcVertices.length; v < vl; v += 3 ) {\r\n\r\n\t\t\t\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\t\t\t\tvertex.x = srcVertices[ v ] * scale;\r\n\t\t\t\t\t\tvertex.y = srcVertices[ v + 1 ] * scale;\r\n\t\t\t\t\t\tvertex.z = srcVertices[ v + 2 ] * scale;\r\n\r\n\t\t\t\t\t\tdstVertices.push( vertex );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( json.morphColors !== undefined ) {\r\n\r\n\t\t\t\tvar i, l, c, cl, dstColors, srcColors, color;\r\n\r\n\t\t\t\tfor ( i = 0, l = json.morphColors.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tgeometry.morphColors[ i ] = {};\r\n\t\t\t\t\tgeometry.morphColors[ i ].name = json.morphColors[ i ].name;\r\n\t\t\t\t\tgeometry.morphColors[ i ].colors = [];\r\n\r\n\t\t\t\t\tdstColors = geometry.morphColors[ i ].colors;\r\n\t\t\t\t\tsrcColors = json.morphColors[ i ].colors;\r\n\r\n\t\t\t\t\tfor ( c = 0, cl = srcColors.length; c < cl; c += 3 ) {\r\n\r\n\t\t\t\t\t\tcolor = new THREE.Color( 0xffaa00 );\r\n\t\t\t\t\t\tcolor.setRGB( srcColors[ c ], srcColors[ c + 1 ], srcColors[ c + 2 ] );\r\n\t\t\t\t\t\tdstColors.push( color );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tif ( json.materials === undefined || json.materials.length === 0 ) {\r\n\r\n\t\t\treturn { geometry: geometry };\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar materials = THREE.Loader.prototype.initMaterials( json.materials, texturePath, this.crossOrigin );\r\n\r\n\t\t\treturn { geometry: geometry, materials: materials };\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function ( onLoad, onProgress, onError ) {\r\n\r\n\tvar scope = this;\r\n\r\n\tvar isLoading = false, itemsLoaded = 0, itemsTotal = 0;\r\n\r\n\tthis.onStart = undefined;\r\n\tthis.onLoad = onLoad;\r\n\tthis.onProgress = onProgress;\r\n\tthis.onError = onError;\r\n\r\n\tthis.itemStart = function ( url ) {\r\n\r\n\t\titemsTotal ++;\r\n\r\n\t\tif ( isLoading === false ) {\r\n\r\n\t\t\tif ( scope.onStart !== undefined ) {\r\n\r\n\t\t\t\tscope.onStart( url, itemsLoaded, itemsTotal );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tisLoading = true;\r\n\r\n\t};\r\n\r\n\tthis.itemEnd = function ( url ) {\r\n\r\n\t\titemsLoaded ++;\r\n\r\n\t\tif ( scope.onProgress !== undefined ) {\r\n\r\n\t\t\tscope.onProgress( url, itemsLoaded, itemsTotal );\r\n\r\n\t\t}\r\n\r\n\t\tif ( itemsLoaded === itemsTotal ) {\r\n\r\n\t\t\tisLoading = false;\r\n\r\n\t\t\tif ( scope.onLoad !== undefined ) {\r\n\r\n\t\t\t\tscope.onLoad();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.itemError = function ( url ) {\r\n\r\n\t\tif ( scope.onError !== undefined ) {\r\n\r\n\t\t\tscope.onError( url );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n\tconstructor: THREE.BufferGeometryLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tonLoad( scope.parse( JSON.parse( text ) ) );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json ) {\r\n\r\n\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\tvar index = json.data.index;\r\n\r\n\t\tif ( index !== undefined ) {\r\n\r\n\t\t\tvar typedArray = new self[ index.type ]( index.array );\r\n\t\t\tgeometry.setIndex( new THREE.BufferAttribute( typedArray, 1 ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar attributes = json.data.attributes;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ key ];\r\n\t\t\tvar typedArray = new self[ attribute.type ]( attribute.array );\r\n\r\n\t\t\tgeometry.addAttribute( key, new THREE.BufferAttribute( typedArray, attribute.itemSize ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar groups = json.data.groups || json.data.drawcalls || json.data.offsets;\r\n\r\n\t\tif ( groups !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, n = groups.length; i !== n; ++ i ) {\r\n\r\n\t\t\t\tvar group = groups[ i ];\r\n\r\n\t\t\t\tgeometry.addGroup( group.start, group.count );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar boundingSphere = json.data.boundingSphere;\r\n\r\n\t\tif ( boundingSphere !== undefined ) {\r\n\r\n\t\t\tvar center = new THREE.Vector3();\r\n\r\n\t\t\tif ( boundingSphere.center !== undefined ) {\r\n\r\n\t\t\t\tcenter.fromArray( boundingSphere.center );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.boundingSphere = new THREE.Sphere( center, boundingSphere.radius );\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\tthis.textures = {};\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n\tconstructor: THREE.MaterialLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tonLoad( scope.parse( JSON.parse( text ) ) );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tsetTextures: function ( value ) {\r\n\r\n\t\tthis.textures = value;\r\n\r\n\t},\r\n\r\n\tgetTexture: function ( name ) {\r\n\r\n\t\tvar textures = this.textures;\r\n\r\n\t\tif ( textures[ name ] === undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.MaterialLoader: Undefined texture', name );\r\n\r\n\t\t}\r\n\r\n\t\treturn textures[ name ];\r\n\r\n\t},\r\n\r\n\tparse: function ( json ) {\r\n\r\n\t\tvar material = new THREE[ json.type ];\r\n\t\tmaterial.uuid = json.uuid;\r\n\r\n\t\tif ( json.name !== undefined ) material.name = json.name;\r\n\t\tif ( json.color !== undefined ) material.color.setHex( json.color );\r\n\t\tif ( json.emissive !== undefined ) material.emissive.setHex( json.emissive );\r\n\t\tif ( json.specular !== undefined ) material.specular.setHex( json.specular );\r\n\t\tif ( json.shininess !== undefined ) material.shininess = json.shininess;\r\n\t\tif ( json.uniforms !== undefined ) material.uniforms = json.uniforms;\r\n\t\tif ( json.vertexShader !== undefined ) material.vertexShader = json.vertexShader;\r\n\t\tif ( json.fragmentShader !== undefined ) material.fragmentShader = json.fragmentShader;\r\n\t\tif ( json.vertexColors !== undefined ) material.vertexColors = json.vertexColors;\r\n\t\tif ( json.shading !== undefined ) material.shading = json.shading;\r\n\t\tif ( json.blending !== undefined ) material.blending = json.blending;\r\n\t\tif ( json.side !== undefined ) material.side = json.side;\r\n\t\tif ( json.opacity !== undefined ) material.opacity = json.opacity;\r\n\t\tif ( json.transparent !== undefined ) material.transparent = json.transparent;\r\n\t\tif ( json.alphaTest !== undefined ) material.alphaTest = json.alphaTest;\r\n\t\tif ( json.depthTest !== undefined ) material.depthTest = json.depthTest;\r\n\t\tif ( json.depthWrite !== undefined ) material.depthWrite = json.depthWrite;\r\n\t\tif ( json.wireframe !== undefined ) material.wireframe = json.wireframe;\r\n\t\tif ( json.wireframeLinewidth !== undefined ) material.wireframeLinewidth = json.wireframeLinewidth;\r\n\r\n\t\t// for PointsMaterial\r\n\t\tif ( json.size !== undefined ) material.size = json.size;\r\n\t\tif ( json.sizeAttenuation !== undefined ) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n\t\t// maps\r\n\r\n\t\tif ( json.map !== undefined ) material.map = this.getTexture( json.map );\r\n\r\n\t\tif ( json.alphaMap !== undefined ) {\r\n\r\n\t\t\tmaterial.alphaMap = this.getTexture( json.alphaMap );\r\n\t\t\tmaterial.transparent = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( json.bumpMap !== undefined ) material.bumpMap = this.getTexture( json.bumpMap );\r\n\t\tif ( json.bumpScale !== undefined ) material.bumpScale = json.bumpScale;\r\n\r\n\t\tif ( json.normalMap !== undefined ) material.normalMap = this.getTexture( json.normalMap );\r\n\t\tif ( json.normalScale )\tmaterial.normalScale = new THREE.Vector2( json.normalScale, json.normalScale );\r\n\r\n\t\tif ( json.displacementMap !== undefined ) material.displacementMap = this.getTexture( json.displacementMap );\r\n\t\tif ( json.displacementScale !== undefined ) material.displacementScale = json.displacementScale;\r\n\t\tif ( json.displacementBias !== undefined ) material.displacementBias = json.displacementBias;\r\n\r\n\t\tif ( json.specularMap !== undefined ) material.specularMap = this.getTexture( json.specularMap );\r\n\r\n\t\tif ( json.envMap !== undefined ) {\r\n\r\n\t\t\tmaterial.envMap = this.getTexture( json.envMap );\r\n\t\t\tmaterial.combine = THREE.MultiplyOperation;\r\n\r\n\t\t}\r\n\r\n\t\tif ( json.reflectivity ) material.reflectivity = json.reflectivity;\r\n\r\n\t\tif ( json.lightMap !== undefined ) material.lightMap = this.getTexture( json.lightMap );\r\n\t\tif ( json.lightMapIntensity !== undefined ) material.lightMapIntensity = json.lightMapIntensity;\r\n\r\n\t\tif ( json.aoMap !== undefined ) material.aoMap = this.getTexture( json.aoMap );\r\n\t\tif ( json.aoMapIntensity !== undefined ) material.aoMapIntensity = json.aoMapIntensity;\r\n\r\n\t\t// MeshFaceMaterial\r\n\r\n\t\tif ( json.materials !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.materials.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tmaterial.materials.push( this.parse( json.materials[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\tthis.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n\tconstructor: THREE.ObjectLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tif ( this.texturePath === '' ) {\r\n\r\n\t\t\tthis.texturePath = url.substring( 0, url.lastIndexOf( '/' ) + 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tscope.parse( JSON.parse( text ), onLoad );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetTexturePath: function ( value ) {\r\n\r\n\t\tthis.texturePath = value;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json, onLoad ) {\r\n\r\n\t\tvar geometries = this.parseGeometries( json.geometries );\r\n\r\n\t\tvar images = this.parseImages( json.images, function () {\r\n\r\n\t\t\tif ( onLoad !== undefined ) onLoad( object );\r\n\r\n\t\t} );\r\n\r\n\t\tvar textures  = this.parseTextures( json.textures, images );\r\n\t\tvar materials = this.parseMaterials( json.materials, textures );\r\n\t\tvar object = this.parseObject( json.object, geometries, materials );\r\n\r\n\t\tif ( json.images === undefined || json.images.length === 0 ) {\r\n\r\n\t\t\tif ( onLoad !== undefined ) onLoad( object );\r\n\r\n\t\t}\r\n\r\n\t\treturn object;\r\n\r\n\t},\r\n\r\n\tparseGeometries: function ( json ) {\r\n\r\n\t\tvar geometries = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tvar geometryLoader = new THREE.JSONLoader();\r\n\t\t\tvar bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar geometry;\r\n\t\t\t\tvar data = json[ i ];\r\n\r\n\t\t\t\tswitch ( data.type ) {\r\n\r\n\t\t\t\t\tcase 'PlaneGeometry':\r\n\t\t\t\t\tcase 'PlaneBufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE[ data.type ](\r\n\t\t\t\t\t\t\tdata.width,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'BoxGeometry':\r\n\t\t\t\t\tcase 'CubeGeometry': // backwards compatible\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.BoxGeometry(\r\n\t\t\t\t\t\t\tdata.width,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.depth,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.depthSegments\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'CircleBufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.CircleBufferGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.segments,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'CircleGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.CircleGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.segments,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'CylinderGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.CylinderGeometry(\r\n\t\t\t\t\t\t\tdata.radiusTop,\r\n\t\t\t\t\t\t\tdata.radiusBottom,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.openEnded,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'SphereGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.SphereGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.phiStart,\r\n\t\t\t\t\t\t\tdata.phiLength,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'SphereBufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.SphereBufferGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.phiStart,\r\n\t\t\t\t\t\t\tdata.phiLength,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'DodecahedronGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.DodecahedronGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'IcosahedronGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.IcosahedronGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'OctahedronGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.OctahedronGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TetrahedronGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TetrahedronGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'RingGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.RingGeometry(\r\n\t\t\t\t\t\t\tdata.innerRadius,\r\n\t\t\t\t\t\t\tdata.outerRadius,\r\n\t\t\t\t\t\t\tdata.thetaSegments,\r\n\t\t\t\t\t\t\tdata.phiSegments,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TorusGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TorusGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.tube,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.tubularSegments,\r\n\t\t\t\t\t\t\tdata.arc\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TorusKnotGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TorusKnotGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.tube,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.tubularSegments,\r\n\t\t\t\t\t\t\tdata.p,\r\n\t\t\t\t\t\t\tdata.q,\r\n\t\t\t\t\t\t\tdata.heightScale\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TextGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TextGeometry(\r\n\t\t\t\t\t\t\tdata.text,\r\n\t\t\t\t\t\t\tdata.data\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'BufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = bufferGeometryLoader.parse( data );\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Geometry':\r\n\r\n\t\t\t\t\t\tgeometry = geometryLoader.parse( data.data, this.texturePath ).geometry;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.ObjectLoader: Unsupported geometry type \"' + data.type + '\"' );\r\n\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.uuid = data.uuid;\r\n\r\n\t\t\t\tif ( data.name !== undefined ) geometry.name = data.name;\r\n\r\n\t\t\t\tgeometries[ data.uuid ] = geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn geometries;\r\n\r\n\t},\r\n\r\n\tparseMaterials: function ( json, textures ) {\r\n\r\n\t\tvar materials = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tvar loader = new THREE.MaterialLoader();\r\n\t\t\tloader.setTextures( textures );\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar material = loader.parse( json[ i ] );\r\n\t\t\t\tmaterials[ material.uuid ] = material;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn materials;\r\n\r\n\t},\r\n\r\n\tparseImages: function ( json, onLoad ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar images = {};\r\n\r\n\t\tfunction loadImage( url ) {\r\n\r\n\t\t\tscope.manager.itemStart( url );\r\n\r\n\t\t\treturn loader.load( url, function () {\r\n\r\n\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tif ( json !== undefined && json.length > 0 ) {\r\n\r\n\t\t\tvar manager = new THREE.LoadingManager( onLoad );\r\n\r\n\t\t\tvar loader = new THREE.ImageLoader( manager );\r\n\t\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar image = json[ i ];\r\n\t\t\t\tvar path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test( image.url ) ? image.url : scope.texturePath + image.url;\r\n\r\n\t\t\t\timages[ image.uuid ] = loadImage( path );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn images;\r\n\r\n\t},\r\n\r\n\tparseTextures: function ( json, images ) {\r\n\r\n\t\tfunction parseConstant( value ) {\r\n\r\n\t\t\tif ( typeof( value ) === 'number' ) return value;\r\n\r\n\t\t\tconsole.warn( 'THREE.ObjectLoader.parseTexture: Constant should be in numeric form.', value );\r\n\r\n\t\t\treturn THREE[ value ];\r\n\r\n\t\t}\r\n\r\n\t\tvar textures = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar data = json[ i ];\r\n\r\n\t\t\t\tif ( data.image === undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ObjectLoader: No \"image\" specified for', data.uuid );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( images[ data.image ] === undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ObjectLoader: Undefined image', data.image );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar texture = new THREE.Texture( images[ data.image ] );\r\n\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\ttexture.uuid = data.uuid;\r\n\r\n\t\t\t\tif ( data.name !== undefined ) texture.name = data.name;\r\n\t\t\t\tif ( data.mapping !== undefined ) texture.mapping = parseConstant( data.mapping );\r\n\t\t\t\tif ( data.offset !== undefined ) texture.offset = new THREE.Vector2( data.offset[ 0 ], data.offset[ 1 ] );\r\n\t\t\t\tif ( data.repeat !== undefined ) texture.repeat = new THREE.Vector2( data.repeat[ 0 ], data.repeat[ 1 ] );\r\n\t\t\t\tif ( data.minFilter !== undefined ) texture.minFilter = parseConstant( data.minFilter );\r\n\t\t\t\tif ( data.magFilter !== undefined ) texture.magFilter = parseConstant( data.magFilter );\r\n\t\t\t\tif ( data.anisotropy !== undefined ) texture.anisotropy = data.anisotropy;\r\n\t\t\t\tif ( Array.isArray( data.wrap ) ) {\r\n\r\n\t\t\t\t\ttexture.wrapS = parseConstant( data.wrap[ 0 ] );\r\n\t\t\t\t\ttexture.wrapT = parseConstant( data.wrap[ 1 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextures[ data.uuid ] = texture;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn textures;\r\n\r\n\t},\r\n\r\n\tparseObject: function () {\r\n\r\n\t\tvar matrix = new THREE.Matrix4();\r\n\r\n\t\treturn function ( data, geometries, materials ) {\r\n\r\n\t\t\tvar object;\r\n\r\n\t\t\tvar getGeometry = function ( name ) {\r\n\r\n\t\t\t\tif ( geometries[ name ] === undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ObjectLoader: Undefined geometry', name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn geometries[ name ];\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar getMaterial = function ( name ) {\r\n\r\n\t\t\t\tif ( materials[ name ] === undefined ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.ObjectLoader: Undefined material', name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn materials[ name ];\r\n\r\n\t\t\t};\r\n\r\n\t\t\tswitch ( data.type ) {\r\n\r\n\t\t\t\tcase 'Scene':\r\n\r\n\t\t\t\t\tobject = new THREE.Scene();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PerspectiveCamera':\r\n\r\n\t\t\t\t\tobject = new THREE.PerspectiveCamera( data.fov, data.aspect, data.near, data.far );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'OrthographicCamera':\r\n\r\n\t\t\t\t\tobject = new THREE.OrthographicCamera( data.left, data.right, data.top, data.bottom, data.near, data.far );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AmbientLight':\r\n\r\n\t\t\t\t\tobject = new THREE.AmbientLight( data.color );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'DirectionalLight':\r\n\r\n\t\t\t\t\tobject = new THREE.DirectionalLight( data.color, data.intensity );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointLight':\r\n\r\n\t\t\t\t\tobject = new THREE.PointLight( data.color, data.intensity, data.distance, data.decay );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'SpotLight':\r\n\r\n\t\t\t\t\tobject = new THREE.SpotLight( data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'HemisphereLight':\r\n\r\n\t\t\t\t\tobject = new THREE.HemisphereLight( data.color, data.groundColor, data.intensity );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Mesh':\r\n\r\n\t\t\t\t\tobject = new THREE.Mesh( getGeometry( data.geometry ), getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'LOD':\r\n\r\n\t\t\t\t\tobject = new THREE.LOD();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Line':\r\n\r\n\t\t\t\t\tobject = new THREE.Line( getGeometry( data.geometry ), getMaterial( data.material ), data.mode );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointCloud':\r\n\t\t\t\tcase 'Points':\r\n\r\n\t\t\t\t\tobject = new THREE.Points( getGeometry( data.geometry ), getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Sprite':\r\n\r\n\t\t\t\t\tobject = new THREE.Sprite( getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Group':\r\n\r\n\t\t\t\t\tobject = new THREE.Group();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tobject = new THREE.Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.uuid = data.uuid;\r\n\r\n\t\t\tif ( data.name !== undefined ) object.name = data.name;\r\n\t\t\tif ( data.matrix !== undefined ) {\r\n\r\n\t\t\t\tmatrix.fromArray( data.matrix );\r\n\t\t\t\tmatrix.decompose( object.position, object.quaternion, object.scale );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( data.position !== undefined ) object.position.fromArray( data.position );\r\n\t\t\t\tif ( data.rotation !== undefined ) object.rotation.fromArray( data.rotation );\r\n\t\t\t\tif ( data.scale !== undefined ) object.scale.fromArray( data.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.castShadow !== undefined ) object.castShadow = data.castShadow;\r\n\t\t\tif ( data.receiveShadow !== undefined ) object.receiveShadow = data.receiveShadow;\r\n\r\n\t\t\tif ( data.visible !== undefined ) object.visible = data.visible;\r\n\t\t\tif ( data.userData !== undefined ) object.userData = data.userData;\r\n\r\n\t\t\tif ( data.children !== undefined ) {\r\n\r\n\t\t\t\tfor ( var child in data.children ) {\r\n\r\n\t\t\t\t\tobject.add( this.parseObject( data.children[ child ], geometries, materials ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.type === 'LOD' ) {\r\n\r\n\t\t\t\tvar levels = data.levels;\r\n\r\n\t\t\t\tfor ( var l = 0; l < levels.length; l ++ ) {\r\n\r\n\t\t\t\t\tvar level = levels[ l ];\r\n\t\t\t\t\tvar child = object.getObjectByProperty( 'uuid', level.object );\r\n\r\n\t\t\t\t\tif ( child !== undefined ) {\r\n\r\n\t\t\t\t\t\tobject.addLevel( child, level.distance );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn object;\r\n\r\n\t\t}\r\n\r\n\t}()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.TextureLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.ImageLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( image ) {\r\n\r\n\t\t\tvar texture = new THREE.Texture( image );\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad !== undefined ) {\r\n\r\n\t\t\t\tonLoad( texture );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\t// override in sub classes\r\n\tthis._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.BinaryTextureLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar texture = new THREE.DataTexture();\r\n\r\n\t\tvar loader = new THREE.XHRLoader( this.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\tvar texData = scope._parser( buffer );\r\n\r\n\t\t\tif ( ! texData ) return;\r\n\r\n\t\t\tif ( undefined !== texData.image ) {\r\n\r\n\t\t\t\ttexture.image = texData.image;\r\n\r\n\t\t\t} else if ( undefined !== texData.data ) {\r\n\r\n\t\t\t\ttexture.image.width = texData.width;\r\n\t\t\t\ttexture.image.height = texData.height;\r\n\t\t\t\ttexture.image.data = texData.data;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n\t\t\ttexture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\t\t\ttexture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n\t\t\ttexture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\t\t\ttexture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n\t\t\tif ( undefined !== texData.format ) {\r\n\r\n\t\t\t\ttexture.format = texData.format;\r\n\r\n\t\t\t}\r\n\t\t\tif ( undefined !== texData.type ) {\r\n\r\n\t\t\t\ttexture.type = texData.type;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( undefined !== texData.mipmaps ) {\r\n\r\n\t\t\t\ttexture.mipmaps = texData.mipmaps;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( 1 === texData.mipmapCount ) {\r\n\r\n\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad ) onLoad( texture, texData );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n\t// override in sub classes\r\n\tthis._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.CompressedTextureLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar images = [];\r\n\r\n\t\tvar texture = new THREE.CompressedTexture();\r\n\t\ttexture.image = images;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( this.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( Array.isArray( url ) ) {\r\n\r\n\t\t\tvar loaded = 0;\r\n\r\n\t\t\tvar loadTexture = function ( i ) {\r\n\r\n\t\t\t\tloader.load( url[ i ], function ( buffer ) {\r\n\r\n\t\t\t\t\tvar texDatas = scope._parser( buffer, true );\r\n\r\n\t\t\t\t\timages[ i ] = {\r\n\t\t\t\t\t\twidth: texDatas.width,\r\n\t\t\t\t\t\theight: texDatas.height,\r\n\t\t\t\t\t\tformat: texDatas.format,\r\n\t\t\t\t\t\tmipmaps: texDatas.mipmaps\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tloaded += 1;\r\n\r\n\t\t\t\t\tif ( loaded === 6 ) {\r\n\r\n\t\t\t\t\t\tif ( texDatas.mipmapCount === 1 )\r\n \t\t\t\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\t\t\ttexture.format = texDatas.format;\r\n\t\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, onProgress, onError );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, il = url.length; i < il; ++ i ) {\r\n\r\n\t\t\t\tloadTexture( i );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// compressed cubemap texture stored in a single DDS file\r\n\r\n\t\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\t\tvar texDatas = scope._parser( buffer, true );\r\n\r\n\t\t\t\tif ( texDatas.isCubemap ) {\r\n\r\n\t\t\t\t\tvar faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n\t\t\t\t\tfor ( var f = 0; f < faces; f ++ ) {\r\n\r\n\t\t\t\t\t\timages[ f ] = { mipmaps : [] };\r\n\r\n\t\t\t\t\t\tfor ( var i = 0; i < texDatas.mipmapCount; i ++ ) {\r\n\r\n\t\t\t\t\t\t\timages[ f ].mipmaps.push( texDatas.mipmaps[ f * texDatas.mipmapCount + i ] );\r\n\t\t\t\t\t\t\timages[ f ].format = texDatas.format;\r\n\t\t\t\t\t\t\timages[ f ].width = texDatas.width;\r\n\t\t\t\t\t\t\timages[ f ].height = texDatas.height;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttexture.image.width = texDatas.width;\r\n\t\t\t\t\ttexture.image.height = texDatas.height;\r\n\t\t\t\t\ttexture.mipmaps = texDatas.mipmaps;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( texDatas.mipmapCount === 1 ) {\r\n\r\n\t\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.format = texDatas.format;\r\n\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t}, onProgress, onError );\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.MaterialIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Material';\r\n\r\n\tthis.side = THREE.FrontSide;\r\n\r\n\tthis.opacity = 1;\r\n\tthis.transparent = false;\r\n\r\n\tthis.blending = THREE.NormalBlending;\r\n\r\n\tthis.blendSrc = THREE.SrcAlphaFactor;\r\n\tthis.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n\tthis.blendEquation = THREE.AddEquation;\r\n\tthis.blendSrcAlpha = null;\r\n\tthis.blendDstAlpha = null;\r\n\tthis.blendEquationAlpha = null;\r\n\r\n\tthis.depthFunc = THREE.LessEqualDepth;\r\n\tthis.depthTest = true;\r\n\tthis.depthWrite = true;\r\n\r\n\tthis.colorWrite = true;\r\n\r\n\tthis.precision = null; // override the renderer's default precision for this material\r\n\r\n\tthis.polygonOffset = false;\r\n\tthis.polygonOffsetFactor = 0;\r\n\tthis.polygonOffsetUnits = 0;\r\n\r\n\tthis.alphaTest = 0;\r\n\r\n\tthis.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n\tthis.visible = true;\r\n\r\n\tthis._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n\tconstructor: THREE.Material,\r\n\r\n\tget needsUpdate () {\r\n\r\n\t\treturn this._needsUpdate;\r\n\r\n\t},\r\n\r\n\tset needsUpdate ( value ) {\r\n\r\n\t\tif ( value === true ) this.update();\r\n\r\n\t\tthis._needsUpdate = value;\r\n\r\n\t},\r\n\r\n\tsetValues: function ( values ) {\r\n\r\n\t\tif ( values === undefined ) return;\r\n\r\n\t\tfor ( var key in values ) {\r\n\r\n\t\t\tvar newValue = values[ key ];\r\n\r\n\t\t\tif ( newValue === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( \"THREE.Material: '\" + key + \"' parameter is undefined.\" );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar currentValue = this[ key ];\r\n\r\n\t\t\tif ( currentValue === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( \"THREE.\" + this.type + \": '\" + key + \"' is not a property of this material.\" );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( currentValue instanceof THREE.Color ) {\r\n\r\n\t\t\t\tcurrentValue.set( newValue );\r\n\r\n\t\t\t} else if ( currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3 ) {\r\n\r\n\t\t\t\tcurrentValue.copy( newValue );\r\n\r\n\t\t\t} else if ( key === 'overdraw' ) {\r\n\r\n\t\t\t\t// ensure overdraw is backwards-compatible with legacy boolean type\r\n\t\t\t\tthis[ key ] = Number( newValue );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis[ key ] = newValue;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttoJSON: function ( meta ) {\r\n\r\n\t\tvar data = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Material',\r\n\t\t\t\tgenerator: 'Material.toJSON'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// standard Material serialization\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\r\n\t\tif ( this.color instanceof THREE.Color ) data.color = this.color.getHex();\r\n\t\tif ( this.emissive instanceof THREE.Color ) data.emissive = this.emissive.getHex();\r\n\t\tif ( this.specular instanceof THREE.Color ) data.specular = this.specular.getHex();\r\n\t\tif ( this.shininess !== undefined ) data.shininess = this.shininess;\r\n\r\n\t\tif ( this.map instanceof THREE.Texture ) data.map = this.map.toJSON( meta ).uuid;\r\n\t\tif ( this.alphaMap instanceof THREE.Texture ) data.alphaMap = this.alphaMap.toJSON( meta ).uuid;\r\n\t\tif ( this.lightMap instanceof THREE.Texture ) data.lightMap = this.lightMap.toJSON( meta ).uuid;\r\n\t\tif ( this.bumpMap instanceof THREE.Texture ) {\r\n\r\n\t\t\tdata.bumpMap = this.bumpMap.toJSON( meta ).uuid;\r\n\t\t\tdata.bumpScale = this.bumpScale;\r\n\r\n\t\t}\r\n\t\tif ( this.normalMap instanceof THREE.Texture ) {\r\n\r\n\t\t\tdata.normalMap = this.normalMap.toJSON( meta ).uuid;\r\n\t\t\tdata.normalScale = this.normalScale; // Removed for now, causes issue in editor ui.js\r\n\r\n\t\t}\r\n\t\tif ( this.displacementMap instanceof THREE.Texture ) {\r\n\r\n\t\t\tdata.displacementMap = this.displacementMap.toJSON( meta ).uuid;\r\n\t\t\tdata.displacementScale = this.displacementScale;\r\n\t\t\tdata.displacementBias = this.displacementBias;\r\n\r\n\t\t}\r\n\t\tif ( this.specularMap instanceof THREE.Texture ) data.specularMap = this.specularMap.toJSON( meta ).uuid;\r\n\t\tif ( this.envMap instanceof THREE.Texture ) {\r\n\r\n\t\t\tdata.envMap = this.envMap.toJSON( meta ).uuid;\r\n\t\t\tdata.reflectivity = this.reflectivity; // Scale behind envMap\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.size !== undefined ) data.size = this.size;\r\n\t\tif ( this.sizeAttenuation !== undefined ) data.sizeAttenuation = this.sizeAttenuation;\r\n\r\n\t\tif ( this.vertexColors !== undefined && this.vertexColors !== THREE.NoColors ) data.vertexColors = this.vertexColors;\r\n\t\tif ( this.shading !== undefined && this.shading !== THREE.SmoothShading ) data.shading = this.shading;\r\n\t\tif ( this.blending !== undefined && this.blending !== THREE.NormalBlending ) data.blending = this.blending;\r\n\t\tif ( this.side !== undefined && this.side !== THREE.FrontSide ) data.side = this.side;\r\n\r\n\t\tif ( this.opacity < 1 ) data.opacity = this.opacity;\r\n\t\tif ( this.transparent === true ) data.transparent = this.transparent;\r\n\t\tif ( this.alphaTest > 0 ) data.alphaTest = this.alphaTest;\r\n\t\tif ( this.wireframe === true ) data.wireframe = this.wireframe;\r\n\t\tif ( this.wireframeLinewidth > 1 ) data.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\tthis.side = source.side;\r\n\r\n\t\tthis.opacity = source.opacity;\r\n\t\tthis.transparent = source.transparent;\r\n\r\n\t\tthis.blending = source.blending;\r\n\r\n\t\tthis.blendSrc = source.blendSrc;\r\n\t\tthis.blendDst = source.blendDst;\r\n\t\tthis.blendEquation = source.blendEquation;\r\n\t\tthis.blendSrcAlpha = source.blendSrcAlpha;\r\n\t\tthis.blendDstAlpha = source.blendDstAlpha;\r\n\t\tthis.blendEquationAlpha = source.blendEquationAlpha;\r\n\r\n\t\tthis.depthFunc = source.depthFunc;\r\n\t\tthis.depthTest = source.depthTest;\r\n\t\tthis.depthWrite = source.depthWrite;\r\n\r\n\t\tthis.precision = source.precision;\r\n\r\n\t\tthis.polygonOffset = source.polygonOffset;\r\n\t\tthis.polygonOffsetFactor = source.polygonOffsetFactor;\r\n\t\tthis.polygonOffsetUnits = source.polygonOffsetUnits;\r\n\r\n\t\tthis.alphaTest = source.alphaTest;\r\n\r\n\t\tthis.overdraw = source.overdraw;\r\n\r\n\t\tthis.visible = source.visible;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tupdate: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'update' } );\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t},\r\n\r\n\t// Deprecated\r\n\r\n\tget wrapAround () {\r\n\r\n\t\tconsole.warn( 'THREE.' + this.type + ': .wrapAround has been removed.' );\r\n\r\n\t},\r\n\r\n\tset wrapAround ( boolean ) {\r\n\r\n\t\tconsole.warn( 'THREE.' + this.type + ': .wrapAround has been removed.' );\r\n\r\n\t},\r\n\r\n\tget wrapRGB () {\r\n\r\n\t\tconsole.warn( 'THREE.' + this.type + ': .wrapRGB has been removed.' );\r\n\t\treturn new THREE.Color();\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Material.prototype );\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'LineBasicMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.linewidth = 1;\r\n\tthis.linecap = 'round';\r\n\tthis.linejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\r\n\tthis.linewidth = source.linewidth;\r\n\tthis.linecap = source.linecap;\r\n\tthis.linejoin = source.linejoin;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'LineDashedMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.linewidth = 1;\r\n\r\n\tthis.scale = 1;\r\n\tthis.dashSize = 3;\r\n\tthis.gapSize = 1;\r\n\r\n\tthis.vertexColors = false;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\t\r\n\tthis.linewidth = source.linewidth;\r\n\r\n\tthis.scale = source.scale;\r\n\tthis.dashSize = source.dashSize;\r\n\tthis.gapSize = source.gapSize;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshBasicMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // emissive\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.aoMap = null;\r\n\tthis.aoMapIntensity = 1.0;\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.copy = function ( source ) {\r\n\t\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\r\n\tthis.map = source.map;\r\n\r\n\tthis.aoMap = source.aoMap;\r\n\tthis.aoMapIntensity = source.aoMapIntensity;\r\n\r\n\tthis.specularMap = source.specularMap;\r\n\r\n\tthis.alphaMap = source.alphaMap;\r\n\r\n\tthis.envMap = source.envMap;\r\n\tthis.combine = source.combine;\r\n\tthis.reflectivity = source.reflectivity;\r\n\tthis.refractionRatio = source.refractionRatio;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\tthis.shading = source.shading;\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\tthis.wireframeLinecap = source.wireframeLinecap;\r\n\tthis.wireframeLinejoin = source.wireframeLinejoin;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.skinning = source.skinning;\r\n\tthis.morphTargets = source.morphTargets;\r\n\t\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshLambertMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // diffuse\r\n\tthis.emissive = new THREE.Color( 0x000000 );\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\tthis.morphNormals = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\tthis.emissive.copy( source.emissive );\r\n\r\n\tthis.map = source.map;\r\n\r\n\tthis.specularMap = source.specularMap;\r\n\r\n\tthis.alphaMap = source.alphaMap;\r\n\r\n\tthis.envMap = source.envMap;\r\n\tthis.combine = source.combine;\r\n\tthis.reflectivity = source.reflectivity;\r\n\tthis.refractionRatio = source.refractionRatio;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\tthis.wireframeLinecap = source.wireframeLinecap;\r\n\tthis.wireframeLinejoin = source.wireframeLinejoin;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.skinning = source.skinning;\r\n\tthis.morphTargets = source.morphTargets;\r\n\tthis.morphNormals = source.morphNormals;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *  lightMapIntensity: <float>\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  emissiveMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  displacementMap: new THREE.Texture( <Image> ),\r\n *  displacementScale: <float>,\r\n *  displacementBias: <float>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshPhongMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // diffuse\r\n\tthis.emissive = new THREE.Color( 0x000000 );\r\n\tthis.specular = new THREE.Color( 0x111111 );\r\n\tthis.shininess = 30;\r\n\r\n\tthis.metal = false;\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.lightMap = null;\r\n\tthis.lightMapIntensity = 1.0;\r\n\r\n\tthis.aoMap = null;\r\n\tthis.aoMapIntensity = 1.0;\r\n\r\n\tthis.emissiveMap = null;\r\n\r\n\tthis.bumpMap = null;\r\n\tthis.bumpScale = 1;\r\n\r\n\tthis.normalMap = null;\r\n\tthis.normalScale = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.displacementMap = null;\r\n\tthis.displacementScale = 1;\r\n\tthis.displacementBias = 0;\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\tthis.morphNormals = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\tthis.emissive.copy( source.emissive );\r\n\tthis.specular.copy( source.specular );\r\n\tthis.shininess = source.shininess;\r\n\r\n\tthis.metal = source.metal;\r\n\r\n\tthis.map = source.map;\r\n\r\n\tthis.lightMap = source.lightMap;\r\n\tthis.lightMapIntensity = source.lightMapIntensity;\r\n\r\n\tthis.aoMap = source.aoMap;\r\n\tthis.aoMapIntensity = source.aoMapIntensity;\r\n\r\n\tthis.emissiveMap = source.emissiveMap;\r\n\r\n\tthis.bumpMap = source.bumpMap;\r\n\tthis.bumpScale = source.bumpScale;\r\n\r\n\tthis.normalMap = source.normalMap;\r\n\tthis.normalScale.copy( source.normalScale );\r\n\r\n\tthis.displacementMap = source.displacementMap;\r\n\tthis.displacementScale = source.displacementScale;\r\n\tthis.displacementBias = source.displacementBias;\r\n\r\n\tthis.specularMap = source.specularMap;\r\n\r\n\tthis.alphaMap = source.alphaMap;\r\n\r\n\tthis.envMap = source.envMap;\r\n\tthis.combine = source.combine;\r\n\tthis.reflectivity = source.reflectivity;\r\n\tthis.refractionRatio = source.refractionRatio;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\tthis.shading = source.shading;\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\tthis.wireframeLinecap = source.wireframeLinecap;\r\n\tthis.wireframeLinejoin = source.wireframeLinejoin;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.skinning = source.skinning;\r\n\tthis.morphTargets = source.morphTargets;\r\n\tthis.morphNormals = source.morphNormals;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshDepthMaterial';\r\n\r\n\tthis.morphTargets = false;\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this, parameters );\r\n\r\n\tthis.type = 'MeshNormalMaterial';\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.morphTargets = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/materials/MultiMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MultiMaterial = function ( materials ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.type = 'MultiMaterial';\r\n\r\n\tthis.materials = materials instanceof Array ? materials : [];\r\n\r\n\tthis.visible = true;\r\n\r\n};\r\n\r\nTHREE.MultiMaterial.prototype = {\r\n\r\n\tconstructor: THREE.MultiMaterial,\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.2,\r\n\t\t\t\ttype: 'material',\r\n\t\t\t\tgenerator: 'MaterialExporter'\r\n\t\t\t},\r\n\t\t\tuuid: this.uuid,\r\n\t\t\ttype: this.type,\r\n\t\t\tmaterials: []\r\n\t\t};\r\n\r\n\t\tfor ( var i = 0, l = this.materials.length; i < l; i ++ ) {\r\n\r\n\t\t\toutput.materials.push( this.materials[ i ].toJSON() );\r\n\r\n\t\t}\r\n\r\n\t\toutput.visible = this.visible;\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar material = new this.constructor();\r\n\r\n\t\tfor ( var i = 0; i < this.materials.length; i ++ ) {\r\n\r\n\t\t\tmaterial.materials.push( this.materials[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\tmaterial.visible = this.visible;\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.MeshFaceMaterial = THREE.MultiMaterial;\r\n\r\n// File:src/materials/PointsMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointsMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'PointsMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.size = 1;\r\n\tthis.sizeAttenuation = true;\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.PointsMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.PointsMaterial.prototype.constructor = THREE.PointsMaterial;\r\n\r\nTHREE.PointsMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\r\n\tthis.map = source.map;\r\n\r\n\tthis.size = source.size;\r\n\tthis.sizeAttenuation = source.sizeAttenuation;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.PointCloudMaterial = function ( parameters ) {\r\n\r\n\tconsole.warn( 'THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.' );\r\n\treturn new THREE.PointsMaterial( parameters );\r\n\r\n};\r\n\r\nTHREE.ParticleBasicMaterial = function ( parameters ) {\r\n\r\n\tconsole.warn( 'THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.' );\r\n\treturn new THREE.PointsMaterial( parameters );\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function ( parameters ) {\r\n\r\n\tconsole.warn( 'THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.' );\r\n\treturn new THREE.PointsMaterial( parameters );\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'ShaderMaterial';\r\n\r\n\tthis.defines = {};\r\n\tthis.uniforms = {};\r\n\r\n\tthis.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n\tthis.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.linewidth = 1;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.fog = false; // set to use scene fog\r\n\r\n\tthis.lights = false; // set to use scene lights\r\n\r\n\tthis.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n\tthis.skinning = false; // set to use skinning attribute streams\r\n\r\n\tthis.morphTargets = false; // set to use morph targets\r\n\tthis.morphNormals = false; // set to use morph normals\r\n\r\n\tthis.derivatives = false; // set to use derivatives\r\n\r\n\t// When rendered geometry doesn't include these attributes but the material does,\r\n\t// use these default values in WebGL. This avoids errors when buffer data is missing.\r\n\tthis.defaultAttributeValues = {\r\n\t\t'color': [ 1, 1, 1 ],\r\n\t\t'uv': [ 0, 0 ],\r\n\t\t'uv2': [ 0, 0 ]\r\n\t};\r\n\r\n\tthis.index0AttributeName = undefined;\r\n\r\n\tif ( parameters !== undefined ) {\r\n\r\n\t\tif ( parameters.attributes !== undefined ) {\r\n\r\n\t\t\tconsole.error( 'THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.fragmentShader = source.fragmentShader;\r\n\tthis.vertexShader = source.vertexShader;\r\n\r\n\tthis.uniforms = THREE.UniformsUtils.clone( source.uniforms );\r\n\r\n\tthis.attributes = source.attributes;\r\n\tthis.defines = source.defines;\r\n\r\n\tthis.shading = source.shading;\r\n\r\n\tthis.wireframe = source.wireframe;\r\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\tthis.lights = source.lights;\r\n\r\n\tthis.vertexColors = source.vertexColors;\r\n\r\n\tthis.skinning = source.skinning;\r\n\r\n\tthis.morphTargets = source.morphTargets;\r\n\tthis.morphNormals = source.morphNormals;\r\n\r\n\tthis.derivatives = source.derivatives;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Material.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.uniforms = this.uniforms;\r\n\tdata.attributes = this.attributes;\r\n\tdata.vertexShader = this.vertexShader;\r\n\tdata.fragmentShader = this.fragmentShader;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function ( parameters ) {\r\n\r\n\tTHREE.ShaderMaterial.call( this, parameters );\r\n\r\n\tthis.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create( THREE.ShaderMaterial.prototype );\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'SpriteMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\tthis.map = null;\r\n\r\n\tthis.rotation = 0;\r\n\r\n\tthis.fog = false;\r\n\r\n\t// set parameters\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Material.prototype.copy.call( this, source );\r\n\r\n\tthis.color.copy( source.color );\r\n\tthis.map = source.map;\r\n\r\n\tthis.rotation = source.rotation;\r\n\r\n\tthis.fog = source.fog;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function ( image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.TextureIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.sourceFile = '';\r\n\r\n\tthis.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n\tthis.mipmaps = [];\r\n\r\n\tthis.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n\tthis.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n\tthis.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\tthis.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n\tthis.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\tthis.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n\tthis.format = format !== undefined ? format : THREE.RGBAFormat;\r\n\tthis.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n\tthis.offset = new THREE.Vector2( 0, 0 );\r\n\tthis.repeat = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.generateMipmaps = true;\r\n\tthis.premultiplyAlpha = false;\r\n\tthis.flipY = true;\r\n\tthis.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n\tthis.version = 0;\r\n\tthis.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n\tconstructor: THREE.Texture,\r\n\r\n\tset needsUpdate ( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.image = source.image;\r\n\t\tthis.mipmaps = source.mipmaps.slice( 0 );\r\n\r\n\t\tthis.mapping = source.mapping;\r\n\r\n\t\tthis.wrapS = source.wrapS;\r\n\t\tthis.wrapT = source.wrapT;\r\n\r\n\t\tthis.magFilter = source.magFilter;\r\n\t\tthis.minFilter = source.minFilter;\r\n\r\n\t\tthis.anisotropy = source.anisotropy;\r\n\r\n\t\tthis.format = source.format;\r\n\t\tthis.type = source.type;\r\n\r\n\t\tthis.offset.copy( source.offset );\r\n\t\tthis.repeat.copy( source.repeat );\r\n\r\n\t\tthis.generateMipmaps = source.generateMipmaps;\r\n\t\tthis.premultiplyAlpha = source.premultiplyAlpha;\r\n\t\tthis.flipY = source.flipY;\r\n\t\tthis.unpackAlignment = source.unpackAlignment;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoJSON: function ( meta ) {\r\n\r\n\t\tif ( meta.textures[ this.uuid ] !== undefined ) {\r\n\r\n\t\t\treturn meta.textures[ this.uuid ];\r\n\r\n\t\t}\r\n\r\n\t\tfunction getDataURL( image ) {\r\n\r\n\t\t\tvar canvas;\r\n\r\n\t\t\tif ( image.toDataURL !== undefined ) {\r\n\r\n\t\t\t\tcanvas = image;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcanvas = document.createElement( 'canvas' );\r\n\t\t\t\tcanvas.width = image.width;\r\n\t\t\t\tcanvas.height = image.height;\r\n\r\n\t\t\t\tcanvas.getContext( '2d' ).drawImage( image, 0, 0, image.width, image.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( canvas.width > 2048 || canvas.height > 2048 ) {\r\n\r\n\t\t\t\treturn canvas.toDataURL( 'image/jpeg', 0.6 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn canvas.toDataURL( 'image/png' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.4,\r\n\t\t\t\ttype: 'Texture',\r\n\t\t\t\tgenerator: 'Texture.toJSON'\r\n\t\t\t},\r\n\r\n\t\t\tuuid: this.uuid,\r\n\t\t\tname: this.name,\r\n\r\n\t\t\tmapping: this.mapping,\r\n\r\n\t\t\trepeat: [ this.repeat.x, this.repeat.y ],\r\n\t\t\toffset: [ this.offset.x, this.offset.y ],\r\n\t\t\twrap: [ this.wrapS, this.wrapT ],\r\n\r\n\t\t\tminFilter: this.minFilter,\r\n\t\t\tmagFilter: this.magFilter,\r\n\t\t\tanisotropy: this.anisotropy\r\n\t\t};\r\n\r\n\t\tif ( this.image !== undefined ) {\r\n\r\n\t\t\t// TODO: Move to THREE.Image\r\n\r\n\t\t\tvar image = this.image;\r\n\r\n\t\t\tif ( image.uuid === undefined ) {\r\n\r\n\t\t\t\timage.uuid = THREE.Math.generateUUID(); // UGH\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( meta.images[ image.uuid ] === undefined ) {\r\n\r\n\t\t\t\tmeta.images[ image.uuid ] = {\r\n\t\t\t\t\tuuid: image.uuid,\r\n\t\t\t\t\turl: getDataURL( image )\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\toutput.image = image.uuid;\r\n\r\n\t\t}\r\n\r\n\t\tmeta.textures[ this.uuid ] = output;\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t},\r\n\r\n\ttransformUv: function ( uv ) {\r\n\r\n\t\tif ( this.mapping !== THREE.UVMapping )  return;\r\n\r\n\t\tuv.multiply( this.repeat );\r\n\t\tuv.add( this.offset );\r\n\r\n\t\tif ( uv.x < 0 || uv.x > 1 ) {\r\n\r\n\t\t\tswitch ( this.wrapS ) {\r\n\r\n\t\t\t\tcase THREE.RepeatWrapping:\r\n\r\n\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.ClampToEdgeWrapping:\r\n\r\n\t\t\t\t\tuv.x = uv.x < 0 ? 0 : 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.MirroredRepeatWrapping:\r\n\r\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.x ) % 2 ) === 1 ) {\r\n\r\n\t\t\t\t\t\tuv.x = Math.ceil( uv.x ) - uv.x;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( uv.y < 0 || uv.y > 1 ) {\r\n\r\n\t\t\tswitch ( this.wrapT ) {\r\n\r\n\t\t\t\tcase THREE.RepeatWrapping:\r\n\r\n\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.ClampToEdgeWrapping:\r\n\r\n\t\t\t\t\tuv.y = uv.y < 0 ? 0 : 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.MirroredRepeatWrapping:\r\n\r\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.y ) % 2 ) === 1 ) {\r\n\r\n\t\t\t\t\t\tuv.y = Math.ceil( uv.y ) - uv.y;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.flipY ) {\r\n\r\n\t\t\tuv.y = 1 - uv.y;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Texture.prototype );\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CanvasTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CanvasTexture = function ( canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.CanvasTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.CanvasTexture.prototype.constructor = THREE.CanvasTexture;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function ( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tmapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\r\n\tTHREE.Texture.call( this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.images = images;\r\n\tthis.flipY = false;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Texture.prototype.copy.call( this, source );\r\n\t\r\n\tthis.images = source.images;\r\n\t\r\n\treturn this;\r\n\r\n};\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function ( mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.image = { width: width, height: height };\r\n\tthis.mipmaps = mipmaps;\r\n\r\n\t// no flipping for cube textures\r\n\t// (also flipping doesn't work for compressed textures )\r\n\r\n\tthis.flipY = false;\r\n\r\n\t// can't generate mipmaps for compressed textures\r\n\t// mips must be embedded in DDS files\r\n\r\n\tthis.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function ( data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.image = { data: data, width: width, height: height };\r\n\r\n\tthis.magFilter = magFilter !== undefined ? magFilter : THREE.NearestFilter;\r\n\tthis.minFilter = minFilter !== undefined ? minFilter : THREE.NearestFilter;\r\n\t\r\n\tthis.flipY = false;\r\n\tthis.generateMipmaps  = false;\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function ( video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.generateMipmaps = false;\r\n\r\n\tvar scope = this;\r\n\r\n\tvar update = function () {\r\n\r\n\t\trequestAnimationFrame( update );\r\n\r\n\t\tif ( video.readyState === video.HAVE_ENOUGH_DATA ) {\r\n\r\n\t\t\tscope.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tupdate();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n// File:src/objects/Points.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Points = function ( geometry, material ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Points';\r\n\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.PointsMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n};\r\n\r\nTHREE.Points.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Points.prototype.constructor = THREE.Points;\r\n\r\nTHREE.Points.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\r\n\treturn function raycast( raycaster, intersects ) {\r\n\r\n\t\tvar object = this;\r\n\t\tvar geometry = object.geometry;\r\n\t\tvar threshold = raycaster.params.Points.threshold;\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tif ( ray.isIntersectionBox( geometry.boundingBox ) === false ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );\r\n\t\tvar localThresholdSq = localThreshold * localThreshold;\r\n\t\tvar position = new THREE.Vector3();\r\n\r\n\t\tfunction testPoint( point, index ) {\r\n\r\n\t\t\tvar rayPointDistanceSq = ray.distanceSqToPoint( point );\r\n\r\n\t\t\tif ( rayPointDistanceSq < localThresholdSq ) {\r\n\r\n\t\t\t\tvar intersectPoint = ray.closestPointToPoint( point );\r\n\t\t\t\tintersectPoint.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectPoint );\r\n\r\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) return;\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\tdistanceToRay: Math.sqrt( rayPointDistanceSq ),\r\n\t\t\t\t\tpoint: intersectPoint.clone(),\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tface: null,\r\n\t\t\t\t\tobject: object\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar index = geometry.index;\r\n\t\t\tvar attributes = geometry.attributes;\r\n\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tvar indices = index.array;\r\n\r\n\t\t\t\tfor ( var i = 0, il = indices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar a = indices[ i ];\r\n\r\n\t\t\t\t\tposition.fromArray( positions, a * 3 );\r\n\r\n\t\t\t\t\ttestPoint( position, a );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tfor ( var i = 0, l = positions.length / 3; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tposition.fromArray( positions, i * 3 );\r\n\r\n\t\t\t\t\ttestPoint( position, i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\r\n\t\t\tfor ( var i = 0, l = vertices.length; i < l; i ++ ) {\r\n\r\n\t\t\t\ttestPoint( vertices[ i ], i );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Points.prototype.clone = function () {\r\n\r\n\treturn new this.constructor( this.geometry, this.material ).copy( this );\r\n\r\n};\r\n\r\nTHREE.Points.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\t// only serialize if not in meta geometries cache\r\n\tif ( meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n\r\n\t\tmeta.geometries[ this.geometry.uuid ] = this.geometry.toJSON();\r\n\r\n\t}\r\n\r\n\t// only serialize if not in meta materials cache\r\n\tif ( meta.materials[ this.material.uuid ] === undefined ) {\r\n\r\n\t\tmeta.materials[ this.material.uuid ] = this.material.toJSON();\r\n\r\n\t}\r\n\r\n\tdata.object.geometry = this.geometry.uuid;\r\n\tdata.object.material = this.material.uuid;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.PointCloud = function ( geometry, material ) {\r\n\r\n\tconsole.warn( 'THREE.PointCloud has been renamed to THREE.Points.' );\r\n\treturn new THREE.Points( geometry, material );\r\n\r\n};\r\n\r\nTHREE.ParticleSystem = function ( geometry, material ) {\r\n\r\n\tconsole.warn( 'THREE.ParticleSystem has been renamed to THREE.Points.' );\r\n\treturn new THREE.Points( geometry, material );\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function ( geometry, material, mode ) {\r\n\r\n\tif ( mode === 1 ) {\r\n\r\n\t\tconsole.warn( 'THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.' );\r\n\t\treturn new THREE.LineSegments( geometry, material );\r\n\r\n\t}\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Line';\r\n\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.LineBasicMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n};\r\n\r\nTHREE.Line.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\tvar sphere = new THREE.Sphere();\r\n\r\n\treturn function raycast( raycaster, intersects ) {\r\n\r\n\t\tvar precision = raycaster.linePrecision;\r\n\t\tvar precisionSq = precision * precision;\r\n\r\n\t\tvar geometry = this.geometry;\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tsphere.copy( geometry.boundingSphere );\r\n\t\tsphere.applyMatrix4( this.matrixWorld );\r\n\r\n\t\tif ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tvar vStart = new THREE.Vector3();\r\n\t\tvar vEnd = new THREE.Vector3();\r\n\t\tvar interSegment = new THREE.Vector3();\r\n\t\tvar interRay = new THREE.Vector3();\r\n\t\tvar step = this instanceof THREE.LineSegments ? 2 : 1;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar index = geometry.index;\r\n\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tvar indices = index.array;\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0, l = indices.length - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\tvar a = indices[ i ];\r\n\t\t\t\t\tvar b = indices[ i + 1 ];\r\n\r\n\t\t\t\t\tvStart.fromArray( positions, a * 3 );\r\n\t\t\t\t\tvEnd.fromArray( positions, b * 3 );\r\n\r\n\t\t\t\t\tvar distSq = ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\r\n\r\n\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0, l = positions.length / 3 - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\tvStart.fromArray( positions, 3 * i );\r\n\t\t\t\t\tvEnd.fromArray( positions, 3 * i + 3 );\r\n\r\n\t\t\t\t\tvar distSq = ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\r\n\r\n\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\t\t\tvar nbVertices = vertices.length;\r\n\r\n\t\t\tfor ( var i = 0; i < nbVertices - 1; i += step ) {\r\n\r\n\t\t\t\tvar distSq = ray.distanceSqToSegment( vertices[ i ], vertices[ i + 1 ], interRay, interSegment );\r\n\r\n\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\r\n\r\n\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\tindex: i,\r\n\t\t\t\t\tface: null,\r\n\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Line.prototype.clone = function () {\r\n\r\n\treturn new this.constructor( this.geometry, this.material ).copy( this );\r\n\r\n};\r\n\r\nTHREE.Line.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\t// only serialize if not in meta geometries cache\r\n\tif ( meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n\r\n\t\tmeta.geometries[ this.geometry.uuid ] = this.geometry.toJSON();\r\n\r\n\t}\r\n\r\n\t// only serialize if not in meta materials cache\r\n\tif ( meta.materials[ this.material.uuid ] === undefined ) {\r\n\r\n\t\tmeta.materials[ this.material.uuid ] = this.material.toJSON();\r\n\r\n\t}\r\n\r\n\tdata.object.geometry = this.geometry.uuid;\r\n\tdata.object.material = this.material.uuid;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// DEPRECATED\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\n// File:src/objects/LineSegments.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LineSegments = function ( geometry, material ) {\r\n\r\n\tTHREE.Line.call( this, geometry, material );\r\n\r\n\tthis.type = 'LineSegments';\r\n\r\n};\r\n\r\nTHREE.LineSegments.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.LineSegments.prototype.constructor = THREE.LineSegments;\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function ( geometry, material ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Mesh';\r\n\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n\tthis.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function () {\r\n\r\n\tif ( this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0 ) {\r\n\r\n\t\tthis.morphTargetBase = - 1;\r\n\t\tthis.morphTargetInfluences = [];\r\n\t\tthis.morphTargetDictionary = {};\r\n\r\n\t\tfor ( var m = 0, ml = this.geometry.morphTargets.length; m < ml; m ++ ) {\r\n\r\n\t\t\tthis.morphTargetInfluences.push( 0 );\r\n\t\t\tthis.morphTargetDictionary[ this.geometry.morphTargets[ m ].name ] = m;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function ( name ) {\r\n\r\n\tif ( this.morphTargetDictionary[ name ] !== undefined ) {\r\n\r\n\t\treturn this.morphTargetDictionary[ name ];\r\n\r\n\t}\r\n\r\n\tconsole.warn( 'THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.' );\r\n\r\n\treturn 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\tvar sphere = new THREE.Sphere();\r\n\r\n\tvar vA = new THREE.Vector3();\r\n\tvar vB = new THREE.Vector3();\r\n\tvar vC = new THREE.Vector3();\r\n\r\n\tvar tempA = new THREE.Vector3();\r\n\tvar tempB = new THREE.Vector3();\r\n\tvar tempC = new THREE.Vector3();\r\n\r\n\tvar uvA = new THREE.Vector2();\r\n\tvar uvB = new THREE.Vector2();\r\n\tvar uvC = new THREE.Vector2();\r\n\r\n\tvar barycoord = new THREE.Vector3();\r\n\r\n\tvar intersectionPoint = new THREE.Vector3();\r\n\tvar intersectionPointWorld = new THREE.Vector3();\r\n\r\n\tfunction uvIntersection( point, p1, p2, p3, uv1, uv2, uv3 ) {\r\n\r\n\t\tTHREE.Triangle.barycoordFromPoint( point, p1, p2, p3, barycoord );\r\n\r\n\t\tuv1.multiplyScalar( barycoord.x );\r\n\t\tuv2.multiplyScalar( barycoord.y );\r\n\t\tuv3.multiplyScalar( barycoord.z );\r\n\r\n\t\tuv1.add( uv2 ).add( uv3 );\r\n\r\n\t\treturn uv1.clone();\r\n\r\n\t}\r\n\r\n\treturn function raycast( raycaster, intersects ) {\r\n\r\n\t\tvar geometry = this.geometry;\r\n\t\tvar material = this.material;\r\n\r\n\t\tif ( material === undefined ) return;\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\tsphere.copy( geometry.boundingSphere );\r\n\t\tsphere.applyMatrix4( this.matrixWorld );\r\n\r\n\t\tif ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// Check boundingBox before continuing\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tif ( ray.isIntersectionBox( geometry.boundingBox ) === false ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar a, b, c;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar index = geometry.index;\r\n\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tvar indices = index.array;\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\ta = indices[ i ];\r\n\t\t\t\t\tb = indices[ i + 1 ];\r\n\t\t\t\t\tc = indices[ i + 2 ];\r\n\r\n\t\t\t\t\tvA.fromArray( positions, a * 3 );\r\n\t\t\t\t\tvB.fromArray( positions, b * 3 );\r\n\t\t\t\t\tvC.fromArray( positions, c * 3 );\r\n\r\n\t\t\t\t\tif ( material.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\t\tif ( ray.intersectTriangle( vC, vB, vA, true, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tintersectionPointWorld.copy( intersectionPoint );\r\n\t\t\t\t\tintersectionPointWorld.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPointWorld );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tvar uv;\r\n\r\n\t\t\t\t\tif ( attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar uvs = attributes.uv.array;\r\n\t\t\t\t\t\tuvA.fromArray( uvs, a * 2 );\r\n\t\t\t\t\t\tuvB.fromArray( uvs, b * 2 );\r\n\t\t\t\t\t\tuvC.fromArray( uvs, c * 2 );\r\n\t\t\t\t\t\tuv = uvIntersection( intersectionPoint, vA, vB, vC, uvA, uvB, uvC );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\tpoint: intersectionPointWorld.clone(),\r\n\t\t\t\t\t\tuv: uv,\r\n\t\t\t\t\t\tface: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),\r\n\t\t\t\t\t\tfaceIndex: Math.floor( i / 3 ), // triangle number in indices buffer semantics\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 9 ) {\r\n\r\n\t\t\t\t\tvA.fromArray( positions, i );\r\n\t\t\t\t\tvB.fromArray( positions, i + 3 );\r\n\t\t\t\t\tvC.fromArray( positions, i + 6 );\r\n\r\n\t\t\t\t\tif ( material.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\t\tif ( ray.intersectTriangle( vC, vB, vA, true, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tintersectionPointWorld.copy( intersectionPoint );\r\n\t\t\t\t\tintersectionPointWorld.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPointWorld );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tvar uv;\r\n\r\n\t\t\t\t\tif ( attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar uvs = attributes.uv.array;\r\n\t\t\t\t\t\tuvA.fromArray( uvs, i );\r\n\t\t\t\t\t\tuvB.fromArray( uvs, i + 2 );\r\n\t\t\t\t\t\tuvC.fromArray( uvs, i + 4 );\r\n\t\t\t\t\t\tuv = uvIntersection( intersectionPoint, vA, vB, vC, uvA, uvB, uvC );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ta = i / 3;\r\n\t\t\t\t\tb = a + 1;\r\n\t\t\t\t\tc = a + 2;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\tpoint: intersectionPointWorld.clone(),\r\n\t\t\t\t\t\tuv: uv,\r\n\t\t\t\t\t\tface: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),\r\n\t\t\t\t\t\tindex: a, // triangle number in positions buffer semantics\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tvar isFaceMaterial = material instanceof THREE.MeshFaceMaterial;\r\n\t\t\tvar materials = isFaceMaterial === true ? material.materials : null;\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\t\t\tvar faces = geometry.faces;\r\n\r\n\t\t\tfor ( var f = 0, fl = faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tvar face = faces[ f ];\r\n\t\t\t\tvar faceMaterial = isFaceMaterial === true ? materials[ face.materialIndex ] : material;\r\n\r\n\t\t\t\tif ( faceMaterial === undefined ) continue;\r\n\r\n\t\t\t\ta = vertices[ face.a ];\r\n\t\t\t\tb = vertices[ face.b ];\r\n\t\t\t\tc = vertices[ face.c ];\r\n\r\n\t\t\t\tif ( faceMaterial.morphTargets === true ) {\r\n\r\n\t\t\t\t\tvar morphTargets = geometry.morphTargets;\r\n\t\t\t\t\tvar morphInfluences = this.morphTargetInfluences;\r\n\r\n\t\t\t\t\tvA.set( 0, 0, 0 );\r\n\t\t\t\t\tvB.set( 0, 0, 0 );\r\n\t\t\t\t\tvC.set( 0, 0, 0 );\r\n\r\n\t\t\t\t\tfor ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {\r\n\r\n\t\t\t\t\t\tvar influence = morphInfluences[ t ];\r\n\r\n\t\t\t\t\t\tif ( influence === 0 ) continue;\r\n\r\n\t\t\t\t\t\tvar targets = morphTargets[ t ].vertices;\r\n\r\n\t\t\t\t\t\tvA.addScaledVector( tempA.subVectors( targets[ face.a ], a ), influence );\r\n\t\t\t\t\t\tvB.addScaledVector( tempB.subVectors( targets[ face.b ], b ), influence );\r\n\t\t\t\t\t\tvC.addScaledVector( tempC.subVectors( targets[ face.c ], c ), influence );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvA.add( a );\r\n\t\t\t\t\tvB.add( b );\r\n\t\t\t\t\tvC.add( c );\r\n\r\n\t\t\t\t\ta = vA;\r\n\t\t\t\t\tb = vB;\r\n\t\t\t\t\tc = vC;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( faceMaterial.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\tif ( ray.intersectTriangle( c, b, a, true, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( ray.intersectTriangle( a, b, c, faceMaterial.side !== THREE.DoubleSide, intersectionPoint ) === null ) continue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tintersectionPointWorld.copy( intersectionPoint );\r\n\t\t\t\tintersectionPointWorld.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPointWorld );\r\n\r\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\tvar uv;\r\n\r\n\t\t\t\tif ( geometry.faceVertexUvs[ 0 ].length > 0 ) {\r\n\r\n\t\t\t\t\tvar uvs = geometry.faceVertexUvs[ 0 ][ f ];\r\n\t\t\t\t\tuvA.copy( uvs[ 0 ] );\r\n\t\t\t\t\tuvB.copy( uvs[ 1 ] );\r\n\t\t\t\t\tuvC.copy( uvs[ 2 ] );\r\n\t\t\t\t\tuv = uvIntersection( intersectionPoint, a, b, c, uvA, uvB, uvC );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\tpoint: intersectionPointWorld.clone(),\r\n\t\t\t\t\tuv: uv,\r\n\t\t\t\t\tface: face,\r\n\t\t\t\t\tfaceIndex: f,\r\n\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Mesh.prototype.clone = function () {\r\n\r\n\treturn new this.constructor( this.geometry, this.material ).copy( this );\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\t// only serialize if not in meta geometries cache\r\n\tif ( meta.geometries[ this.geometry.uuid ] === undefined ) {\r\n\r\n\t\tmeta.geometries[ this.geometry.uuid ] = this.geometry.toJSON( meta );\r\n\r\n\t}\r\n\r\n\t// only serialize if not in meta materials cache\r\n\tif ( meta.materials[ this.material.uuid ] === undefined ) {\r\n\r\n\t\tmeta.materials[ this.material.uuid ] = this.material.toJSON( meta );\r\n\r\n\t}\r\n\r\n\tdata.object.geometry = this.geometry.uuid;\r\n\tdata.object.material = this.material.uuid;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function ( skin ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Bone';\r\n\r\n\tthis.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\nTHREE.Bone.prototype.copy = function ( source ) {\r\n\t\r\n\tTHREE.Object3D.prototype.copy.call( this, source );\r\n\t\r\n\tthis.skin = source.skin;\r\n\t\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function ( bones, boneInverses, useVertexTexture ) {\r\n\r\n\tthis.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n\tthis.identityMatrix = new THREE.Matrix4();\r\n\r\n\t// copy the bone array\r\n\r\n\tbones = bones || [];\r\n\r\n\tthis.bones = bones.slice( 0 );\r\n\r\n\t// create a bone texture or an array of floats\r\n\r\n\tif ( this.useVertexTexture ) {\r\n\r\n\t\t// layout (1 matrix = 4 pixels)\r\n\t\t//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n\t\t//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)\r\n\t\t//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)\r\n\t\t//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)\r\n\t\t//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)\r\n\r\n\t\t\r\n\t\tvar size = Math.sqrt( this.bones.length * 4 ); // 4 pixels needed for 1 matrix\r\n\t\tsize = THREE.Math.nextPowerOfTwo( Math.ceil( size ) );\r\n\t\tsize = Math.max( size, 4 );\r\n\r\n\t\tthis.boneTextureWidth = size;\r\n\t\tthis.boneTextureHeight = size;\r\n\r\n\t\tthis.boneMatrices = new Float32Array( this.boneTextureWidth * this.boneTextureHeight * 4 ); // 4 floats per RGBA pixel\r\n\t\tthis.boneTexture = new THREE.DataTexture( this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType );\r\n\r\n\t} else {\r\n\r\n\t\tthis.boneMatrices = new Float32Array( 16 * this.bones.length );\r\n\r\n\t}\r\n\r\n\t// use the supplied bone inverses or calculate the inverses\r\n\r\n\tif ( boneInverses === undefined ) {\r\n\r\n\t\tthis.calculateInverses();\r\n\r\n\t} else {\r\n\r\n\t\tif ( this.bones.length === boneInverses.length ) {\r\n\r\n\t\t\tthis.boneInverses = boneInverses.slice( 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.Skeleton bonInverses is the wrong length.' );\r\n\r\n\t\t\tthis.boneInverses = [];\r\n\r\n\t\t\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\t\t\tthis.boneInverses.push( new THREE.Matrix4() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function () {\r\n\r\n\tthis.boneInverses = [];\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tvar inverse = new THREE.Matrix4();\r\n\r\n\t\tif ( this.bones[ b ] ) {\r\n\r\n\t\t\tinverse.getInverse( this.bones[ b ].matrixWorld );\r\n\r\n\t\t}\r\n\r\n\t\tthis.boneInverses.push( inverse );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function () {\r\n\r\n\tvar bone;\r\n\r\n\t// recover the bind-time world matrices\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tbone = this.bones[ b ];\r\n\r\n\t\tif ( bone ) {\r\n\r\n\t\t\tbone.matrixWorld.getInverse( this.boneInverses[ b ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// compute the local matrices, positions, rotations and scales\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tbone = this.bones[ b ];\r\n\r\n\t\tif ( bone ) {\r\n\r\n\t\t\tif ( bone.parent ) {\r\n\r\n\t\t\t\tbone.matrix.getInverse( bone.parent.matrixWorld );\r\n\t\t\t\tbone.matrix.multiply( bone.matrixWorld );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbone.matrix.copy( bone.matrixWorld );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbone.matrix.decompose( bone.position, bone.quaternion, bone.scale );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = ( function () {\r\n\r\n\tvar offsetMatrix = new THREE.Matrix4();\r\n\r\n\treturn function update() {\r\n\r\n\t\t// flatten bone matrices to array\r\n\r\n\t\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\t\t// compute the offset between the current and the original transform\r\n\r\n\t\t\tvar matrix = this.bones[ b ] ? this.bones[ b ].matrixWorld : this.identityMatrix;\r\n\r\n\t\t\toffsetMatrix.multiplyMatrices( matrix, this.boneInverses[ b ] );\r\n\t\t\toffsetMatrix.flattenToArrayOffset( this.boneMatrices, b * 16 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.useVertexTexture ) {\r\n\r\n\t\t\tthis.boneTexture.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n} )();\r\n\r\nTHREE.Skeleton.prototype.clone = function () {\r\n\r\n\treturn new THREE.Skeleton( this.bones, this.boneInverses, this.useVertexTexture );\r\n\r\n};\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function ( geometry, material, useVertexTexture ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.type = 'SkinnedMesh';\r\n\r\n\tthis.bindMode = \"attached\";\r\n\tthis.bindMatrix = new THREE.Matrix4();\r\n\tthis.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n\t// init bones\r\n\r\n\t// TODO: remove bone creation as there is no reason (other than\r\n\t// convenience) for THREE.SkinnedMesh to do this.\r\n\r\n\tvar bones = [];\r\n\r\n\tif ( this.geometry && this.geometry.bones !== undefined ) {\r\n\r\n\t\tvar bone, gbone;\r\n\r\n\t\tfor ( var b = 0, bl = this.geometry.bones.length; b < bl; ++ b ) {\r\n\r\n\t\t\tgbone = this.geometry.bones[ b ];\r\n\r\n\t\t\tbone = new THREE.Bone( this );\r\n\t\t\tbones.push( bone );\r\n\r\n\t\t\tbone.name = gbone.name;\r\n\t\t\tbone.position.fromArray( gbone.pos );\r\n\t\t\tbone.quaternion.fromArray( gbone.rotq );\r\n\t\t\tif ( gbone.scl !== undefined ) bone.scale.fromArray( gbone.scl );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var b = 0, bl = this.geometry.bones.length; b < bl; ++ b ) {\r\n\r\n\t\t\tgbone = this.geometry.bones[ b ];\r\n\r\n\t\t\tif ( gbone.parent !== - 1 ) {\r\n\r\n\t\t\t\tbones[ gbone.parent ].add( bones[ b ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.add( bones[ b ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.normalizeSkinWeights();\r\n\r\n\tthis.updateMatrixWorld( true );\r\n\tthis.bind( new THREE.Skeleton( bones, undefined, useVertexTexture ), this.matrixWorld );\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function( skeleton, bindMatrix ) {\r\n\r\n\tthis.skeleton = skeleton;\r\n\r\n\tif ( bindMatrix === undefined ) {\r\n\r\n\t\tthis.updateMatrixWorld( true );\r\n\t\t\r\n\t\tthis.skeleton.calculateInverses();\r\n\r\n\t\tbindMatrix = this.matrixWorld;\r\n\r\n\t}\r\n\r\n\tthis.bindMatrix.copy( bindMatrix );\r\n\tthis.bindMatrixInverse.getInverse( bindMatrix );\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function () {\r\n\r\n\tthis.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function () {\r\n\r\n\tif ( this.geometry instanceof THREE.Geometry ) {\r\n\r\n\t\tfor ( var i = 0; i < this.geometry.skinIndices.length; i ++ ) {\r\n\r\n\t\t\tvar sw = this.geometry.skinWeights[ i ];\r\n\r\n\t\t\tvar scale = 1.0 / sw.lengthManhattan();\r\n\r\n\t\t\tif ( scale !== Infinity ) {\r\n\r\n\t\t\t\tsw.multiplyScalar( scale );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tsw.set( 1 ); // this will be normalized by the shader anyway\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\t// skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function( force ) {\r\n\r\n\tTHREE.Mesh.prototype.updateMatrixWorld.call( this, true );\r\n\r\n\tif ( this.bindMode === \"attached\" ) {\r\n\r\n\t\tthis.bindMatrixInverse.getInverse( this.matrixWorld );\r\n\r\n\t} else if ( this.bindMode === \"detached\" ) {\r\n\r\n\t\tthis.bindMatrixInverse.getInverse( this.bindMatrix );\r\n\r\n\t} else {\r\n\r\n\t\tconsole.warn( 'THREE.SkinnedMesh unrecognized bindMode: ' + this.bindMode );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function() {\r\n\r\n\treturn new this.constructor( this.geometry, this.material, this.useVertexTexture ).copy( this );\r\n\r\n};\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function ( geometry, material ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.type = 'MorphAnimMesh';\r\n\r\n\t// API\r\n\r\n\tthis.duration = 1000; // milliseconds\r\n\tthis.mirroredLoop = false;\r\n\tthis.time = 0;\r\n\r\n\t// internals\r\n\r\n\tthis.lastKeyframe = 0;\r\n\tthis.currentKeyframe = 0;\r\n\r\n\tthis.direction = 1;\r\n\tthis.directionBackwards = false;\r\n\r\n\tthis.setFrameRange( 0, geometry.morphTargets.length - 1 );\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function ( start, end ) {\r\n\r\n\tthis.startKeyframe = start;\r\n\tthis.endKeyframe = end;\r\n\r\n\tthis.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function () {\r\n\r\n\tthis.direction = 1;\r\n\tthis.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function () {\r\n\r\n\tthis.direction = - 1;\r\n\tthis.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function () {\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tif ( ! geometry.animations ) geometry.animations = {};\r\n\r\n\tvar firstAnimation, animations = geometry.animations;\r\n\r\n\tvar pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n\tfor ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\tvar morph = geometry.morphTargets[ i ];\r\n\t\tvar parts = morph.name.match( pattern );\r\n\r\n\t\tif ( parts && parts.length > 1 ) {\r\n\r\n\t\t\tvar label = parts[ 1 ];\r\n\r\n\t\t\tif ( ! animations[ label ] ) animations[ label ] = { start: Infinity, end: - Infinity };\r\n\r\n\t\t\tvar animation = animations[ label ];\r\n\r\n\t\t\tif ( i < animation.start ) animation.start = i;\r\n\t\t\tif ( i > animation.end ) animation.end = i;\r\n\r\n\t\t\tif ( ! firstAnimation ) firstAnimation = label;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function ( label, start, end ) {\r\n\r\n\tif ( ! this.geometry.animations ) this.geometry.animations = {};\r\n\r\n\tthis.geometry.animations[ label ] = { start: start, end: end };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function ( label, fps ) {\r\n\r\n\tvar animation = this.geometry.animations[ label ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tthis.setFrameRange( animation.start, animation.end );\r\n\t\tthis.duration = 1000 * ( ( animation.end - animation.start ) / fps );\r\n\t\tthis.time = 0;\r\n\r\n\t} else {\r\n\r\n\t\tconsole.warn( 'THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function ( delta ) {\r\n\r\n\tvar frameTime = this.duration / this.length;\r\n\r\n\tthis.time += this.direction * delta;\r\n\r\n\tif ( this.mirroredLoop ) {\r\n\r\n\t\tif ( this.time > this.duration || this.time < 0 ) {\r\n\r\n\t\t\tthis.direction *= - 1;\r\n\r\n\t\t\tif ( this.time > this.duration ) {\r\n\r\n\t\t\t\tthis.time = this.duration;\r\n\t\t\t\tthis.directionBackwards = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.time < 0 ) {\r\n\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t\tthis.directionBackwards = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tthis.time = this.time % this.duration;\r\n\r\n\t\tif ( this.time < 0 ) this.time += this.duration;\r\n\r\n\t}\r\n\r\n\tvar keyframe = this.startKeyframe + THREE.Math.clamp( Math.floor( this.time / frameTime ), 0, this.length - 1 );\r\n\r\n\tvar influences = this.morphTargetInfluences;\r\n\r\n\tif ( keyframe !== this.currentKeyframe ) {\r\n\r\n\t\tinfluences[ this.lastKeyframe ] = 0;\r\n\t\tinfluences[ this.currentKeyframe ] = 1;\r\n\t\tinfluences[ keyframe ] = 0;\r\n\r\n\t\tthis.lastKeyframe = this.currentKeyframe;\r\n\t\tthis.currentKeyframe = keyframe;\r\n\r\n\t}\r\n\r\n\tvar mix = ( this.time % frameTime ) / frameTime;\r\n\r\n\tif ( this.directionBackwards ) {\r\n\r\n\t\tmix = 1 - mix;\r\n\r\n\t}\r\n\r\n\tinfluences[ this.currentKeyframe ] = mix;\r\n\tinfluences[ this.lastKeyframe ] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function ( a, b, t ) {\r\n\r\n\tvar influences = this.morphTargetInfluences;\r\n\r\n\tfor ( var i = 0, l = influences.length; i < l; i ++ ) {\r\n\r\n\t\tinfluences[ i ] = 0;\r\n\r\n\t}\r\n\r\n\tif ( a > - 1 ) influences[ a ] = 1 - t;\r\n\tif ( b > - 1 ) influences[ b ] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Mesh.prototype.copy.call( this, source );\r\n\r\n\tthis.duration = source.duration;\r\n\tthis.mirroredLoop = source.mirroredLoop;\r\n\tthis.time = source.time;\r\n\r\n\tthis.lastKeyframe = source.lastKeyframe;\r\n\tthis.currentKeyframe = source.currentKeyframe;\r\n\r\n\tthis.direction = source.direction;\r\n\tthis.directionBackwards = source.directionBackwards;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'LOD';\r\n\r\n\tObject.defineProperties( this, {\r\n\t\tlevels: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: []\r\n\t\t},\r\n\t\tobjects: {\r\n\t\t\tget: function () {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.LOD: .objects has been renamed to .levels.' );\r\n\t\t\t\treturn this.levels;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t} );\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function ( object, distance ) {\r\n\r\n\tif ( distance === undefined ) distance = 0;\r\n\r\n\tdistance = Math.abs( distance );\r\n\r\n\tvar levels = this.levels;\r\n\r\n\tfor ( var l = 0; l < levels.length; l ++ ) {\r\n\r\n\t\tif ( distance < levels[ l ].distance ) {\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlevels.splice( l, 0, { distance: distance, object: object } );\r\n\r\n\tthis.add( object );\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function ( distance ) {\r\n\r\n\tvar levels = this.levels;\r\n\r\n\tfor ( var i = 1, l = levels.length; i < l; i ++ ) {\r\n\r\n\t\tif ( distance < levels[ i ].distance ) {\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn levels[ i - 1 ].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = ( function () {\r\n\r\n\tvar matrixPosition = new THREE.Vector3();\r\n\r\n\treturn function raycast( raycaster, intersects ) {\r\n\r\n\t\tmatrixPosition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tvar distance = raycaster.ray.origin.distanceTo( matrixPosition );\r\n\r\n\t\tthis.getObjectForDistance( distance ).raycast( raycaster, intersects );\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.LOD.prototype.update = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\r\n\treturn function update( camera ) {\r\n\r\n\t\tvar levels = this.levels;\r\n\r\n\t\tif ( levels.length > 1 ) {\r\n\r\n\t\t\tv1.setFromMatrixPosition( camera.matrixWorld );\r\n\t\t\tv2.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\t\tvar distance = v1.distanceTo( v2 );\r\n\r\n\t\t\tlevels[ 0 ].object.visible = true;\r\n\r\n\t\t\tfor ( var i = 1, l = levels.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tif ( distance >= levels[ i ].distance ) {\r\n\r\n\t\t\t\t\tlevels[ i - 1 ].object.visible = false;\r\n\t\t\t\t\tlevels[ i ].object.visible = true;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( ; i < l; i ++ ) {\r\n\r\n\t\t\t\tlevels[ i ].object.visible = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Object3D.prototype.copy.call( this, source, false );\r\n\r\n\tvar levels = source.levels;\r\n\r\n\tfor ( var i = 0, l = levels.length; i < l; i ++ ) {\r\n\r\n\t\tvar level = levels[ i ];\r\n\r\n\t\tthis.addLevel( level.object.clone(), level.distance );\r\n\r\n\t}\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\tdata.object.levels = [];\r\n\r\n\tvar levels = this.levels;\r\n\r\n\tfor ( var i = 0, l = levels.length; i < l; i ++ ) {\r\n\r\n\t\tvar level = levels[ i ];\r\n\r\n\t\tdata.object.levels.push( {\r\n\t\t\tobject: level.object.uuid,\r\n\t\t\tdistance: level.distance\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = ( function () {\r\n\r\n\tvar indices = new Uint16Array( [ 0, 1, 2,  0, 2, 3 ] );\r\n\tvar vertices = new Float32Array( [ - 0.5, - 0.5, 0,   0.5, - 0.5, 0,   0.5, 0.5, 0,   - 0.5, 0.5, 0 ] );\r\n\tvar uvs = new Float32Array( [ 0, 0,   1, 0,   1, 1,   0, 1 ] );\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.setIndex( new THREE.BufferAttribute( indices, 1 ) );\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tgeometry.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n\treturn function Sprite( material ) {\r\n\r\n\t\tTHREE.Object3D.call( this );\r\n\r\n\t\tthis.type = 'Sprite';\r\n\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.material = ( material !== undefined ) ? material : new THREE.SpriteMaterial();\r\n\r\n\t};\r\n\r\n} )();\r\n\r\nTHREE.Sprite.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = ( function () {\r\n\r\n\tvar matrixPosition = new THREE.Vector3();\r\n\r\n\treturn function raycast( raycaster, intersects ) {\r\n\r\n\t\tmatrixPosition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tvar distanceSq = raycaster.ray.distanceSqToPoint( matrixPosition );\r\n\t\tvar guessSizeSq = this.scale.x * this.scale.y;\r\n\r\n\t\tif ( distanceSq > guessSizeSq ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tintersects.push( {\r\n\r\n\t\t\tdistance: Math.sqrt( distanceSq ),\r\n\t\t\tpoint: this.position,\r\n\t\t\tface: null,\r\n\t\t\tobject: this\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Sprite.prototype.clone = function () {\r\n\r\n\treturn new this.constructor( this.material ).copy( this );\r\n\r\n};\r\n\r\nTHREE.Sprite.prototype.toJSON = function ( meta ) {\r\n\r\n\tvar data = THREE.Object3D.prototype.toJSON.call( this, meta );\r\n\r\n\t// only serialize if not in meta materials cache\r\n\tif ( meta.materials[ this.material.uuid ] === undefined ) {\r\n\r\n\t\tmeta.materials[ this.material.uuid ] = this.material.toJSON();\r\n\r\n\t}\r\n\r\n\tdata.object.material = this.material.uuid;\r\n\r\n\treturn data;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function ( texture, size, distance, blending, color ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.lensFlares = [];\r\n\r\n\tthis.positionScreen = new THREE.Vector3();\r\n\tthis.customUpdateCallback = undefined;\r\n\r\n\tif ( texture !== undefined ) {\r\n\r\n\t\tthis.add( texture, size, distance, blending, color );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function ( texture, size, distance, blending, color, opacity ) {\r\n\r\n\tif ( size === undefined ) size = - 1;\r\n\tif ( distance === undefined ) distance = 0;\r\n\tif ( opacity === undefined ) opacity = 1;\r\n\tif ( color === undefined ) color = new THREE.Color( 0xffffff );\r\n\tif ( blending === undefined ) blending = THREE.NormalBlending;\r\n\r\n\tdistance = Math.min( distance, Math.max( 0, distance ) );\r\n\r\n\tthis.lensFlares.push( {\r\n\t\ttexture: texture,\t// THREE.Texture\r\n\t\tsize: size, \t\t// size in pixels (-1 = use texture.width)\r\n\t\tdistance: distance, \t// distance (0-1) from light source (0=at light source)\r\n\t\tx: 0, y: 0, z: 0,\t// screen position (-1 => 1) z = 0 is in front z = 1 is back\r\n\t\tscale: 1, \t\t// scale\r\n\t\trotation: 0, \t\t// rotation\r\n\t\topacity: opacity,\t// opacity\r\n\t\tcolor: color,\t\t// color\r\n\t\tblending: blending\t// blending\r\n\t} );\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function () {\r\n\r\n\tvar f, fl = this.lensFlares.length;\r\n\tvar flare;\r\n\tvar vecX = - this.positionScreen.x * 2;\r\n\tvar vecY = - this.positionScreen.y * 2;\r\n\r\n\tfor ( f = 0; f < fl; f ++ ) {\r\n\r\n\t\tflare = this.lensFlares[ f ];\r\n\r\n\t\tflare.x = this.positionScreen.x + vecX * flare.distance;\r\n\t\tflare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n\t\tflare.wantedRotation = flare.x * Math.PI * 0.25;\r\n\t\tflare.rotation += ( flare.wantedRotation - flare.rotation ) * 0.25;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Object3D.prototype.copy.call( this, source );\r\n\r\n\tthis.positionScreen.copy( source.positionScreen );\r\n\tthis.customUpdateCallback = source.customUpdateCallback;\r\n\r\n\tfor ( var i = 0, l = source.lensFlares.length; i < l; i ++ ) {\r\n\r\n\t\tthis.lensFlares.push( source.lensFlares[ i ] );\r\n\r\n\t}\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Scene';\r\n\r\n\tthis.fog = null;\r\n\tthis.overrideMaterial = null;\r\n\r\n\tthis.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Object3D.prototype.copy.call( this, source );\r\n\r\n\tif ( source.fog !== null ) this.fog = source.fog.clone();\r\n\tif ( source.overrideMaterial !== null ) this.overrideMaterial = source.overrideMaterial.clone();\r\n\r\n\tthis.autoUpdate = source.autoUpdate;\r\n\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function ( color, near, far ) {\r\n\r\n\tthis.name = '';\r\n\r\n\tthis.color = new THREE.Color( color );\r\n\r\n\tthis.near = ( near !== undefined ) ? near : 1;\r\n\tthis.far = ( far !== undefined ) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function () {\r\n\r\n\treturn new THREE.Fog( this.color.getHex(), this.near, this.far );\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function ( color, density ) {\r\n\r\n\tthis.name = '';\r\n\r\n\tthis.color = new THREE.Color( color );\r\n\tthis.density = ( density !== undefined ) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function () {\r\n\r\n\treturn new THREE.FogExp2( this.color.getHex(), this.density );\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/aomap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'aomap_fragment'] = \"#ifdef USE_AOMAP\\n\\n\ttotalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/aomap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'aomap_pars_fragment'] = \"#ifdef USE_AOMAP\\n\\n\tuniform sampler2D aoMap;\\n\tuniform float aoMapIntensity;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/begin_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'begin_vertex'] = \"\\nvec3 transformed = vec3( position );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/beginnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'beginnormal_vertex'] = \"\\nvec3 objectNormal = vec3( normal );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = color.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk[ 'common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\n\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n\\n}\\n\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n\\n}\\n\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\n\treturn - distance * planeNormal + point;\\n\\n}\\n\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n\\n}\\n\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n\\n}\\n\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\\n\tif ( decayExponent > 0.0 ) {\\n\\n\t  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\n\t}\\n\\n\treturn 1.0;\\n\\n}\\n\\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\\n\\n\t// Original approximation by Christophe Schlick '94\\n\t//;float fresnel = pow( 1.0 - dotLH, 5.0 );\\n\\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\\n\tfloat fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\\n\\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n\\n}\\n\\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\\n\\n\t// geometry term is (nl)(nv) / 4(nl)(nv)\\n\\n\treturn 0.25;\\n\\n}\\n\\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\\n\\n\t// factor of 1/PI in distribution term omitted\\n\\n\treturn ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n\\n}\\n\\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\\n\\n\tvec3 halfDir = normalize( lightDir + viewDir );\\n\\n\t//float dotNL = saturate( dot( normal, lightDir ) );\\n\t//float dotNV = saturate( dot( normal, viewDir ) );\\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\\n\tfloat dotLH = saturate( dot( lightDir, halfDir ) );\\n\\n\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\\n\\n\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\n\treturn F * G * D;\\n\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n\\n\t#ifdef GAMMA_INPUT\\n\\n\t\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n\\n\t#else\\n\\n\t\treturn a;\\n\\n\t#endif\\n\\n}\\n\\nvec3 linearToOutput( in vec3 a ) {\\n\\n\t#ifdef GAMMA_OUTPUT\\n\\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n\\n\t#else\\n\\n\t\treturn a;\\n\\n\t#endif\\n\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'defaultnormal_vertex'] = \"#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/displacementmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'displacementmap_vertex'] = \"#ifdef USE_DISPLACEMENTMAP\\n\\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/displacementmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'displacementmap_pars_vertex'] = \"#ifdef USE_DISPLACEMENTMAP\\n\\n\tuniform sampler2D displacementMap;\\n\tuniform float displacementScale;\\n\tuniform float displacementBias;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/emissivemap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'emissivemap_fragment'] = \"#ifdef USE_EMISSIVEMAP\\n\\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\n\temissiveColor.rgb = inputToLinear( emissiveColor.rgb );\\n\\n\ttotalEmissiveLight *= emissiveColor.rgb;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/emissivemap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'emissivemap_pars_fragment'] = \"#ifdef USE_EMISSIVEMAP\\n\\n\tuniform sampler2D emissiveMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\ttotalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tuniform sampler2D lightMap;\\n\tuniform float lightMapIntensity;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\nvec3 normal = normalize( transformedNormal );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = pointLightColor[ i ];\\n\\n\t\tvec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\t// attenuation\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = spotLightColor[ i ];\\n\\n\t\tvec3 lightPosition = spotLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition - mvPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\\n\\n\t\t\t// attenuation\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tattenuation *= spotEffect;\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = directionalLightColor[ i ];\\n\\n\t\tvec3 lightDir = directionalLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tvLightFront += lightColor * saturate( dotProduct );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += lightColor * saturate( - dotProduct );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tfloat hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 viewDir = normalize( vViewPosition );\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = pointLightColor[ i ];\\n\\n\t\tvec3 lightPosition = pointLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\t// attenuation\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\t// diffuse\\n\\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\\n\\n\t\t// specular\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = spotLightColor[ i ];\\n\\n\t\tvec3 lightPosition = spotLightPosition[ i ];\\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\\n\t\tvec3 lightDir = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\\n\\n\t\t\t// attenuation\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tattenuation *= spotEffect;\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightColor = directionalLightColor[ i ];\\n\\n\t\tvec3 lightDir = directionalLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\\n\\n\t\ttotalDiffuseLight += lightColor * cosineTerm;\\n\\n\t\t// specular\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lightDir );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += lightColor;\\n\\n\t\t// specular (sky term only)\\n\\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\\n\\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * max( dotProduct, 0.0 );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/project_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'project_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t#endif\\n\\n\t}\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv2_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv2_pars_fragment'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv2_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv2_pars_vertex'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tattribute vec2 uv2;\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv2_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv2_vertex'] = \"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/uv_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'uv_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n\tmerge: function ( uniforms ) {\r\n\r\n\t\tvar merged = {};\r\n\r\n\t\tfor ( var u = 0; u < uniforms.length; u ++ ) {\r\n\r\n\t\t\tvar tmp = this.clone( uniforms[ u ] );\r\n\r\n\t\t\tfor ( var p in tmp ) {\r\n\r\n\t\t\t\tmerged[ p ] = tmp[ p ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn merged;\r\n\r\n\t},\r\n\r\n\tclone: function ( uniforms_src ) {\r\n\r\n\t\tvar uniforms_dst = {};\r\n\r\n\t\tfor ( var u in uniforms_src ) {\r\n\r\n\t\t\tuniforms_dst[ u ] = {};\r\n\r\n\t\t\tfor ( var p in uniforms_src[ u ] ) {\r\n\r\n\t\t\t\tvar parameter_src = uniforms_src[ u ][ p ];\r\n\r\n\t\t\t\tif ( parameter_src instanceof THREE.Color ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector2 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector3 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector4 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Matrix3 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Matrix4 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Texture ) {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src.clone();\r\n\r\n\t\t\t\t} else if ( Array.isArray( parameter_src ) ) {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src.slice();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn uniforms_dst;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n\tcommon: {\r\n\r\n\t\t\"diffuse\" : { type: \"c\", value: new THREE.Color( 0xeeeeee ) },\r\n\t\t\"opacity\" : { type: \"f\", value: 1.0 },\r\n\r\n\t\t\"map\" : { type: \"t\", value: null },\r\n\t\t\"offsetRepeat\" : { type: \"v4\", value: new THREE.Vector4( 0, 0, 1, 1 ) },\r\n\r\n\t\t\"specularMap\" : { type: \"t\", value: null },\r\n\t\t\"alphaMap\" : { type: \"t\", value: null },\r\n\r\n\t\t\"envMap\" : { type: \"t\", value: null },\r\n\t\t\"flipEnvMap\" : { type: \"f\", value: - 1 },\r\n\t\t\"reflectivity\" : { type: \"f\", value: 1.0 },\r\n\t\t\"refractionRatio\" : { type: \"f\", value: 0.98 }\r\n\r\n\t},\r\n\r\n\taomap: {\r\n\r\n\t\t\"aoMap\" : { type: \"t\", value: null },\r\n\t\t\"aoMapIntensity\" : { type: \"f\", value: 1 },\r\n\r\n\t},\r\n\r\n\tlightmap: {\r\n\r\n\t\t\"lightMap\" : { type: \"t\", value: null },\r\n\t\t\"lightMapIntensity\" : { type: \"f\", value: 1 },\r\n\r\n\t},\r\n\r\n\temissivemap: {\r\n\r\n\t\t\"emissiveMap\" : { type: \"t\", value: null },\r\n\r\n\t},\r\n\r\n\tbumpmap: {\r\n\r\n\t\t\"bumpMap\" : { type: \"t\", value: null },\r\n\t\t\"bumpScale\" : { type: \"f\", value: 1 }\r\n\r\n\t},\r\n\r\n\tnormalmap: {\r\n\r\n\t\t\"normalMap\" : { type: \"t\", value: null },\r\n\t\t\"normalScale\" : { type: \"v2\", value: new THREE.Vector2( 1, 1 ) }\r\n\r\n\t},\r\n\r\n\tdisplacementmap: {\r\n\r\n\t\t\"displacementMap\" : { type: \"t\", value: null },\r\n\t\t\"displacementScale\" : { type: \"f\", value: 1 },\r\n\t\t\"displacementBias\" : { type: \"f\", value: 0 }\r\n\r\n\t},\r\n\r\n\tfog : {\r\n\r\n\t\t\"fogDensity\" : { type: \"f\", value: 0.00025 },\r\n\t\t\"fogNear\" : { type: \"f\", value: 1 },\r\n\t\t\"fogFar\" : { type: \"f\", value: 2000 },\r\n\t\t\"fogColor\" : { type: \"c\", value: new THREE.Color( 0xffffff ) }\r\n\r\n\t},\r\n\r\n\tlights: {\r\n\r\n\t\t\"ambientLightColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"directionalLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"directionalLightColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"hemisphereLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"hemisphereLightSkyColor\" : { type: \"fv\", value: [] },\r\n\t\t\"hemisphereLightGroundColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"pointLightColor\" : { type: \"fv\", value: [] },\r\n\t\t\"pointLightPosition\" : { type: \"fv\", value: [] },\r\n\t\t\"pointLightDistance\" : { type: \"fv1\", value: [] },\r\n\t\t\"pointLightDecay\" : { type: \"fv1\", value: [] },\r\n\r\n\t\t\"spotLightColor\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightPosition\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightDistance\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightAngleCos\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightExponent\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightDecay\" : { type: \"fv1\", value: [] }\r\n\r\n\t},\r\n\r\n\tpoints: {\r\n\r\n\t\t\"psColor\" : { type: \"c\", value: new THREE.Color( 0xeeeeee ) },\r\n\t\t\"opacity\" : { type: \"f\", value: 1.0 },\r\n\t\t\"size\" : { type: \"f\", value: 1.0 },\r\n\t\t\"scale\" : { type: \"f\", value: 1.0 },\r\n\t\t\"map\" : { type: \"t\", value: null },\r\n\t\t\"offsetRepeat\" : { type: \"v4\", value: new THREE.Vector4( 0, 0, 1, 1 ) },\r\n\r\n\t\t\"fogDensity\" : { type: \"f\", value: 0.00025 },\r\n\t\t\"fogNear\" : { type: \"f\", value: 1 },\r\n\t\t\"fogFar\" : { type: \"f\", value: 2000 },\r\n\t\t\"fogColor\" : { type: \"c\", value: new THREE.Color( 0xffffff ) }\r\n\r\n\t},\r\n\r\n\tshadowmap: {\r\n\r\n\t\t\"shadowMap\": { type: \"tv\", value: [] },\r\n\t\t\"shadowMapSize\": { type: \"v2v\", value: [] },\r\n\r\n\t\t\"shadowBias\" : { type: \"fv1\", value: [] },\r\n\t\t\"shadowDarkness\": { type: \"fv1\", value: [] },\r\n\r\n\t\t\"shadowMatrix\" : { type: \"m4v\", value: [] }\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n\t'basic': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"aomap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ]\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv2_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_ENVMAP\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"beginnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"aomap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\t\t\t\"\tvec3 totalAmbientLight = vec3( 1.0 );\", // hardwired\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"aomap_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb * totalAmbientLight;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\t\t// TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'lambert': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"lights\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"emissive\" : { type: \"c\", value: new THREE.Color( 0x000000 ) }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"#define LAMBERT\",\r\n\r\n\t\t\t\"varying vec3 vLightFront;\",\r\n\r\n\t\t\t\"#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\"\tvarying vec3 vLightBack;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_lambert_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv2_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"beginnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_lambert_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform vec3 emissive;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\t\"varying vec3 vLightFront;\",\r\n\r\n\t\t\t\"#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\"\tvarying vec3 vLightBack;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\"\t\tif ( gl_FrontFacing )\",\r\n\t\t\t\"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\t\t\t\"\t\telse\",\r\n\t\t\t\"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'phong': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"aomap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"lightmap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"emissivemap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"bumpmap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"normalmap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"displacementmap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"lights\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"emissive\" : { type: \"c\", value: new THREE.Color( 0x000000 ) },\r\n\t\t\t\t\"specular\" : { type: \"c\", value: new THREE.Color( 0x111111 ) },\r\n\t\t\t\t\"shininess\": { type: \"f\", value: 30 }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"#define PHONG\",\r\n\r\n\t\t\t\"varying vec3 vViewPosition;\",\r\n\r\n\t\t\t\"#ifndef FLAT_SHADED\",\r\n\r\n\t\t\t\"\tvarying vec3 vNormal;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"displacementmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_phong_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"uv2_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"beginnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n\t\t\t\"\tvNormal = normalize( transformedNormal );\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"displacementmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"\tvViewPosition = - mvPosition.xyz;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_phong_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"#define PHONG\",\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform vec3 emissive;\",\r\n\t\t\t\"uniform vec3 specular;\",\r\n\t\t\t\"uniform float shininess;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"uv2_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"aomap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"emissivemap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_phong_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"bumpmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"normalmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\t\t\t\"\tvec3 totalAmbientLight = ambientLightColor;\",\r\n\t\t\t\"\tvec3 totalEmissiveLight = emissive;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"aomap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"emissivemap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_phong_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'points': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"points\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ]\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"uniform float size;\",\r\n\t\t\t\"uniform float scale;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\"\t#ifdef USE_SIZEATTENUATION\",\r\n\t\t\t\"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n\t\t\t\"\t#else\",\r\n\t\t\t\"\t\tgl_PointSize = size;\",\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 psColor;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_particle_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\r\n\t\t\t\"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_particle_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'dashed': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"scale\"    : { type: \"f\", value: 1 },\r\n\t\t\t\t\"dashSize\" : { type: \"f\", value: 1 },\r\n\t\t\t\t\"totalSize\": { type: \"f\", value: 2 }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"uniform float scale;\",\r\n\t\t\t\"attribute float lineDistance;\",\r\n\r\n\t\t\t\"varying float vLineDistance;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\"\tvLineDistance = scale * lineDistance;\",\r\n\r\n\t\t\t\"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\t\t\t\"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\t\"uniform float dashSize;\",\r\n\t\t\t\"uniform float totalSize;\",\r\n\r\n\t\t\t\"varying float vLineDistance;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n\t\t\t\"\t\tdiscard;\",\r\n\r\n\t\t\t\"\t}\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'depth': {\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t\"mNear\": { type: \"f\", value: 1.0 },\r\n\t\t\t\"mFar\" : { type: \"f\", value: 2000.0 },\r\n\t\t\t\"opacity\" : { type: \"f\", value: 1.0 }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform float mNear;\",\r\n\t\t\t\"uniform float mFar;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n\t\t\t\"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n\t\t\t\"\tgl_FragColor = vec4( vec3( color ), opacity );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t'normal': {\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t\"opacity\" : { type: \"f\", value: 1.0 }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vNormal;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform float opacity;\",\r\n\t\t\t\"varying vec3 vNormal;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t/* -------------------------------------------------------------------------\r\n\t//\tCube map shader\r\n\t ------------------------------------------------------------------------- */\r\n\r\n\t'cube': {\r\n\r\n\t\tuniforms: { \"tCube\": { type: \"t\", value: null },\r\n\t\t\t\t\t\"tFlip\": { type: \"f\", value: - 1 } },\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform samplerCube tCube;\",\r\n\t\t\t\"uniform float tFlip;\",\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t/* -------------------------------------------------------------------------\r\n\t//\tCube map shader\r\n\t ------------------------------------------------------------------------- */\r\n\r\n\t'equirect': {\r\n\r\n\t\tuniforms: { \"tEquirect\": { type: \"t\", value: null },\r\n\t\t\t\t\t\"tFlip\": { type: \"f\", value: - 1 } },\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform sampler2D tEquirect;\",\r\n\t\t\t\"uniform float tFlip;\",\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t// \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\t\t\t\t\"vec3 direction = normalize( vWorldPosition );\",\r\n\t\t\t\t\"vec2 sampleUV;\",\r\n\t\t\t\t\"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n\t\t\t\t\"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n\t\t\t\t\"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t},\r\n\r\n\t/* Depth encoding into RGBA texture\r\n\t *\r\n\t * based on SpiderGL shadow map example\r\n\t * http://spidergl.org/example.php?id=6\r\n\t *\r\n\t * originally from\r\n\t * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n\t *\r\n\t * see also\r\n\t * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n\t */\r\n\r\n\t'depthRGBA': {\r\n\r\n\t\tuniforms: {},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"begin_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"project_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" ),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"vec4 pack_depth( const in float depth ) {\",\r\n\r\n\t\t\t\"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n\t\t\t\"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n\t\t\t\"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n\t\t\t\"\tres -= res.xxyz * bit_mask;\",\r\n\t\t\t\"\treturn res;\",\r\n\r\n\t\t\t\"}\",\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n\t\t\t\"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\t//\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n\t\t\t\t//\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n\t\t\t\t//\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n\t\t\t\t//\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join( \"\\n\" )\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function ( parameters ) {\r\n\r\n\tconsole.log( 'THREE.WebGLRenderer', THREE.REVISION );\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement( 'canvas' ),\r\n\t_context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n\t_width = _canvas.width,\r\n\t_height = _canvas.height,\r\n\r\n\tpixelRatio = 1,\r\n\r\n\t_alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n\t_depth = parameters.depth !== undefined ? parameters.depth : true,\r\n\t_stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n\t_antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n\t_premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n\t_preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n\r\n\t_clearColor = new THREE.Color( 0x000000 ),\r\n\t_clearAlpha = 0;\r\n\r\n\tvar lights = [];\r\n\r\n\tvar opaqueObjects = [];\r\n\tvar opaqueObjectsLastIndex = -1;\r\n\tvar transparentObjects = [];\r\n\tvar transparentObjectsLastIndex = -1;\r\n\r\n\tvar opaqueImmediateObjects = [];\r\n\tvar opaqueImmediateObjectsLastIndex = -1;\r\n\tvar transparentImmediateObjects = [];\r\n\tvar transparentImmediateObjectsLastIndex = -1;\r\n\r\n\tvar morphInfluences = new Float32Array( 8 );\r\n\r\n\r\n\tvar sprites = [];\r\n\tvar lensFlares = [];\r\n\r\n\t// public properties\r\n\r\n\tthis.domElement = _canvas;\r\n\tthis.context = null;\r\n\r\n\t// clearing\r\n\r\n\tthis.autoClear = true;\r\n\tthis.autoClearColor = true;\r\n\tthis.autoClearDepth = true;\r\n\tthis.autoClearStencil = true;\r\n\r\n\t// scene graph\r\n\r\n\tthis.sortObjects = true;\r\n\r\n\t// physically based shading\r\n\r\n\tthis.gammaFactor = 2.0;\t// for backwards compatibility\r\n\tthis.gammaInput = false;\r\n\tthis.gammaOutput = false;\r\n\r\n\t// morphs\r\n\r\n\tthis.maxMorphTargets = 8;\r\n\tthis.maxMorphNormals = 4;\r\n\r\n\t// flags\r\n\r\n\tthis.autoScaleCubemaps = true;\r\n\r\n\t// internal properties\r\n\r\n\tvar _this = this,\r\n\r\n\t// internal state cache\r\n\r\n\t_currentProgram = null,\r\n\t_currentFramebuffer = null,\r\n\t_currentMaterialId = - 1,\r\n\t_currentGeometryProgram = '',\r\n\t_currentCamera = null,\r\n\r\n\t_usedTextureUnits = 0,\r\n\r\n\t_viewportX = 0,\r\n\t_viewportY = 0,\r\n\t_viewportWidth = _canvas.width,\r\n\t_viewportHeight = _canvas.height,\r\n\t_currentWidth = 0,\r\n\t_currentHeight = 0,\r\n\r\n\t// frustum\r\n\r\n\t_frustum = new THREE.Frustum(),\r\n\r\n\t // camera matrices cache\r\n\r\n\t_projScreenMatrix = new THREE.Matrix4(),\r\n\r\n\t_vector3 = new THREE.Vector3(),\r\n\r\n\t// light arrays cache\r\n\r\n\t_direction = new THREE.Vector3(),\r\n\r\n\t_lightsNeedUpdate = true,\r\n\r\n\t_lights = {\r\n\r\n\t\tambient: [ 0, 0, 0 ],\r\n\t\tdirectional: { length: 0, colors: [], positions: [] },\r\n\t\tpoint: { length: 0, colors: [], positions: [], distances: [], decays: [] },\r\n\t\tspot: { length: 0, colors: [], positions: [], distances: [], directions: [], anglesCos: [], exponents: [], decays: [] },\r\n\t\themi: { length: 0, skyColors: [], groundColors: [], positions: [] }\r\n\r\n\t},\r\n\r\n\t// info\r\n\r\n\t_infoMemory = {\r\n\r\n\t\tgeometries: 0,\r\n\t\ttextures: 0\r\n\r\n\t},\r\n\r\n\t_infoRender = {\r\n\r\n\t\tcalls: 0,\r\n\t\tvertices: 0,\r\n\t\tfaces: 0,\r\n\t\tpoints: 0\r\n\r\n\t};\r\n\r\n\tthis.info = {\r\n\r\n\t\trender: _infoRender,\r\n\t\tmemory: _infoMemory,\r\n\t\tprograms: null\r\n\r\n\t};\r\n\r\n\r\n\t// initialize\r\n\r\n\tvar _gl;\r\n\r\n\ttry {\r\n\r\n\t\tvar attributes = {\r\n\t\t\talpha: _alpha,\r\n\t\t\tdepth: _depth,\r\n\t\t\tstencil: _stencil,\r\n\t\t\tantialias: _antialias,\r\n\t\t\tpremultipliedAlpha: _premultipliedAlpha,\r\n\t\t\tpreserveDrawingBuffer: _preserveDrawingBuffer\r\n\t\t};\r\n\r\n\t\t_gl = _context || _canvas.getContext( 'webgl', attributes ) || _canvas.getContext( 'experimental-webgl', attributes );\r\n\r\n\t\tif ( _gl === null ) {\r\n\r\n\t\t\tif ( _canvas.getContext( 'webgl' ) !== null ) {\r\n\r\n\t\t\t\tthrow 'Error creating WebGL context with your selected attributes.';\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthrow 'Error creating WebGL context.';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_canvas.addEventListener( 'webglcontextlost', onContextLost, false );\r\n\r\n\t} catch ( error ) {\r\n\r\n\t\tconsole.error( 'THREE.WebGLRenderer: ' + error );\r\n\r\n\t}\r\n\r\n\tvar extensions = new THREE.WebGLExtensions( _gl );\r\n\r\n\textensions.get( 'OES_texture_float' );\r\n\textensions.get( 'OES_texture_float_linear' );\r\n\textensions.get( 'OES_texture_half_float' );\r\n\textensions.get( 'OES_texture_half_float_linear' );\r\n\textensions.get( 'OES_standard_derivatives' );\r\n\textensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\tif ( extensions.get( 'OES_element_index_uint' ) ) {\r\n\r\n\t\tTHREE.BufferGeometry.MaxIndex = 4294967296;\r\n\r\n\t}\r\n\r\n\tvar capabilities = new THREE.WebGLCapabilities( _gl, extensions, parameters );\r\n\r\n\tvar state = new THREE.WebGLState( _gl, extensions, paramThreeToGL );\r\n\tvar properties = new THREE.WebGLProperties();\r\n\tvar objects = new THREE.WebGLObjects( _gl, properties, this.info );\r\n\tvar programCache = new THREE.WebGLPrograms( this, capabilities );\r\n\r\n\tthis.info.programs = programCache.programs;\r\n\r\n\tvar bufferRenderer = new THREE.WebGLBufferRenderer( _gl, extensions, _infoRender );\r\n\tvar indexedBufferRenderer = new THREE.WebGLIndexedBufferRenderer( _gl, extensions, _infoRender );\r\n\r\n\t//\r\n\r\n\tfunction glClearColor( r, g, b, a ) {\r\n\r\n\t\tif ( _premultipliedAlpha === true ) {\r\n\r\n\t\t\tr *= a; g *= a; b *= a;\r\n\r\n\t\t}\r\n\r\n\t\t_gl.clearColor( r, g, b, a );\r\n\r\n\t}\r\n\r\n\tfunction setDefaultGLState() {\r\n\r\n\t\tstate.init();\r\n\r\n\t\t_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t}\r\n\r\n\tfunction resetGLState() {\r\n\r\n\t\t_currentProgram = null;\r\n\t\t_currentCamera = null;\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\t\t_currentMaterialId = - 1;\r\n\r\n\t\t_lightsNeedUpdate = true;\r\n\r\n\t\tstate.reset();\r\n\r\n\t}\r\n\r\n\tsetDefaultGLState();\r\n\r\n\tthis.context = _gl;\r\n\tthis.capabilities = capabilities;\r\n\tthis.extensions = extensions;\r\n\tthis.state = state;\r\n\r\n\t// shadow map\r\n\r\n\tvar shadowMap = new THREE.WebGLShadowMap( this, lights, objects );\r\n\r\n\tthis.shadowMap = shadowMap;\r\n\r\n\r\n\t// Plugins\r\n\r\n\tvar spritePlugin = new THREE.SpritePlugin( this, sprites );\r\n\tvar lensFlarePlugin = new THREE.LensFlarePlugin( this, lensFlares );\r\n\r\n\t// API\r\n\r\n\tthis.getContext = function () {\r\n\r\n\t\treturn _gl;\r\n\r\n\t};\r\n\r\n\tthis.getContextAttributes = function () {\r\n\r\n\t\treturn _gl.getContextAttributes();\r\n\r\n\t};\r\n\r\n\tthis.forceContextLoss = function () {\r\n\r\n\t\textensions.get( 'WEBGL_lose_context' ).loseContext();\r\n\r\n\t};\r\n\r\n\tthis.getMaxAnisotropy = ( function () {\r\n\r\n\t\tvar value;\r\n\r\n\t\treturn function getMaxAnisotropy() {\r\n\r\n\t\t\tif ( value !== undefined ) return value;\r\n\r\n\t\t\tvar extension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\tvalue = _gl.getParameter( extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvalue = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\r\n\t\t}\r\n\r\n\t} )();\r\n\r\n\tthis.getPrecision = function () {\r\n\r\n\t\treturn capabilities.precision;\r\n\r\n\t};\r\n\r\n\tthis.getPixelRatio = function () {\r\n\r\n\t\treturn pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setPixelRatio = function ( value ) {\r\n\r\n\t\tif ( value !== undefined ) pixelRatio = value;\r\n\r\n\t};\r\n\r\n\tthis.getSize = function () {\r\n\r\n\t\treturn {\r\n\t\t\twidth: _width,\r\n\t\t\theight: _height\r\n\t\t};\r\n\r\n\t};\r\n\r\n\tthis.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\t_width = width;\r\n\t\t_height = height;\r\n\r\n\t\t_canvas.width = width * pixelRatio;\r\n\t\t_canvas.height = height * pixelRatio;\r\n\r\n\t\tif ( updateStyle !== false ) {\r\n\r\n\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t_canvas.style.height = height + 'px';\r\n\r\n\t\t}\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.setViewport = function ( x, y, width, height ) {\r\n\r\n\t\t_viewportX = x * pixelRatio;\r\n\t\t_viewportY = y * pixelRatio;\r\n\r\n\t\t_viewportWidth = width * pixelRatio;\r\n\t\t_viewportHeight = height * pixelRatio;\r\n\r\n\t\t_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );\r\n\r\n\t};\r\n\r\n\tthis.setScissor = function ( x, y, width, height ) {\r\n\r\n\t\t_gl.scissor(\r\n\t\t\tx * pixelRatio,\r\n\t\t\ty * pixelRatio,\r\n\t\t\twidth * pixelRatio,\r\n\t\t\theight * pixelRatio\r\n\t\t);\r\n\r\n\t};\r\n\r\n\tthis.enableScissorTest = function ( boolean ) {\r\n\r\n\t\tstate.setScissorTest( boolean );\r\n\r\n\t};\r\n\r\n\t// Clearing\r\n\r\n\tthis.getClearColor = function () {\r\n\r\n\t\treturn _clearColor;\r\n\r\n\t};\r\n\r\n\tthis.setClearColor = function ( color, alpha ) {\r\n\r\n\t\t_clearColor.set( color );\r\n\r\n\t\t_clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t};\r\n\r\n\tthis.getClearAlpha = function () {\r\n\r\n\t\treturn _clearAlpha;\r\n\r\n\t};\r\n\r\n\tthis.setClearAlpha = function ( alpha ) {\r\n\r\n\t\t_clearAlpha = alpha;\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t};\r\n\r\n\tthis.clear = function ( color, depth, stencil ) {\r\n\r\n\t\tvar bits = 0;\r\n\r\n\t\tif ( color === undefined || color ) bits |= _gl.COLOR_BUFFER_BIT;\r\n\t\tif ( depth === undefined || depth ) bits |= _gl.DEPTH_BUFFER_BIT;\r\n\t\tif ( stencil === undefined || stencil ) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n\t\t_gl.clear( bits );\r\n\r\n\t};\r\n\r\n\tthis.clearColor = function () {\r\n\r\n\t\t_gl.clear( _gl.COLOR_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearDepth = function () {\r\n\r\n\t\t_gl.clear( _gl.DEPTH_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearStencil = function () {\r\n\r\n\t\t_gl.clear( _gl.STENCIL_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearTarget = function ( renderTarget, color, depth, stencil ) {\r\n\r\n\t\tthis.setRenderTarget( renderTarget );\r\n\t\tthis.clear( color, depth, stencil );\r\n\r\n\t};\r\n\r\n\t// Reset\r\n\r\n\tthis.resetGLState = resetGLState;\r\n\r\n\tthis.dispose = function() {\r\n\r\n\t\t_canvas.removeEventListener( 'webglcontextlost', onContextLost, false );\r\n\r\n\t};\r\n\r\n\t// Events\r\n\r\n\tfunction onContextLost( event ) {\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tresetGLState();\r\n\t\tsetDefaultGLState();\r\n\r\n\t\tproperties.clear();\r\n\r\n\t};\r\n\r\n\tfunction onTextureDispose( event ) {\r\n\r\n\t\tvar texture = event.target;\r\n\r\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\tdeallocateTexture( texture );\r\n\r\n\t\t_infoMemory.textures --;\r\n\r\n\r\n\t}\r\n\r\n\tfunction onRenderTargetDispose( event ) {\r\n\r\n\t\tvar renderTarget = event.target;\r\n\r\n\t\trenderTarget.removeEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\tdeallocateRenderTarget( renderTarget );\r\n\r\n\t\t_infoMemory.textures --;\r\n\r\n\t}\r\n\r\n\tfunction onMaterialDispose( event ) {\r\n\r\n\t\tvar material = event.target;\r\n\r\n\t\tmaterial.removeEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\tdeallocateMaterial( material );\r\n\r\n\t}\r\n\r\n\t// Buffer deallocation\r\n\r\n\tfunction deallocateTexture( texture ) {\r\n\r\n\t\tvar textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.image && textureProperties.__image__webglTextureCube ) {\r\n\r\n\t\t\t// cube texture\r\n\r\n\t\t\t_gl.deleteTexture( textureProperties.__image__webglTextureCube );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// 2D texture\r\n\r\n\t\t\tif ( textureProperties.__webglInit === undefined ) return;\r\n\r\n\t\t\t_gl.deleteTexture( textureProperties.__webglTexture );\r\n\r\n\t\t}\r\n\r\n\t\t// remove all webgl properties\r\n\t\tproperties.delete( texture );\r\n\r\n\t}\r\n\r\n\tfunction deallocateRenderTarget( renderTarget ) {\r\n\r\n\t\tvar renderTargetProperties = properties.get( renderTarget );\r\n\r\n\t\tif ( ! renderTarget || renderTargetProperties.__webglTexture === undefined ) return;\r\n\r\n\t\t_gl.deleteTexture( renderTargetProperties.__webglTexture );\r\n\r\n\t\tif ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer[ i ] );\r\n\t\t\t\t_gl.deleteRenderbuffer( renderTargetProperties.__webglRenderbuffer[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer );\r\n\t\t\t_gl.deleteRenderbuffer( renderTargetProperties.__webglRenderbuffer );\r\n\r\n\t\t}\r\n\r\n\t\tproperties.delete( renderTarget );\r\n\r\n\t}\r\n\r\n\tfunction deallocateMaterial( material ) {\r\n\r\n\t\treleaseMaterialProgramReference( material );\r\n\r\n\t\tproperties.delete( material );\r\n\r\n\t}\r\n\r\n\r\n\tfunction releaseMaterialProgramReference( material ) {\r\n\r\n\t\tvar programInfo = properties.get( material ).program;\r\n\r\n\t\tmaterial.program = undefined;\r\n\r\n\t\tif ( programInfo !== undefined ) {\r\n\r\n\t\t\tprogramCache.releaseProgram( programInfo );\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Buffer rendering\r\n\r\n\tthis.renderBufferImmediate = function ( object, program, material ) {\r\n\r\n\t\tstate.initAttributes();\r\n\r\n\t\tvar buffers = properties.get( object );\r\n\r\n\t\tif ( object.hasPositions && ! buffers.position ) buffers.position = _gl.createBuffer();\r\n\t\tif ( object.hasNormals && ! buffers.normal ) buffers.normal = _gl.createBuffer();\r\n\t\tif ( object.hasUvs && ! buffers.uv ) buffers.uv = _gl.createBuffer();\r\n\t\tif ( object.hasColors && ! buffers.color ) buffers.color = _gl.createBuffer();\r\n\r\n\t\tvar attributes = program.getAttributes();\r\n\r\n\t\tif ( object.hasPositions ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.position );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( attributes.position );\r\n\t\t\t_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasNormals ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.normal );\r\n\r\n\t\t\tif ( material.type !== 'MeshPhongMaterial' && material.shading === THREE.FlatShading ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = object.count * 3; i < l; i += 9 ) {\r\n\r\n\t\t\t\t\tvar array = object.normalArray;\r\n\r\n\t\t\t\t\tvar nx = ( array[ i + 0 ] + array[ i + 3 ] + array[ i + 6 ] ) / 3;\r\n\t\t\t\t\tvar ny = ( array[ i + 1 ] + array[ i + 4 ] + array[ i + 7 ] ) / 3;\r\n\t\t\t\t\tvar nz = ( array[ i + 2 ] + array[ i + 5 ] + array[ i + 8 ] ) / 3;\r\n\r\n\t\t\t\t\tarray[ i + 0 ] = nx;\r\n\t\t\t\t\tarray[ i + 1 ] = ny;\r\n\t\t\t\t\tarray[ i + 2 ] = nz;\r\n\r\n\t\t\t\t\tarray[ i + 3 ] = nx;\r\n\t\t\t\t\tarray[ i + 4 ] = ny;\r\n\t\t\t\t\tarray[ i + 5 ] = nz;\r\n\r\n\t\t\t\t\tarray[ i + 6 ] = nx;\r\n\t\t\t\t\tarray[ i + 7 ] = ny;\r\n\t\t\t\t\tarray[ i + 8 ] = nz;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( attributes.normal );\r\n\r\n\t\t\t_gl.vertexAttribPointer( attributes.normal, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasUvs && material.map ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.uv );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( attributes.uv );\r\n\r\n\t\t\t_gl.vertexAttribPointer( attributes.uv, 2, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasColors && material.vertexColors !== THREE.NoColors ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.color );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( attributes.color );\r\n\r\n\t\t\t_gl.vertexAttribPointer( attributes.color, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t\t_gl.drawArrays( _gl.TRIANGLES, 0, object.count );\r\n\r\n\t\tobject.count = 0;\r\n\r\n\t};\r\n\r\n\tthis.renderBufferDirect = function ( camera, lights, fog, geometry, material, object, group ) {\r\n\r\n\t\tsetMaterial( material );\r\n\r\n\t\tvar program = setProgram( camera, lights, fog, material, object );\r\n\r\n\t\tvar updateBuffers = false;\r\n\t\tvar geometryProgram = geometry.id + '_' + program.id + '_' + material.wireframe;\r\n\r\n\t\tif ( geometryProgram !== _currentGeometryProgram ) {\r\n\r\n\t\t\t_currentGeometryProgram = geometryProgram;\r\n\t\t\tupdateBuffers = true;\r\n\r\n\t\t}\r\n\r\n\t\t// morph targets\r\n\r\n\t\tvar morphTargetInfluences = object.morphTargetInfluences;\r\n\r\n\t\tif ( morphTargetInfluences !== undefined ) {\r\n\r\n\t\t\tvar activeInfluences = [];\r\n\r\n\t\t\tfor ( var i = 0, l = morphTargetInfluences.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar influence = morphTargetInfluences[ i ];\r\n\t\t\t\tactiveInfluences.push( [ influence, i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tactiveInfluences.sort( numericalSort );\r\n\r\n\t\t\tif ( activeInfluences.length > 8 ) {\r\n\r\n\t\t\t\tactiveInfluences.length = 8;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar morphAttributes = geometry.morphAttributes;\r\n\r\n\t\t\tfor ( var i = 0, l = activeInfluences.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar influence = activeInfluences[ i ];\r\n\t\t\t\tmorphInfluences[ i ] = influence[ 0 ];\r\n\r\n\t\t\t\tif ( influence[ 0 ] !== 0 ) {\r\n\r\n\t\t\t\t\tvar index = influence[ 1 ];\r\n\r\n\t\t\t\t\tif ( material.morphTargets === true && morphAttributes.position ) geometry.addAttribute( 'morphTarget' + i, morphAttributes.position[ index ] );\r\n\t\t\t\t\tif ( material.morphNormals === true && morphAttributes.normal ) geometry.addAttribute( 'morphNormal' + i, morphAttributes.normal[ index ] );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( material.morphTargets === true ) geometry.removeAttribute( 'morphTarget' + i );\r\n\t\t\t\t\tif ( material.morphNormals === true ) geometry.removeAttribute( 'morphNormal' + i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar uniforms = program.getUniforms();\r\n\r\n\t\t\tif ( uniforms.morphTargetInfluences !== null ) {\r\n\r\n\t\t\t\t_gl.uniform1fv( uniforms.morphTargetInfluences, morphInfluences );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tupdateBuffers = true;\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar index = geometry.index;\r\n\t\tvar position = geometry.attributes.position;\r\n\r\n\t\tif ( material.wireframe === true ) {\r\n\r\n\t\t\tindex = objects.getWireframeAttribute( geometry );\r\n\r\n\t\t}\r\n\r\n\t\tvar renderer;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\trenderer = indexedBufferRenderer;\r\n\t\t\trenderer.setIndex( index );\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer = bufferRenderer;\r\n\r\n\t\t}\r\n\r\n\t\tif ( updateBuffers ) {\r\n\r\n\t\t\tsetupVertexAttributes( material, program, geometry );\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, objects.getAttributeBuffer( index ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( group === undefined ) {\r\n\r\n\t\t\tvar count;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tcount = index.count;\r\n\r\n\t\t\t} else if ( position instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\t\tcount = position.data.array.length / 3;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcount = position.count;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar drawRange = geometry.drawRange;\r\n\r\n\t\t\tgroup = {\r\n\t\t\t\tstart: drawRange.start,\r\n\t\t\t\tcount: Math.min( drawRange.count, count )\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\tif ( material.wireframe === true ) {\r\n\r\n\t\t\t\tstate.setLineWidth( material.wireframeLinewidth * pixelRatio );\r\n\t\t\t\trenderer.setMode( _gl.LINES );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setMode( _gl.TRIANGLES );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometry instanceof THREE.InstancedBufferGeometry && geometry.maxInstancedCount > 0 ) {\r\n\r\n\t\t\t\trenderer.renderInstances( geometry );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.render( group.start, group.count );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\tvar lineWidth = material.linewidth;\r\n\r\n\t\t\tif ( lineWidth === undefined ) lineWidth = 1; // Not using Line*Material\r\n\r\n\t\t\tstate.setLineWidth( lineWidth * pixelRatio );\r\n\r\n\t\t\tif ( object instanceof THREE.LineSegments ) {\r\n\r\n\t\t\t\trenderer.setMode( _gl.LINES );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setMode( _gl.LINE_STRIP );\r\n\r\n\t\t\t}\r\n\r\n\t\t\trenderer.render( group.start, group.count );\r\n\r\n\t\t} else if ( object instanceof THREE.Points ) {\r\n\r\n\t\t\trenderer.setMode( _gl.POINTS );\r\n\t\t\trenderer.render( group.start, group.count );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction setupVertexAttributes( material, program, geometry, startIndex ) {\r\n\r\n\t\tvar extension;\r\n\r\n\t\tif ( geometry instanceof THREE.InstancedBufferGeometry ) {\r\n\r\n\t\t\textension = extensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( startIndex === undefined ) startIndex = 0;\r\n\r\n\t\tstate.initAttributes();\r\n\r\n\t\tvar geometryAttributes = geometry.attributes;\r\n\r\n\t\tvar programAttributes = program.getAttributes();\r\n\r\n\t\tvar materialDefaultAttributeValues = material.defaultAttributeValues;\r\n\r\n\t\tfor ( var name in programAttributes ) {\r\n\r\n\t\t\tvar programAttribute = programAttributes[ name ];\r\n\r\n\t\t\tif ( programAttribute >= 0 ) {\r\n\r\n\t\t\t\tvar geometryAttribute = geometryAttributes[ name ];\r\n\r\n\t\t\t\tif ( geometryAttribute !== undefined ) {\r\n\r\n\t\t\t\t\tstate.enableAttribute( programAttribute );\r\n\r\n\t\t\t\t\tvar size = geometryAttribute.itemSize;\r\n\t\t\t\t\tvar buffer = objects.getAttributeBuffer( geometryAttribute );\r\n\r\n\t\t\t\t\tif ( geometryAttribute instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\t\t\t\tvar data = geometryAttribute.data;\r\n\t\t\t\t\t\tvar stride = data.stride;\r\n\t\t\t\t\t\tvar offset = geometryAttribute.offset;\r\n\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffer );\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( programAttribute, size, _gl.FLOAT, false, stride * data.array.BYTES_PER_ELEMENT, ( startIndex * stride + offset ) * data.array.BYTES_PER_ELEMENT );\r\n\r\n\t\t\t\t\t\tif ( data instanceof THREE.InstancedInterleavedBuffer ) {\r\n\r\n\t\t\t\t\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\textension.vertexAttribDivisorANGLE( programAttribute, data.meshPerAttribute );\r\n\r\n\t\t\t\t\t\t\tif ( geometry.maxInstancedCount === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tgeometry.maxInstancedCount = data.meshPerAttribute * data.count;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffer );\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4 ); // 4 bytes per Float32\r\n\r\n\t\t\t\t\t\tif ( geometryAttribute instanceof THREE.InstancedBufferAttribute ) {\r\n\r\n\t\t\t\t\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\textension.vertexAttribDivisorANGLE( programAttribute, geometryAttribute.meshPerAttribute );\r\n\r\n\t\t\t\t\t\t\tif ( geometry.maxInstancedCount === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tgeometry.maxInstancedCount = geometryAttribute.meshPerAttribute * geometryAttribute.count;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( materialDefaultAttributeValues !== undefined ) {\r\n\r\n\t\t\t\t\tvar value = materialDefaultAttributeValues[ name ];\r\n\r\n\t\t\t\t\tif ( value !== undefined ) {\r\n\r\n\t\t\t\t\t\tswitch ( value.length ) {\r\n\r\n\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\t_gl.vertexAttrib2fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\t_gl.vertexAttrib3fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t\t_gl.vertexAttrib4fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t_gl.vertexAttrib1fv( programAttribute, value );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t}\r\n\r\n\t// Sorting\r\n\r\n\tfunction numericalSort ( a, b ) {\r\n\r\n\t\treturn b[ 0 ] - a[ 0 ];\r\n\r\n\t}\r\n\r\n\tfunction painterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.object.renderOrder !== b.object.renderOrder ) {\r\n\r\n\t\t\treturn a.object.renderOrder - b.object.renderOrder;\r\n\r\n\t\t} else if ( a.material.id !== b.material.id ) {\r\n\r\n\t\t\treturn a.material.id - b.material.id;\r\n\r\n\t\t} else if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn a.z - b.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction reversePainterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.object.renderOrder !== b.object.renderOrder ) {\r\n\r\n\t\t\treturn a.object.renderOrder - b.object.renderOrder;\r\n\r\n\t\t} if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Rendering\r\n\r\n\tthis.render = function ( scene, camera, renderTarget, forceClear ) {\r\n\r\n\t\tif ( camera instanceof THREE.Camera === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar fog = scene.fog;\r\n\r\n\t\t// reset caching for this frame\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\t\t_currentMaterialId = - 1;\r\n\t\t_currentCamera = null;\r\n\t\t_lightsNeedUpdate = true;\r\n\r\n\t\t// update scene graph\r\n\r\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\r\n\t\t// update camera matrices and frustum\r\n\r\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\tcamera.matrixWorldInverse.getInverse( camera.matrixWorld );\r\n\r\n\t\t_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );\r\n\t\t_frustum.setFromMatrix( _projScreenMatrix );\r\n\r\n\t\tlights.length = 0;\r\n\r\n\t\topaqueObjectsLastIndex = -1;\r\n\t\ttransparentObjectsLastIndex = -1;\r\n\r\n\t\topaqueImmediateObjectsLastIndex = -1;\r\n\t\ttransparentImmediateObjectsLastIndex = -1;\r\n\r\n\t\tsprites.length = 0;\r\n\t\tlensFlares.length = 0;\r\n\r\n\t\tprojectObject( scene );\r\n\r\n\t\topaqueObjects.length = opaqueObjectsLastIndex + 1;\r\n\t\ttransparentObjects.length = transparentObjectsLastIndex + 1;\r\n\r\n\t\topaqueImmediateObjects.length = opaqueImmediateObjectsLastIndex + 1;\r\n\t\ttransparentImmediateObjects.length = transparentImmediateObjectsLastIndex + 1;\r\n\r\n\t\tif ( _this.sortObjects === true ) {\r\n\r\n\t\t\topaqueObjects.sort( painterSortStable );\r\n\t\t\ttransparentObjects.sort( reversePainterSortStable );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tshadowMap.render( scene, camera );\r\n\r\n\t\t//\r\n\r\n\t\t_infoRender.calls = 0;\r\n\t\t_infoRender.vertices = 0;\r\n\t\t_infoRender.faces = 0;\r\n\t\t_infoRender.points = 0;\r\n\r\n\t\tthis.setRenderTarget( renderTarget );\r\n\r\n\t\tif ( this.autoClear || forceClear ) {\r\n\r\n\t\t\tthis.clear( this.autoClearColor, this.autoClearDepth, this.autoClearStencil );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( scene.overrideMaterial ) {\r\n\r\n\t\t\tvar overrideMaterial = scene.overrideMaterial;\r\n\r\n\t\t\trenderObjects( opaqueObjects, camera, lights, fog, overrideMaterial );\r\n\t\t\trenderObjects( transparentObjects, camera, lights, fog, overrideMaterial );\r\n\r\n\t\t\trenderObjectsImmediate( opaqueImmediateObjects, camera, lights, fog, overrideMaterial );\r\n\t\t\trenderObjectsImmediate( transparentImmediateObjects, camera, lights, fog, overrideMaterial );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// opaque pass (front-to-back order)\r\n\r\n\t\t\tstate.setBlending( THREE.NoBlending );\r\n\r\n\t\t\trenderObjects( opaqueObjects, camera, lights, fog );\r\n\t\t\trenderObjectsImmediate( opaqueImmediateObjects, camera, lights, fog );\r\n\r\n\t\t\t// transparent pass (back-to-front order)\r\n\r\n\t\t\trenderObjects( transparentObjects, camera, lights, fog );\r\n\t\t\trenderObjectsImmediate( transparentImmediateObjects, camera, lights, fog );\r\n\r\n\t\t}\r\n\r\n\t\t// custom render plugins (post pass)\r\n\r\n\t\tspritePlugin.render( scene, camera );\r\n\t\tlensFlarePlugin.render( scene, camera, _currentWidth, _currentHeight );\r\n\r\n\t\t// Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n\t\tif ( renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter ) {\r\n\r\n\t\t\tupdateRenderTargetMipmap( renderTarget );\r\n\r\n\t\t}\r\n\r\n\t\t// Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n\t\tstate.setDepthTest( true );\r\n\t\tstate.setDepthWrite( true );\r\n\t\tstate.setColorWrite( true );\r\n\r\n\t\t// _gl.finish();\r\n\r\n\t};\r\n\r\n\tfunction pushImmediateRenderItem( object ) {\r\n\r\n\t\tvar array, index;\r\n\r\n\t\t// allocate the next position in the appropriate array\r\n\r\n\t\tif ( object.material.transparent ) {\r\n\r\n\t\t\tarray = transparentImmediateObjects;\r\n\t\t\tindex = ++ transparentImmediateObjectsLastIndex;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tarray = opaqueImmediateObjects;\r\n\t\t\tindex = ++ opaqueImmediateObjectsLastIndex;\r\n\r\n\t\t}\r\n\r\n\t\t// recycle existing position or grow the array\r\n\r\n\t\tif ( index < array.length ) {\r\n\r\n\t\t\tarray[ index ] = object;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// assert( index === array.length );\r\n\t\t\tarray.push( object );\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tfunction pushRenderItem( object, geometry, material, z, group ) {\r\n\r\n\t\tvar array, index;\r\n\r\n\t\t// allocate the next position in the appropriate array\r\n\r\n\t\tif ( material.transparent ) {\r\n\r\n\t\t\tarray = transparentObjects;\r\n\t\t\tindex = ++ transparentObjectsLastIndex;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tarray = opaqueObjects;\r\n\t\t\tindex = ++ opaqueObjectsLastIndex;\r\n\r\n\t\t}\r\n\r\n\t\t// recycle existing render item or grow the array\r\n\r\n\t\tvar renderItem = array[ index ];\r\n\r\n\t\tif ( renderItem !== undefined ) {\r\n\r\n\t\t\trenderItem.id = object.id;\r\n\t\t\trenderItem.object = object;\r\n\t\t\trenderItem.geometry = geometry;\r\n\t\t\trenderItem.material = material;\r\n\t\t\trenderItem.z = _vector3.z;\r\n\t\t\trenderItem.group = group;\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderItem = {\r\n\t\t\t\tid: object.id,\r\n\t\t\t\tobject: object,\r\n\t\t\t\tgeometry: geometry,\r\n\t\t\t\tmaterial: material,\r\n\t\t\t\tz: _vector3.z,\r\n\t\t\t\tgroup: group\r\n\t\t\t};\r\n\r\n\t\t\t// assert( index === array.length );\r\n\t\t\tarray.push( renderItem );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction projectObject( object ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tif ( object instanceof THREE.Light ) {\r\n\r\n\t\t\tlights.push( object );\r\n\r\n\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\r\n\t\t\tsprites.push( object );\r\n\r\n\t\t} else if ( object instanceof THREE.LensFlare ) {\r\n\r\n\t\t\tlensFlares.push( object );\r\n\r\n\t\t} else if ( object instanceof THREE.ImmediateRenderObject ) {\r\n\r\n\t\t\tpushImmediateRenderItem( object );\r\n\r\n\t\t} else if ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Points ) {\r\n\r\n\t\t\tif ( object instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\t\tobject.skeleton.update();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) {\r\n\r\n\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\tif ( material.visible === true ) {\r\n\r\n\t\t\t\t\tif ( _this.sortObjects === true ) {\r\n\r\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld );\r\n\t\t\t\t\t\t_vector3.applyProjection( _projScreenMatrix );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar geometry = objects.update( object );\r\n\r\n\t\t\t\t\tif ( material instanceof THREE.MeshFaceMaterial ) {\r\n\r\n\t\t\t\t\t\tvar groups = geometry.groups;\r\n\t\t\t\t\t\tvar materials = material.materials;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar group = groups[ i ];\r\n\t\t\t\t\t\t\tvar groupMaterial = materials[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\t\tif ( groupMaterial.visible === true ) {\r\n\r\n\t\t\t\t\t\t\t\tpushRenderItem( object, geometry, groupMaterial, _vector3.z, group );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tpushRenderItem( object, geometry, material, _vector3.z );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar children = object.children;\r\n\r\n\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tprojectObject( children[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderObjects( renderList, camera, lights, fog, overrideMaterial ) {\r\n\r\n\t\tfor ( var i = 0, l = renderList.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar renderItem = renderList[ i ];\r\n\r\n\t\t\tvar object = renderItem.object;\r\n\t\t\tvar geometry = renderItem.geometry;\r\n\t\t\tvar material = overrideMaterial === undefined ? renderItem.material : overrideMaterial;\r\n\t\t\tvar group = renderItem.group;\r\n\r\n\t\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\r\n\t\t\tobject.normalMatrix.getNormalMatrix( object.modelViewMatrix );\r\n\r\n\t\t\t_this.renderBufferDirect( camera, lights, fog, geometry, material, object, group );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderObjectsImmediate( renderList, camera, lights, fog, overrideMaterial ) {\r\n\r\n\t\tvar material = overrideMaterial;\r\n\r\n\t\tfor ( var i = 0, l = renderList.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar object = renderList[ i ];\r\n\r\n\t\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\r\n\t\t\tobject.normalMatrix.getNormalMatrix( object.modelViewMatrix );\r\n\r\n\t\t\tif ( overrideMaterial === undefined ) material = object.material;\r\n\r\n\t\t\tsetMaterial( material );\r\n\r\n\t\t\tvar program = setProgram( camera, lights, fog, material, object );\r\n\r\n\t\t\t_currentGeometryProgram = '';\r\n\r\n\t\t\tobject.render( function ( object ) {\r\n\r\n\t\t\t\t_this.renderBufferImmediate( object, program, material );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction initMaterial( material, lights, fog, object ) {\r\n\r\n\t\tvar materialProperties = properties.get( material );\r\n\r\n\t\tvar parameters = programCache.getParameters( material, lights, fog, object );\r\n\t\tvar code = programCache.getProgramCode( material, parameters );\r\n\r\n\t\tvar program = materialProperties.program;\r\n\t\tvar programChange = true;\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\t// new material\r\n\t\t\tmaterial.addEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\t} else if ( program.code !== code ) {\r\n\r\n\t\t\t// changed glsl or parameters\r\n\t\t\treleaseMaterialProgramReference( material );\r\n\r\n\t\t} else if ( parameters.shaderID !== undefined ) {\r\n\r\n\t\t\t// same glsl and uniform list\r\n\t\t\treturn;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// only rebuild uniform list\r\n\t\t\tprogramChange = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( programChange ) {\r\n\r\n\t\t\tif ( parameters.shaderID ) {\r\n\r\n\t\t\t\tvar shader = THREE.ShaderLib[ parameters.shaderID ];\r\n\r\n\t\t\t\tmaterialProperties.__webglShader = {\r\n\t\t\t\t\tname: material.type,\r\n\t\t\t\t\tuniforms: THREE.UniformsUtils.clone( shader.uniforms ),\r\n\t\t\t\t\tvertexShader: shader.vertexShader,\r\n\t\t\t\t\tfragmentShader: shader.fragmentShader\r\n\t\t\t\t};\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterialProperties.__webglShader = {\r\n\t\t\t\t\tname: material.type,\r\n\t\t\t\t\tuniforms: material.uniforms,\r\n\t\t\t\t\tvertexShader: material.vertexShader,\r\n\t\t\t\t\tfragmentShader: material.fragmentShader\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterial.__webglShader = materialProperties.__webglShader;\r\n\r\n\t\t\tprogram = programCache.acquireProgram( material, parameters, code );\r\n\r\n\t\t\tmaterialProperties.program = program;\r\n\t\t\tmaterial.program = program;\r\n\r\n\t\t}\r\n\r\n\t\tvar attributes = program.getAttributes();\r\n\r\n\t\tif ( material.morphTargets ) {\r\n\r\n\t\t\tmaterial.numSupportedMorphTargets = 0;\r\n\r\n\t\t\tfor ( var i = 0; i < _this.maxMorphTargets; i ++ ) {\r\n\r\n\t\t\t\tif ( attributes[ 'morphTarget' + i ] >= 0 ) {\r\n\r\n\t\t\t\t\tmaterial.numSupportedMorphTargets ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.morphNormals ) {\r\n\r\n\t\t\tmaterial.numSupportedMorphNormals = 0;\r\n\r\n\t\t\tfor ( i = 0; i < _this.maxMorphNormals; i ++ ) {\r\n\r\n\t\t\t\tif ( attributes[ 'morphNormal' + i ] >= 0 ) {\r\n\r\n\t\t\t\t\tmaterial.numSupportedMorphNormals ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tmaterialProperties.uniformsList = [];\r\n\r\n\t\tvar uniformLocations = materialProperties.program.getUniforms();\r\n\r\n\t\tfor ( var u in materialProperties.__webglShader.uniforms ) {\r\n\r\n\t\t\tvar location = uniformLocations[ u ];\r\n\r\n\t\t\tif ( location ) {\r\n\r\n\t\t\t\tmaterialProperties.uniformsList.push( [ materialProperties.__webglShader.uniforms[ u ], location ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setMaterial( material ) {\r\n\r\n\t\tsetMaterialFaces( material );\r\n\r\n\t\tif ( material.transparent === true ) {\r\n\r\n\t\t\tstate.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tstate.setBlending( THREE.NoBlending );\r\n\r\n\t\t}\r\n\r\n\t\tstate.setDepthFunc( material.depthFunc );\r\n\t\tstate.setDepthTest( material.depthTest );\r\n\t\tstate.setDepthWrite( material.depthWrite );\r\n\t\tstate.setColorWrite( material.colorWrite );\r\n\t\tstate.setPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );\r\n\r\n\t}\r\n\r\n\tfunction setMaterialFaces( material ) {\r\n\r\n\t\tmaterial.side !== THREE.DoubleSide ? state.enable( _gl.CULL_FACE ) : state.disable( _gl.CULL_FACE );\r\n\t\tstate.setFlipSided( material.side === THREE.BackSide );\r\n\r\n\t}\r\n\r\n\tfunction setProgram( camera, lights, fog, material, object ) {\r\n\r\n\t\t_usedTextureUnits = 0;\r\n\r\n\t\tvar materialProperties = properties.get( material );\r\n\r\n\t\tif ( material.needsUpdate || ! materialProperties.program ) {\r\n\r\n\t\t\tinitMaterial( material, lights, fog, object );\r\n\t\t\tmaterial.needsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tvar refreshProgram = false;\r\n\t\tvar refreshMaterial = false;\r\n\t\tvar refreshLights = false;\r\n\r\n\t\tvar program = materialProperties.program,\r\n\t\t\tp_uniforms = program.getUniforms(),\r\n\t\t\tm_uniforms = materialProperties.__webglShader.uniforms;\r\n\r\n\t\tif ( program.id !== _currentProgram ) {\r\n\r\n\t\t\t_gl.useProgram( program.program );\r\n\t\t\t_currentProgram = program.id;\r\n\r\n\t\t\trefreshProgram = true;\r\n\t\t\trefreshMaterial = true;\r\n\t\t\trefreshLights = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.id !== _currentMaterialId ) {\r\n\r\n\t\t\tif ( _currentMaterialId === - 1 ) refreshLights = true;\r\n\t\t\t_currentMaterialId = material.id;\r\n\r\n\t\t\trefreshMaterial = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshProgram || camera !== _currentCamera ) {\r\n\r\n\t\t\t_gl.uniformMatrix4fv( p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements );\r\n\r\n\t\t\tif ( capabilities.logarithmicDepthBuffer ) {\r\n\r\n\t\t\t\t_gl.uniform1f( p_uniforms.logDepthBufFC, 2.0 / ( Math.log( camera.far + 1.0 ) / Math.LN2 ) );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif ( camera !== _currentCamera ) _currentCamera = camera;\r\n\r\n\t\t\t// load material specific uniforms\r\n\t\t\t// (shader material also gets them for the sake of genericity)\r\n\r\n\t\t\tif ( material instanceof THREE.ShaderMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material.envMap ) {\r\n\r\n\t\t\t\tif ( p_uniforms.cameraPosition !== undefined ) {\r\n\r\n\t\t\t\t\t_vector3.setFromMatrixPosition( camera.matrixWorld );\r\n\t\t\t\t\t_gl.uniform3f( p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t material instanceof THREE.ShaderMaterial ||\r\n\t\t\t\t material.skinning ) {\r\n\r\n\t\t\t\tif ( p_uniforms.viewMatrix !== undefined ) {\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// skinning uniforms must be set even if material didn't change\r\n\t\t// auto-setting of texture unit for bone texture must go before other textures\r\n\t\t// not sure why, but otherwise weird things happen\r\n\r\n\t\tif ( material.skinning ) {\r\n\r\n\t\t\tif ( object.bindMatrix && p_uniforms.bindMatrix !== undefined ) {\r\n\r\n\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.bindMatrix, false, object.bindMatrix.elements );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== undefined ) {\r\n\r\n\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( capabilities.floatVertexTextures && object.skeleton && object.skeleton.useVertexTexture ) {\r\n\r\n\t\t\t\tif ( p_uniforms.boneTexture !== undefined ) {\r\n\r\n\t\t\t\t\tvar textureUnit = getTextureUnit();\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTexture, textureUnit );\r\n\t\t\t\t\t_this.setTexture( object.skeleton.boneTexture, textureUnit );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p_uniforms.boneTextureWidth !== undefined ) {\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p_uniforms.boneTextureHeight !== undefined ) {\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object.skeleton && object.skeleton.boneMatrices ) {\r\n\r\n\t\t\t\tif ( p_uniforms.boneGlobalMatrices !== undefined ) {\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshMaterial ) {\r\n\r\n\t\t\t// refresh uniforms common to several materials\r\n\r\n\t\t\tif ( fog && material.fog ) {\r\n\r\n\t\t\t\trefreshUniformsFog( m_uniforms, fog );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material.lights ) {\r\n\r\n\t\t\t\tif ( _lightsNeedUpdate ) {\r\n\r\n\t\t\t\t\trefreshLights = true;\r\n\t\t\t\t\tsetupLights( lights, camera );\r\n\t\t\t\t\t_lightsNeedUpdate = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( refreshLights ) {\r\n\r\n\t\t\t\t\trefreshUniformsLights( m_uniforms, _lights );\r\n\t\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, true );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, false );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsCommon( m_uniforms, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// refresh single material specific uniforms\r\n\r\n\t\t\tif ( material instanceof THREE.LineBasicMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsLine( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.LineDashedMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsLine( m_uniforms, material );\r\n\t\t\t\trefreshUniformsDash( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.PointsMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsParticle( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsPhong( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshDepthMaterial ) {\r\n\r\n\t\t\t\tm_uniforms.mNear.value = camera.near;\r\n\t\t\t\tm_uniforms.mFar.value = camera.far;\r\n\t\t\t\tm_uniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshNormalMaterial ) {\r\n\r\n\t\t\t\tm_uniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( object.receiveShadow && ! material._shadowPass ) {\r\n\r\n\t\t\t\trefreshUniformsShadow( m_uniforms, lights );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// load common uniforms\r\n\r\n\t\t\tloadUniformsGeneric( materialProperties.uniformsList );\r\n\r\n\t\t}\r\n\r\n\t\tloadUniformsMatrices( p_uniforms, object );\r\n\r\n\t\tif ( p_uniforms.modelMatrix !== undefined ) {\r\n\r\n\t\t\t_gl.uniformMatrix4fv( p_uniforms.modelMatrix, false, object.matrixWorld.elements );\r\n\r\n\t\t}\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\t// Uniforms (refresh uniforms objects)\r\n\r\n\tfunction refreshUniformsCommon ( uniforms, material ) {\r\n\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\tuniforms.diffuse.value = material.color;\r\n\r\n\t\tif ( material.emissive ) {\r\n\r\n\t\t\tuniforms.emissive.value = material.emissive;\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.map.value = material.map;\r\n\t\tuniforms.specularMap.value = material.specularMap;\r\n\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\tif ( material.aoMap ) {\r\n\r\n\t\t\tuniforms.aoMap.value = material.aoMap;\r\n\t\t\tuniforms.aoMapIntensity.value = material.aoMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities\r\n\t\t// 1. color map\r\n\t\t// 2. specular map\r\n\t\t// 3. normal map\r\n\t\t// 4. bump map\r\n\t\t// 5. alpha map\r\n\t\t// 6. emissive map\r\n\r\n\t\tvar uvScaleMap;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t} else if ( material.specularMap ) {\r\n\r\n\t\t\tuvScaleMap = material.specularMap;\r\n\r\n\t\t} else if ( material.displacementMap ) {\r\n\r\n\t\t\tuvScaleMap = material.displacementMap;\r\n\r\n\t\t} else if ( material.normalMap ) {\r\n\r\n\t\t\tuvScaleMap = material.normalMap;\r\n\r\n\t\t} else if ( material.bumpMap ) {\r\n\r\n\t\t\tuvScaleMap = material.bumpMap;\r\n\r\n\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t} else if ( material.emissiveMap ) {\r\n\r\n\t\t\tuvScaleMap = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\tvar offset = uvScaleMap.offset;\r\n\t\t\tvar repeat = uvScaleMap.repeat;\r\n\r\n\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.envMap.value = material.envMap;\r\n\t\tuniforms.flipEnvMap.value = ( material.envMap instanceof THREE.WebGLRenderTargetCube ) ? 1 : - 1;\r\n\r\n\t\tuniforms.reflectivity.value = material.reflectivity;\r\n\t\tuniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLine ( uniforms, material ) {\r\n\r\n\t\tuniforms.diffuse.value = material.color;\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsDash ( uniforms, material ) {\r\n\r\n\t\tuniforms.dashSize.value = material.dashSize;\r\n\t\tuniforms.totalSize.value = material.dashSize + material.gapSize;\r\n\t\tuniforms.scale.value = material.scale;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsParticle ( uniforms, material ) {\r\n\r\n\t\tuniforms.psColor.value = material.color;\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\t\tuniforms.size.value = material.size;\r\n\t\tuniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n\t\tuniforms.map.value = material.map;\r\n\r\n\t\tif ( material.map !== null ) {\r\n\r\n\t\t\tvar offset = material.map.offset;\r\n\t\t\tvar repeat = material.map.repeat;\r\n\r\n\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsFog ( uniforms, fog ) {\r\n\r\n\t\tuniforms.fogColor.value = fog.color;\r\n\r\n\t\tif ( fog instanceof THREE.Fog ) {\r\n\r\n\t\t\tuniforms.fogNear.value = fog.near;\r\n\t\t\tuniforms.fogFar.value = fog.far;\r\n\r\n\t\t} else if ( fog instanceof THREE.FogExp2 ) {\r\n\r\n\t\t\tuniforms.fogDensity.value = fog.density;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsPhong ( uniforms, material ) {\r\n\r\n\t\tuniforms.specular.value = material.specular;\r\n\t\tuniforms.shininess.value = material.shininess;\r\n\r\n\t\tif ( material.lightMap ) {\r\n\r\n\t\t\tuniforms.lightMap.value = material.lightMap;\r\n\t\t\tuniforms.lightMapIntensity.value = material.lightMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.emissiveMap ) {\r\n\r\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLights ( uniforms, lights ) {\r\n\r\n\t\tuniforms.ambientLightColor.value = lights.ambient;\r\n\r\n\t\tuniforms.directionalLightColor.value = lights.directional.colors;\r\n\t\tuniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n\t\tuniforms.pointLightColor.value = lights.point.colors;\r\n\t\tuniforms.pointLightPosition.value = lights.point.positions;\r\n\t\tuniforms.pointLightDistance.value = lights.point.distances;\r\n\t\tuniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n\t\tuniforms.spotLightColor.value = lights.spot.colors;\r\n\t\tuniforms.spotLightPosition.value = lights.spot.positions;\r\n\t\tuniforms.spotLightDistance.value = lights.spot.distances;\r\n\t\tuniforms.spotLightDirection.value = lights.spot.directions;\r\n\t\tuniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n\t\tuniforms.spotLightExponent.value = lights.spot.exponents;\r\n\t\tuniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n\t\tuniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n\t\tuniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n\t\tuniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n\t}\r\n\r\n\t// If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n\tfunction markUniformsLightsNeedsUpdate ( uniforms, value ) {\r\n\r\n\t\tuniforms.ambientLightColor.needsUpdate = value;\r\n\r\n\t\tuniforms.directionalLightColor.needsUpdate = value;\r\n\t\tuniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n\t\tuniforms.pointLightColor.needsUpdate = value;\r\n\t\tuniforms.pointLightPosition.needsUpdate = value;\r\n\t\tuniforms.pointLightDistance.needsUpdate = value;\r\n\t\tuniforms.pointLightDecay.needsUpdate = value;\r\n\r\n\t\tuniforms.spotLightColor.needsUpdate = value;\r\n\t\tuniforms.spotLightPosition.needsUpdate = value;\r\n\t\tuniforms.spotLightDistance.needsUpdate = value;\r\n\t\tuniforms.spotLightDirection.needsUpdate = value;\r\n\t\tuniforms.spotLightAngleCos.needsUpdate = value;\r\n\t\tuniforms.spotLightExponent.needsUpdate = value;\r\n\t\tuniforms.spotLightDecay.needsUpdate = value;\r\n\r\n\t\tuniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n\t\tuniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n\t\tuniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsShadow ( uniforms, lights ) {\r\n\r\n\t\tif ( uniforms.shadowMatrix ) {\r\n\r\n\t\t\tvar j = 0;\r\n\r\n\t\t\tfor ( var i = 0, il = lights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar light = lights[ i ];\r\n\r\n\t\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\t\tif ( light instanceof THREE.SpotLight || ( light instanceof THREE.DirectionalLight ) ) {\r\n\r\n\t\t\t\t\tuniforms.shadowMap.value[ j ] = light.shadowMap;\r\n\t\t\t\t\tuniforms.shadowMapSize.value[ j ] = light.shadowMapSize;\r\n\r\n\t\t\t\t\tuniforms.shadowMatrix.value[ j ] = light.shadowMatrix;\r\n\r\n\t\t\t\t\tuniforms.shadowDarkness.value[ j ] = light.shadowDarkness;\r\n\t\t\t\t\tuniforms.shadowBias.value[ j ] = light.shadowBias;\r\n\r\n\t\t\t\t\tj ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Uniforms (load to GPU)\r\n\r\n\tfunction loadUniformsMatrices ( uniforms, object ) {\r\n\r\n\t\t_gl.uniformMatrix4fv( uniforms.modelViewMatrix, false, object.modelViewMatrix.elements );\r\n\r\n\t\tif ( uniforms.normalMatrix ) {\r\n\r\n\t\t\t_gl.uniformMatrix3fv( uniforms.normalMatrix, false, object.normalMatrix.elements );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction getTextureUnit() {\r\n\r\n\t\tvar textureUnit = _usedTextureUnits;\r\n\r\n\t\tif ( textureUnit >= capabilities.maxTextures ) {\r\n\r\n\t\t\tconsole.warn( 'WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + capabilities.maxTextures );\r\n\r\n\t\t}\r\n\r\n\t\t_usedTextureUnits += 1;\r\n\r\n\t\treturn textureUnit;\r\n\r\n\t}\r\n\r\n\tfunction loadUniformsGeneric ( uniforms ) {\r\n\r\n\t\tvar texture, textureUnit;\r\n\r\n\t\tfor ( var j = 0, jl = uniforms.length; j < jl; j ++ ) {\r\n\r\n\t\t\tvar uniform = uniforms[ j ][ 0 ];\r\n\r\n\t\t\t// needsUpdate property is not added to all uniforms.\r\n\t\t\tif ( uniform.needsUpdate === false ) continue;\r\n\r\n\t\t\tvar type = uniform.type;\r\n\t\t\tvar value = uniform.value;\r\n\t\t\tvar location = uniforms[ j ][ 1 ];\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase '1i':\r\n\t\t\t\t\t_gl.uniform1i( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1f':\r\n\t\t\t\t\t_gl.uniform1f( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '2f':\r\n\t\t\t\t\t_gl.uniform2f( location, value[ 0 ], value[ 1 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3f':\r\n\t\t\t\t\t_gl.uniform3f( location, value[ 0 ], value[ 1 ], value[ 2 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '4f':\r\n\t\t\t\t\t_gl.uniform4f( location, value[ 0 ], value[ 1 ], value[ 2 ], value[ 3 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1iv':\r\n\t\t\t\t\t_gl.uniform1iv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3iv':\r\n\t\t\t\t\t_gl.uniform3iv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1fv':\r\n\t\t\t\t\t_gl.uniform1fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '2fv':\r\n\t\t\t\t\t_gl.uniform2fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3fv':\r\n\t\t\t\t\t_gl.uniform3fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '4fv':\r\n\t\t\t\t\t_gl.uniform4fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Matrix3fv':\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Matrix4fv':\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tcase 'i':\r\n\r\n\t\t\t\t\t// single integer\r\n\t\t\t\t\t_gl.uniform1i( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'f':\r\n\r\n\t\t\t\t\t// single float\r\n\t\t\t\t\t_gl.uniform1f( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v2':\r\n\r\n\t\t\t\t\t// single THREE.Vector2\r\n\t\t\t\t\t_gl.uniform2f( location, value.x, value.y );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v3':\r\n\r\n\t\t\t\t\t// single THREE.Vector3\r\n\t\t\t\t\t_gl.uniform3f( location, value.x, value.y, value.z );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v4':\r\n\r\n\t\t\t\t\t// single THREE.Vector4\r\n\t\t\t\t\t_gl.uniform4f( location, value.x, value.y, value.z, value.w );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'c':\r\n\r\n\t\t\t\t\t// single THREE.Color\r\n\t\t\t\t\t_gl.uniform3f( location, value.r, value.g, value.b );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'iv1':\r\n\r\n\t\t\t\t\t// flat array of integers (JS or typed array)\r\n\t\t\t\t\t_gl.uniform1iv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'iv':\r\n\r\n\t\t\t\t\t// flat array of integers with 3 x N size (JS or typed array)\r\n\t\t\t\t\t_gl.uniform3iv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'fv1':\r\n\r\n\t\t\t\t\t// flat array of floats (JS or typed array)\r\n\t\t\t\t\t_gl.uniform1fv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'fv':\r\n\r\n\t\t\t\t\t// flat array of floats with 3 x N size (JS or typed array)\r\n\t\t\t\t\t_gl.uniform3fv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v2v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector2\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 2 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, i2 = 0, il = value.length; i < il; i ++, i2 += 2 ) {\r\n\r\n\t\t\t\t\t\tuniform._array[ i2 + 0 ] = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ i2 + 1 ] = value[ i ].y;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform2fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v3v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector3\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 3 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, i3 = 0, il = value.length; i < il; i ++, i3 += 3 ) {\r\n\r\n\t\t\t\t\t\tuniform._array[ i3 + 0 ] = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ i3 + 1 ] = value[ i ].y;\r\n\t\t\t\t\t\tuniform._array[ i3 + 2 ] = value[ i ].z;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform3fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v4v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector4\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 4 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, i4 = 0, il = value.length; i < il; i ++, i4 += 4 ) {\r\n\r\n\t\t\t\t\t\tuniform._array[ i4 + 0 ] = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ i4 + 1 ] = value[ i ].y;\r\n\t\t\t\t\t\tuniform._array[ i4 + 2 ] = value[ i ].z;\r\n\t\t\t\t\t\tuniform._array[ i4 + 3 ] = value[ i ].w;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform4fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm3':\r\n\r\n\t\t\t\t\t// single THREE.Matrix3\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, value.elements );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm3v':\r\n\r\n\t\t\t\t\t// array of THREE.Matrix3\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 9 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvalue[ i ].flattenToArrayOffset( uniform._array, i * 9 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm4':\r\n\r\n\t\t\t\t\t// single THREE.Matrix4\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, value.elements );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm4v':\r\n\r\n\t\t\t\t\t// array of THREE.Matrix4\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 16 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvalue[ i ].flattenToArrayOffset( uniform._array, i * 16 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 't':\r\n\r\n\t\t\t\t\t// single THREE.Texture (2d or cube)\r\n\r\n\t\t\t\t\ttexture = value;\r\n\t\t\t\t\ttextureUnit = getTextureUnit();\r\n\r\n\t\t\t\t\t_gl.uniform1i( location, textureUnit );\r\n\r\n\t\t\t\t\tif ( ! texture ) continue;\r\n\r\n\t\t\t\t\tif ( texture instanceof THREE.CubeTexture ||\r\n\t\t\t\t\t\t ( Array.isArray( texture.image ) && texture.image.length === 6 ) ) {\r\n\r\n\t\t\t\t\t\t// CompressedTexture can have Array in image :/\r\n\r\n\t\t\t\t\t\tsetCubeTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t} else if ( texture instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\t\t\t\tsetCubeTextureDynamic( texture, textureUnit );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t_this.setTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'tv':\r\n\r\n\t\t\t\t\t// array of THREE.Texture (2d)\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = [];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = uniform.value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tuniform._array[ i ] = getTextureUnit();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform1iv( location, uniform._array );\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = uniform.value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\ttexture = uniform.value[ i ];\r\n\t\t\t\t\t\ttextureUnit = uniform._array[ i ];\r\n\r\n\t\t\t\t\t\tif ( ! texture ) continue;\r\n\r\n\t\t\t\t\t\t_this.setTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Unknown uniform type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setColorLinear( array, offset, color, intensity ) {\r\n\r\n\t\tarray[ offset + 0 ] = color.r * intensity;\r\n\t\tarray[ offset + 1 ] = color.g * intensity;\r\n\t\tarray[ offset + 2 ] = color.b * intensity;\r\n\r\n\t}\r\n\r\n\tfunction setupLights ( lights, camera ) {\r\n\r\n\t\tvar l, ll, light,\r\n\t\tr = 0, g = 0, b = 0,\r\n\t\tcolor, skyColor, groundColor,\r\n\t\tintensity,\r\n\t\tdistance,\r\n\r\n\t\tzlights = _lights,\r\n\r\n\t\tviewMatrix = camera.matrixWorldInverse,\r\n\r\n\t\tdirColors = zlights.directional.colors,\r\n\t\tdirPositions = zlights.directional.positions,\r\n\r\n\t\tpointColors = zlights.point.colors,\r\n\t\tpointPositions = zlights.point.positions,\r\n\t\tpointDistances = zlights.point.distances,\r\n\t\tpointDecays = zlights.point.decays,\r\n\r\n\t\tspotColors = zlights.spot.colors,\r\n\t\tspotPositions = zlights.spot.positions,\r\n\t\tspotDistances = zlights.spot.distances,\r\n\t\tspotDirections = zlights.spot.directions,\r\n\t\tspotAnglesCos = zlights.spot.anglesCos,\r\n\t\tspotExponents = zlights.spot.exponents,\r\n\t\tspotDecays = zlights.spot.decays,\r\n\r\n\t\themiSkyColors = zlights.hemi.skyColors,\r\n\t\themiGroundColors = zlights.hemi.groundColors,\r\n\t\themiPositions = zlights.hemi.positions,\r\n\r\n\t\tdirLength = 0,\r\n\t\tpointLength = 0,\r\n\t\tspotLength = 0,\r\n\t\themiLength = 0,\r\n\r\n\t\tdirCount = 0,\r\n\t\tpointCount = 0,\r\n\t\tspotCount = 0,\r\n\t\themiCount = 0,\r\n\r\n\t\tdirOffset = 0,\r\n\t\tpointOffset = 0,\r\n\t\tspotOffset = 0,\r\n\t\themiOffset = 0;\r\n\r\n\t\tfor ( l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tlight = lights[ l ];\r\n\r\n\t\t\tif ( light.onlyShadow ) continue;\r\n\r\n\t\t\tcolor = light.color;\r\n\t\t\tintensity = light.intensity;\r\n\t\t\tdistance = light.distance;\r\n\r\n\t\t\tif ( light instanceof THREE.AmbientLight ) {\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tr += color.r;\r\n\t\t\t\tg += color.g;\r\n\t\t\t\tb += color.b;\r\n\r\n\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\tdirCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\t_direction.sub( _vector3 );\r\n\t\t\t\t_direction.transformDirection( viewMatrix );\r\n\r\n\t\t\t\tdirOffset = dirLength * 3;\r\n\r\n\t\t\t\tdirPositions[ dirOffset + 0 ] = _direction.x;\r\n\t\t\t\tdirPositions[ dirOffset + 1 ] = _direction.y;\r\n\t\t\t\tdirPositions[ dirOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tsetColorLinear( dirColors, dirOffset, color, intensity );\r\n\r\n\t\t\t\tdirLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\tpointCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tpointOffset = pointLength * 3;\r\n\r\n\t\t\t\tsetColorLinear( pointColors, pointOffset, color, intensity );\r\n\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_vector3.applyMatrix4( viewMatrix );\r\n\r\n\t\t\t\tpointPositions[ pointOffset + 0 ] = _vector3.x;\r\n\t\t\t\tpointPositions[ pointOffset + 1 ] = _vector3.y;\r\n\t\t\t\tpointPositions[ pointOffset + 2 ] = _vector3.z;\r\n\r\n\t\t\t\t// distance is 0 if decay is 0, because there is no attenuation at all.\r\n\t\t\t\tpointDistances[ pointLength ] = distance;\r\n\t\t\t\tpointDecays[ pointLength ] = ( light.distance === 0 ) ? 0.0 : light.decay;\r\n\r\n\t\t\t\tpointLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.SpotLight ) {\r\n\r\n\t\t\t\tspotCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tspotOffset = spotLength * 3;\r\n\r\n\t\t\t\tsetColorLinear( spotColors, spotOffset, color, intensity );\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_vector3.copy( _direction ).applyMatrix4( viewMatrix );\r\n\r\n\t\t\t\tspotPositions[ spotOffset + 0 ] = _vector3.x;\r\n\t\t\t\tspotPositions[ spotOffset + 1 ] = _vector3.y;\r\n\t\t\t\tspotPositions[ spotOffset + 2 ] = _vector3.z;\r\n\r\n\t\t\t\tspotDistances[ spotLength ] = distance;\r\n\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\t_direction.sub( _vector3 );\r\n\t\t\t\t_direction.transformDirection( viewMatrix );\r\n\r\n\t\t\t\tspotDirections[ spotOffset + 0 ] = _direction.x;\r\n\t\t\t\tspotDirections[ spotOffset + 1 ] = _direction.y;\r\n\t\t\t\tspotDirections[ spotOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tspotAnglesCos[ spotLength ] = Math.cos( light.angle );\r\n\t\t\t\tspotExponents[ spotLength ] = light.exponent;\r\n\t\t\t\tspotDecays[ spotLength ] = ( light.distance === 0 ) ? 0.0 : light.decay;\r\n\r\n\t\t\t\tspotLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.HemisphereLight ) {\r\n\r\n\t\t\t\themiCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_direction.transformDirection( viewMatrix );\r\n\r\n\t\t\t\themiOffset = hemiLength * 3;\r\n\r\n\t\t\t\themiPositions[ hemiOffset + 0 ] = _direction.x;\r\n\t\t\t\themiPositions[ hemiOffset + 1 ] = _direction.y;\r\n\t\t\t\themiPositions[ hemiOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tskyColor = light.color;\r\n\t\t\t\tgroundColor = light.groundColor;\r\n\r\n\t\t\t\tsetColorLinear( hemiSkyColors, hemiOffset, skyColor, intensity );\r\n\t\t\t\tsetColorLinear( hemiGroundColors, hemiOffset, groundColor, intensity );\r\n\r\n\t\t\t\themiLength += 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// null eventual remains from removed lights\r\n\t\t// (this is to avoid if in shader)\r\n\r\n\t\tfor ( l = dirLength * 3, ll = Math.max( dirColors.length, dirCount * 3 ); l < ll; l ++ ) dirColors[ l ] = 0.0;\r\n\t\tfor ( l = pointLength * 3, ll = Math.max( pointColors.length, pointCount * 3 ); l < ll; l ++ ) pointColors[ l ] = 0.0;\r\n\t\tfor ( l = spotLength * 3, ll = Math.max( spotColors.length, spotCount * 3 ); l < ll; l ++ ) spotColors[ l ] = 0.0;\r\n\t\tfor ( l = hemiLength * 3, ll = Math.max( hemiSkyColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiSkyColors[ l ] = 0.0;\r\n\t\tfor ( l = hemiLength * 3, ll = Math.max( hemiGroundColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiGroundColors[ l ] = 0.0;\r\n\r\n\t\tzlights.directional.length = dirLength;\r\n\t\tzlights.point.length = pointLength;\r\n\t\tzlights.spot.length = spotLength;\r\n\t\tzlights.hemi.length = hemiLength;\r\n\r\n\t\tzlights.ambient[ 0 ] = r;\r\n\t\tzlights.ambient[ 1 ] = g;\r\n\t\tzlights.ambient[ 2 ] = b;\r\n\r\n\t}\r\n\r\n\t// GL state setting\r\n\r\n\tthis.setFaceCulling = function ( cullFace, frontFaceDirection ) {\r\n\r\n\t\tif ( cullFace === THREE.CullFaceNone ) {\r\n\r\n\t\t\tstate.disable( _gl.CULL_FACE );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( frontFaceDirection === THREE.FrontFaceDirectionCW ) {\r\n\r\n\t\t\t\t_gl.frontFace( _gl.CW );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.frontFace( _gl.CCW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( cullFace === THREE.CullFaceBack ) {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t\t} else if ( cullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.FRONT );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.FRONT_AND_BACK );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tstate.enable( _gl.CULL_FACE );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Textures\r\n\r\n\tfunction setTextureParameters ( textureType, texture, isImagePowerOfTwo ) {\r\n\r\n\t\tvar extension;\r\n\r\n\t\tif ( isImagePowerOfTwo ) {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL( texture.wrapS ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL( texture.wrapT ) );\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL( texture.magFilter ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL( texture.minFilter ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE );\r\n\r\n\t\t\tif ( texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterFallback( texture.magFilter ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterFallback( texture.minFilter ) );\r\n\r\n\t\t\tif ( texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\tif ( extension ) {\r\n\r\n\t\t\tif ( texture.type === THREE.FloatType && extensions.get( 'OES_texture_float_linear' ) === null ) return;\r\n\t\t\tif ( texture.type === THREE.HalfFloatType && extensions.get( 'OES_texture_half_float_linear' ) === null ) return;\r\n\r\n\t\t\tif ( texture.anisotropy > 1 || properties.get( texture ).__currentAnisotropy ) {\r\n\r\n\t\t\t\t_gl.texParameterf( textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min( texture.anisotropy, _this.getMaxAnisotropy() ) );\r\n\t\t\t\tproperties.get( texture ).__currentAnisotropy = texture.anisotropy;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction uploadTexture( textureProperties, texture, slot ) {\r\n\r\n\t\tif ( textureProperties.__webglInit === undefined ) {\r\n\r\n\t\t\ttextureProperties.__webglInit = true;\r\n\r\n\t\t\ttexture.__webglInit = true;\r\n\r\n\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\ttextureProperties.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\t_infoMemory.textures ++;\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_2D, textureProperties.__webglTexture );\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );\r\n\r\n\t\ttexture.image = clampToMaxSize( texture.image, capabilities.maxTextureSize );\r\n\r\n\t\tvar image = texture.image,\r\n\t\tisImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),\r\n\t\tglFormat = paramThreeToGL( texture.format ),\r\n\t\tglType = paramThreeToGL( texture.type );\r\n\r\n\t\tsetTextureParameters( _gl.TEXTURE_2D, texture, isImagePowerOfTwo );\r\n\r\n\t\tvar mipmap, mipmaps = texture.mipmaps;\r\n\r\n\t\tif ( texture instanceof THREE.DataTexture ) {\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( texture instanceof THREE.CompressedTexture ) {\r\n\r\n\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmipmap = mipmaps[ i ];\r\n\r\n\t\t\t\tif ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {\r\n\r\n\t\t\t\t\tif ( state.getCompressedTextureFormats().indexOf( glFormat ) > - 1 ) {\r\n\r\n\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( \"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\" );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// regular Texture (image, video, canvas)\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( texture.generateMipmaps && isImagePowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );\r\n\r\n\t\ttextureProperties.__version = texture.version;\r\n\r\n\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\r\n\t}\r\n\r\n\tthis.setTexture = function ( texture, slot ) {\r\n\r\n\t\tvar textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\tvar image = texture.image;\r\n\r\n\t\t\tif ( image === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is undefined', texture );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( image.complete === false ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is incomplete', texture );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuploadTexture( textureProperties, texture, slot );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_2D, textureProperties.__webglTexture );\r\n\r\n\t};\r\n\r\n\tfunction clampToMaxSize ( image, maxSize ) {\r\n\r\n\t\tif ( image.width > maxSize || image.height > maxSize ) {\r\n\r\n\t\t\t// Warning: Scaling through the canvas will only work with images that use\r\n\t\t\t// premultiplied alpha.\r\n\r\n\t\t\tvar scale = maxSize / Math.max( image.width, image.height );\r\n\r\n\t\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\t\tcanvas.width = Math.floor( image.width * scale );\r\n\t\t\tcanvas.height = Math.floor( image.height * scale );\r\n\r\n\t\t\tvar context = canvas.getContext( '2d' );\r\n\t\t\tcontext.drawImage( image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height );\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image );\r\n\r\n\t\t\treturn canvas;\r\n\r\n\t\t}\r\n\r\n\t\treturn image;\r\n\r\n\t}\r\n\r\n\tfunction setCubeTexture ( texture, slot ) {\r\n\r\n\t\tvar textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.image.length === 6 ) {\r\n\r\n\t\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\t\tif ( ! textureProperties.__image__webglTextureCube ) {\r\n\r\n\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\t\t\ttextureProperties.__image__webglTextureCube = _gl.createTexture();\r\n\r\n\t\t\t\t\t_infoMemory.textures ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__image__webglTextureCube );\r\n\r\n\t\t\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\r\n\t\t\t\tvar isCompressed = texture instanceof THREE.CompressedTexture;\r\n\t\t\t\tvar isDataTexture = texture.image[ 0 ] instanceof THREE.DataTexture;\r\n\r\n\t\t\t\tvar cubeImage = [];\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\tif ( _this.autoScaleCubemaps && ! isCompressed && ! isDataTexture ) {\r\n\r\n\t\t\t\t\t\tcubeImage[ i ] = clampToMaxSize( texture.image[ i ], capabilities.maxCubemapSize );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tcubeImage[ i ] = isDataTexture ? texture.image[ i ].image : texture.image[ i ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar image = cubeImage[ 0 ],\r\n\t\t\t\tisImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),\r\n\t\t\t\tglFormat = paramThreeToGL( texture.format ),\r\n\t\t\t\tglType = paramThreeToGL( texture.type );\r\n\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo );\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\tif ( ! isCompressed ) {\r\n\r\n\t\t\t\t\t\tif ( isDataTexture ) {\r\n\r\n\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[ i ].width, cubeImage[ i ].height, 0, glFormat, glType, cubeImage[ i ].data );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[ i ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar mipmap, mipmaps = cubeImage[ i ].mipmaps;\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = mipmaps.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tmipmap = mipmaps[ j ];\r\n\r\n\t\t\t\t\t\t\tif ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( state.getCompressedTextureFormats().indexOf( glFormat ) > - 1 ) {\r\n\r\n\t\t\t\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.warn( \"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\" );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( texture.generateMipmaps && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\t\t_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextureProperties.__version = texture.version;\r\n\r\n\t\t\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__image__webglTextureCube );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setCubeTextureDynamic ( texture, slot ) {\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, properties.get( texture ).__webglTexture );\r\n\r\n\t}\r\n\r\n\t// Render targets\r\n\r\n\tfunction setupFrameBuffer ( framebuffer, renderTarget, textureTarget ) {\r\n\r\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, properties.get( renderTarget ).__webglTexture, 0 );\r\n\r\n\t}\r\n\r\n\tfunction setupRenderBuffer ( renderbuffer, renderTarget ) {\r\n\r\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t/* For some reason this is not working. Defaulting to RGBA4.\r\n\t\t} else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\t\t*/\r\n\r\n\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.setRenderTarget = function ( renderTarget ) {\r\n\r\n\t\tvar isCube = ( renderTarget instanceof THREE.WebGLRenderTargetCube );\r\n\r\n\t\tif ( renderTarget && properties.get( renderTarget ).__webglFramebuffer === undefined ) {\r\n\r\n\t\t\tvar renderTargetProperties = properties.get( renderTarget );\r\n\r\n\t\t\tif ( renderTarget.depthBuffer === undefined ) renderTarget.depthBuffer = true;\r\n\t\t\tif ( renderTarget.stencilBuffer === undefined ) renderTarget.stencilBuffer = true;\r\n\r\n\t\t\trenderTarget.addEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\t\trenderTargetProperties.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\t_infoMemory.textures ++;\r\n\r\n\t\t\t// Setup texture, create render and frame buffers\r\n\r\n\t\t\tvar isTargetPowerOfTwo = THREE.Math.isPowerOfTwo( renderTarget.width ) && THREE.Math.isPowerOfTwo( renderTarget.height ),\r\n\t\t\t\tglFormat = paramThreeToGL( renderTarget.format ),\r\n\t\t\t\tglType = paramThreeToGL( renderTarget.type );\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\trenderTargetProperties.__webglFramebuffer = [];\r\n\t\t\t\trenderTargetProperties.__webglRenderbuffer = [];\r\n\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, renderTargetProperties.__webglTexture );\r\n\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo );\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\trenderTargetProperties.__webglFramebuffer[ i ] = _gl.createFramebuffer();\r\n\t\t\t\t\trenderTargetProperties.__webglRenderbuffer[ i ] = _gl.createRenderbuffer();\r\n\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\r\n\r\n\t\t\t\t\tsetupFrameBuffer( renderTargetProperties.__webglFramebuffer[ i ], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i );\r\n\t\t\t\t\tsetupRenderBuffer( renderTargetProperties.__webglRenderbuffer[ i ], renderTarget );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( renderTarget.generateMipmaps && isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderTargetProperties.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n\t\t\t\tif ( renderTarget.shareDepthFrom ) {\r\n\r\n\t\t\t\t\trenderTargetProperties.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\trenderTargetProperties.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_2D, renderTargetProperties.__webglTexture );\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo );\r\n\r\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\r\n\r\n\t\t\t\tsetupFrameBuffer( renderTargetProperties.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D );\r\n\r\n\t\t\t\tif ( renderTarget.shareDepthFrom ) {\r\n\r\n\t\t\t\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTargetProperties.__webglRenderbuffer );\r\n\r\n\t\t\t\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTargetProperties.__webglRenderbuffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tsetupRenderBuffer( renderTargetProperties.__webglRenderbuffer, renderTarget );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( renderTarget.generateMipmaps && isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Release everything\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_2D, null );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\r\n\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );\r\n\r\n\t\t}\r\n\r\n\t\tvar framebuffer, width, height, vx, vy;\r\n\r\n\t\tif ( renderTarget ) {\r\n\r\n\t\t\tvar renderTargetProperties = properties.get( renderTarget );\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\tframebuffer = renderTargetProperties.__webglFramebuffer[ renderTarget.activeCubeFace ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tframebuffer = renderTargetProperties.__webglFramebuffer;\r\n\r\n\t\t\t}\r\n\r\n\t\t\twidth = renderTarget.width;\r\n\t\t\theight = renderTarget.height;\r\n\r\n\t\t\tvx = 0;\r\n\t\t\tvy = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tframebuffer = null;\r\n\r\n\t\t\twidth = _viewportWidth;\r\n\t\t\theight = _viewportHeight;\r\n\r\n\t\t\tvx = _viewportX;\r\n\t\t\tvy = _viewportY;\r\n\r\n\t\t}\r\n\r\n\t\tif ( framebuffer !== _currentFramebuffer ) {\r\n\r\n\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\t\t\t_gl.viewport( vx, vy, width, height );\r\n\r\n\t\t\t_currentFramebuffer = framebuffer;\r\n\r\n\t\t}\r\n\r\n\t\t_currentWidth = width;\r\n\t\t_currentHeight = height;\r\n\r\n\t};\r\n\r\n\tthis.readRenderTargetPixels = function( renderTarget, x, y, width, height, buffer ) {\r\n\r\n\t\tif ( ! ( renderTarget instanceof THREE.WebGLRenderTarget ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( properties.get( renderTarget ).__webglFramebuffer ) {\r\n\r\n\t\t\tif ( renderTarget.format !== THREE.RGBAFormat ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar restore = false;\r\n\r\n\t\t\tif ( properties.get( renderTarget ).__webglFramebuffer !== _currentFramebuffer ) {\r\n\r\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, properties.get( renderTarget ).__webglFramebuffer );\r\n\r\n\t\t\t\trestore = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _gl.checkFramebufferStatus( _gl.FRAMEBUFFER ) === _gl.FRAMEBUFFER_COMPLETE ) {\r\n\r\n\t\t\t\t_gl.readPixels( x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( restore ) {\r\n\r\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, _currentFramebuffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction updateRenderTargetMipmap ( renderTarget ) {\r\n\r\n\t\tif ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, properties.get( renderTarget ).__webglTexture );\r\n\t\t\t_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_2D, properties.get( renderTarget ).__webglTexture );\r\n\t\t\t_gl.generateMipmap( _gl.TEXTURE_2D );\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_2D, null );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Fallback filters for non-power-of-2 textures\r\n\r\n\tfunction filterFallback ( f ) {\r\n\r\n\t\tif ( f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter ) {\r\n\r\n\t\t\treturn _gl.NEAREST;\r\n\r\n\t\t}\r\n\r\n\t\treturn _gl.LINEAR;\r\n\r\n\t}\r\n\r\n\t// Map three.js constants to WebGL constants\r\n\r\n\tfunction paramThreeToGL ( p ) {\r\n\r\n\t\tvar extension;\r\n\r\n\t\tif ( p === THREE.RepeatWrapping ) return _gl.REPEAT;\r\n\t\tif ( p === THREE.ClampToEdgeWrapping ) return _gl.CLAMP_TO_EDGE;\r\n\t\tif ( p === THREE.MirroredRepeatWrapping ) return _gl.MIRRORED_REPEAT;\r\n\r\n\t\tif ( p === THREE.NearestFilter ) return _gl.NEAREST;\r\n\t\tif ( p === THREE.NearestMipMapNearestFilter ) return _gl.NEAREST_MIPMAP_NEAREST;\r\n\t\tif ( p === THREE.NearestMipMapLinearFilter ) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n\t\tif ( p === THREE.LinearFilter ) return _gl.LINEAR;\r\n\t\tif ( p === THREE.LinearMipMapNearestFilter ) return _gl.LINEAR_MIPMAP_NEAREST;\r\n\t\tif ( p === THREE.LinearMipMapLinearFilter ) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n\t\tif ( p === THREE.UnsignedByteType ) return _gl.UNSIGNED_BYTE;\r\n\t\tif ( p === THREE.UnsignedShort4444Type ) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n\t\tif ( p === THREE.UnsignedShort5551Type ) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n\t\tif ( p === THREE.UnsignedShort565Type ) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n\t\tif ( p === THREE.ByteType ) return _gl.BYTE;\r\n\t\tif ( p === THREE.ShortType ) return _gl.SHORT;\r\n\t\tif ( p === THREE.UnsignedShortType ) return _gl.UNSIGNED_SHORT;\r\n\t\tif ( p === THREE.IntType ) return _gl.INT;\r\n\t\tif ( p === THREE.UnsignedIntType ) return _gl.UNSIGNED_INT;\r\n\t\tif ( p === THREE.FloatType ) return _gl.FLOAT;\r\n\r\n\t\textension = extensions.get( 'OES_texture_half_float' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.HalfFloatType ) return extension.HALF_FLOAT_OES;\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === THREE.AlphaFormat ) return _gl.ALPHA;\r\n\t\tif ( p === THREE.RGBFormat ) return _gl.RGB;\r\n\t\tif ( p === THREE.RGBAFormat ) return _gl.RGBA;\r\n\t\tif ( p === THREE.LuminanceFormat ) return _gl.LUMINANCE;\r\n\t\tif ( p === THREE.LuminanceAlphaFormat ) return _gl.LUMINANCE_ALPHA;\r\n\r\n\t\tif ( p === THREE.AddEquation ) return _gl.FUNC_ADD;\r\n\t\tif ( p === THREE.SubtractEquation ) return _gl.FUNC_SUBTRACT;\r\n\t\tif ( p === THREE.ReverseSubtractEquation ) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n\t\tif ( p === THREE.ZeroFactor ) return _gl.ZERO;\r\n\t\tif ( p === THREE.OneFactor ) return _gl.ONE;\r\n\t\tif ( p === THREE.SrcColorFactor ) return _gl.SRC_COLOR;\r\n\t\tif ( p === THREE.OneMinusSrcColorFactor ) return _gl.ONE_MINUS_SRC_COLOR;\r\n\t\tif ( p === THREE.SrcAlphaFactor ) return _gl.SRC_ALPHA;\r\n\t\tif ( p === THREE.OneMinusSrcAlphaFactor ) return _gl.ONE_MINUS_SRC_ALPHA;\r\n\t\tif ( p === THREE.DstAlphaFactor ) return _gl.DST_ALPHA;\r\n\t\tif ( p === THREE.OneMinusDstAlphaFactor ) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n\t\tif ( p === THREE.DstColorFactor ) return _gl.DST_COLOR;\r\n\t\tif ( p === THREE.OneMinusDstColorFactor ) return _gl.ONE_MINUS_DST_COLOR;\r\n\t\tif ( p === THREE.SrcAlphaSaturateFactor ) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n\t\textension = extensions.get( 'WEBGL_compressed_texture_s3tc' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.RGB_S3TC_DXT1_Format ) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT1_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT3_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT5_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'WEBGL_compressed_texture_pvrtc' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.RGB_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGB_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGBA_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGBA_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'EXT_blend_minmax' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.MinEquation ) return extension.MIN_EXT;\r\n\t\t\tif ( p === THREE.MaxEquation ) return extension.MAX_EXT;\r\n\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\r\n\t// DEPRECATED\r\n\r\n\tthis.supportsFloatTextures = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( \\'OES_texture_float\\' ).' );\r\n\t\treturn extensions.get( 'OES_texture_float' );\r\n\r\n\t};\r\n\r\n\tthis.supportsHalfFloatTextures = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( \\'OES_texture_half_float\\' ).' );\r\n\t\treturn extensions.get( 'OES_texture_half_float' );\r\n\r\n\t};\r\n\r\n\tthis.supportsStandardDerivatives = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( \\'OES_standard_derivatives\\' ).' );\r\n\t\treturn extensions.get( 'OES_standard_derivatives' );\r\n\r\n\t};\r\n\r\n\tthis.supportsCompressedTextureS3TC = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( \\'WEBGL_compressed_texture_s3tc\\' ).' );\r\n\t\treturn extensions.get( 'WEBGL_compressed_texture_s3tc' );\r\n\r\n\t};\r\n\r\n\tthis.supportsCompressedTexturePVRTC = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( \\'WEBGL_compressed_texture_pvrtc\\' ).' );\r\n\t\treturn extensions.get( 'WEBGL_compressed_texture_pvrtc' );\r\n\r\n\t};\r\n\r\n\tthis.supportsBlendMinMax = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( \\'EXT_blend_minmax\\' ).' );\r\n\t\treturn extensions.get( 'EXT_blend_minmax' );\r\n\r\n\t};\r\n\r\n\tthis.supportsVertexTextures = function () {\r\n\r\n\t\treturn capabilities.vertexTextures;\r\n\r\n\t};\r\n\r\n\tthis.supportsInstancedArrays = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( \\'ANGLE_instanced_arrays\\' ).' );\r\n\t\treturn extensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tthis.initMaterial = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .initMaterial() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.addPrePlugin = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .addPrePlugin() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.addPostPlugin = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .addPostPlugin() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.updateShadowMap = function () {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer: .updateShadowMap() has been removed.' );\r\n\r\n\t};\r\n\r\n\tObject.defineProperties( this, {\r\n\t\tshadowMapEnabled: {\r\n\t\t\tget: function () {\r\n\r\n\t\t\t\treturn shadowMap.enabled;\r\n\r\n\t\t\t},\r\n\t\t\tset: function ( value ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.' );\r\n\t\t\t\tshadowMap.enabled = value;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tshadowMapType: {\r\n\t\t\tget: function () {\r\n\r\n\t\t\t\treturn shadowMap.type;\r\n\r\n\t\t\t},\r\n\t\t\tset: function ( value ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.' );\r\n\t\t\t\tshadowMap.type = value;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tshadowMapCullFace: {\r\n\t\t\tget: function () {\r\n\r\n\t\t\t\treturn shadowMap.cullFace;\r\n\r\n\t\t\t},\r\n\t\t\tset: function ( value ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.' );\r\n\t\t\t\tshadowMap.cullFace = value;\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tshadowMapDebug: {\r\n\t\t\tget: function () {\r\n\r\n\t\t\t\treturn shadowMap.debug;\r\n\r\n\t\t\t},\r\n\t\t\tset: function ( value ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug.' );\r\n\t\t\t\tshadowMap.debug = value;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t} );\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function ( width, height, options ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.width = width;\r\n\tthis.height = height;\r\n\r\n\toptions = options || {};\r\n\r\n\tthis.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n\tthis.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\tthis.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n\tthis.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\tthis.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n\tthis.offset = new THREE.Vector2( 0, 0 );\r\n\tthis.repeat = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n\tthis.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n\tthis.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n\tthis.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n\tthis.generateMipmaps = true;\r\n\r\n\tthis.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n\tconstructor: THREE.WebGLRenderTarget,\r\n\r\n\tsetSize: function ( width, height ) {\r\n\r\n\t\tif ( this.width !== width || this.height !== height ) {\r\n\r\n\t\t\tthis.width = width;\r\n\t\t\tthis.height = height;\r\n\r\n\t\t\tthis.dispose();\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t},\r\n\r\n\tcopy: function ( source ) {\r\n\r\n\t\tthis.width = source.width;\r\n\t\tthis.height = source.height;\r\n\r\n\t\tthis.wrapS = source.wrapS;\r\n\t\tthis.wrapT = source.wrapT;\r\n\r\n\t\tthis.magFilter = source.magFilter;\r\n\t\tthis.minFilter = source.minFilter;\r\n\r\n\t\tthis.anisotropy = source.anisotropy;\r\n\r\n\t\tthis.offset.copy( source.offset );\r\n\t\tthis.repeat.copy( source.repeat );\r\n\r\n\t\tthis.format = source.format;\r\n\t\tthis.type = source.type;\r\n\r\n\t\tthis.depthBuffer = source.depthBuffer;\r\n\t\tthis.stencilBuffer = source.stencilBuffer;\r\n\r\n\t\tthis.generateMipmaps = source.generateMipmaps;\r\n\r\n\t\tthis.shareDepthFrom = source.shareDepthFrom;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.WebGLRenderTarget.prototype );\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function ( width, height, options ) {\r\n\r\n\tTHREE.WebGLRenderTarget.call( this, width, height, options );\r\n\r\n\tthis.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create( THREE.WebGLRenderTarget.prototype );\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLBufferRenderer.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLBufferRenderer = function ( _gl, extensions, _infoRender ) {\r\n\r\n\tvar mode;\r\n\r\n\tfunction setMode( value ) {\r\n\r\n\t\tmode = value;\r\n\r\n\t}\r\n\r\n\tfunction render( start, count ) {\r\n\r\n\t\t_gl.drawArrays( mode, start, count );\r\n\r\n\t\t_infoRender.calls ++;\r\n\t\t_infoRender.vertices += count;\r\n\t\tif ( mode === _gl.TRIANGLES ) _infoRender.faces += count / 3;\r\n\r\n\t}\r\n\r\n\tfunction renderInstances( geometry ) {\r\n\r\n\t\tvar extension = extensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\t\tif ( extension === null ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar position = geometry.attributes.position;\r\n\r\n\t\tif ( position instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\textension.drawArraysInstancedANGLE( mode, 0, position.data.count, geometry.maxInstancedCount );\r\n\r\n\t\t} else {\r\n\r\n\t\t\textension.drawArraysInstancedANGLE( mode, 0, position.count, geometry.maxInstancedCount );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.setMode = setMode;\r\n\tthis.render = render;\r\n\tthis.renderInstances = renderInstances;\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLIndexedBufferRenderer.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLIndexedBufferRenderer = function ( _gl, extensions, _infoRender ) {\r\n\r\n\tvar mode;\r\n\r\n\tfunction setMode( value ) {\r\n\r\n\t\tmode = value;\r\n\r\n\t}\r\n\r\n\tvar type, size;\r\n\r\n\tfunction setIndex( index ) {\r\n\r\n\t\tif ( index.array instanceof Uint32Array && extensions.get( 'OES_element_index_uint' ) ) {\r\n\r\n\t\t\ttype = _gl.UNSIGNED_INT;\r\n\t\t\tsize = 4;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttype = _gl.UNSIGNED_SHORT;\r\n\t\t\tsize = 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction render( start, count ) {\r\n\r\n\t\t_gl.drawElements( mode, count, type, start * size );\r\n\r\n\t\t_infoRender.calls ++;\r\n\t\t_infoRender.vertices += count;\r\n\t\tif ( mode === _gl.TRIANGLES ) _infoRender.faces += count / 3;\r\n\r\n\t}\r\n\r\n\tfunction renderInstances( geometry ) {\r\n\r\n\t\tvar extension = extensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\t\tif ( extension === null ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar index = geometry.index;\r\n\r\n\t\textension.drawElementsInstancedANGLE( mode, index.array.length, type, 0, geometry.maxInstancedCount );\r\n\r\n\t}\r\n\r\n\tthis.setMode = setMode;\r\n\tthis.setIndex = setIndex;\r\n\tthis.render = render;\r\n\tthis.renderInstances = renderInstances;\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLExtensions = function ( gl ) {\r\n\r\n\tvar extensions = {};\r\n\r\n\tthis.get = function ( name ) {\r\n\r\n\t\tif ( extensions[ name ] !== undefined ) {\r\n\r\n\t\t\treturn extensions[ name ];\r\n\r\n\t\t}\r\n\r\n\t\tvar extension;\r\n\r\n\t\tswitch ( name ) {\r\n\r\n\t\t\tcase 'EXT_texture_filter_anisotropic':\r\n\t\t\t\textension = gl.getExtension( 'EXT_texture_filter_anisotropic' ) || gl.getExtension( 'MOZ_EXT_texture_filter_anisotropic' ) || gl.getExtension( 'WEBKIT_EXT_texture_filter_anisotropic' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_s3tc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'MOZ_WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_s3tc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_pvrtc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_pvrtc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\textension = gl.getExtension( name );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension === null ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: ' + name + ' extension not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\textensions[ name ] = extension;\r\n\r\n\t\treturn extension;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLCapabilities.js\r\n\r\nTHREE.WebGLCapabilities = function ( gl, extensions, parameters ) {\r\n\r\n\tfunction getMaxPrecision( precision ) {\r\n\r\n\t\tif ( precision === 'highp' ) {\r\n\r\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.HIGH_FLOAT ).precision > 0 &&\r\n\t\t\t     gl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).precision > 0 ) {\r\n\r\n\t\t\t\treturn 'highp';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tprecision = 'mediump';\r\n\r\n\t\t}\r\n\r\n\t\tif ( precision === 'mediump' ) {\r\n\r\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).precision > 0 &&\r\n\t\t\t     gl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).precision > 0 ) {\r\n\r\n\t\t\t\treturn 'mediump';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn 'lowp';\r\n\r\n\t}\r\n\r\n\tthis.getMaxPrecision = getMaxPrecision;\r\n\r\n\tthis.precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\tthis.logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false;\r\n\r\n\tthis.maxTextures = gl.getParameter( gl.MAX_TEXTURE_IMAGE_UNITS );\r\n\tthis.maxVertexTextures = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS );\r\n\tthis.maxTextureSize = gl.getParameter( gl.MAX_TEXTURE_SIZE );\r\n\tthis.maxCubemapSize = gl.getParameter( gl.MAX_CUBE_MAP_TEXTURE_SIZE );\r\n\r\n\tthis.maxAttributes = gl.getParameter( gl.MAX_VERTEX_ATTRIBS );\r\n\tthis.maxVertexUniforms = gl.getParameter( gl.MAX_VERTEX_UNIFORM_VECTORS );\r\n\tthis.maxVaryings = gl.getParameter( gl.MAX_VARYING_VECTORS );\r\n\tthis.maxFragmentUniforms = gl.getParameter( gl.MAX_FRAGMENT_UNIFORM_VECTORS );\r\n\r\n\tthis.vertexTextures = this.maxVertexTextures > 0;\r\n\tthis.floatFragmentTextures = !! extensions.get( 'OES_texture_float' );\r\n\tthis.floatVertexTextures = this.vertexTextures && this.floatFragmentTextures;\r\n\r\n\tvar _maxPrecision = getMaxPrecision( this.precision );\r\n\r\n\tif ( _maxPrecision !== this.precision ) {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer:', this.precision, 'not supported, using', _maxPrecision, 'instead.' );\r\n\t\tthis.precision = _maxPrecision;\r\n\r\n\t}\r\n\r\n\tif ( this.logarithmicDepthBuffer ) {\r\n\r\n\t\tthis.logarithmicDepthBuffer = !! extensions.get( 'EXT_frag_depth' );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLGeometries.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLGeometries = function ( gl, properties, info ) {\r\n\r\n\tvar geometries = {};\r\n\r\n\tfunction get( object ) {\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tif ( geometries[ geometry.id ] !== undefined ) {\r\n\r\n\t\t\treturn geometries[ geometry.id ];\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.addEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\tvar buffergeometry;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tbuffergeometry = geometry;\r\n\r\n\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tif ( geometry._bufferGeometry === undefined ) {\r\n\r\n\t\t\t\tgeometry._bufferGeometry = new THREE.BufferGeometry().setFromObject( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbuffergeometry = geometry._bufferGeometry;\r\n\r\n\t\t}\r\n\r\n\t\tgeometries[ geometry.id ] = buffergeometry;\r\n\r\n\t\tinfo.memory.geometries ++;\r\n\r\n\t\treturn buffergeometry;\r\n\r\n\t}\r\n\r\n\tfunction onGeometryDispose( event ) {\r\n\r\n\t\tvar geometry = event.target;\r\n\t\tvar buffergeometry = geometries[ geometry.id ];\r\n\r\n\t\tdeleteAttributes( buffergeometry.attributes );\r\n\r\n\t\tgeometry.removeEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\tdelete geometries[ geometry.id ];\r\n\r\n\t\tvar property = properties.get( geometry );\r\n\t\tif ( property.wireframe ) deleteAttribute( property.wireframe );\r\n\r\n\t\tinfo.memory.geometries --;\r\n\r\n\t}\r\n\r\n\tfunction getAttributeBuffer( attribute ) {\r\n\r\n\t\tif ( attribute instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\treturn properties.get( attribute.data ).__webglBuffer;\r\n\r\n\t\t}\r\n\r\n\t\treturn properties.get( attribute ).__webglBuffer;\r\n\r\n\t}\r\n\r\n\tfunction deleteAttribute( attribute ) {\r\n\r\n\t\tvar buffer = getAttributeBuffer( attribute );\r\n\r\n\t\tif ( buffer !== undefined ) {\r\n\r\n\t\t\tgl.deleteBuffer( buffer );\r\n\t\t\tremoveAttributeBuffer( attribute );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction deleteAttributes( attributes ) {\r\n\r\n\t\tfor ( var name in attributes ) {\r\n\r\n\t\t\tdeleteAttribute( attributes[ name ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction removeAttributeBuffer( attribute ) {\r\n\r\n\t\tif ( attribute instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\tproperties.delete( attribute.data );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tproperties.delete( attribute );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.get = get;\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLObjects.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLObjects = function ( gl, properties, info ) {\r\n\r\n\tvar geometries = new THREE.WebGLGeometries( gl, properties, info );\r\n\r\n\t//\r\n\r\n\tfunction update( object ) {\r\n\r\n\t\t// TODO: Avoid updating twice (when using shadowMap). Maybe add frame counter.\r\n\r\n\t\tvar geometry = geometries.get( object );\r\n\r\n\t\tif ( object.geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tgeometry.updateFromObject( object );\r\n\r\n\t\t}\r\n\r\n\t\tvar index = geometry.index;\r\n\t\tvar attributes = geometry.attributes;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tupdateAttribute( index, gl.ELEMENT_ARRAY_BUFFER );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var name in attributes ) {\r\n\r\n\t\t\tupdateAttribute( attributes[ name ], gl.ARRAY_BUFFER );\r\n\r\n\t\t}\r\n\r\n\t\t// morph targets\r\n\r\n\t\tvar morphAttributes = geometry.morphAttributes;\r\n\r\n\t\tfor ( var name in morphAttributes ) {\r\n\r\n\t\t\tvar array = morphAttributes[ name ];\r\n\r\n\t\t\tfor ( var i = 0, l = array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tupdateAttribute( array[ i ], gl.ARRAY_BUFFER );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t}\r\n\r\n\tfunction updateAttribute( attribute, bufferType ) {\r\n\r\n\t\tvar data = ( attribute instanceof THREE.InterleavedBufferAttribute ) ? attribute.data : attribute;\r\n\r\n\t\tvar attributeProperties = properties.get( data );\r\n\r\n\t\tif ( attributeProperties.__webglBuffer === undefined ) {\r\n\r\n\t\t\tcreateBuffer( attributeProperties, data, bufferType );\r\n\r\n\t\t} else if ( attributeProperties.version !== data.version ) {\r\n\r\n\t\t\tupdateBuffer( attributeProperties, data, bufferType );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createBuffer( attributeProperties, data, bufferType ) {\r\n\r\n\t\tattributeProperties.__webglBuffer = gl.createBuffer();\r\n\t\tgl.bindBuffer( bufferType, attributeProperties.__webglBuffer );\r\n\r\n\t\tvar usage = data.dynamic ? gl.DYNAMIC_DRAW : gl.STATIC_DRAW;\r\n\r\n\t\tgl.bufferData( bufferType, data.array, usage );\r\n\r\n\t\tattributeProperties.version = data.version;\r\n\r\n\t}\r\n\r\n\tfunction updateBuffer( attributeProperties, data, bufferType ) {\r\n\r\n\t\tgl.bindBuffer( bufferType, attributeProperties.__webglBuffer );\r\n\r\n\t\tif ( data.dynamic === false || data.updateRange.count === - 1 ) {\r\n\r\n\t\t\t// Not using update ranges\r\n\r\n\t\t\tgl.bufferSubData( bufferType, 0, data.array );\r\n\r\n\t\t} else if ( data.updateRange.count === 0 ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgl.bufferSubData( bufferType, data.updateRange.offset * data.array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\t\t\t  data.array.subarray( data.updateRange.offset, data.updateRange.offset + data.updateRange.count ) );\r\n\r\n\t\t\tdata.updateRange.count = 0; // reset range\r\n\r\n\t\t}\r\n\r\n\t\tattributeProperties.version = data.version;\r\n\r\n\t}\r\n\r\n\tfunction getAttributeBuffer( attribute ) {\r\n\r\n\t\tif ( attribute instanceof THREE.InterleavedBufferAttribute ) {\r\n\r\n\t\t\treturn properties.get( attribute.data ).__webglBuffer;\r\n\r\n\t\t}\r\n\r\n\t\treturn properties.get( attribute ).__webglBuffer;\r\n\r\n\t}\r\n\r\n\tfunction getWireframeAttribute( geometry ) {\r\n\r\n\t\tvar property = properties.get( geometry );\r\n\r\n\t\tif ( property.wireframe !== undefined ) {\r\n\r\n\t\t\treturn property.wireframe;\r\n\r\n\t\t}\r\n\r\n\t\tvar indices = [];\r\n\r\n\t\tvar index = geometry.index;\r\n\t\tvar attributes = geometry.attributes;\r\n\t\tvar position = attributes.position;\r\n\r\n\t\t// console.time( 'wireframe' );\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tvar edges = {};\r\n\t\t\tvar array = index.array;\r\n\r\n\t\t\tfor ( var i = 0, l = array.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\tvar a = array[ i + 0 ];\r\n\t\t\t\tvar b = array[ i + 1 ];\r\n\t\t\t\tvar c = array[ i + 2 ];\r\n\r\n\t\t\t\tif ( checkEdge( edges, a, b ) ) indices.push( a, b );\r\n\t\t\t\tif ( checkEdge( edges, b, c ) ) indices.push( b, c );\r\n\t\t\t\tif ( checkEdge( edges, c, a ) ) indices.push( c, a );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar array = attributes.position.array;\r\n\r\n\t\t\tfor ( var i = 0, l = ( array.length / 3 ) - 1; i < l; i += 3 ) {\r\n\r\n\t\t\t\tvar a = i + 0;\r\n\t\t\t\tvar b = i + 1;\r\n\t\t\t\tvar c = i + 2;\r\n\r\n\t\t\t\tindices.push( a, b, b, c, c, a );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// console.timeEnd( 'wireframe' );\r\n\r\n\t\tvar TypeArray = position.count > 65535 ? Uint32Array : Uint16Array;\r\n\t\tvar attribute = new THREE.BufferAttribute( new TypeArray( indices ), 1 );\r\n\r\n\t\tupdateAttribute( attribute, gl.ELEMENT_ARRAY_BUFFER );\r\n\r\n\t\tproperty.wireframe = attribute;\r\n\r\n\t\treturn attribute;\r\n\r\n\t}\r\n\r\n\tfunction checkEdge( edges, a, b ) {\r\n\r\n\t\tif ( a > b ) {\r\n\r\n\t\t\tvar tmp = a;\r\n\t\t\ta = b;\r\n\t\t\tb = tmp;\r\n\r\n\t\t}\r\n\r\n\t\tvar list = edges[ a ];\r\n\r\n\t\tif ( list === undefined ) {\r\n\r\n\t\t\tedges[ a ] = [ b ];\r\n\t\t\treturn true;\r\n\r\n\t\t} else if ( list.indexOf( b ) === -1 ) {\r\n\r\n\t\t\tlist.push( b );\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tthis.getAttributeBuffer = getAttributeBuffer;\r\n\tthis.getWireframeAttribute = getWireframeAttribute;\r\n\r\n\tthis.update = update;\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = ( function () {\r\n\r\n\tvar programIdCount = 0;\r\n\r\n\tfunction generateDefines( defines ) {\r\n\r\n\t\tvar chunks = [];\r\n\r\n\t\tfor ( var name in defines ) {\r\n\r\n\t\t\tvar value = defines[ name ];\r\n\r\n\t\t\tif ( value === false ) continue;\r\n\r\n\t\t\tchunks.push( '#define ' + name + ' ' + value );\r\n\r\n\t\t}\r\n\r\n\t\treturn chunks.join( '\\n' );\r\n\r\n\t}\r\n\r\n\tfunction fetchUniformLocations( gl, program, identifiers ) {\r\n\r\n\t\tvar uniforms = {};\r\n\r\n\t\tvar n = gl.getProgramParameter( program, gl.ACTIVE_UNIFORMS );\r\n\r\n\t\tfor ( var i = 0; i < n; i ++ ) {\r\n\r\n\t\t\tvar info = gl.getActiveUniform( program, i );\r\n\t\t\tvar name = info.name;\r\n\t\t\tvar location = gl.getUniformLocation( program, name );\r\n\r\n\t\t\t// console.log(\"THREE.WebGLProgram: ACTIVE UNIFORM:\", name);\r\n\r\n\t\t\tvar suffixPos = name.lastIndexOf( '[0]' );\r\n\t\t\tif ( suffixPos !== - 1 && suffixPos === name.length - 3 ) {\r\n\r\n\t\t\t\tuniforms[ name.substr( 0, suffixPos ) ] = location;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniforms[ name ] = location;\r\n\r\n\t\t}\r\n\r\n\t\treturn uniforms;\r\n\r\n\t}\r\n\r\n\tfunction fetchAttributeLocations( gl, program, identifiers ) {\r\n\r\n\t\tvar attributes = {};\r\n\r\n\t\tvar n = gl.getProgramParameter( program, gl.ACTIVE_ATTRIBUTES );\r\n\r\n\t\tfor ( var i = 0; i < n; i ++ ) {\r\n\r\n\t\t\tvar info = gl.getActiveAttrib( program, i );\r\n\t\t\tvar name = info.name;\r\n\r\n\t\t\t// console.log(\"THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:\", name, i );\r\n\r\n\t\t\tattributes[ name ] = gl.getAttribLocation( program, name );\r\n\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\r\n\t}\r\n\r\n\tfunction filterEmptyLine( string ) {\r\n\r\n\t\treturn string !== '';\r\n\r\n\t}\r\n\r\n\treturn function WebGLProgram( renderer, code, material, parameters ) {\r\n\r\n\t\tvar gl = renderer.context;\r\n\r\n\t\tvar defines = material.defines;\r\n\r\n\t\tvar vertexShader = material.__webglShader.vertexShader;\r\n\t\tvar fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n\t\tvar shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n\t\tif ( parameters.shadowMapType === THREE.PCFShadowMap ) {\r\n\r\n\t\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n\t\t} else if ( parameters.shadowMapType === THREE.PCFSoftShadowMap ) {\r\n\r\n\t\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n\t\t}\r\n\r\n\t\tvar envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\t\tvar envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n\t\tvar envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n\t\tif ( parameters.envMap ) {\r\n\r\n\t\t\tswitch ( material.envMap.mapping ) {\r\n\r\n\t\t\t\tcase THREE.CubeReflectionMapping:\r\n\t\t\t\tcase THREE.CubeRefractionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.EquirectangularReflectionMapping:\r\n\t\t\t\tcase THREE.EquirectangularRefractionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.SphericalReflectionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( material.envMap.mapping ) {\r\n\r\n\t\t\t\tcase THREE.CubeRefractionMapping:\r\n\t\t\t\tcase THREE.EquirectangularRefractionMapping:\r\n\t\t\t\t\tenvMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( material.combine ) {\r\n\r\n\t\t\t\tcase THREE.MultiplyOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.MixOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.AddOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar gammaFactorDefine = ( renderer.gammaFactor > 0 ) ? renderer.gammaFactor : 1.0;\r\n\r\n\t\t// console.log( 'building new program ' );\r\n\r\n\t\t//\r\n\r\n\t\tvar customDefines = generateDefines( defines );\r\n\r\n\t\t//\r\n\r\n\t\tvar program = gl.createProgram();\r\n\r\n\t\tvar prefixVertex, prefixFragment;\r\n\r\n\t\tif ( material instanceof THREE.RawShaderMaterial ) {\r\n\r\n\t\t\tprefixVertex = '';\r\n\t\t\tprefixFragment = '';\r\n\r\n\t\t} else {\r\n\r\n\t\t\tprefixVertex = [\r\n\r\n\t\t\t\t'precision ' + parameters.precision + ' float;',\r\n\t\t\t\t'precision ' + parameters.precision + ' int;',\r\n\r\n\t\t\t\t'#define SHADER_NAME ' + material.__webglShader.name,\r\n\r\n\t\t\t\tcustomDefines,\r\n\r\n\t\t\t\tparameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n\t\t\t\trenderer.gammaInput ? '#define GAMMA_INPUT' : '',\r\n\t\t\t\trenderer.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n\t\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t\t'#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n\t\t\t\t'#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n\t\t\t\t'#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n\t\t\t\t'#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n\t\t\t\t'#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n\t\t\t\t'#define MAX_BONES ' + parameters.maxBones,\r\n\r\n\t\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\r\n\t\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\r\n\t\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t\tparameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '',\r\n\t\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\t\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n\t\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n\t\t\t\tparameters.skinning ? '#define USE_SKINNING' : '',\r\n\t\t\t\tparameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n\t\t\t\tparameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n\t\t\t\tparameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '',\r\n\t\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\t\t\t\tparameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n\r\n\t\t\t\tparameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n\t\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t\tparameters.logarithmicDepthBuffer && renderer.extensions.get( 'EXT_frag_depth' ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n\t\t\t\t'uniform mat4 modelMatrix;',\r\n\t\t\t\t'uniform mat4 modelViewMatrix;',\r\n\t\t\t\t'uniform mat4 projectionMatrix;',\r\n\t\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t\t'uniform mat3 normalMatrix;',\r\n\t\t\t\t'uniform vec3 cameraPosition;',\r\n\r\n\t\t\t\t'attribute vec3 position;',\r\n\t\t\t\t'attribute vec3 normal;',\r\n\t\t\t\t'attribute vec2 uv;',\r\n\r\n\t\t\t\t'#ifdef USE_COLOR',\r\n\r\n\t\t\t\t'\tattribute vec3 color;',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t'#ifdef USE_MORPHTARGETS',\r\n\r\n\t\t\t\t'\tattribute vec3 morphTarget0;',\r\n\t\t\t\t'\tattribute vec3 morphTarget1;',\r\n\t\t\t\t'\tattribute vec3 morphTarget2;',\r\n\t\t\t\t'\tattribute vec3 morphTarget3;',\r\n\r\n\t\t\t\t'\t#ifdef USE_MORPHNORMALS',\r\n\r\n\t\t\t\t'\t\tattribute vec3 morphNormal0;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal1;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal2;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal3;',\r\n\r\n\t\t\t\t'\t#else',\r\n\r\n\t\t\t\t'\t\tattribute vec3 morphTarget4;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget5;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget6;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget7;',\r\n\r\n\t\t\t\t'\t#endif',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t'#ifdef USE_SKINNING',\r\n\r\n\t\t\t\t'\tattribute vec4 skinIndex;',\r\n\t\t\t\t'\tattribute vec4 skinWeight;',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t'\\n'\r\n\r\n\t\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t\t\tprefixFragment = [\r\n\r\n\t\t\t\tparameters.bumpMap || parameters.normalMap || parameters.flatShading || material.derivatives ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\t\t\t\tparameters.logarithmicDepthBuffer && renderer.extensions.get( 'EXT_frag_depth' ) ? '#extension GL_EXT_frag_depth : enable' : '',\r\n\r\n\t\t\t\t'precision ' + parameters.precision + ' float;',\r\n\t\t\t\t'precision ' + parameters.precision + ' int;',\r\n\r\n\t\t\t\t'#define SHADER_NAME ' + material.__webglShader.name,\r\n\r\n\t\t\t\tcustomDefines,\r\n\r\n\t\t\t\t'#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n\t\t\t\t'#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n\t\t\t\t'#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n\t\t\t\t'#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n\t\t\t\t'#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n\t\t\t\tparameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n\t\t\t\trenderer.gammaInput ? '#define GAMMA_INPUT' : '',\r\n\t\t\t\trenderer.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n\t\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\r\n\t\t\t\t( parameters.useFog && parameters.fogExp ) ? '#define FOG_EXP2' : '',\r\n\r\n\t\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n\t\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\r\n\t\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\r\n\t\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\t\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n\t\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n\t\t\t\tparameters.metal ? '#define METAL' : '',\r\n\t\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\t\t\t\tparameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n\r\n\t\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t\tparameters.logarithmicDepthBuffer && renderer.extensions.get( 'EXT_frag_depth' ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\t\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t\t'uniform vec3 cameraPosition;',\r\n\r\n\t\t\t\t'\\n'\r\n\r\n\t\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t\t}\r\n\r\n\t\tvar vertexGlsl = prefixVertex + vertexShader;\r\n\t\tvar fragmentGlsl = prefixFragment + fragmentShader;\r\n\r\n\t\tvar glVertexShader = THREE.WebGLShader( gl, gl.VERTEX_SHADER, vertexGlsl );\r\n\t\tvar glFragmentShader = THREE.WebGLShader( gl, gl.FRAGMENT_SHADER, fragmentGlsl );\r\n\r\n\t\tgl.attachShader( program, glVertexShader );\r\n\t\tgl.attachShader( program, glFragmentShader );\r\n\r\n\t\t// Force a particular attribute to index 0.\r\n\r\n\t\tif ( material.index0AttributeName !== undefined ) {\r\n\r\n\t\t\tgl.bindAttribLocation( program, 0, material.index0AttributeName );\r\n\r\n\t\t} else if ( parameters.morphTargets === true ) {\r\n\r\n\t\t\t// programs with morphTargets displace position out of attribute 0\r\n\t\t\tgl.bindAttribLocation( program, 0, 'position' );\r\n\r\n\t\t}\r\n\r\n\t\tgl.linkProgram( program );\r\n\r\n\t\tvar programLog = gl.getProgramInfoLog( program );\r\n\t\tvar vertexLog = gl.getShaderInfoLog( glVertexShader );\r\n\t\tvar fragmentLog = gl.getShaderInfoLog( glFragmentShader );\r\n\r\n\t\tvar runnable = true;\r\n\t\tvar haveDiagnostics = true;\r\n\r\n\t\tif ( gl.getProgramParameter( program, gl.LINK_STATUS ) === false ) {\r\n\r\n\t\t\trunnable = false;\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLProgram: shader error: ', gl.getError(), 'gl.VALIDATE_STATUS', gl.getProgramParameter( program, gl.VALIDATE_STATUS ), 'gl.getProgramInfoLog', programLog, vertexLog, fragmentLog );\r\n\r\n\t\t} else if ( programLog !== '' ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLProgram: gl.getProgramInfoLog()', programLog );\r\n\r\n\t\t} else if ( vertexLog === '' || fragmentLog === '' ) {\r\n\r\n\t\t\thaveDiagnostics = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( haveDiagnostics ) {\r\n\r\n\t\t\tthis.diagnostics = {\r\n\r\n\t\t\t\trunnable: runnable,\r\n\t\t\t\tmaterial: material,\r\n\r\n\t\t\t\tprogramLog: programLog,\r\n\r\n\t\t\t\tvertexShader: {\r\n\r\n\t\t\t\t\tlog: vertexLog,\r\n\t\t\t\t\tprefix: prefixVertex\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfragmentShader: {\r\n\r\n\t\t\t\t\tlog: fragmentLog,\r\n\t\t\t\t\tprefix: prefixFragment\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\t// clean up\r\n\r\n\t\tgl.deleteShader( glVertexShader );\r\n\t\tgl.deleteShader( glFragmentShader );\r\n\r\n\t\t// set up caching for uniform locations\r\n\r\n\t\tvar cachedUniforms;\r\n\r\n\t\tthis.getUniforms = function() {\r\n\r\n\t\t\tif ( cachedUniforms === undefined ) {\r\n\r\n\t\t\t\tcachedUniforms = fetchUniformLocations( gl, program );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn cachedUniforms;\r\n\r\n\t\t};\r\n\r\n\t\t// set up caching for attribute locations\r\n\r\n\t\tvar cachedAttributes;\r\n\r\n\t\tthis.getAttributes = function() {\r\n\r\n\t\t\tif ( cachedAttributes === undefined ) {\r\n\r\n\t\t\t\tcachedAttributes = fetchAttributeLocations( gl, program );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn cachedAttributes;\r\n\r\n\t\t};\r\n\r\n\t\t// free resource\r\n\r\n\t\tthis.destroy = function() {\r\n\r\n\t\t\tgl.deleteProgram( program );\r\n\t\t\tthis.program = undefined;\r\n\r\n\t\t};\r\n\r\n\t\t// DEPRECATED\r\n\r\n\t\tObject.defineProperties( this, {\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tget: function() {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLProgram: .uniforms is now .getUniforms().' );\r\n\t\t\t\t\treturn this.getUniforms();\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tattributes: {\r\n\t\t\t\tget: function() {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLProgram: .attributes is now .getAttributes().' );\r\n\t\t\t\t\treturn this.getAttributes();\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\r\n\t\t//\r\n\r\n\t\tthis.id = programIdCount ++;\r\n\t\tthis.code = code;\r\n\t\tthis.usedTimes = 1;\r\n\t\tthis.program = program;\r\n\t\tthis.vertexShader = glVertexShader;\r\n\t\tthis.fragmentShader = glFragmentShader;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/renderers/webgl/WebGLPrograms.js\r\n\r\nTHREE.WebGLPrograms = function ( renderer, capabilities ) {\r\n\r\n\tvar programs = [];\r\n\r\n\tvar shaderIDs = {\r\n\t\tMeshDepthMaterial: 'depth',\r\n\t\tMeshNormalMaterial: 'normal',\r\n\t\tMeshBasicMaterial: 'basic',\r\n\t\tMeshLambertMaterial: 'lambert',\r\n\t\tMeshPhongMaterial: 'phong',\r\n\t\tLineBasicMaterial: 'basic',\r\n\t\tLineDashedMaterial: 'dashed',\r\n\t\tPointsMaterial: 'points'\r\n\t};\r\n\r\n\tvar parameterNames = [\r\n\t\t\"precision\", \"supportsVertexTextures\", \"map\", \"envMap\", \"envMapMode\",\r\n\t\t\"lightMap\", \"aoMap\", \"emissiveMap\", \"bumpMap\", \"normalMap\", \"specularMap\",\r\n\t\t\"alphaMap\", \"combine\", \"vertexColors\", \"fog\", \"useFog\", \"fogExp\",\r\n\t\t\"flatShading\", \"sizeAttenuation\", \"logarithmicDepthBuffer\", \"skinning\",\r\n\t\t\"maxBones\", \"useVertexTexture\", \"morphTargets\", \"morphNormals\",\r\n\t\t\"maxMorphTargets\", \"maxMorphNormals\", \"maxDirLights\", \"maxPointLights\",\r\n\t\t\"maxSpotLights\", \"maxHemiLights\", \"maxShadows\", \"shadowMapEnabled\",\r\n\t\t\"shadowMapType\", \"shadowMapDebug\", \"alphaTest\", \"metal\", \"doubleSided\",\r\n\t\t\"flipSided\"\r\n\t];\r\n\r\n\r\n\tfunction allocateBones ( object ) {\r\n\r\n\t\tif ( capabilities.floatVertexTextures && object && object.skeleton && object.skeleton.useVertexTexture ) {\r\n\r\n\t\t\treturn 1024;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// default for when object is not specified\r\n\t\t\t// ( for example when prebuilding shader to be used with multiple objects )\r\n\t\t\t//\r\n\t\t\t//  - leave some extra space for other uniforms\r\n\t\t\t//  - limit here is ANGLE's 254 max uniform vectors\r\n\t\t\t//    (up to 54 should be safe)\r\n\r\n\t\t\tvar nVertexUniforms = capabilities.maxVertexUniforms;\r\n\t\t\tvar nVertexMatrices = Math.floor( ( nVertexUniforms - 20 ) / 4 );\r\n\r\n\t\t\tvar maxBones = nVertexMatrices;\r\n\r\n\t\t\tif ( object !== undefined && object instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\t\tmaxBones = Math.min( object.skeleton.bones.length, maxBones );\r\n\r\n\t\t\t\tif ( maxBones < object.skeleton.bones.length ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn maxBones;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction allocateLights( lights ) {\r\n\r\n\t\tvar dirLights = 0;\r\n\t\tvar pointLights = 0;\r\n\t\tvar spotLights = 0;\r\n\t\tvar hemiLights = 0;\r\n\r\n\t\tfor ( var l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = lights[ l ];\r\n\r\n\t\t\tif ( light.onlyShadow || light.visible === false ) continue;\r\n\r\n\t\t\tif ( light instanceof THREE.DirectionalLight ) dirLights ++;\r\n\t\t\tif ( light instanceof THREE.PointLight ) pointLights ++;\r\n\t\t\tif ( light instanceof THREE.SpotLight ) spotLights ++;\r\n\t\t\tif ( light instanceof THREE.HemisphereLight ) hemiLights ++;\r\n\r\n\t\t}\r\n\r\n\t\treturn { 'directional': dirLights, 'point': pointLights, 'spot': spotLights, 'hemi': hemiLights };\r\n\r\n\t}\r\n\r\n\tfunction allocateShadows( lights ) {\r\n\r\n\t\tvar maxShadows = 0;\r\n\r\n\t\tfor ( var l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = lights[ l ];\r\n\r\n\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\tif ( light instanceof THREE.SpotLight ) maxShadows ++;\r\n\t\t\tif ( light instanceof THREE.DirectionalLight ) maxShadows ++;\r\n\r\n\t\t}\r\n\r\n\t\treturn maxShadows;\r\n\r\n\t}\r\n\r\n\tthis.getParameters = function ( material, lights, fog, object ) {\r\n\r\n\t\tvar shaderID = shaderIDs[ material.type ];\r\n\t\t// heuristics to create shader parameters according to lights in the scene\r\n\t\t// (not to blow over maxLights budget)\r\n\r\n\t\tvar maxLightCount = allocateLights( lights );\r\n\t\tvar maxShadows = allocateShadows( lights );\r\n\t\tvar maxBones = allocateBones( object );\r\n\t\tvar precision = renderer.getPrecision();\r\n\r\n\t\tif ( material.precision !== null ) {\r\n\r\n\t\t\tprecision = capabilities.getMaxPrecision( material.precision );\r\n\r\n\t\t\tif ( precision !== material.precision ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer.initMaterial:', material.precision, 'not supported, using', precision, 'instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar parameters = {\r\n\r\n\t\t\tshaderID: shaderID,\r\n\r\n\t\t\tprecision: precision,\r\n\t\t\tsupportsVertexTextures: capabilities.vertexTextures,\r\n\r\n\t\t\tmap: !! material.map,\r\n\t\t\tenvMap: !! material.envMap,\r\n\t\t\tenvMapMode: material.envMap && material.envMap.mapping,\r\n\t\t\tlightMap: !! material.lightMap,\r\n\t\t\taoMap: !! material.aoMap,\r\n\t\t\temissiveMap: !! material.emissiveMap,\r\n\t\t\tbumpMap: !! material.bumpMap,\r\n\t\t\tnormalMap: !! material.normalMap,\r\n\t\t\tdisplacementMap: !! material.displacementMap,\r\n\t\t\tspecularMap: !! material.specularMap,\r\n\t\t\talphaMap: !! material.alphaMap,\r\n\r\n\t\t\tcombine: material.combine,\r\n\r\n\t\t\tvertexColors: material.vertexColors,\r\n\r\n\t\t\tfog: fog,\r\n\t\t\tuseFog: material.fog,\r\n\t\t\tfogExp: fog instanceof THREE.FogExp2,\r\n\r\n\t\t\tflatShading: material.shading === THREE.FlatShading,\r\n\r\n\t\t\tsizeAttenuation: material.sizeAttenuation,\r\n\t\t\tlogarithmicDepthBuffer: capabilities.logarithmicDepthBuffer,\r\n\r\n\t\t\tskinning: material.skinning,\r\n\t\t\tmaxBones: maxBones,\r\n\t\t\tuseVertexTexture: capabilities.floatVertexTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n\t\t\tmorphTargets: material.morphTargets,\r\n\t\t\tmorphNormals: material.morphNormals,\r\n\t\t\tmaxMorphTargets: renderer.maxMorphTargets,\r\n\t\t\tmaxMorphNormals: renderer.maxMorphNormals,\r\n\r\n\t\t\tmaxDirLights: maxLightCount.directional,\r\n\t\t\tmaxPointLights: maxLightCount.point,\r\n\t\t\tmaxSpotLights: maxLightCount.spot,\r\n\t\t\tmaxHemiLights: maxLightCount.hemi,\r\n\r\n\t\t\tmaxShadows: maxShadows,\r\n\t\t\tshadowMapEnabled: renderer.shadowMap.enabled && object.receiveShadow && maxShadows > 0,\r\n\t\t\tshadowMapType: renderer.shadowMap.type,\r\n\t\t\tshadowMapDebug: renderer.shadowMap.debug,\r\n\r\n\t\t\talphaTest: material.alphaTest,\r\n\t\t\tmetal: material.metal,\r\n\t\t\tdoubleSided: material.side === THREE.DoubleSide,\r\n\t\t\tflipSided: material.side === THREE.BackSide\r\n\r\n\t\t};\r\n\r\n\t\treturn parameters;\r\n\r\n\t};\r\n\r\n\tthis.getProgramCode = function ( material, parameters ) {\r\n\r\n\t\tvar chunks = [];\r\n\r\n\t\tif ( parameters.shaderID ) {\r\n\r\n\t\t\tchunks.push( parameters.shaderID );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tchunks.push( material.fragmentShader );\r\n\t\t\tchunks.push( material.vertexShader );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.defines !== undefined ) {\r\n\r\n\t\t\tfor ( var name in material.defines ) {\r\n\r\n\t\t\t\tchunks.push( name );\r\n\t\t\t\tchunks.push( material.defines[ name ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < parameterNames.length; i ++ ) {\r\n\r\n\t\t\tvar parameterName = parameterNames[ i ];\r\n\t\t\tchunks.push( parameterName );\r\n\t\t\tchunks.push( parameters[ parameterName ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn chunks.join();\r\n\r\n\t};\r\n\r\n\tthis.acquireProgram = function ( material, parameters, code ) {\r\n\r\n\t\tvar program;\r\n\r\n\t\t// Check if code has been already compiled\r\n\t\tfor ( var p = 0, pl = programs.length; p < pl; p ++ ) {\r\n\r\n\t\t\tvar programInfo = programs[ p ];\r\n\r\n\t\t\tif ( programInfo.code === code ) {\r\n\r\n\t\t\t\tprogram = programInfo;\r\n\t\t\t\t++ program.usedTimes;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tprogram = new THREE.WebGLProgram( renderer, code, material, parameters );\r\n\t\t\tprograms.push( program );\r\n\r\n\t\t}\r\n\r\n\t\treturn program;\r\n\r\n\t};\r\n\r\n\tthis.releaseProgram = function( program ) {\r\n\r\n\t\tif ( -- program.usedTimes === 0 ) {\r\n\r\n\t\t\t// Remove from unordered set\r\n\t\t\tvar i = programs.indexOf( program );\r\n\t\t\tprograms[ i ] = programs[ programs.length - 1 ];\r\n\t\t\tprograms.pop();\r\n\r\n\t\t\t// Free WebGL resources\r\n\t\t\tprogram.destroy();\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Exposed for resource monitoring & error feedback via renderer.info:\r\n\tthis.programs = programs;\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProperties.js\r\n\r\n/**\r\n* @author fordacious / fordacious.github.io\r\n*/\r\n\r\nTHREE.WebGLProperties = function () {\r\n\r\n\tvar properties = {};\r\n\r\n\tthis.get = function ( object ) {\r\n\r\n\t\tvar uuid = object.uuid;\r\n\t\tvar map = properties[ uuid ];\r\n\r\n\t\tif ( map === undefined ) {\r\n\r\n\t\t\tmap = {};\r\n\t\t\tproperties[ uuid ] = map;\r\n\r\n\t\t}\r\n\r\n\t\treturn map;\r\n\r\n\t};\r\n\r\n\tthis.delete = function ( object ) {\r\n\r\n\t\tdelete properties[ object.uuid ];\r\n\r\n\t};\r\n\r\n\tthis.clear = function () {\r\n\r\n\t\tproperties = {};\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = ( function () {\r\n\r\n\tvar addLineNumbers = function ( string ) {\r\n\r\n\t\tvar lines = string.split( '\\n' );\r\n\r\n\t\tfor ( var i = 0; i < lines.length; i ++ ) {\r\n\r\n\t\t\tlines[ i ] = ( i + 1 ) + ': ' + lines[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn lines.join( '\\n' );\r\n\r\n\t};\r\n\r\n\treturn function WebGLShader( gl, type, string ) {\r\n\r\n\t\tvar shader = gl.createShader( type );\r\n\r\n\t\tgl.shaderSource( shader, string );\r\n\t\tgl.compileShader( shader );\r\n\r\n\t\tif ( gl.getShaderParameter( shader, gl.COMPILE_STATUS ) === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLShader: Shader couldn\\'t compile.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( gl.getShaderInfoLog( shader ) !== '' ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLShader: gl.getShaderInfoLog()', type === gl.VERTEX_SHADER ? 'vertex' : 'fragment', gl.getShaderInfoLog( shader ), addLineNumbers( string ) );\r\n\r\n\t\t}\r\n\r\n\t\t// --enable-privileged-webgl-extension\r\n\t\t// console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n\t\treturn shader;\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/renderers/webgl/WebGLShadowMap.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLShadowMap = function ( _renderer, _lights, _objects ) {\r\n\r\n\tvar _gl = _renderer.context,\r\n\t_state = _renderer.state,\r\n\t_frustum = new THREE.Frustum(),\r\n\t_projScreenMatrix = new THREE.Matrix4(),\r\n\r\n\t_min = new THREE.Vector3(),\r\n\t_max = new THREE.Vector3(),\r\n\r\n\t_matrixPosition = new THREE.Vector3(),\r\n\r\n\t_renderList = [];\r\n\r\n\t// init\r\n\r\n\tvar depthShader = THREE.ShaderLib[ \"depthRGBA\" ];\r\n\tvar depthUniforms = THREE.UniformsUtils.clone( depthShader.uniforms );\r\n\r\n\tvar _depthMaterial = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader\r\n\t } );\r\n\r\n\tvar _depthMaterialMorph = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tmorphTargets: true\r\n\t} );\r\n\r\n\tvar _depthMaterialSkin = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tskinning: true\r\n\t} );\r\n\r\n\tvar _depthMaterialMorphSkin = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tmorphTargets: true,\r\n\t\tskinning: true\r\n\t} );\r\n\r\n\t_depthMaterial._shadowPass = true;\r\n\t_depthMaterialMorph._shadowPass = true;\r\n\t_depthMaterialSkin._shadowPass = true;\r\n\t_depthMaterialMorphSkin._shadowPass = true;\r\n\r\n\t//\r\n\r\n\tvar scope = this;\r\n\r\n\tthis.enabled = false;\r\n\r\n\tthis.autoUpdate = true;\r\n\tthis.needsUpdate = false;\r\n\r\n\tthis.type = THREE.PCFShadowMap;\r\n\tthis.cullFace = THREE.CullFaceFront;\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\t\tif ( scope.autoUpdate === false && scope.needsUpdate === false ) return;\r\n\r\n\t\t// set GL state for depth map\r\n\r\n\t\t_gl.clearColor( 1, 1, 1, 1 );\r\n\t\t_state.disable( _gl.BLEND );\r\n\r\n\t\t_state.enable( _gl.CULL_FACE );\r\n\t\t_gl.frontFace( _gl.CCW );\r\n\r\n\t\tif ( scope.cullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t_gl.cullFace( _gl.FRONT );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t}\r\n\r\n\t\t_state.setDepthTest( true );\r\n\r\n\t\t// render depth map\r\n\r\n\t\tfor ( var i = 0, il = _lights.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar light = _lights[ i ];\r\n\r\n\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\tif ( ! light.shadowMap ) {\r\n\r\n\t\t\t\tvar shadowFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\tif ( scope.type === THREE.PCFSoftShadowMap ) {\r\n\r\n\t\t\t\t\tshadowFilter = THREE.NearestFilter;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar pars = { minFilter: shadowFilter, magFilter: shadowFilter, format: THREE.RGBAFormat };\r\n\r\n\t\t\t\tlight.shadowMap = new THREE.WebGLRenderTarget( light.shadowMapWidth, light.shadowMapHeight, pars );\r\n\t\t\t\tlight.shadowMapSize = new THREE.Vector2( light.shadowMapWidth, light.shadowMapHeight );\r\n\r\n\t\t\t\tlight.shadowMatrix = new THREE.Matrix4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! light.shadowCamera ) {\r\n\r\n\t\t\t\tif ( light instanceof THREE.SpotLight ) {\r\n\r\n\t\t\t\t\tlight.shadowCamera = new THREE.PerspectiveCamera( light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar );\r\n\r\n\t\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\t\tlight.shadowCamera = new THREE.OrthographicCamera( light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( \"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light );\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscene.add( light.shadowCamera );\r\n\r\n\t\t\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( light.shadowCameraVisible && ! light.cameraHelper ) {\r\n\r\n\t\t\t\tlight.cameraHelper = new THREE.CameraHelper( light.shadowCamera );\r\n\t\t\t\tscene.add( light.cameraHelper );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar shadowMap = light.shadowMap;\r\n\t\t\tvar shadowMatrix = light.shadowMatrix;\r\n\t\t\tvar shadowCamera = light.shadowCamera;\r\n\r\n\t\t\t//\r\n\r\n\t\t\tshadowCamera.position.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t_matrixPosition.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\tshadowCamera.lookAt( _matrixPosition );\r\n\t\t\tshadowCamera.updateMatrixWorld();\r\n\r\n\t\t\tshadowCamera.matrixWorldInverse.getInverse( shadowCamera.matrixWorld );\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( light.cameraHelper ) light.cameraHelper.visible = light.shadowCameraVisible;\r\n\t\t\tif ( light.shadowCameraVisible ) light.cameraHelper.update();\r\n\r\n\t\t\t// compute shadow matrix\r\n\r\n\t\t\tshadowMatrix.set(\r\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.0, 1.0\r\n\t\t\t);\r\n\r\n\t\t\tshadowMatrix.multiply( shadowCamera.projectionMatrix );\r\n\t\t\tshadowMatrix.multiply( shadowCamera.matrixWorldInverse );\r\n\r\n\t\t\t// update camera matrices and frustum\r\n\r\n\t\t\t_projScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );\r\n\t\t\t_frustum.setFromMatrix( _projScreenMatrix );\r\n\r\n\t\t\t// render shadow map\r\n\r\n\t\t\t_renderer.setRenderTarget( shadowMap );\r\n\t\t\t_renderer.clear();\r\n\r\n\t\t\t// set object matrices & frustum culling\r\n\r\n\t\t\t_renderList.length = 0;\r\n\r\n\t\t\tprojectObject( scene, shadowCamera );\r\n\r\n\r\n\t\t\t// render regular objects\r\n\r\n\t\t\tfor ( var j = 0, jl = _renderList.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tvar object = _renderList[ j ];\r\n\t\t\t\tvar geometry = _objects.update( object );\r\n\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\tif ( material instanceof THREE.MeshFaceMaterial ) {\r\n\r\n\t\t\t\t\tvar groups = geometry.groups;\r\n\t\t\t\t\tvar materials = material.materials;\r\n\r\n\t\t\t\t\tfor ( var k = 0, kl = groups.length; k < kl; k ++ ) {\r\n\r\n\t\t\t\t\t\tvar group = groups[ k ];\r\n\t\t\t\t\t\tvar groupMaterial = materials[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\tif ( groupMaterial.visible === true ) {\r\n\r\n\t\t\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, _lights, null, geometry, getDepthMaterial( object, groupMaterial ), object, group );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, _lights, null, geometry, getDepthMaterial( object, material ), object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore GL state\r\n\r\n\t\tvar clearColor = _renderer.getClearColor(),\r\n\t\tclearAlpha = _renderer.getClearAlpha();\r\n\r\n\t\t_renderer.setClearColor( clearColor, clearAlpha );\r\n\t\t_state.enable( _gl.BLEND );\r\n\r\n\t\tif ( scope.cullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t}\r\n\r\n\t\t_renderer.resetGLState();\r\n\r\n\t\tscope.needsUpdate = false;\r\n\r\n\t};\r\n\r\n\tfunction getDepthMaterial( object, material ) {\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tvar useMorphing = geometry.morphTargets !== undefined && geometry.morphTargets.length > 0 && material.morphTargets;\r\n\t\tvar useSkinning = object instanceof THREE.SkinnedMesh && material.skinning;\r\n\r\n\t\tvar depthMaterial;\r\n\r\n\t\tif ( object.customDepthMaterial ) {\r\n\r\n\t\t\tdepthMaterial = object.customDepthMaterial;\r\n\r\n\t\t} else if ( useSkinning ) {\r\n\r\n\t\t\tdepthMaterial = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n\t\t} else if ( useMorphing ) {\r\n\r\n\t\t\tdepthMaterial = _depthMaterialMorph;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdepthMaterial = _depthMaterial;\r\n\r\n\t\t}\r\n\r\n\t\tdepthMaterial.visible = material.visible;\r\n\t\tdepthMaterial.wireframe = material.wireframe;\r\n\t\tdepthMaterial.wireframeLinewidth = material.wireframeLinewidth;\r\n\r\n\t\treturn depthMaterial;\r\n\r\n\t}\r\n\r\n\tfunction projectObject( object, camera ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tif ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Points ) {\r\n\r\n\t\t\tif ( object.castShadow && ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) ) {\r\n\r\n\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\tif ( material.visible === true ) {\r\n\r\n\t\t\t\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\r\n\t\t\t\t\t_renderList.push( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar children = object.children;\r\n\r\n\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tprojectObject( children[ i ], camera );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLState = function ( gl, extensions, paramThreeToGL ) {\r\n\r\n\tvar _this = this;\r\n\r\n\tvar newAttributes = new Uint8Array( 16 );\r\n\tvar enabledAttributes = new Uint8Array( 16 );\r\n\r\n\tvar capabilities = {};\r\n\r\n\tvar compressedTextureFormats = null;\r\n\r\n\tvar currentBlending = null;\r\n\tvar currentBlendEquation = null;\r\n\tvar currentBlendSrc = null;\r\n\tvar currentBlendDst = null;\r\n\tvar currentBlendEquationAlpha = null;\r\n\tvar currentBlendSrcAlpha = null;\r\n\tvar currentBlendDstAlpha = null;\r\n\r\n\tvar currentDepthFunc = null;\r\n\tvar currentDepthWrite = null;\r\n\r\n\tvar currentColorWrite = null;\r\n\r\n\tvar currentFlipSided = null;\r\n\r\n\tvar currentLineWidth = null;\r\n\r\n\tvar currentPolygonOffsetFactor = null;\r\n\tvar currentPolygonOffsetUnits = null;\r\n\r\n\tvar maxTextures = gl.getParameter( gl.MAX_TEXTURE_IMAGE_UNITS );\r\n\r\n\tvar currentTextureSlot = undefined;\r\n\tvar currentBoundTextures = {};\r\n\r\n\tthis.init = function () {\r\n\r\n\t\tgl.clearColor( 0, 0, 0, 1 );\r\n\t\tgl.clearDepth( 1 );\r\n\t\tgl.clearStencil( 0 );\r\n\r\n\t\tthis.enable( gl.DEPTH_TEST );\r\n\t\tgl.depthFunc( gl.LEQUAL );\r\n\r\n\t\tgl.frontFace( gl.CCW );\r\n\t\tgl.cullFace( gl.BACK );\r\n\t\tthis.enable( gl.CULL_FACE );\r\n\r\n\t\tthis.enable( gl.BLEND );\r\n\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t};\r\n\r\n\tthis.initAttributes = function () {\r\n\r\n\t\tfor ( var i = 0, l = newAttributes.length; i < l; i ++ ) {\r\n\r\n\t\t\tnewAttributes[ i ] = 0;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.enableAttribute = function ( attribute ) {\r\n\r\n\t\tnewAttributes[ attribute ] = 1;\r\n\r\n\t\tif ( enabledAttributes[ attribute ] === 0 ) {\r\n\r\n\t\t\tgl.enableVertexAttribArray( attribute );\r\n\t\t\tenabledAttributes[ attribute ] = 1;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.disableUnusedAttributes = function () {\r\n\r\n\t\tfor ( var i = 0, l = enabledAttributes.length; i < l; i ++ ) {\r\n\r\n\t\t\tif ( enabledAttributes[ i ] !== newAttributes[ i ] ) {\r\n\r\n\t\t\t\tgl.disableVertexAttribArray( i );\r\n\t\t\t\tenabledAttributes[ i ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.enable = function ( id ) {\r\n\r\n\t\tif ( capabilities[ id ] !== true ) {\r\n\r\n\t\t\tgl.enable( id );\r\n\t\t\tcapabilities[ id ] = true;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.disable = function ( id ) {\r\n\r\n\t\tif ( capabilities[ id ] !== false ) {\r\n\r\n\t\t\tgl.disable( id );\r\n\t\t\tcapabilities[ id ] = false;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.getCompressedTextureFormats = function () {\r\n\r\n\t\tif ( compressedTextureFormats === null ) {\r\n\r\n\t\t\tcompressedTextureFormats = [];\r\n\r\n\t\t\tif ( extensions.get( 'WEBGL_compressed_texture_pvrtc' ) ||\r\n\t\t\t     extensions.get( 'WEBGL_compressed_texture_s3tc' ) ) {\r\n\r\n\t\t\t\tvar formats = gl.getParameter( gl.COMPRESSED_TEXTURE_FORMATS );\r\n\r\n\t\t\t\tfor ( var i = 0; i < formats.length; i ++ ) {\r\n\r\n\t\t\t\t\tcompressedTextureFormats.push( formats[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn compressedTextureFormats;\r\n\r\n\t};\r\n\r\n\tthis.setBlending = function ( blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha ) {\r\n\r\n\t\tif ( blending !== currentBlending ) {\r\n\r\n\t\t\tif ( blending === THREE.NoBlending ) {\r\n\r\n\t\t\t\tthis.disable( gl.BLEND );\r\n\r\n\t\t\t} else if ( blending === THREE.AdditiveBlending ) {\r\n\r\n\t\t\t\tthis.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\r\n\t\t\t} else if ( blending === THREE.SubtractiveBlending ) {\r\n\r\n\t\t\t\t// TODO: Find blendFuncSeparate() combination\r\n\r\n\t\t\t\tthis.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.ZERO, gl.ONE_MINUS_SRC_COLOR );\r\n\r\n\t\t\t} else if ( blending === THREE.MultiplyBlending ) {\r\n\r\n\t\t\t\t// TODO: Find blendFuncSeparate() combination\r\n\r\n\t\t\t\tthis.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.ZERO, gl.SRC_COLOR );\r\n\r\n\t\t\t} else if ( blending === THREE.CustomBlending ) {\r\n\r\n\t\t\t\tthis.enable( gl.BLEND );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquationSeparate( gl.FUNC_ADD, gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFuncSeparate( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentBlending = blending;\r\n\r\n\t\t}\r\n\r\n\t\tif ( blending === THREE.CustomBlending ) {\r\n\r\n\t\t\tblendEquationAlpha = blendEquationAlpha || blendEquation;\r\n\t\t\tblendSrcAlpha = blendSrcAlpha || blendSrc;\r\n\t\t\tblendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n\t\t\tif ( blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha ) {\r\n\r\n\t\t\t\tgl.blendEquationSeparate( paramThreeToGL( blendEquation ), paramThreeToGL( blendEquationAlpha ) );\r\n\r\n\t\t\t\tcurrentBlendEquation = blendEquation;\r\n\t\t\t\tcurrentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha ) {\r\n\r\n\t\t\t\tgl.blendFuncSeparate( paramThreeToGL( blendSrc ), paramThreeToGL( blendDst ), paramThreeToGL( blendSrcAlpha ), paramThreeToGL( blendDstAlpha ) );\r\n\r\n\t\t\t\tcurrentBlendSrc = blendSrc;\r\n\t\t\t\tcurrentBlendDst = blendDst;\r\n\t\t\t\tcurrentBlendSrcAlpha = blendSrcAlpha;\r\n\t\t\t\tcurrentBlendDstAlpha = blendDstAlpha;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcurrentBlendEquation = null;\r\n\t\t\tcurrentBlendSrc = null;\r\n\t\t\tcurrentBlendDst = null;\r\n\t\t\tcurrentBlendEquationAlpha = null;\r\n\t\t\tcurrentBlendSrcAlpha = null;\r\n\t\t\tcurrentBlendDstAlpha = null;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDepthFunc = function ( depthFunc ) {\r\n\r\n\t\tif ( currentDepthFunc !== depthFunc ) {\r\n\r\n\t\t\tif ( depthFunc ) {\r\n\r\n\t\t\t\tswitch ( depthFunc ) {\r\n\r\n\t\t\t\t\tcase THREE.NeverDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.NEVER );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.AlwaysDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.ALWAYS );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.LessDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.LESS );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.LessEqualDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.EqualDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.EQUAL );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.GreaterEqualDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.GEQUAL );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.GreaterDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.GREATER );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase THREE.NotEqualDepth:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.NOTEQUAL );\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentDepthFunc = depthFunc;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDepthTest = function ( depthTest ) {\r\n\r\n\t\tif ( depthTest ) {\r\n\r\n\t\t\tthis.enable( gl.DEPTH_TEST );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.disable( gl.DEPTH_TEST );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDepthWrite = function ( depthWrite ) {\r\n\r\n\t\tif ( currentDepthWrite !== depthWrite ) {\r\n\r\n\t\t\tgl.depthMask( depthWrite );\r\n\t\t\tcurrentDepthWrite = depthWrite;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setColorWrite = function ( colorWrite ) {\r\n\r\n\t\tif ( currentColorWrite !== colorWrite ) {\r\n\r\n\t\t\tgl.colorMask( colorWrite, colorWrite, colorWrite, colorWrite );\r\n\t\t\tcurrentColorWrite = colorWrite;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setFlipSided = function ( flipSided ) {\r\n\r\n\t\tif ( currentFlipSided !== flipSided ) {\r\n\r\n\t\t\tif ( flipSided ) {\r\n\r\n\t\t\t\tgl.frontFace( gl.CW );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.frontFace( gl.CCW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentFlipSided = flipSided;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setLineWidth = function ( width ) {\r\n\r\n\t\tif ( width !== currentLineWidth ) {\r\n\r\n\t\t\tgl.lineWidth( width );\r\n\r\n\t\t\tcurrentLineWidth = width;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setPolygonOffset = function ( polygonOffset, factor, units ) {\r\n\r\n\t\tif ( polygonOffset ) {\r\n\r\n\t\t\tthis.enable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.disable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t}\r\n\r\n\t\tif ( polygonOffset && ( currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units ) ) {\r\n\r\n\t\t\tgl.polygonOffset( factor, units );\r\n\r\n\t\t\tcurrentPolygonOffsetFactor = factor;\r\n\t\t\tcurrentPolygonOffsetUnits = units;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setScissorTest = function ( scissorTest ) {\r\n\r\n\t\tif ( scissorTest ) {\r\n\r\n\t\t\tthis.enable( gl.SCISSOR_TEST );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.disable( gl.SCISSOR_TEST );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// texture\r\n\r\n\tthis.activeTexture = function ( webglSlot ) {\r\n\r\n\t\tif ( webglSlot === undefined ) webglSlot = gl.TEXTURE0 + maxTextures - 1;\r\n\r\n\t\tif ( currentTextureSlot !== webglSlot ) {\r\n\r\n\t\t\tgl.activeTexture( webglSlot );\r\n\t\t\tcurrentTextureSlot = webglSlot;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.bindTexture = function ( webglType, webglTexture ) {\r\n\r\n\t\tif ( currentTextureSlot === undefined ) {\r\n\r\n\t\t\t_this.activeTexture();\r\n\r\n\t\t}\r\n\r\n\t\tvar boundTexture = currentBoundTextures[ currentTextureSlot ];\r\n\r\n\t\tif ( boundTexture === undefined ) {\r\n\r\n\t\t\tboundTexture = { type: undefined, texture: undefined };\r\n\t\t\tcurrentBoundTextures[ currentTextureSlot ] = boundTexture;\r\n\r\n\t\t}\r\n\r\n\t\tif ( boundTexture.type !== webglType || boundTexture.texture !== webglTexture ) {\r\n\r\n\t\t\tgl.bindTexture( webglType, webglTexture );\r\n\r\n\t\t\tboundTexture.type = webglType;\r\n\t\t\tboundTexture.texture = webglTexture;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.compressedTexImage2D = function () {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tgl.compressedTexImage2D.apply( gl, arguments );\r\n\r\n\t\t} catch ( error ) {\r\n\r\n\t\t\tconsole.error( error );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.texImage2D = function () {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tgl.texImage2D.apply( gl, arguments );\r\n\r\n\t\t} catch ( error ) {\r\n\r\n\t\t\tconsole.error( error );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\tfor ( var i = 0; i < enabledAttributes.length; i ++ ) {\r\n\r\n\t\t\tif ( enabledAttributes[ i ] === 1 ) {\r\n\r\n\t\t\t\tgl.disableVertexAttribArray( i );\r\n\t\t\t\tenabledAttributes[ i ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tcapabilities = {};\r\n\r\n\t\tcompressedTextureFormats = null;\r\n\r\n\t\tcurrentBlending = null;\r\n\r\n\t\tcurrentDepthWrite = null;\r\n\t\tcurrentColorWrite = null;\r\n\r\n\t\tcurrentFlipSided = null;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function ( renderer, flares ) {\r\n\r\n\tvar gl = renderer.context;\r\n\tvar state = renderer.state;\r\n\r\n\tvar vertexBuffer, elementBuffer;\r\n\tvar program, attributes, uniforms;\r\n\tvar hasVertexTexture;\r\n\r\n\tvar tempTexture, occlusionTexture;\r\n\r\n\tvar init = function () {\r\n\r\n\t\tvar vertices = new Float32Array( [\r\n\t\t\t- 1, - 1,  0, 0,\r\n\t\t\t 1, - 1,  1, 0,\r\n\t\t\t 1,  1,  1, 1,\r\n\t\t\t- 1,  1,  0, 1\r\n\t\t] );\r\n\r\n\t\tvar faces = new Uint16Array( [\r\n\t\t\t0, 1, 2,\r\n\t\t\t0, 2, 3\r\n\t\t] );\r\n\r\n\t\t// buffers\r\n\r\n\t\tvertexBuffer     = gl.createBuffer();\r\n\t\telementBuffer    = gl.createBuffer();\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\t\tgl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );\r\n\r\n\t\t// textures\r\n\r\n\t\ttempTexture      = gl.createTexture();\r\n\t\tocclusionTexture = gl.createTexture();\r\n\r\n\t\tstate.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\r\n\t\tstate.bindTexture( gl.TEXTURE_2D, occlusionTexture );\r\n\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\r\n\t\thasVertexTexture = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS ) > 0;\r\n\r\n\t\tvar shader;\r\n\r\n\t\tif ( hasVertexTexture ) {\r\n\r\n\t\t\tshader = {\r\n\r\n\t\t\t\tvertexShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform vec3 screenPosition;\",\r\n\t\t\t\t\t\"uniform vec2 scale;\",\r\n\t\t\t\t\t\"uniform float rotation;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D occlusionMap;\",\r\n\r\n\t\t\t\t\t\"attribute vec2 position;\",\r\n\t\t\t\t\t\"attribute vec2 uv;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\t\t\t\t\t\"varying float vVisibility;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t\"vUV = uv;\",\r\n\r\n\t\t\t\t\t\t\"vec2 pos = position;\",\r\n\r\n\t\t\t\t\t\t\"if( renderType == 2 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n\t\t\t\t\t\t\t\"vVisibility =        visibility.r / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *=       visibility.b / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n\t\t\t\t\t\t\t\"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n\t\t\t\t\t\t\t\"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\t\"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" ),\r\n\r\n\t\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D map;\",\r\n\t\t\t\t\t\"uniform float opacity;\",\r\n\t\t\t\t\t\"uniform vec3 color;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\t\t\t\t\t\"varying float vVisibility;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t// pink square\r\n\r\n\t\t\t\t\t\t\"if( renderType == 0 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n\t\t\t\t\t\t// restore\r\n\r\n\t\t\t\t\t\t\"} else if( renderType == 1 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n\t\t\t\t\t\t// flare\r\n\r\n\t\t\t\t\t\t\"} else {\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 texture = texture2D( map, vUV );\",\r\n\t\t\t\t\t\t\t\"texture.a *= opacity * vVisibility;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor.rgb *= color;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" )\r\n\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\tshader = {\r\n\r\n\t\t\t\tvertexShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform vec3 screenPosition;\",\r\n\t\t\t\t\t\"uniform vec2 scale;\",\r\n\t\t\t\t\t\"uniform float rotation;\",\r\n\r\n\t\t\t\t\t\"attribute vec2 position;\",\r\n\t\t\t\t\t\"attribute vec2 uv;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t\"vUV = uv;\",\r\n\r\n\t\t\t\t\t\t\"vec2 pos = position;\",\r\n\r\n\t\t\t\t\t\t\"if( renderType == 2 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n\t\t\t\t\t\t\t\"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\t\"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" ),\r\n\r\n\t\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t\t\"precision mediump float;\",\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D map;\",\r\n\t\t\t\t\t\"uniform sampler2D occlusionMap;\",\r\n\t\t\t\t\t\"uniform float opacity;\",\r\n\t\t\t\t\t\"uniform vec3 color;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t// pink square\r\n\r\n\t\t\t\t\t\t\"if( renderType == 0 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n\t\t\t\t\t\t// restore\r\n\r\n\t\t\t\t\t\t\"} else if( renderType == 1 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n\t\t\t\t\t\t// flare\r\n\r\n\t\t\t\t\t\t\"} else {\",\r\n\r\n\t\t\t\t\t\t\t\"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 texture = texture2D( map, vUV );\",\r\n\t\t\t\t\t\t\t\"texture.a *= opacity * visibility;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor.rgb *= color;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" )\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tprogram = createProgram( shader );\r\n\r\n\t\tattributes = {\r\n\t\t\tvertex: gl.getAttribLocation ( program, \"position\" ),\r\n\t\t\tuv:     gl.getAttribLocation ( program, \"uv\" )\r\n\t\t};\r\n\r\n\t\tuniforms = {\r\n\t\t\trenderType:     gl.getUniformLocation( program, \"renderType\" ),\r\n\t\t\tmap:            gl.getUniformLocation( program, \"map\" ),\r\n\t\t\tocclusionMap:   gl.getUniformLocation( program, \"occlusionMap\" ),\r\n\t\t\topacity:        gl.getUniformLocation( program, \"opacity\" ),\r\n\t\t\tcolor:          gl.getUniformLocation( program, \"color\" ),\r\n\t\t\tscale:          gl.getUniformLocation( program, \"scale\" ),\r\n\t\t\trotation:       gl.getUniformLocation( program, \"rotation\" ),\r\n\t\t\tscreenPosition: gl.getUniformLocation( program, \"screenPosition\" )\r\n\t\t};\r\n\r\n\t};\r\n\r\n\t/*\r\n\t * Render lens flares\r\n\t * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n\t *         reads these back and calculates occlusion.\r\n\t */\r\n\r\n\tthis.render = function ( scene, camera, viewportWidth, viewportHeight ) {\r\n\r\n\t\tif ( flares.length === 0 ) return;\r\n\r\n\t\tvar tempPosition = new THREE.Vector3();\r\n\r\n\t\tvar invAspect = viewportHeight / viewportWidth,\r\n\t\t\thalfViewportWidth = viewportWidth * 0.5,\r\n\t\t\thalfViewportHeight = viewportHeight * 0.5;\r\n\r\n\t\tvar size = 16 / viewportHeight,\r\n\t\t\tscale = new THREE.Vector2( size * invAspect, size );\r\n\r\n\t\tvar screenPosition = new THREE.Vector3( 1, 1, 0 ),\r\n\t\t\tscreenPositionPixels = new THREE.Vector2( 1, 1 );\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tinit();\r\n\r\n\t\t}\r\n\r\n\t\tgl.useProgram( program );\r\n\r\n\t\tstate.initAttributes();\r\n\t\tstate.enableAttribute( attributes.vertex );\r\n\t\tstate.enableAttribute( attributes.uv );\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t\t// loop through all lens flares to update their occlusion and positions\r\n\t\t// setup gl and common used attribs/uniforms\r\n\r\n\t\tgl.uniform1i( uniforms.occlusionMap, 0 );\r\n\t\tgl.uniform1i( uniforms.map, 1 );\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.vertexAttribPointer( attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0 );\r\n\t\tgl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\r\n\t\tstate.disable( gl.CULL_FACE );\r\n\t\tgl.depthMask( false );\r\n\r\n\t\tfor ( var i = 0, l = flares.length; i < l; i ++ ) {\r\n\r\n\t\t\tsize = 16 / viewportHeight;\r\n\t\t\tscale.set( size * invAspect, size );\r\n\r\n\t\t\t// calc object screen position\r\n\r\n\t\t\tvar flare = flares[ i ];\r\n\r\n\t\t\ttempPosition.set( flare.matrixWorld.elements[ 12 ], flare.matrixWorld.elements[ 13 ], flare.matrixWorld.elements[ 14 ] );\r\n\r\n\t\t\ttempPosition.applyMatrix4( camera.matrixWorldInverse );\r\n\t\t\ttempPosition.applyProjection( camera.projectionMatrix );\r\n\r\n\t\t\t// setup arrays for gl programs\r\n\r\n\t\t\tscreenPosition.copy( tempPosition );\r\n\r\n\t\t\tscreenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n\t\t\tscreenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n\t\t\t// screen cull\r\n\r\n\t\t\tif ( hasVertexTexture || (\r\n\t\t\t\tscreenPositionPixels.x > 0 &&\r\n\t\t\t\tscreenPositionPixels.x < viewportWidth &&\r\n\t\t\t\tscreenPositionPixels.y > 0 &&\r\n\t\t\t\tscreenPositionPixels.y < viewportHeight ) ) {\r\n\r\n\t\t\t\t// save current RGB to temp texture\r\n\r\n\t\t\t\tstate.activeTexture( gl.TEXTURE0 );\r\n\t\t\t\tstate.bindTexture( gl.TEXTURE_2D, null );\r\n\t\t\t\tstate.activeTexture( gl.TEXTURE1 );\r\n\t\t\t\tstate.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\t\t\tgl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );\r\n\r\n\r\n\t\t\t\t// render pink quad\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 0 );\r\n\t\t\t\tgl.uniform2f( uniforms.scale, scale.x, scale.y );\r\n\t\t\t\tgl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );\r\n\r\n\t\t\t\tstate.disable( gl.BLEND );\r\n\t\t\t\tstate.enable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\r\n\t\t\t\t// copy result to occlusionMap\r\n\r\n\t\t\t\tstate.activeTexture( gl.TEXTURE0 );\r\n\t\t\t\tstate.bindTexture( gl.TEXTURE_2D, occlusionTexture );\r\n\t\t\t\tgl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );\r\n\r\n\r\n\t\t\t\t// restore graphics\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 1 );\r\n\t\t\t\tstate.disable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\tstate.activeTexture( gl.TEXTURE1 );\r\n\t\t\t\tstate.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\r\n\t\t\t\t// update object positions\r\n\r\n\t\t\t\tflare.positionScreen.copy( screenPosition );\r\n\r\n\t\t\t\tif ( flare.customUpdateCallback ) {\r\n\r\n\t\t\t\t\tflare.customUpdateCallback( flare );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tflare.updateLensFlares();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// render flares\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 2 );\r\n\t\t\t\tstate.enable( gl.BLEND );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = flare.lensFlares.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar sprite = flare.lensFlares[ j ];\r\n\r\n\t\t\t\t\tif ( sprite.opacity > 0.001 && sprite.scale > 0.001 ) {\r\n\r\n\t\t\t\t\t\tscreenPosition.x = sprite.x;\r\n\t\t\t\t\t\tscreenPosition.y = sprite.y;\r\n\t\t\t\t\t\tscreenPosition.z = sprite.z;\r\n\r\n\t\t\t\t\t\tsize = sprite.size * sprite.scale / viewportHeight;\r\n\r\n\t\t\t\t\t\tscale.x = size * invAspect;\r\n\t\t\t\t\t\tscale.y = size;\r\n\r\n\t\t\t\t\t\tgl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );\r\n\t\t\t\t\t\tgl.uniform2f( uniforms.scale, scale.x, scale.y );\r\n\t\t\t\t\t\tgl.uniform1f( uniforms.rotation, sprite.rotation );\r\n\r\n\t\t\t\t\t\tgl.uniform1f( uniforms.opacity, sprite.opacity );\r\n\t\t\t\t\t\tgl.uniform3f( uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b );\r\n\r\n\t\t\t\t\t\tstate.setBlending( sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst );\r\n\t\t\t\t\t\trenderer.setTexture( sprite.texture, 1 );\r\n\r\n\t\t\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore gl\r\n\r\n\t\tstate.enable( gl.CULL_FACE );\r\n\t\tstate.enable( gl.DEPTH_TEST );\r\n\t\tgl.depthMask( true );\r\n\r\n\t\trenderer.resetGLState();\r\n\r\n\t};\r\n\r\n\tfunction createProgram ( shader ) {\r\n\r\n\t\tvar program = gl.createProgram();\r\n\r\n\t\tvar fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );\r\n\t\tvar vertexShader = gl.createShader( gl.VERTEX_SHADER );\r\n\r\n\t\tvar prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n\t\tgl.shaderSource( fragmentShader, prefix + shader.fragmentShader );\r\n\t\tgl.shaderSource( vertexShader, prefix + shader.vertexShader );\r\n\r\n\t\tgl.compileShader( fragmentShader );\r\n\t\tgl.compileShader( vertexShader );\r\n\r\n\t\tgl.attachShader( program, fragmentShader );\r\n\t\tgl.attachShader( program, vertexShader );\r\n\r\n\t\tgl.linkProgram( program );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function ( renderer, sprites ) {\r\n\r\n\tvar gl = renderer.context;\r\n\tvar state = renderer.state;\r\n\r\n\tvar vertexBuffer, elementBuffer;\r\n\tvar program, attributes, uniforms;\r\n\r\n\tvar texture;\r\n\r\n\t// decompose matrixWorld\r\n\r\n\tvar spritePosition = new THREE.Vector3();\r\n\tvar spriteRotation = new THREE.Quaternion();\r\n\tvar spriteScale = new THREE.Vector3();\r\n\r\n\tvar init = function () {\r\n\r\n\t\tvar vertices = new Float32Array( [\r\n\t\t\t- 0.5, - 0.5,  0, 0,\r\n\t\t\t  0.5, - 0.5,  1, 0,\r\n\t\t\t  0.5,   0.5,  1, 1,\r\n\t\t\t- 0.5,   0.5,  0, 1\r\n\t\t] );\r\n\r\n\t\tvar faces = new Uint16Array( [\r\n\t\t\t0, 1, 2,\r\n\t\t\t0, 2, 3\r\n\t\t] );\r\n\r\n\t\tvertexBuffer  = gl.createBuffer();\r\n\t\telementBuffer = gl.createBuffer();\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\t\tgl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );\r\n\r\n\t\tprogram = createProgram();\r\n\r\n\t\tattributes = {\r\n\t\t\tposition:\t\t\tgl.getAttribLocation ( program, 'position' ),\r\n\t\t\tuv:\t\t\t\t\tgl.getAttribLocation ( program, 'uv' )\r\n\t\t};\r\n\r\n\t\tuniforms = {\r\n\t\t\tuvOffset:\t\t\tgl.getUniformLocation( program, 'uvOffset' ),\r\n\t\t\tuvScale:\t\t\tgl.getUniformLocation( program, 'uvScale' ),\r\n\r\n\t\t\trotation:\t\t\tgl.getUniformLocation( program, 'rotation' ),\r\n\t\t\tscale:\t\t\t\tgl.getUniformLocation( program, 'scale' ),\r\n\r\n\t\t\tcolor:\t\t\t\tgl.getUniformLocation( program, 'color' ),\r\n\t\t\tmap:\t\t\t\tgl.getUniformLocation( program, 'map' ),\r\n\t\t\topacity:\t\t\tgl.getUniformLocation( program, 'opacity' ),\r\n\r\n\t\t\tmodelViewMatrix: \tgl.getUniformLocation( program, 'modelViewMatrix' ),\r\n\t\t\tprojectionMatrix:\tgl.getUniformLocation( program, 'projectionMatrix' ),\r\n\r\n\t\t\tfogType:\t\t\tgl.getUniformLocation( program, 'fogType' ),\r\n\t\t\tfogDensity:\t\t\tgl.getUniformLocation( program, 'fogDensity' ),\r\n\t\t\tfogNear:\t\t\tgl.getUniformLocation( program, 'fogNear' ),\r\n\t\t\tfogFar:\t\t\t\tgl.getUniformLocation( program, 'fogFar' ),\r\n\t\t\tfogColor:\t\t\tgl.getUniformLocation( program, 'fogColor' ),\r\n\r\n\t\t\talphaTest:\t\t\tgl.getUniformLocation( program, 'alphaTest' )\r\n\t\t};\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = 8;\r\n\t\tcanvas.height = 8;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.fillStyle = 'white';\r\n\t\tcontext.fillRect( 0, 0, 8, 8 );\r\n\r\n\t\ttexture = new THREE.Texture( canvas );\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t};\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( sprites.length === 0 ) return;\r\n\r\n\t\t// setup gl\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tinit();\r\n\r\n\t\t}\r\n\r\n\t\tgl.useProgram( program );\r\n\r\n\t\tstate.initAttributes();\r\n\t\tstate.enableAttribute( attributes.position );\r\n\t\tstate.enableAttribute( attributes.uv );\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t\tstate.disable( gl.CULL_FACE );\r\n\t\tstate.enable( gl.BLEND );\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.vertexAttribPointer( attributes.position, 2, gl.FLOAT, false, 2 * 8, 0 );\r\n\t\tgl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\r\n\t\tgl.uniformMatrix4fv( uniforms.projectionMatrix, false, camera.projectionMatrix.elements );\r\n\r\n\t\tstate.activeTexture( gl.TEXTURE0 );\r\n\t\tgl.uniform1i( uniforms.map, 0 );\r\n\r\n\t\tvar oldFogType = 0;\r\n\t\tvar sceneFogType = 0;\r\n\t\tvar fog = scene.fog;\r\n\r\n\t\tif ( fog ) {\r\n\r\n\t\t\tgl.uniform3f( uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b );\r\n\r\n\t\t\tif ( fog instanceof THREE.Fog ) {\r\n\r\n\t\t\t\tgl.uniform1f( uniforms.fogNear, fog.near );\r\n\t\t\t\tgl.uniform1f( uniforms.fogFar, fog.far );\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, 1 );\r\n\t\t\t\toldFogType = 1;\r\n\t\t\t\tsceneFogType = 1;\r\n\r\n\t\t\t} else if ( fog instanceof THREE.FogExp2 ) {\r\n\r\n\t\t\t\tgl.uniform1f( uniforms.fogDensity, fog.density );\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, 2 );\r\n\t\t\t\toldFogType = 2;\r\n\t\t\t\tsceneFogType = 2;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgl.uniform1i( uniforms.fogType, 0 );\r\n\t\t\toldFogType = 0;\r\n\t\t\tsceneFogType = 0;\r\n\r\n\t\t}\r\n\r\n\r\n\t\t// update positions and sort\r\n\r\n\t\tfor ( var i = 0, l = sprites.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar sprite = sprites[ i ];\r\n\r\n\t\t\tsprite.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, sprite.matrixWorld );\r\n\t\t\tsprite.z = - sprite.modelViewMatrix.elements[ 14 ];\r\n\r\n\t\t}\r\n\r\n\t\tsprites.sort( painterSortStable );\r\n\r\n\t\t// render all sprites\r\n\r\n\t\tvar scale = [];\r\n\r\n\t\tfor ( var i = 0, l = sprites.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar sprite = sprites[ i ];\r\n\t\t\tvar material = sprite.material;\r\n\r\n\t\t\tgl.uniform1f( uniforms.alphaTest, material.alphaTest );\r\n\t\t\tgl.uniformMatrix4fv( uniforms.modelViewMatrix, false, sprite.modelViewMatrix.elements );\r\n\r\n\t\t\tsprite.matrixWorld.decompose( spritePosition, spriteRotation, spriteScale );\r\n\r\n\t\t\tscale[ 0 ] = spriteScale.x;\r\n\t\t\tscale[ 1 ] = spriteScale.y;\r\n\r\n\t\t\tvar fogType = 0;\r\n\r\n\t\t\tif ( scene.fog && material.fog ) {\r\n\r\n\t\t\t\tfogType = sceneFogType;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( oldFogType !== fogType ) {\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, fogType );\r\n\t\t\t\toldFogType = fogType;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material.map !== null ) {\r\n\r\n\t\t\t\tgl.uniform2f( uniforms.uvOffset, material.map.offset.x, material.map.offset.y );\r\n\t\t\t\tgl.uniform2f( uniforms.uvScale, material.map.repeat.x, material.map.repeat.y );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.uniform2f( uniforms.uvOffset, 0, 0 );\r\n\t\t\t\tgl.uniform2f( uniforms.uvScale, 1, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgl.uniform1f( uniforms.opacity, material.opacity );\r\n\t\t\tgl.uniform3f( uniforms.color, material.color.r, material.color.g, material.color.b );\r\n\r\n\t\t\tgl.uniform1f( uniforms.rotation, material.rotation );\r\n\t\t\tgl.uniform2fv( uniforms.scale, scale );\r\n\r\n\t\t\tstate.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );\r\n\t\t\tstate.setDepthTest( material.depthTest );\r\n\t\t\tstate.setDepthWrite( material.depthWrite );\r\n\r\n\t\t\tif ( material.map && material.map.image && material.map.image.width ) {\r\n\r\n\t\t\t\trenderer.setTexture( material.map, 0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setTexture( texture, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\t\t}\r\n\r\n\t\t// restore gl\r\n\r\n\t\tstate.enable( gl.CULL_FACE );\r\n\r\n\t\trenderer.resetGLState();\r\n\r\n\t};\r\n\r\n\tfunction createProgram () {\r\n\r\n\t\tvar program = gl.createProgram();\r\n\r\n\t\tvar vertexShader = gl.createShader( gl.VERTEX_SHADER );\r\n\t\tvar fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );\r\n\r\n\t\tgl.shaderSource( vertexShader, [\r\n\r\n\t\t\t'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n\t\t\t'uniform mat4 modelViewMatrix;',\r\n\t\t\t'uniform mat4 projectionMatrix;',\r\n\t\t\t'uniform float rotation;',\r\n\t\t\t'uniform vec2 scale;',\r\n\t\t\t'uniform vec2 uvOffset;',\r\n\t\t\t'uniform vec2 uvScale;',\r\n\r\n\t\t\t'attribute vec2 position;',\r\n\t\t\t'attribute vec2 uv;',\r\n\r\n\t\t\t'varying vec2 vUV;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t\t'vUV = uvOffset + uv * uvScale;',\r\n\r\n\t\t\t\t'vec2 alignedPosition = position * scale;',\r\n\r\n\t\t\t\t'vec2 rotatedPosition;',\r\n\t\t\t\t'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n\t\t\t\t'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n\t\t\t\t'vec4 finalPosition;',\r\n\r\n\t\t\t\t'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n\t\t\t\t'finalPosition.xy += rotatedPosition;',\r\n\t\t\t\t'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n\t\t\t\t'gl_Position = finalPosition;',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join( '\\n' ) );\r\n\r\n\t\tgl.shaderSource( fragmentShader, [\r\n\r\n\t\t\t'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n\t\t\t'uniform vec3 color;',\r\n\t\t\t'uniform sampler2D map;',\r\n\t\t\t'uniform float opacity;',\r\n\r\n\t\t\t'uniform int fogType;',\r\n\t\t\t'uniform vec3 fogColor;',\r\n\t\t\t'uniform float fogDensity;',\r\n\t\t\t'uniform float fogNear;',\r\n\t\t\t'uniform float fogFar;',\r\n\t\t\t'uniform float alphaTest;',\r\n\r\n\t\t\t'varying vec2 vUV;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t\t'vec4 texture = texture2D( map, vUV );',\r\n\r\n\t\t\t\t'if ( texture.a < alphaTest ) discard;',\r\n\r\n\t\t\t\t'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n\t\t\t\t'if ( fogType > 0 ) {',\r\n\r\n\t\t\t\t\t'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n\t\t\t\t\t'float fogFactor = 0.0;',\r\n\r\n\t\t\t\t\t'if ( fogType == 1 ) {',\r\n\r\n\t\t\t\t\t\t'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n\t\t\t\t\t'} else {',\r\n\r\n\t\t\t\t\t\t'const float LOG2 = 1.442695;',\r\n\t\t\t\t\t\t'fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n\t\t\t\t\t\t'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n\t\t\t\t\t'}',\r\n\r\n\t\t\t\t\t'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n\t\t\t\t'}',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join( '\\n' ) );\r\n\r\n\t\tgl.compileShader( vertexShader );\r\n\t\tgl.compileShader( fragmentShader );\r\n\r\n\t\tgl.attachShader( program, vertexShader );\r\n\t\tgl.attachShader( program, fragmentShader );\r\n\r\n\t\tgl.linkProgram( program );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tfunction painterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn b.id - a.id;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n\tmerge: function ( geometry1, geometry2, materialIndexOffset ) {\r\n\r\n\t\tconsole.warn( 'THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.' );\r\n\r\n\t\tvar matrix;\r\n\r\n\t\tif ( geometry2 instanceof THREE.Mesh ) {\r\n\r\n\t\t\tgeometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n\t\t\tmatrix = geometry2.matrix;\r\n\t\t\tgeometry2 = geometry2.geometry;\r\n\r\n\t\t}\r\n\r\n\t\tgeometry1.merge( geometry2, matrix, materialIndexOffset );\r\n\r\n\t},\r\n\r\n\tcenter: function ( geometry ) {\r\n\r\n\t\tconsole.warn( 'THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.' );\r\n\t\treturn geometry.center();\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n\tcrossOrigin: undefined,\r\n\r\n\tloadTexture: function ( url, mapping, onLoad, onError ) {\r\n\r\n\t\tvar loader = new THREE.ImageLoader();\r\n\t\tloader.crossOrigin = this.crossOrigin;\r\n\r\n\t\tvar texture = new THREE.Texture( undefined, mapping );\r\n\r\n\t\tloader.load( url, function ( image ) {\r\n\r\n\t\t\ttexture.image = image;\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t}, undefined, function ( event ) {\r\n\r\n\t\t\tif ( onError ) onError( event );\r\n\r\n\t\t} );\r\n\r\n\t\ttexture.sourceFile = url;\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tloadTextureCube: function ( array, mapping, onLoad, onError ) {\r\n\r\n\t\tvar images = [];\r\n\r\n\t\tvar loader = new THREE.ImageLoader();\r\n\t\tloader.crossOrigin = this.crossOrigin;\r\n\r\n\t\tvar texture = new THREE.CubeTexture( images, mapping );\r\n\r\n\t\tvar loaded = 0;\r\n\r\n\t\tvar loadTexture = function ( i ) {\r\n\r\n\t\t\tloader.load( array[ i ], function ( image ) {\r\n\r\n\t\t\t\ttexture.images[ i ] = image;\r\n\r\n\t\t\t\tloaded += 1;\r\n\r\n\t\t\t\tif ( loaded === 6 ) {\r\n\r\n\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, undefined, onError );\r\n\r\n\t\t};\r\n\r\n\t\tfor ( var i = 0, il = array.length; i < il; ++ i ) {\r\n\r\n\t\t\tloadTexture( i );\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tloadCompressedTexture: function () {\r\n\r\n\t\tconsole.error( 'THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.' )\r\n\r\n\t},\r\n\r\n\tloadCompressedTextureCube: function () {\r\n\r\n\t\tconsole.error( 'THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.' )\r\n\r\n\t},\r\n\r\n\tgetNormalMap: function ( image, depth ) {\r\n\r\n\t\t// Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n\t\tvar cross = function ( a, b ) {\r\n\r\n\t\t\treturn [ a[ 1 ] * b[ 2 ] - a[ 2 ] * b[ 1 ], a[ 2 ] * b[ 0 ] - a[ 0 ] * b[ 2 ], a[ 0 ] * b[ 1 ] - a[ 1 ] * b[ 0 ] ];\r\n\r\n\t\t};\r\n\r\n\t\tvar subtract = function ( a, b ) {\r\n\r\n\t\t\treturn [ a[ 0 ] - b[ 0 ], a[ 1 ] - b[ 1 ], a[ 2 ] - b[ 2 ] ];\r\n\r\n\t\t};\r\n\r\n\t\tvar normalize = function ( a ) {\r\n\r\n\t\t\tvar l = Math.sqrt( a[ 0 ] * a[ 0 ] + a[ 1 ] * a[ 1 ] + a[ 2 ] * a[ 2 ] );\r\n\t\t\treturn [ a[ 0 ] / l, a[ 1 ] / l, a[ 2 ] / l ];\r\n\r\n\t\t};\r\n\r\n\t\tdepth = depth | 1;\r\n\r\n\t\tvar width = image.width;\r\n\t\tvar height = image.height;\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = width;\r\n\t\tcanvas.height = height;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.drawImage( image, 0, 0 );\r\n\r\n\t\tvar data = context.getImageData( 0, 0, width, height ).data;\r\n\t\tvar imageData = context.createImageData( width, height );\r\n\t\tvar output = imageData.data;\r\n\r\n\t\tfor ( var x = 0; x < width; x ++ ) {\r\n\r\n\t\t\tfor ( var y = 0; y < height; y ++ ) {\r\n\r\n\t\t\t\tvar ly = y - 1 < 0 ? 0 : y - 1;\r\n\t\t\t\tvar uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n\t\t\t\tvar lx = x - 1 < 0 ? 0 : x - 1;\r\n\t\t\t\tvar ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n\t\t\t\tvar points = [];\r\n\t\t\t\tvar origin = [ 0, 0, data[ ( y * width + x ) * 4 ] / 255 * depth ];\r\n\t\t\t\tpoints.push( [ - 1, 0, data[ ( y * width + lx ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ - 1, - 1, data[ ( ly * width + lx ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 0, - 1, data[ ( ly * width + x ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, - 1, data[ ( ly * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, 0, data[ ( y * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, 1, data[ ( uy * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 0, 1, data[ ( uy * width + x ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ - 1, 1, data[ ( uy * width + lx ) * 4 ] / 255 * depth ] );\r\n\r\n\t\t\t\tvar normals = [];\r\n\t\t\t\tvar num_points = points.length;\r\n\r\n\t\t\t\tfor ( var i = 0; i < num_points; i ++ ) {\r\n\r\n\t\t\t\t\tvar v1 = points[ i ];\r\n\t\t\t\t\tvar v2 = points[ ( i + 1 ) % num_points ];\r\n\t\t\t\t\tv1 = subtract( v1, origin );\r\n\t\t\t\t\tv2 = subtract( v2, origin );\r\n\t\t\t\t\tnormals.push( normalize( cross( v1, v2 ) ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar normal = [ 0, 0, 0 ];\r\n\r\n\t\t\t\tfor ( var i = 0; i < normals.length; i ++ ) {\r\n\r\n\t\t\t\t\tnormal[ 0 ] += normals[ i ][ 0 ];\r\n\t\t\t\t\tnormal[ 1 ] += normals[ i ][ 1 ];\r\n\t\t\t\t\tnormal[ 2 ] += normals[ i ][ 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnormal[ 0 ] /= normals.length;\r\n\t\t\t\tnormal[ 1 ] /= normals.length;\r\n\t\t\t\tnormal[ 2 ] /= normals.length;\r\n\r\n\t\t\t\tvar idx = ( y * width + x ) * 4;\r\n\r\n\t\t\t\toutput[ idx ] = ( ( normal[ 0 ] + 1.0 ) / 2.0 * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 1 ] = ( ( normal[ 1 ] + 1.0 ) / 2.0 * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 2 ] = ( normal[ 2 ] * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 3 ] = 255;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tcontext.putImageData( imageData, 0, 0 );\r\n\r\n\t\treturn canvas;\r\n\r\n\t},\r\n\r\n\tgenerateDataTexture: function ( width, height, color ) {\r\n\r\n\t\tvar size = width * height;\r\n\t\tvar data = new Uint8Array( 3 * size );\r\n\r\n\t\tvar r = Math.floor( color.r * 255 );\r\n\t\tvar g = Math.floor( color.g * 255 );\r\n\t\tvar b = Math.floor( color.b * 255 );\r\n\r\n\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\tdata[ i * 3 ] \t   = r;\r\n\t\t\tdata[ i * 3 + 1 ] = g;\r\n\t\t\tdata[ i * 3 + 2 ] = b;\r\n\r\n\t\t}\r\n\r\n\t\tvar texture = new THREE.DataTexture( data, width, height, THREE.RGBFormat );\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n\tcreateMultiMaterialObject: function ( geometry, materials ) {\r\n\r\n\t\tvar group = new THREE.Group();\r\n\r\n\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\r\n\r\n\t\t\tgroup.add( new THREE.Mesh( geometry, materials[ i ] ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn group;\r\n\r\n\t},\r\n\r\n\tdetach: function ( child, parent, scene ) {\r\n\r\n\t\tchild.applyMatrix( parent.matrixWorld );\r\n\t\tparent.remove( child );\r\n\t\tscene.add( child );\r\n\r\n\t},\r\n\r\n\tattach: function ( child, scene, parent ) {\r\n\r\n\t\tvar matrixWorldInverse = new THREE.Matrix4();\r\n\t\tmatrixWorldInverse.getInverse( parent.matrixWorld );\r\n\t\tchild.applyMatrix( matrixWorldInverse );\r\n\r\n\t\tscene.remove( child );\r\n\t\tparent.add( child );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n\tfaces: {},\r\n\r\n\t// Just for now. face[weight][style]\r\n\r\n\tface: 'helvetiker',\r\n\tweight: 'normal',\r\n\tstyle: 'normal',\r\n\tsize: 150,\r\n\tdivisions: 10,\r\n\r\n\tgetFace: function () {\r\n\r\n\t\ttry {\r\n\r\n\t\t\treturn this.faces[ this.face.toLowerCase() ][ this.weight ][ this.style ];\r\n\r\n\t\t} catch ( e ) {\r\n\r\n\t\t\tthrow \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tloadFace: function ( data ) {\r\n\r\n\t\tvar family = data.familyName.toLowerCase();\r\n\r\n\t\tvar ThreeFont = this;\r\n\r\n\t\tThreeFont.faces[ family ] = ThreeFont.faces[ family ] || {};\r\n\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ] = ThreeFont.faces[ family ][ data.cssFontWeight ] || {};\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;\r\n\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tdrawText: function ( text ) {\r\n\r\n\t\t// RenderText\r\n\r\n\t\tvar i,\r\n\t\t\tface = this.getFace(),\r\n\t\t\tscale = this.size / face.resolution,\r\n\t\t\toffset = 0,\r\n\t\t\tchars = String( text ).split( '' ),\r\n\t\t\tlength = chars.length;\r\n\r\n\t\tvar fontPaths = [];\r\n\r\n\t\tfor ( i = 0; i < length; i ++ ) {\r\n\r\n\t\t\tvar path = new THREE.Path();\r\n\r\n\t\t\tvar ret = this.extractGlyphPoints( chars[ i ], face, scale, offset, path );\r\n\t\t\toffset += ret.offset;\r\n\r\n\t\t\tfontPaths.push( ret.path );\r\n\r\n\t\t}\r\n\r\n\t\t// get the width\r\n\r\n\t\tvar width = offset / 2;\r\n\t\t//\r\n\t\t// for ( p = 0; p < allPts.length; p++ ) {\r\n\t\t//\r\n\t\t// \tallPts[ p ].x -= width;\r\n\t\t//\r\n\t\t// }\r\n\r\n\t\t//var extract = this.extractPoints( allPts, characterPts );\r\n\t\t//extract.contour = allPts;\r\n\r\n\t\t//extract.paths = fontPaths;\r\n\t\t//extract.offset = width;\r\n\r\n\t\treturn { paths: fontPaths, offset: width };\r\n\r\n\t},\r\n\r\n\r\n\r\n\r\n\textractGlyphPoints: function ( c, face, scale, offset, path ) {\r\n\r\n\t\tvar pts = [];\r\n\r\n\t\tvar i, i2, divisions,\r\n\t\t\toutline, action, length,\r\n\t\t\tscaleX, scaleY,\r\n\t\t\tx, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n\t\t\tlaste,\r\n\t\t\tglyph = face.glyphs[ c ] || face.glyphs[ '?' ];\r\n\r\n\t\tif ( ! glyph ) return;\r\n\r\n\t\tif ( glyph.o ) {\r\n\r\n\t\t\toutline = glyph._cachedOutline || ( glyph._cachedOutline = glyph.o.split( ' ' ) );\r\n\t\t\tlength = outline.length;\r\n\r\n\t\t\tscaleX = scale;\r\n\t\t\tscaleY = scale;\r\n\r\n\t\t\tfor ( i = 0; i < length; ) {\r\n\r\n\t\t\t\taction = outline[ i ++ ];\r\n\r\n\t\t\t\t//console.log( action );\r\n\r\n\t\t\t\tswitch ( action ) {\r\n\r\n\t\t\t\tcase 'm':\r\n\r\n\t\t\t\t\t// Move To\r\n\r\n\t\t\t\t\tx = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\ty = outline[ i ++ ] * scaleY;\r\n\r\n\t\t\t\t\tpath.moveTo( x, y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'l':\r\n\r\n\t\t\t\t\t// Line To\r\n\r\n\t\t\t\t\tx = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\ty = outline[ i ++ ] * scaleY;\r\n\t\t\t\t\tpath.lineTo( x, y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'q':\r\n\r\n\t\t\t\t\t// QuadraticCurveTo\r\n\r\n\t\t\t\t\tcpx  = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\tcpy  = outline[ i ++ ] * scaleY;\r\n\t\t\t\t\tcpx1 = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\tcpy1 = outline[ i ++ ] * scaleY;\r\n\r\n\t\t\t\t\tpath.quadraticCurveTo( cpx1, cpy1, cpx, cpy );\r\n\r\n\t\t\t\t\tlaste = pts[ pts.length - 1 ];\r\n\r\n\t\t\t\t\tif ( laste ) {\r\n\r\n\t\t\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t\t\t\tfor ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar t = i2 / divisions;\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'b':\r\n\r\n\t\t\t\t\t// Cubic Bezier Curve\r\n\r\n\t\t\t\t\tcpx  = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy  = outline[ i ++ ] *  scaleY;\r\n\t\t\t\t\tcpx1 = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy1 = outline[ i ++ ] *  scaleY;\r\n\t\t\t\t\tcpx2 = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy2 = outline[ i ++ ] *  scaleY;\r\n\r\n\t\t\t\t\tpath.bezierCurveTo( cpx1, cpy1, cpx2, cpy2, cpx, cpy );\r\n\r\n\t\t\t\t\tlaste = pts[ pts.length - 1 ];\r\n\r\n\t\t\t\t\tif ( laste ) {\r\n\r\n\t\t\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t\t\t\tfor ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar t = i2 / divisions;\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn { offset: glyph.ha * scale, path: path };\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function ( text, parameters ) {\r\n\r\n\t// Parameters\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar size = parameters.size !== undefined ? parameters.size : 100;\r\n\tvar curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n\tvar font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n\tvar weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n\tvar style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n\tTHREE.FontUtils.size = size;\r\n\tTHREE.FontUtils.divisions = curveSegments;\r\n\r\n\tTHREE.FontUtils.face = font;\r\n\tTHREE.FontUtils.weight = weight;\r\n\tTHREE.FontUtils.style = style;\r\n\r\n\t// Get a Font data json object\r\n\r\n\tvar data = THREE.FontUtils.drawText( text );\r\n\r\n\tvar paths = data.paths;\r\n\tvar shapes = [];\r\n\r\n\tfor ( var p = 0, pl = paths.length; p < pl; p ++ ) {\r\n\r\n\t\tArray.prototype.push.apply( shapes, paths[ p ].toShapes() );\r\n\r\n\t}\r\n\r\n\treturn shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n( function ( namespace ) {\r\n\r\n\tvar EPSILON = 0.0000000001;\r\n\r\n\t// takes in an contour array and returns\r\n\r\n\tvar process = function ( contour, indices ) {\r\n\r\n\t\tvar n = contour.length;\r\n\r\n\t\tif ( n < 3 ) return null;\r\n\r\n\t\tvar result = [],\r\n\t\t\tverts = [],\r\n\t\t\tvertIndices = [];\r\n\r\n\t\t/* we want a counter-clockwise polygon in verts */\r\n\r\n\t\tvar u, v, w;\r\n\r\n\t\tif ( area( contour ) > 0.0 ) {\r\n\r\n\t\t\tfor ( v = 0; v < n; v ++ ) verts[ v ] = v;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( v = 0; v < n; v ++ ) verts[ v ] = ( n - 1 ) - v;\r\n\r\n\t\t}\r\n\r\n\t\tvar nv = n;\r\n\r\n\t\t/*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n\t\tvar count = 2 * nv;   /* error detection */\r\n\r\n\t\tfor ( v = nv - 1; nv > 2; ) {\r\n\r\n\t\t\t/* if we loop, it is probably a non-simple polygon */\r\n\r\n\t\t\tif ( ( count -- ) <= 0 ) {\r\n\r\n\t\t\t\t//** Triangulate: ERROR - probable bad polygon!\r\n\r\n\t\t\t\t//throw ( \"Warning, unable to triangulate polygon!\" );\r\n\t\t\t\t//return null;\r\n\t\t\t\t// Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n\t\t\t\tconsole.warn( 'THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()' );\r\n\r\n\t\t\t\tif ( indices ) return vertIndices;\r\n\t\t\t\treturn result;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t/* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n\t\t\tu = v; \t \tif ( nv <= u ) u = 0;     /* previous */\r\n\t\t\tv = u + 1;  if ( nv <= v ) v = 0;     /* new v    */\r\n\t\t\tw = v + 1;  if ( nv <= w ) w = 0;     /* next     */\r\n\r\n\t\t\tif ( snip( contour, u, v, w, nv, verts ) ) {\r\n\r\n\t\t\t\tvar a, b, c, s, t;\r\n\r\n\t\t\t\t/* true names of the vertices */\r\n\r\n\t\t\t\ta = verts[ u ];\r\n\t\t\t\tb = verts[ v ];\r\n\t\t\t\tc = verts[ w ];\r\n\r\n\t\t\t\t/* output Triangle */\r\n\r\n\t\t\t\tresult.push( [ contour[ a ],\r\n\t\t\t\t\tcontour[ b ],\r\n\t\t\t\t\tcontour[ c ] ] );\r\n\r\n\r\n\t\t\t\tvertIndices.push( [ verts[ u ], verts[ v ], verts[ w ] ] );\r\n\r\n\t\t\t\t/* remove v from the remaining polygon */\r\n\r\n\t\t\t\tfor ( s = v, t = v + 1; t < nv; s ++, t ++ ) {\r\n\r\n\t\t\t\t\tverts[ s ] = verts[ t ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnv --;\r\n\r\n\t\t\t\t/* reset error detection counter */\r\n\r\n\t\t\t\tcount = 2 * nv;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( indices ) return vertIndices;\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\t// calculate area of the contour polygon\r\n\r\n\tvar area = function ( contour ) {\r\n\r\n\t\tvar n = contour.length;\r\n\t\tvar a = 0.0;\r\n\r\n\t\tfor ( var p = n - 1, q = 0; q < n; p = q ++ ) {\r\n\r\n\t\t\ta += contour[ p ].x * contour[ q ].y - contour[ q ].x * contour[ p ].y;\r\n\r\n\t\t}\r\n\r\n\t\treturn a * 0.5;\r\n\r\n\t};\r\n\r\n\tvar snip = function ( contour, u, v, w, n, verts ) {\r\n\r\n\t\tvar p;\r\n\t\tvar ax, ay, bx, by;\r\n\t\tvar cx, cy, px, py;\r\n\r\n\t\tax = contour[ verts[ u ] ].x;\r\n\t\tay = contour[ verts[ u ] ].y;\r\n\r\n\t\tbx = contour[ verts[ v ] ].x;\r\n\t\tby = contour[ verts[ v ] ].y;\r\n\r\n\t\tcx = contour[ verts[ w ] ].x;\r\n\t\tcy = contour[ verts[ w ] ].y;\r\n\r\n\t\tif ( EPSILON > ( ( ( bx - ax ) * ( cy - ay ) ) - ( ( by - ay ) * ( cx - ax ) ) ) ) return false;\r\n\r\n\t\tvar aX, aY, bX, bY, cX, cY;\r\n\t\tvar apx, apy, bpx, bpy, cpx, cpy;\r\n\t\tvar cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n\t\taX = cx - bx;  aY = cy - by;\r\n\t\tbX = ax - cx;  bY = ay - cy;\r\n\t\tcX = bx - ax;  cY = by - ay;\r\n\r\n\t\tfor ( p = 0; p < n; p ++ ) {\r\n\r\n\t\t\tpx = contour[ verts[ p ] ].x;\r\n\t\t\tpy = contour[ verts[ p ] ].y;\r\n\r\n\t\t\tif ( ( ( px === ax ) && ( py === ay ) ) ||\r\n\t\t\t\t ( ( px === bx ) && ( py === by ) ) ||\r\n\t\t\t\t ( ( px === cx ) && ( py === cy ) ) )\tcontinue;\r\n\r\n\t\t\tapx = px - ax;  apy = py - ay;\r\n\t\t\tbpx = px - bx;  bpy = py - by;\r\n\t\t\tcpx = px - cx;  cpy = py - cy;\r\n\r\n\t\t\t// see if p is inside triangle abc\r\n\r\n\t\t\taCROSSbp = aX * bpy - aY * bpx;\r\n\t\t\tcCROSSap = cX * apy - cY * apx;\r\n\t\t\tbCROSScp = bX * cpy - bY * cpx;\r\n\r\n\t\t\tif ( ( aCROSSbp >= - EPSILON ) && ( bCROSScp >= - EPSILON ) && ( cCROSSap >= - EPSILON ) ) return false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t};\r\n\r\n\r\n\tnamespace.Triangulate = process;\r\n\tnamespace.Triangulate.area = area;\r\n\r\n\treturn namespace;\r\n\r\n} )( THREE.FontUtils );\r\n\r\n// To use the typeface.js face files, hook up the API\r\n\r\nTHREE.typeface_js = { faces: THREE.FontUtils.faces, loadFace: THREE.FontUtils.loadFace };\r\nif ( typeof self !== 'undefined' ) self._typeface_js = THREE.typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function ( listener ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Audio';\r\n\r\n\tthis.context = listener.context;\r\n\tthis.source = this.context.createBufferSource();\r\n\tthis.source.onended = this.onEnded.bind( this );\r\n\r\n\tthis.gain = this.context.createGain();\r\n\tthis.gain.connect( this.context.destination );\r\n\r\n\tthis.panner = this.context.createPanner();\r\n\tthis.panner.connect( this.gain );\r\n\r\n\tthis.autoplay = false;\r\n\r\n\tthis.startTime = 0;\r\n\tthis.playbackRate = 1;\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function ( file ) {\r\n\r\n\tvar scope = this;\r\n\r\n\tvar request = new XMLHttpRequest();\r\n\trequest.open( 'GET', file, true );\r\n\trequest.responseType = 'arraybuffer';\r\n\trequest.onload = function ( e ) {\r\n\r\n\t\tscope.context.decodeAudioData( this.response, function ( buffer ) {\r\n\r\n\t\t\tscope.source.buffer = buffer;\r\n\r\n\t\t\tif ( scope.autoplay ) scope.play();\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\trequest.send();\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function () {\r\n\r\n\tif ( this.isPlaying === true ) {\r\n\r\n\t\tconsole.warn( 'THREE.Audio: Audio is already playing.' );\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar source = this.context.createBufferSource();\r\n\r\n\tsource.buffer = this.source.buffer;\r\n\tsource.loop = this.source.loop;\r\n\tsource.onended = this.source.onended;\r\n\tsource.start( 0, this.startTime );\r\n\tsource.playbackRate.value = this.playbackRate;\r\n\r\n\tthis.isPlaying = true;\r\n\r\n\tthis.source = source;\r\n\r\n\tthis.connect();\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function () {\r\n\r\n\tthis.source.stop();\r\n\tthis.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function () {\r\n\r\n\tthis.source.stop();\r\n\tthis.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.connect = function () {\r\n\r\n\tif ( this.filter !== undefined ) {\r\n\r\n\t\tthis.source.connect( this.filter );\r\n\t\tthis.filter.connect( this.panner );\r\n\r\n\t} else {\r\n\r\n\t\tthis.source.connect( this.panner );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.disconnect = function () {\r\n\r\n\tif ( this.filter !== undefined ) {\r\n\r\n\t\tthis.source.disconnect( this.filter );\r\n\t\tthis.filter.disconnect( this.panner );\r\n\r\n\t} else {\r\n\r\n\t\tthis.source.disconnect( this.panner );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setFilter = function ( value ) {\r\n\r\n\tif ( this.isPlaying === true ) {\r\n\r\n\t\tthis.disconnect();\r\n\t\tthis.filter = value;\r\n\t\tthis.connect();\r\n\r\n\t} else {\r\n\r\n\t\tthis.filter = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getFilter = function () {\r\n\r\n\treturn this.filter;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setPlaybackRate = function ( value ) {\r\n\r\n\tthis.playbackRate = value;\r\n\r\n\tif ( this.isPlaying === true ) {\r\n\r\n\t\tthis.source.playbackRate.value = this.playbackRate;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getPlaybackRate = function () {\r\n\r\n\treturn this.playbackRate;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function ( value ) {\r\n\r\n\tthis.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getLoop = function () {\r\n\r\n\treturn this.source.loop;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function ( value ) {\r\n\r\n\tthis.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getRefDistance = function () {\r\n\r\n\treturn this.panner.refDistance;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function ( value ) {\r\n\r\n\tthis.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getRolloffFactor = function () {\r\n\r\n\treturn this.panner.rolloffFactor;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function ( value ) {\r\n\r\n\tthis.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.getVolume = function () {\r\n\r\n\treturn this.gain.gain.value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = ( function () {\r\n\r\n\tvar position = new THREE.Vector3();\r\n\r\n\treturn function updateMatrixWorld( force ) {\r\n\r\n\t\tTHREE.Object3D.prototype.updateMatrixWorld.call( this, force );\r\n\r\n\t\tposition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tthis.panner.setPosition( position.x, position.y, position.z );\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'AudioListener';\r\n\r\n\tthis.context = new ( window.AudioContext || window.webkitAudioContext )();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = ( function () {\r\n\r\n\tvar position = new THREE.Vector3();\r\n\tvar quaternion = new THREE.Quaternion();\r\n\tvar scale = new THREE.Vector3();\r\n\r\n\tvar orientation = new THREE.Vector3();\r\n\r\n\treturn function updateMatrixWorld( force ) {\r\n\r\n\t\tTHREE.Object3D.prototype.updateMatrixWorld.call( this, force );\r\n\r\n\t\tvar listener = this.context.listener;\r\n\t\tvar up = this.up;\r\n\r\n\t\tthis.matrixWorld.decompose( position, quaternion, scale );\r\n\r\n\t\torientation.set( 0, 0, - 1 ).applyQuaternion( quaternion );\r\n\r\n\t\tlistener.setPosition( position.x, position.y, position.z );\r\n\t\tlistener.setOrientation( orientation.x, orientation.y, orientation.z, up.x, up.y, up.z );\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function () {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function ( t ) {\r\n\r\n\tconsole.warn( \"THREE.Curve: Warning, getPoint() not implemented!\" );\r\n\treturn null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function ( u ) {\r\n\r\n\tvar t = this.getUtoTmapping( u );\r\n\treturn this.getPoint( t );\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = 5;\r\n\r\n\tvar d, pts = [];\r\n\r\n\tfor ( d = 0; d <= divisions; d ++ ) {\r\n\r\n\t\tpts.push( this.getPoint( d / divisions ) );\r\n\r\n\t}\r\n\r\n\treturn pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = 5;\r\n\r\n\tvar d, pts = [];\r\n\r\n\tfor ( d = 0; d <= divisions; d ++ ) {\r\n\r\n\t\tpts.push( this.getPointAt( d / divisions ) );\r\n\r\n\t}\r\n\r\n\treturn pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function () {\r\n\r\n\tvar lengths = this.getLengths();\r\n\treturn lengths[ lengths.length - 1 ];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = ( this.__arcLengthDivisions ) ? ( this.__arcLengthDivisions ) : 200;\r\n\r\n\tif ( this.cacheArcLengths\r\n\t\t&& ( this.cacheArcLengths.length === divisions + 1 )\r\n\t\t&& ! this.needsUpdate ) {\r\n\r\n\t\t//console.log( \"cached\", this.cacheArcLengths );\r\n\t\treturn this.cacheArcLengths;\r\n\r\n\t}\r\n\r\n\tthis.needsUpdate = false;\r\n\r\n\tvar cache = [];\r\n\tvar current, last = this.getPoint( 0 );\r\n\tvar p, sum = 0;\r\n\r\n\tcache.push( 0 );\r\n\r\n\tfor ( p = 1; p <= divisions; p ++ ) {\r\n\r\n\t\tcurrent = this.getPoint ( p / divisions );\r\n\t\tsum += current.distanceTo( last );\r\n\t\tcache.push( sum );\r\n\t\tlast = current;\r\n\r\n\t}\r\n\r\n\tthis.cacheArcLengths = cache;\r\n\r\n\treturn cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n\r\n\tthis.needsUpdate = true;\r\n\tthis.getLengths();\r\n\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equidistant\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function ( u, distance ) {\r\n\r\n\tvar arcLengths = this.getLengths();\r\n\r\n\tvar i = 0, il = arcLengths.length;\r\n\r\n\tvar targetArcLength; // The targeted u distance value to get\r\n\r\n\tif ( distance ) {\r\n\r\n\t\ttargetArcLength = distance;\r\n\r\n\t} else {\r\n\r\n\t\ttargetArcLength = u * arcLengths[ il - 1 ];\r\n\r\n\t}\r\n\r\n\t//var time = Date.now();\r\n\r\n\t// binary search for the index with largest value smaller than target u distance\r\n\r\n\tvar low = 0, high = il - 1, comparison;\r\n\r\n\twhile ( low <= high ) {\r\n\r\n\t\ti = Math.floor( low + ( high - low ) / 2 ); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n\t\tcomparison = arcLengths[ i ] - targetArcLength;\r\n\r\n\t\tif ( comparison < 0 ) {\r\n\r\n\t\t\tlow = i + 1;\r\n\r\n\t\t} else if ( comparison > 0 ) {\r\n\r\n\t\t\thigh = i - 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\thigh = i;\r\n\t\t\tbreak;\r\n\r\n\t\t\t// DONE\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ti = high;\r\n\r\n\t//console.log('b' , i, low, high, Date.now()- time);\r\n\r\n\tif ( arcLengths[ i ] === targetArcLength ) {\r\n\r\n\t\tvar t = i / ( il - 1 );\r\n\t\treturn t;\r\n\r\n\t}\r\n\r\n\t// we could get finer grain at lengths, or use simple interpolation between two points\r\n\r\n\tvar lengthBefore = arcLengths[ i ];\r\n\tvar lengthAfter = arcLengths[ i + 1 ];\r\n\r\n\tvar segmentLength = lengthAfter - lengthBefore;\r\n\r\n\t// determine where we are between the 'before' and 'after' points\r\n\r\n\tvar segmentFraction = ( targetArcLength - lengthBefore ) / segmentLength;\r\n\r\n\t// add that fractional amount to t\r\n\r\n\tvar t = ( i + segmentFraction ) / ( il - 1 );\r\n\r\n\treturn t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function( t ) {\r\n\r\n\tvar delta = 0.0001;\r\n\tvar t1 = t - delta;\r\n\tvar t2 = t + delta;\r\n\r\n\t// Capping in case of danger\r\n\r\n\tif ( t1 < 0 ) t1 = 0;\r\n\tif ( t2 > 1 ) t2 = 1;\r\n\r\n\tvar pt1 = this.getPoint( t1 );\r\n\tvar pt2 = this.getPoint( t2 );\r\n\r\n\tvar vec = pt2.clone().sub( pt1 );\r\n\treturn vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function ( u ) {\r\n\r\n\tvar t = this.getUtoTmapping( u );\r\n\treturn this.getTangent( t );\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n\ttangentQuadraticBezier: function ( t, p0, p1, p2 ) {\r\n\r\n\t\treturn 2 * ( 1 - t ) * ( p1 - p0 ) + 2 * t * ( p2 - p1 );\r\n\r\n\t},\r\n\r\n\t// Puay Bing, thanks for helping with this derivative!\r\n\r\n\ttangentCubicBezier: function ( t, p0, p1, p2, p3 ) {\r\n\r\n\t\treturn - 3 * p0 * ( 1 - t ) * ( 1 - t )  +\r\n\t\t\t3 * p1 * ( 1 - t ) * ( 1 - t ) - 6 * t * p1 * ( 1 - t ) +\r\n\t\t\t6 * t *  p2 * ( 1 - t ) - 3 * t * t * p2 +\r\n\t\t\t3 * t * t * p3;\r\n\r\n\t},\r\n\r\n\ttangentSpline: function ( t, p0, p1, p2, p3 ) {\r\n\r\n\t\t// To check if my formulas are correct\r\n\r\n\t\tvar h00 = 6 * t * t - 6 * t; \t// derived from 2t^3  3t^2 + 1\r\n\t\tvar h10 = 3 * t * t - 4 * t + 1; // t^3  2t^2 + t\r\n\t\tvar h01 = - 6 * t * t + 6 * t; \t//  2t3 + 3t2\r\n\t\tvar h11 = 3 * t * t - 2 * t;\t// t3  t2\r\n\r\n\t\treturn h00 + h10 + h01 + h11;\r\n\r\n\t},\r\n\r\n\t// Catmull-Rom\r\n\r\n\tinterpolate: function( p0, p1, p2, p3, t ) {\r\n\r\n\t\tvar v0 = ( p2 - p0 ) * 0.5;\r\n\t\tvar v1 = ( p3 - p1 ) * 0.5;\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t * t2;\r\n\t\treturn ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function ( constructor, getPointFunc ) {\r\n\r\n\tconstructor.prototype = Object.create( THREE.Curve.prototype );\r\n\tconstructor.prototype.constructor = constructor;\r\n\tconstructor.prototype.getPoint = getPointFunc;\r\n\r\n\treturn constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function () {\r\n\r\n\tthis.curves = [];\r\n\tthis.bends = [];\r\n\r\n\tthis.autoClose = false; // Automatically closes the path\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function ( curve ) {\r\n\r\n\tthis.curves.push( curve );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n\t// TODO\r\n\t// If the ending of curve is not connected to the starting\r\n\t// or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n\r\n\t// TODO Test\r\n\t// and verify for vector3 (needs to implement equals)\r\n\t// Add a line curve if start and end of lines are not connected\r\n\tvar startPoint = this.curves[ 0 ].getPoint( 0 );\r\n\tvar endPoint = this.curves[ this.curves.length - 1 ].getPoint( 1 );\r\n\r\n\tif ( ! startPoint.equals( endPoint ) ) {\r\n\r\n\t\tthis.curves.push( new THREE.LineCurve( endPoint, startPoint ) );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function( t ) {\r\n\r\n\tvar d = t * this.getLength();\r\n\tvar curveLengths = this.getCurveLengths();\r\n\tvar i = 0, diff, curve;\r\n\r\n\t// To think about boundaries points.\r\n\r\n\twhile ( i < curveLengths.length ) {\r\n\r\n\t\tif ( curveLengths[ i ] >= d ) {\r\n\r\n\t\t\tdiff = curveLengths[ i ] - d;\r\n\t\t\tcurve = this.curves[ i ];\r\n\r\n\t\t\tvar u = 1 - diff / curve.getLength();\r\n\r\n\t\t\treturn curve.getPointAt( u );\r\n\r\n\t\t}\r\n\r\n\t\ti ++;\r\n\r\n\t}\r\n\r\n\treturn null;\r\n\r\n\t// loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n\tvar lens = this.getCurveLengths();\r\n\treturn lens[ lens.length - 1 ];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n\t// We use cache values if curves and cache array are same length\r\n\r\n\tif ( this.cacheLengths && this.cacheLengths.length === this.curves.length ) {\r\n\r\n\t\treturn this.cacheLengths;\r\n\r\n\t}\r\n\r\n\t// Get length of sub-curve\r\n\t// Push sums into cached array\r\n\r\n\tvar lengths = [], sums = 0;\r\n\tvar i, il = this.curves.length;\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tsums += this.curves[ i ].getLength();\r\n\t\tlengths.push( sums );\r\n\r\n\t}\r\n\r\n\tthis.cacheLengths = lengths;\r\n\r\n\treturn lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function () {\r\n\r\n\tvar points = this.getPoints();\r\n\r\n\tvar maxX, maxY, maxZ;\r\n\tvar minX, minY, minZ;\r\n\r\n\tmaxX = maxY = Number.NEGATIVE_INFINITY;\r\n\tminX = minY = Number.POSITIVE_INFINITY;\r\n\r\n\tvar p, i, il, sum;\r\n\r\n\tvar v3 = points[ 0 ] instanceof THREE.Vector3;\r\n\r\n\tsum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n\tfor ( i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\tp = points[ i ];\r\n\r\n\t\tif ( p.x > maxX ) maxX = p.x;\r\n\t\telse if ( p.x < minX ) minX = p.x;\r\n\r\n\t\tif ( p.y > maxY ) maxY = p.y;\r\n\t\telse if ( p.y < minY ) minY = p.y;\r\n\r\n\t\tif ( v3 ) {\r\n\r\n\t\t\tif ( p.z > maxZ ) maxZ = p.z;\r\n\t\t\telse if ( p.z < minZ ) minZ = p.z;\r\n\r\n\t\t}\r\n\r\n\t\tsum.add( p );\r\n\r\n\t}\r\n\r\n\tvar ret = {\r\n\r\n\t\tminX: minX,\r\n\t\tminY: minY,\r\n\t\tmaxX: maxX,\r\n\t\tmaxY: maxY\r\n\r\n\t};\r\n\r\n\tif ( v3 ) {\r\n\r\n\t\tret.maxZ = maxZ;\r\n\t\tret.minZ = minZ;\r\n\r\n\t}\r\n\r\n\treturn ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function( divisions ) {\r\n\r\n\tvar pts = this.getPoints( divisions, true );\r\n\treturn this.createGeometry( pts );\r\n\r\n};\r\n\r\n// Generate geometry from equidistant sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function( divisions ) {\r\n\r\n\tvar pts = this.getSpacedPoints( divisions, true );\r\n\treturn this.createGeometry( pts );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function( points ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tfor ( var i = 0; i < points.length; i ++ ) {\r\n\r\n\t\tgeometry.vertices.push( new THREE.Vector3( points[ i ].x, points[ i ].y, points[ i ].z || 0 ) );\r\n\r\n\t}\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function ( bendpath ) {\r\n\r\n\tthis.bends.push( bendpath );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function( segments, bends ) {\r\n\r\n\tvar oldPts = this.getPoints( segments ); // getPoints getSpacedPoints\r\n\tvar i, il;\r\n\r\n\tif ( ! bends ) {\r\n\r\n\t\tbends = this.bends;\r\n\r\n\t}\r\n\r\n\tfor ( i = 0, il = bends.length; i < il; i ++ ) {\r\n\r\n\t\toldPts = this.getWrapPoints( oldPts, bends[ i ] );\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function( segments, bends ) {\r\n\r\n\tvar oldPts = this.getSpacedPoints( segments );\r\n\r\n\tvar i, il;\r\n\r\n\tif ( ! bends ) {\r\n\r\n\t\tbends = this.bends;\r\n\r\n\t}\r\n\r\n\tfor ( i = 0, il = bends.length; i < il; i ++ ) {\r\n\r\n\t\toldPts = this.getWrapPoints( oldPts, bends[ i ] );\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function ( oldPts, path ) {\r\n\r\n\tvar bounds = this.getBoundingBox();\r\n\r\n\tvar i, il, p, oldX, oldY, xNorm;\r\n\r\n\tfor ( i = 0, il = oldPts.length; i < il; i ++ ) {\r\n\r\n\t\tp = oldPts[ i ];\r\n\r\n\t\toldX = p.x;\r\n\t\toldY = p.y;\r\n\r\n\t\txNorm = oldX / bounds.maxX;\r\n\r\n\t\t// If using actual distance, for length > path, requires line extrusions\r\n\t\t//xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n\t\txNorm = path.getUtoTmapping( xNorm, oldX );\r\n\r\n\t\t// check for out of bounds?\r\n\r\n\t\tvar pathPt = path.getPoint( xNorm );\r\n\t\tvar normal = path.getTangent( xNorm );\r\n\t\tnormal.set( - normal.y, normal.x ).multiplyScalar( oldY );\r\n\r\n\t\tp.x = pathPt.x + normal.x;\r\n\t\tp.y = pathPt.y + normal.y;\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function ( points ) {\r\n\r\n\tTHREE.CurvePath.call( this );\r\n\r\n\tthis.actions = [];\r\n\r\n\tif ( points ) {\r\n\r\n\t\tthis.fromPoints( points );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create( THREE.CurvePath.prototype );\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n\tMOVE_TO: 'moveTo',\r\n\tLINE_TO: 'lineTo',\r\n\tQUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n\tBEZIER_CURVE_TO: 'bezierCurveTo', \t\t// Bezier cubic curve\r\n\tCSPLINE_THRU: 'splineThru',\t\t\t\t// Catmull-Rom spline\r\n\tARC: 'arc',\t\t\t\t\t\t\t\t// Circle\r\n\tELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function ( vectors ) {\r\n\r\n\tthis.moveTo( vectors[ 0 ].x, vectors[ 0 ].y );\r\n\r\n\tfor ( var v = 1, vlen = vectors.length; v < vlen; v ++ ) {\r\n\r\n\t\tthis.lineTo( vectors[ v ].x, vectors[ v ].y );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function ( x, y ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\tthis.actions.push( { action: THREE.PathActions.MOVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function ( x, y ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.LineCurve( new THREE.Vector2( x0, y0 ), new THREE.Vector2( x, y ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.LINE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function( aCPx, aCPy, aX, aY ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.QuadraticBezierCurve( new THREE.Vector2( x0, y0 ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCPx, aCPy ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aX, aY ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.QUADRATIC_CURVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function( aCP1x, aCP1y,\r\n\t\t\t\t\t\t\t\t\t\t\t   aCP2x, aCP2y,\r\n\t\t\t\t\t\t\t\t\t\t\t   aX, aY ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.CubicBezierCurve( new THREE.Vector2( x0, y0 ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCP1x, aCP1y ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCP2x, aCP2y ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aX, aY ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.BEZIER_CURVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function( pts /*Array of Vector*/ ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\t//---\r\n\tvar npts = [ new THREE.Vector2( x0, y0 ) ];\r\n\tArray.prototype.push.apply( npts, pts );\r\n\r\n\tvar curve = new THREE.SplineCurve( npts );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.CSPLINE_THRU, args: args } );\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function ( aX, aY, aRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tthis.absarc( aX + x0, aY + y0, aRadius,\r\n\t\taStartAngle, aEndAngle, aClockwise );\r\n\r\n };\r\n\r\n THREE.Path.prototype.absarc = function ( aX, aY, aRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tthis.absellipse( aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise );\r\n\r\n };\r\n\r\nTHREE.Path.prototype.ellipse = function ( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise, aRotation ) {\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tthis.absellipse( aX + x0, aY + y0, xRadius, yRadius,\r\n\t\taStartAngle, aEndAngle, aClockwise, aRotation );\r\n\r\n };\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function ( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise, aRotation ) {\r\n\r\n\tvar args = [\r\n\t\taX, aY,\r\n\t\txRadius, yRadius,\r\n\t\taStartAngle, aEndAngle,\r\n\t\taClockwise,\r\n\t\taRotation || 0 // aRotation is optional.\r\n\t];\r\n\tvar curve = new THREE.EllipseCurve( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\taStartAngle, aEndAngle, aClockwise, aRotation );\r\n\tthis.curves.push( curve );\r\n\r\n\tvar lastPoint = curve.getPoint( 1 );\r\n\targs.push( lastPoint.x );\r\n\targs.push( lastPoint.y );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.ELLIPSE, args: args } );\r\n\r\n };\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function ( divisions, closedPath ) {\r\n\r\n\tif ( ! divisions ) divisions = 40;\r\n\r\n\tvar points = [];\r\n\r\n\tfor ( var i = 0; i < divisions; i ++ ) {\r\n\r\n\t\tpoints.push( this.getPoint( i / divisions ) );\r\n\r\n\t\t//if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n\t}\r\n\r\n\t// if ( closedPath ) {\r\n\t//\r\n\t// \tpoints.push( points[ 0 ] );\r\n\t//\r\n\t// }\r\n\r\n\treturn points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function( divisions, closedPath ) {\r\n\r\n\tif ( this.useSpacedPoints ) {\r\n\r\n\t\treturn this.getSpacedPoints( divisions, closedPath );\r\n\r\n\t}\r\n\r\n\tdivisions = divisions || 12;\r\n\r\n\tvar points = [];\r\n\r\n\tvar i, il, item, action, args;\r\n\tvar cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n\t\tlaste, j,\r\n\t\tt, tx, ty;\r\n\r\n\tfor ( i = 0, il = this.actions.length; i < il; i ++ ) {\r\n\r\n\t\titem = this.actions[ i ];\r\n\r\n\t\taction = item.action;\r\n\t\targs = item.args;\r\n\r\n\t\tswitch ( action ) {\r\n\r\n\t\tcase THREE.PathActions.MOVE_TO:\r\n\r\n\t\t\tpoints.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.LINE_TO:\r\n\r\n\t\t\tpoints.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n\t\t\tcpx  = args[ 2 ];\r\n\t\t\tcpy  = args[ 3 ];\r\n\r\n\t\t\tcpx1 = args[ 0 ];\r\n\t\t\tcpy1 = args[ 1 ];\r\n\r\n\t\t\tif ( points.length > 0 ) {\r\n\r\n\t\t\t\tlaste = points[ points.length - 1 ];\r\n\r\n\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\t\tcpx0 = laste[ laste.length - 2 ];\r\n\t\t\t\tcpy0 = laste[ laste.length - 1 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( j = 1; j <= divisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / divisions;\r\n\r\n\t\t\t\ttx = THREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );\r\n\t\t\t\tty = THREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n\t\t\tcpx  = args[ 4 ];\r\n\t\t\tcpy  = args[ 5 ];\r\n\r\n\t\t\tcpx1 = args[ 0 ];\r\n\t\t\tcpy1 = args[ 1 ];\r\n\r\n\t\t\tcpx2 = args[ 2 ];\r\n\t\t\tcpy2 = args[ 3 ];\r\n\r\n\t\t\tif ( points.length > 0 ) {\r\n\r\n\t\t\t\tlaste = points[ points.length - 1 ];\r\n\r\n\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\t\tcpx0 = laste[ laste.length - 2 ];\r\n\t\t\t\tcpy0 = laste[ laste.length - 1 ];\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor ( j = 1; j <= divisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / divisions;\r\n\r\n\t\t\t\ttx = THREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );\r\n\t\t\t\tty = THREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.CSPLINE_THRU:\r\n\r\n\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\tvar last = new THREE.Vector2( laste[ laste.length - 2 ], laste[ laste.length - 1 ] );\r\n\t\t\tvar spts = [ last ];\r\n\r\n\t\t\tvar n = divisions * args[ 0 ].length;\r\n\r\n\t\t\tspts = spts.concat( args[ 0 ] );\r\n\r\n\t\t\tvar spline = new THREE.SplineCurve( spts );\r\n\r\n\t\t\tfor ( j = 1; j <= n; j ++ ) {\r\n\r\n\t\t\t\tpoints.push( spline.getPointAt( j / n ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.ARC:\r\n\r\n\t\t\tvar aX = args[ 0 ], aY = args[ 1 ],\r\n\t\t\t\taRadius = args[ 2 ],\r\n\t\t\t\taStartAngle = args[ 3 ], aEndAngle = args[ 4 ],\r\n\t\t\t\taClockwise = !! args[ 5 ];\r\n\r\n\t\t\tvar deltaAngle = aEndAngle - aStartAngle;\r\n\t\t\tvar angle;\r\n\t\t\tvar tdivisions = divisions * 2;\r\n\r\n\t\t\tfor ( j = 1; j <= tdivisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / tdivisions;\r\n\r\n\t\t\t\tif ( ! aClockwise ) {\r\n\r\n\t\t\t\t\tt = 1 - t;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tangle = aStartAngle + t * deltaAngle;\r\n\r\n\t\t\t\ttx = aX + aRadius * Math.cos( angle );\r\n\t\t\t\tty = aY + aRadius * Math.sin( angle );\r\n\r\n\t\t\t\t//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//console.log(points);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.ELLIPSE:\r\n\r\n\t\t\tvar aX = args[ 0 ], aY = args[ 1 ],\r\n\t\t\t\txRadius = args[ 2 ],\r\n\t\t\t\tyRadius = args[ 3 ],\r\n\t\t\t\taStartAngle = args[ 4 ], aEndAngle = args[ 5 ],\r\n\t\t\t\taClockwise = !! args[ 6 ],\r\n\t\t\t\taRotation = args[ 7 ];\r\n\r\n\r\n\t\t\tvar deltaAngle = aEndAngle - aStartAngle;\r\n\t\t\tvar angle;\r\n\t\t\tvar tdivisions = divisions * 2;\r\n\r\n\t\t\tvar cos, sin;\r\n\t\t\tif ( aRotation !== 0 ) {\r\n\t\t\r\n\t\t\t\tcos = Math.cos( aRotation );\r\n\t\t\t\tsin = Math.sin( aRotation );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( j = 1; j <= tdivisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / tdivisions;\r\n\r\n\t\t\t\tif ( ! aClockwise ) {\r\n\r\n\t\t\t\t\tt = 1 - t;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tangle = aStartAngle + t * deltaAngle;\r\n\r\n\t\t\t\ttx = aX + xRadius * Math.cos( angle );\r\n\t\t\t\tty = aY + yRadius * Math.sin( angle );\r\n\r\n\t\t\t\tif ( aRotation !== 0 ) {\r\n\r\n\t\t\t\t\tvar x = tx, y = ty;\r\n\r\n\t\t\t\t\t// Rotate the point about the center of the ellipse.\r\n\t\t\t\t\ttx = ( x - aX ) * cos - ( y - aY ) * sin + aX;\r\n\t\t\t\t\tty = ( x - aX ) * sin + ( y - aY ) * cos + aY;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//console.log(points);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t} // end switch\r\n\r\n\t}\r\n\r\n\r\n\r\n\t// Normalize to remove the closing point by default.\r\n\tvar lastPoint = points[ points.length - 1 ];\r\n\tvar EPSILON = 0.0000000001;\r\n\tif ( Math.abs( lastPoint.x - points[ 0 ].x ) < EPSILON &&\r\n\t\t\t Math.abs( lastPoint.y - points[ 0 ].y ) < EPSILON )\r\n\t\tpoints.splice( points.length - 1, 1 );\r\n\tif ( closedPath ) {\r\n\r\n\t\tpoints.push( points[ 0 ] );\r\n\r\n\t}\r\n\r\n\treturn points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function( isCCW, noHoles ) {\r\n\r\n\tfunction extractSubpaths( inActions ) {\r\n\r\n\t\tvar i, il, item, action, args;\r\n\r\n\t\tvar subPaths = [], lastPath = new THREE.Path();\r\n\r\n\t\tfor ( i = 0, il = inActions.length; i < il; i ++ ) {\r\n\r\n\t\t\titem = inActions[ i ];\r\n\r\n\t\t\targs = item.args;\r\n\t\t\taction = item.action;\r\n\r\n\t\t\tif ( action === THREE.PathActions.MOVE_TO ) {\r\n\r\n\t\t\t\tif ( lastPath.actions.length !== 0 ) {\r\n\r\n\t\t\t\t\tsubPaths.push( lastPath );\r\n\t\t\t\t\tlastPath = new THREE.Path();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlastPath[ action ].apply( lastPath, args );\r\n\r\n\t\t}\r\n\r\n\t\tif ( lastPath.actions.length !== 0 ) {\r\n\r\n\t\t\tsubPaths.push( lastPath );\r\n\r\n\t\t}\r\n\r\n\t\t// console.log(subPaths);\r\n\r\n\t\treturn\tsubPaths;\r\n\r\n\t}\r\n\r\n\tfunction toShapesNoHoles( inSubpaths ) {\r\n\r\n\t\tvar shapes = [];\r\n\r\n\t\tfor ( var i = 0, il = inSubpaths.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar tmpPath = inSubpaths[ i ];\r\n\r\n\t\t\tvar tmpShape = new THREE.Shape();\r\n\t\t\ttmpShape.actions = tmpPath.actions;\r\n\t\t\ttmpShape.curves = tmpPath.curves;\r\n\r\n\t\t\tshapes.push( tmpShape );\r\n\r\n\t\t}\r\n\r\n\t\t//console.log(\"shape\", shapes);\r\n\r\n\t\treturn shapes;\r\n\r\n\t}\r\n\r\n\tfunction isPointInsidePolygon( inPt, inPolygon ) {\r\n\r\n\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\tvar polyLen = inPolygon.length;\r\n\r\n\t\t// inPt on polygon contour => immediate success    or\r\n\t\t// toggling of inside/outside at every single! intersection point of an edge\r\n\t\t//  with the horizontal line through inPt, left of inPt\r\n\t\t//  not counting lowerY endpoints of edges and whole edges on that line\r\n\t\tvar inside = false;\r\n\t\tfor ( var p = polyLen - 1, q = 0; q < polyLen; p = q ++ ) {\r\n\r\n\t\t\tvar edgeLowPt  = inPolygon[ p ];\r\n\t\t\tvar edgeHighPt = inPolygon[ q ];\r\n\r\n\t\t\tvar edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n\t\t\tvar edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n\t\t\tif ( Math.abs( edgeDy ) > EPSILON ) {\r\n\r\n\t\t\t\t// not parallel\r\n\t\t\t\tif ( edgeDy < 0 ) {\r\n\r\n\t\t\t\t\tedgeLowPt  = inPolygon[ q ]; edgeDx = - edgeDx;\r\n\t\t\t\t\tedgeHighPt = inPolygon[ p ]; edgeDy = - edgeDy;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( ( inPt.y < edgeLowPt.y ) || ( inPt.y > edgeHighPt.y ) ) \t\tcontinue;\r\n\r\n\t\t\t\tif ( inPt.y === edgeLowPt.y ) {\r\n\r\n\t\t\t\t\tif ( inPt.x === edgeLowPt.x )\t\treturn\ttrue;\t\t// inPt is on contour ?\r\n\t\t\t\t\t// continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvar perpEdge = edgeDy * ( inPt.x - edgeLowPt.x ) - edgeDx * ( inPt.y - edgeLowPt.y );\r\n\t\t\t\t\tif ( perpEdge === 0 )\t\t\t\treturn\ttrue;\t\t// inPt is on contour ?\r\n\t\t\t\t\tif ( perpEdge < 0 ) \t\t\t\tcontinue;\r\n\t\t\t\t\tinside = ! inside;\t\t// true intersection left of inPt\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// parallel or collinear\r\n\t\t\t\tif ( inPt.y !== edgeLowPt.y ) \t\tcontinue;\t\t\t// parallel\r\n\t\t\t\t// edge lies on the same horizontal line as inPt\r\n\t\t\t\tif ( ( ( edgeHighPt.x <= inPt.x ) && ( inPt.x <= edgeLowPt.x ) ) ||\r\n\t\t\t\t\t ( ( edgeLowPt.x <= inPt.x ) && ( inPt.x <= edgeHighPt.x ) ) )\t\treturn\ttrue;\t// inPt: Point on contour !\r\n\t\t\t\t// continue;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn\tinside;\r\n\r\n\t}\r\n\r\n\r\n\tvar subPaths = extractSubpaths( this.actions );\r\n\tif ( subPaths.length === 0 ) return [];\r\n\r\n\tif ( noHoles === true )\treturn\ttoShapesNoHoles( subPaths );\r\n\r\n\r\n\tvar solid, tmpPath, tmpShape, shapes = [];\r\n\r\n\tif ( subPaths.length === 1 ) {\r\n\r\n\t\ttmpPath = subPaths[ 0 ];\r\n\t\ttmpShape = new THREE.Shape();\r\n\t\ttmpShape.actions = tmpPath.actions;\r\n\t\ttmpShape.curves = tmpPath.curves;\r\n\t\tshapes.push( tmpShape );\r\n\t\treturn shapes;\r\n\r\n\t}\r\n\r\n\tvar holesFirst = ! THREE.Shape.Utils.isClockWise( subPaths[ 0 ].getPoints() );\r\n\tholesFirst = isCCW ? ! holesFirst : holesFirst;\r\n\r\n\t// console.log(\"Holes first\", holesFirst);\r\n\r\n\tvar betterShapeHoles = [];\r\n\tvar newShapes = [];\r\n\tvar newShapeHoles = [];\r\n\tvar mainIdx = 0;\r\n\tvar tmpPoints;\r\n\r\n\tnewShapes[ mainIdx ] = undefined;\r\n\tnewShapeHoles[ mainIdx ] = [];\r\n\r\n\tvar i, il;\r\n\r\n\tfor ( i = 0, il = subPaths.length; i < il; i ++ ) {\r\n\r\n\t\ttmpPath = subPaths[ i ];\r\n\t\ttmpPoints = tmpPath.getPoints();\r\n\t\tsolid = THREE.Shape.Utils.isClockWise( tmpPoints );\r\n\t\tsolid = isCCW ? ! solid : solid;\r\n\r\n\t\tif ( solid ) {\r\n\r\n\t\t\tif ( ( ! holesFirst ) && ( newShapes[ mainIdx ] ) )\tmainIdx ++;\r\n\r\n\t\t\tnewShapes[ mainIdx ] = { s: new THREE.Shape(), p: tmpPoints };\r\n\t\t\tnewShapes[ mainIdx ].s.actions = tmpPath.actions;\r\n\t\t\tnewShapes[ mainIdx ].s.curves = tmpPath.curves;\r\n\r\n\t\t\tif ( holesFirst )\tmainIdx ++;\r\n\t\t\tnewShapeHoles[ mainIdx ] = [];\r\n\r\n\t\t\t//console.log('cw', i);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tnewShapeHoles[ mainIdx ].push( { h: tmpPath, p: tmpPoints[ 0 ] } );\r\n\r\n\t\t\t//console.log('ccw', i);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// only Holes? -> probably all Shapes with wrong orientation\r\n\tif ( ! newShapes[ 0 ] )\treturn\ttoShapesNoHoles( subPaths );\r\n\r\n\r\n\tif ( newShapes.length > 1 ) {\r\n\r\n\t\tvar ambiguous = false;\r\n\t\tvar toChange = [];\r\n\r\n\t\tfor ( var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {\r\n\r\n\t\t\tbetterShapeHoles[ sIdx ] = [];\r\n\r\n\t\t}\r\n\t\tfor ( var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {\r\n\r\n\t\t\tvar sho = newShapeHoles[ sIdx ];\r\n\t\t\tfor ( var hIdx = 0; hIdx < sho.length; hIdx ++ ) {\r\n\r\n\t\t\t\tvar ho = sho[ hIdx ];\r\n\t\t\t\tvar hole_unassigned = true;\r\n\t\t\t\tfor ( var s2Idx = 0; s2Idx < newShapes.length; s2Idx ++ ) {\r\n\r\n\t\t\t\t\tif ( isPointInsidePolygon( ho.p, newShapes[ s2Idx ].p ) ) {\r\n\r\n\t\t\t\t\t\tif ( sIdx !== s2Idx )\ttoChange.push( { froms: sIdx, tos: s2Idx, hole: hIdx } );\r\n\t\t\t\t\t\tif ( hole_unassigned ) {\r\n\r\n\t\t\t\t\t\t\thole_unassigned = false;\r\n\t\t\t\t\t\t\tbetterShapeHoles[ s2Idx ].push( ho );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tambiguous = true;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( hole_unassigned ) {\r\n\r\n\t\t\t\t\tbetterShapeHoles[ sIdx ].push( ho );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t// console.log(\"ambiguous: \", ambiguous);\r\n\t\tif ( toChange.length > 0 ) {\r\n\r\n\t\t\t// console.log(\"to change: \", toChange);\r\n\t\t\tif ( ! ambiguous )\tnewShapeHoles = betterShapeHoles;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar tmpHoles, j, jl;\r\n\tfor ( i = 0, il = newShapes.length; i < il; i ++ ) {\r\n\r\n\t\ttmpShape = newShapes[ i ].s;\r\n\t\tshapes.push( tmpShape );\r\n\t\ttmpHoles = newShapeHoles[ i ];\r\n\t\tfor ( j = 0, jl = tmpHoles.length; j < jl; j ++ ) {\r\n\r\n\t\t\ttmpShape.holes.push( tmpHoles[ j ].h );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//console.log(\"shape\", shapes);\r\n\r\n\treturn shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function () {\r\n\r\n\tTHREE.Path.apply( this, arguments );\r\n\tthis.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create( THREE.Path.prototype );\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function ( options ) {\r\n\r\n\tvar extruded = new THREE.ExtrudeGeometry( this, options );\r\n\treturn extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function ( options ) {\r\n\r\n\tvar geometry = new THREE.ShapeGeometry( this, options );\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function ( divisions ) {\r\n\r\n\tvar i, il = this.holes.length, holesPts = [];\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tholesPts[ i ] = this.holes[ i ].getTransformedPoints( divisions, this.bends );\r\n\r\n\t}\r\n\r\n\treturn holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function ( divisions ) {\r\n\r\n\tvar i, il = this.holes.length, holesPts = [];\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tholesPts[ i ] = this.holes[ i ].getTransformedSpacedPoints( divisions, this.bends );\r\n\r\n\t}\r\n\r\n\treturn holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function ( divisions ) {\r\n\r\n\treturn {\r\n\r\n\t\tshape: this.getTransformedPoints( divisions ),\r\n\t\tholes: this.getPointsHoles( divisions )\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function ( divisions ) {\r\n\r\n\tif ( this.useSpacedPoints ) {\r\n\r\n\t\treturn this.extractAllSpacedPoints( divisions );\r\n\r\n\t}\r\n\r\n\treturn this.extractAllPoints( divisions );\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function ( divisions ) {\r\n\r\n\treturn {\r\n\r\n\t\tshape: this.getTransformedSpacedPoints( divisions ),\r\n\t\tholes: this.getSpacedPointsHoles( divisions )\r\n\r\n\t};\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n\ttriangulateShape: function ( contour, holes ) {\r\n\r\n\t\tfunction point_in_segment_2D_colin( inSegPt1, inSegPt2, inOtherPt ) {\r\n\r\n\t\t\t// inOtherPt needs to be collinear to the inSegment\r\n\t\t\tif ( inSegPt1.x !== inSegPt2.x ) {\r\n\r\n\t\t\t\tif ( inSegPt1.x < inSegPt2.x ) {\r\n\r\n\t\t\t\t\treturn\t( ( inSegPt1.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt2.x ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn\t( ( inSegPt2.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt1.x ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( inSegPt1.y < inSegPt2.y ) {\r\n\r\n\t\t\t\t\treturn\t( ( inSegPt1.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt2.y ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn\t( ( inSegPt2.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt1.y ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction intersect_segments_2D( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs ) {\r\n\r\n\t\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\t\tvar seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,   seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n\t\t\tvar seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,   seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n\t\t\tvar seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n\t\t\tvar seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n\t\t\tvar limit\t\t= seg1dy * seg2dx - seg1dx * seg2dy;\r\n\t\t\tvar perpSeg1\t= seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n\t\t\tif ( Math.abs( limit ) > EPSILON ) {\r\n\r\n\t\t\t\t// not parallel\r\n\r\n\t\t\t\tvar perpSeg2;\r\n\t\t\t\tif ( limit > 0 ) {\r\n\r\n\t\t\t\t\tif ( ( perpSeg1 < 0 ) || ( perpSeg1 > limit ) ) \t\treturn [];\r\n\t\t\t\t\tperpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n\t\t\t\t\tif ( ( perpSeg2 < 0 ) || ( perpSeg2 > limit ) ) \t\treturn [];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( ( perpSeg1 > 0 ) || ( perpSeg1 < limit ) ) \t\treturn [];\r\n\t\t\t\t\tperpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n\t\t\t\t\tif ( ( perpSeg2 > 0 ) || ( perpSeg2 < limit ) ) \t\treturn [];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// i.e. to reduce rounding errors\r\n\t\t\t\t// intersection at endpoint of segment#1?\r\n\t\t\t\tif ( perpSeg2 === 0 ) {\r\n\r\n\t\t\t\t\tif ( ( inExcludeAdjacentSegs ) &&\r\n\t\t\t\t\t\t ( ( perpSeg1 === 0 ) || ( perpSeg1 === limit ) ) )\t\treturn [];\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( perpSeg2 === limit ) {\r\n\r\n\t\t\t\t\tif ( ( inExcludeAdjacentSegs ) &&\r\n\t\t\t\t\t\t ( ( perpSeg1 === 0 ) || ( perpSeg1 === limit ) ) )\t\treturn [];\r\n\t\t\t\t\treturn [ inSeg1Pt2 ];\r\n\r\n\t\t\t\t}\r\n\t\t\t\t// intersection at endpoint of segment#2?\r\n\t\t\t\tif ( perpSeg1 === 0 )\t\treturn [ inSeg2Pt1 ];\r\n\t\t\t\tif ( perpSeg1 === limit )\treturn [ inSeg2Pt2 ];\r\n\r\n\t\t\t\t// return real intersection point\r\n\t\t\t\tvar factorSeg1 = perpSeg2 / limit;\r\n\t\t\t\treturn\t[ { x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n\t\t\t\t\t\t\ty: inSeg1Pt1.y + factorSeg1 * seg1dy } ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// parallel or collinear\r\n\t\t\t\tif ( ( perpSeg1 !== 0 ) ||\r\n\t\t\t\t\t ( seg2dy * seg1seg2dx !== seg2dx * seg1seg2dy ) ) \t\t\treturn [];\r\n\r\n\t\t\t\t// they are collinear or degenerate\r\n\t\t\t\tvar seg1Pt = ( ( seg1dx === 0 ) && ( seg1dy === 0 ) );\t// segment1 is just a point?\r\n\t\t\t\tvar seg2Pt = ( ( seg2dx === 0 ) && ( seg2dy === 0 ) );\t// segment2 is just a point?\r\n\t\t\t\t// both segments are points\r\n\t\t\t\tif ( seg1Pt && seg2Pt ) {\r\n\r\n\t\t\t\t\tif ( ( inSeg1Pt1.x !== inSeg2Pt1.x ) ||\r\n\t\t\t\t\t\t ( inSeg1Pt1.y !== inSeg2Pt1.y ) )\t\treturn [];\t// they are distinct  points\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];                 \t\t\t\t\t\t// they are the same point\r\n\r\n\t\t\t\t}\r\n\t\t\t\t// segment#1  is a single point\r\n\t\t\t\tif ( seg1Pt ) {\r\n\r\n\t\t\t\t\tif ( ! point_in_segment_2D_colin( inSeg2Pt1, inSeg2Pt2, inSeg1Pt1 ) )\t\treturn [];\t\t// but not in segment#2\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];\r\n\r\n\t\t\t\t}\r\n\t\t\t\t// segment#2  is a single point\r\n\t\t\t\tif ( seg2Pt ) {\r\n\r\n\t\t\t\t\tif ( ! point_in_segment_2D_colin( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1 ) )\t\treturn [];\t\t// but not in segment#1\r\n\t\t\t\t\treturn [ inSeg2Pt1 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// they are collinear segments, which might overlap\r\n\t\t\t\tvar seg1min, seg1max, seg1minVal, seg1maxVal;\r\n\t\t\t\tvar seg2min, seg2max, seg2minVal, seg2maxVal;\r\n\t\t\t\tif ( seg1dx !== 0 ) {\r\n\r\n\t\t\t\t\t// the segments are NOT on a vertical line\r\n\t\t\t\t\tif ( inSeg1Pt1.x < inSeg1Pt2.x ) {\r\n\r\n\t\t\t\t\t\tseg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.x;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.x;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tseg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.x;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.x;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( inSeg2Pt1.x < inSeg2Pt2.x ) {\r\n\r\n\t\t\t\t\t\tseg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.x;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.x;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tseg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.x;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.x;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// the segments are on a vertical line\r\n\t\t\t\t\tif ( inSeg1Pt1.y < inSeg1Pt2.y ) {\r\n\r\n\t\t\t\t\t\tseg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.y;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.y;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tseg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.y;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.y;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( inSeg2Pt1.y < inSeg2Pt2.y ) {\r\n\r\n\t\t\t\t\t\tseg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.y;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.y;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tseg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.y;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.y;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif ( seg1minVal <= seg2minVal ) {\r\n\r\n\t\t\t\t\tif ( seg1maxVal <  seg2minVal )\treturn [];\r\n\t\t\t\t\tif ( seg1maxVal === seg2minVal )\t{\r\n\r\n\t\t\t\t\t\tif ( inExcludeAdjacentSegs )\t\treturn [];\r\n\t\t\t\t\t\treturn [ seg2min ];\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( seg1maxVal <= seg2maxVal )\treturn [ seg2min, seg1max ];\r\n\t\t\t\t\treturn\t[ seg2min, seg2max ];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( seg1minVal >  seg2maxVal )\treturn [];\r\n\t\t\t\t\tif ( seg1minVal === seg2maxVal )\t{\r\n\r\n\t\t\t\t\t\tif ( inExcludeAdjacentSegs )\t\treturn [];\r\n\t\t\t\t\t\treturn [ seg1min ];\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( seg1maxVal <= seg2maxVal )\treturn [ seg1min, seg1max ];\r\n\t\t\t\t\treturn\t[ seg1min, seg2max ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction isPointInsideAngle( inVertex, inLegFromPt, inLegToPt, inOtherPt ) {\r\n\r\n\t\t\t// The order of legs is important\r\n\r\n\t\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\t\t// translation of all points, so that Vertex is at (0,0)\r\n\t\t\tvar legFromPtX\t= inLegFromPt.x - inVertex.x,  legFromPtY\t= inLegFromPt.y - inVertex.y;\r\n\t\t\tvar legToPtX\t= inLegToPt.x\t- inVertex.x,  legToPtY\t\t= inLegToPt.y\t- inVertex.y;\r\n\t\t\tvar otherPtX\t= inOtherPt.x\t- inVertex.x,  otherPtY\t\t= inOtherPt.y\t- inVertex.y;\r\n\r\n\t\t\t// main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n\t\t\tvar from2toAngle\t= legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n\t\t\tvar from2otherAngle\t= legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n\t\t\tif ( Math.abs( from2toAngle ) > EPSILON ) {\r\n\r\n\t\t\t\t// angle != 180 deg.\r\n\r\n\t\t\t\tvar other2toAngle\t\t= otherPtX * legToPtY - otherPtY * legToPtX;\r\n\t\t\t\t// console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n\t\t\t\tif ( from2toAngle > 0 ) {\r\n\r\n\t\t\t\t\t// main angle < 180 deg.\r\n\t\t\t\t\treturn\t( ( from2otherAngle >= 0 ) && ( other2toAngle >= 0 ) );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// main angle > 180 deg.\r\n\t\t\t\t\treturn\t( ( from2otherAngle >= 0 ) || ( other2toAngle >= 0 ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// angle == 180 deg.\r\n\t\t\t\t// console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n\t\t\t\treturn\t( from2otherAngle > 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfunction removeHoles( contour, holes ) {\r\n\r\n\t\t\tvar shape = contour.concat(); // work on this shape\r\n\t\t\tvar hole;\r\n\r\n\t\t\tfunction isCutLineInsideAngles( inShapeIdx, inHoleIdx ) {\r\n\r\n\t\t\t\t// Check if hole point lies within angle around shape point\r\n\t\t\t\tvar lastShapeIdx = shape.length - 1;\r\n\r\n\t\t\t\tvar prevShapeIdx = inShapeIdx - 1;\r\n\t\t\t\tif ( prevShapeIdx < 0 )\t\t\tprevShapeIdx = lastShapeIdx;\r\n\r\n\t\t\t\tvar nextShapeIdx = inShapeIdx + 1;\r\n\t\t\t\tif ( nextShapeIdx > lastShapeIdx )\tnextShapeIdx = 0;\r\n\r\n\t\t\t\tvar insideAngle = isPointInsideAngle( shape[ inShapeIdx ], shape[ prevShapeIdx ], shape[ nextShapeIdx ], hole[ inHoleIdx ] );\r\n\t\t\t\tif ( ! insideAngle ) {\r\n\r\n\t\t\t\t\t// console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n\t\t\t\t\treturn\tfalse;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if shape point lies within angle around hole point\r\n\t\t\t\tvar lastHoleIdx = hole.length - 1;\r\n\r\n\t\t\t\tvar prevHoleIdx = inHoleIdx - 1;\r\n\t\t\t\tif ( prevHoleIdx < 0 )\t\t\tprevHoleIdx = lastHoleIdx;\r\n\r\n\t\t\t\tvar nextHoleIdx = inHoleIdx + 1;\r\n\t\t\t\tif ( nextHoleIdx > lastHoleIdx )\tnextHoleIdx = 0;\r\n\r\n\t\t\t\tinsideAngle = isPointInsideAngle( hole[ inHoleIdx ], hole[ prevHoleIdx ], hole[ nextHoleIdx ], shape[ inShapeIdx ] );\r\n\t\t\t\tif ( ! insideAngle ) {\r\n\r\n\t\t\t\t\t// console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n\t\t\t\t\treturn\tfalse;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn\ttrue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction intersectsShapeEdge( inShapePt, inHolePt ) {\r\n\r\n\t\t\t\t// checks for intersections with shape edges\r\n\t\t\t\tvar sIdx, nextIdx, intersection;\r\n\t\t\t\tfor ( sIdx = 0; sIdx < shape.length; sIdx ++ ) {\r\n\r\n\t\t\t\t\tnextIdx = sIdx + 1; nextIdx %= shape.length;\r\n\t\t\t\t\tintersection = intersect_segments_2D( inShapePt, inHolePt, shape[ sIdx ], shape[ nextIdx ], true );\r\n\t\t\t\t\tif ( intersection.length > 0 )\t\treturn\ttrue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn\tfalse;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar indepHoles = [];\r\n\r\n\t\t\tfunction intersectsHoleEdge( inShapePt, inHolePt ) {\r\n\r\n\t\t\t\t// checks for intersections with hole edges\r\n\t\t\t\tvar ihIdx, chkHole,\r\n\t\t\t\t\thIdx, nextIdx, intersection;\r\n\t\t\t\tfor ( ihIdx = 0; ihIdx < indepHoles.length; ihIdx ++ ) {\r\n\r\n\t\t\t\t\tchkHole = holes[ indepHoles[ ihIdx ]];\r\n\t\t\t\t\tfor ( hIdx = 0; hIdx < chkHole.length; hIdx ++ ) {\r\n\r\n\t\t\t\t\t\tnextIdx = hIdx + 1; nextIdx %= chkHole.length;\r\n\t\t\t\t\t\tintersection = intersect_segments_2D( inShapePt, inHolePt, chkHole[ hIdx ], chkHole[ nextIdx ], true );\r\n\t\t\t\t\t\tif ( intersection.length > 0 )\t\treturn\ttrue;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\treturn\tfalse;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar holeIndex, shapeIndex,\r\n\t\t\t\tshapePt, holePt,\r\n\t\t\t\tholeIdx, cutKey, failedCuts = [],\r\n\t\t\t\ttmpShape1, tmpShape2,\r\n\t\t\t\ttmpHole1, tmpHole2;\r\n\r\n\t\t\tfor ( var h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\t\tindepHoles.push( h );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar minShapeIndex = 0;\r\n\t\t\tvar counter = indepHoles.length * 2;\r\n\t\t\twhile ( indepHoles.length > 0 ) {\r\n\r\n\t\t\t\tcounter --;\r\n\t\t\t\tif ( counter < 0 ) {\r\n\r\n\t\t\t\t\tconsole.log( \"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\" );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// search for shape-vertex and hole-vertex,\r\n\t\t\t\t// which can be connected without intersections\r\n\t\t\t\tfor ( shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex ++ ) {\r\n\r\n\t\t\t\t\tshapePt = shape[ shapeIndex ];\r\n\t\t\t\t\tholeIndex\t= - 1;\r\n\r\n\t\t\t\t\t// search for hole which can be reached without intersections\r\n\t\t\t\t\tfor ( var h = 0; h < indepHoles.length; h ++ ) {\r\n\r\n\t\t\t\t\t\tholeIdx = indepHoles[ h ];\r\n\r\n\t\t\t\t\t\t// prevent multiple checks\r\n\t\t\t\t\t\tcutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n\t\t\t\t\t\tif ( failedCuts[ cutKey ] !== undefined )\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\thole = holes[ holeIdx ];\r\n\t\t\t\t\t\tfor ( var h2 = 0; h2 < hole.length; h2 ++ ) {\r\n\r\n\t\t\t\t\t\t\tholePt = hole[ h2 ];\r\n\t\t\t\t\t\t\tif ( ! isCutLineInsideAngles( shapeIndex, h2 ) )\t\tcontinue;\r\n\t\t\t\t\t\t\tif ( intersectsShapeEdge( shapePt, holePt ) )\t\tcontinue;\r\n\t\t\t\t\t\t\tif ( intersectsHoleEdge( shapePt, holePt ) )\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\tholeIndex = h2;\r\n\t\t\t\t\t\t\tindepHoles.splice( h, 1 );\r\n\r\n\t\t\t\t\t\t\ttmpShape1 = shape.slice( 0, shapeIndex + 1 );\r\n\t\t\t\t\t\t\ttmpShape2 = shape.slice( shapeIndex );\r\n\t\t\t\t\t\t\ttmpHole1 = hole.slice( holeIndex );\r\n\t\t\t\t\t\t\ttmpHole2 = hole.slice( 0, holeIndex + 1 );\r\n\r\n\t\t\t\t\t\t\tshape = tmpShape1.concat( tmpHole1 ).concat( tmpHole2 ).concat( tmpShape2 );\r\n\r\n\t\t\t\t\t\t\tminShapeIndex = shapeIndex;\r\n\r\n\t\t\t\t\t\t\t// Debug only, to show the selected cuts\r\n\t\t\t\t\t\t\t// glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( holeIndex >= 0 )\tbreak;\t\t// hole-vertex found\r\n\r\n\t\t\t\t\t\tfailedCuts[ cutKey ] = true;\t\t\t// remember failure\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( holeIndex >= 0 )\tbreak;\t\t// hole-vertex found\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn shape; \t\t\t/* shape with no holes */\r\n\r\n\t\t}\r\n\r\n\r\n\t\tvar i, il, f, face,\r\n\t\t\tkey, index,\r\n\t\t\tallPointsMap = {};\r\n\r\n\t\t// To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n\t\tvar allpoints = contour.concat();\r\n\r\n\t\tfor ( var h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tArray.prototype.push.apply( allpoints, holes[ h ] );\r\n\r\n\t\t}\r\n\r\n\t\t//console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n\t\t// prepare all points map\r\n\r\n\t\tfor ( i = 0, il = allpoints.length; i < il; i ++ ) {\r\n\r\n\t\t\tkey = allpoints[ i ].x + \":\" + allpoints[ i ].y;\r\n\r\n\t\t\tif ( allPointsMap[ key ] !== undefined ) {\r\n\r\n\t\t\t\tconsole.warn( \"THREE.Shape: Duplicate point\", key );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tallPointsMap[ key ] = i;\r\n\r\n\t\t}\r\n\r\n\t\t// remove holes by cutting paths to holes and adding them to the shape\r\n\t\tvar shapeWithoutHoles = removeHoles( contour, holes );\r\n\r\n\t\tvar triangles = THREE.FontUtils.Triangulate( shapeWithoutHoles, false ); // True returns indices for points of spooled shape\r\n\t\t//console.log( \"triangles\",triangles, triangles.length );\r\n\r\n\t\t// check all face vertices against all points map\r\n\r\n\t\tfor ( i = 0, il = triangles.length; i < il; i ++ ) {\r\n\r\n\t\t\tface = triangles[ i ];\r\n\r\n\t\t\tfor ( f = 0; f < 3; f ++ ) {\r\n\r\n\t\t\t\tkey = face[ f ].x + \":\" + face[ f ].y;\r\n\r\n\t\t\t\tindex = allPointsMap[ key ];\r\n\r\n\t\t\t\tif ( index !== undefined ) {\r\n\r\n\t\t\t\t\tface[ f ] = index;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn triangles.concat();\r\n\r\n\t},\r\n\r\n\tisClockWise: function ( pts ) {\r\n\r\n\t\treturn THREE.FontUtils.Triangulate.area( pts ) < 0;\r\n\r\n\t},\r\n\r\n\t// Bezier Curves formulas obtained from\r\n\t// http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n\t// Quad Bezier Functions\r\n\r\n\tb2p0: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn k * k * p;\r\n\r\n\t},\r\n\r\n\tb2p1: function ( t, p ) {\r\n\r\n\t\treturn 2 * ( 1 - t ) * t * p;\r\n\r\n\t},\r\n\r\n\tb2p2: function ( t, p ) {\r\n\r\n\t\treturn t * t * p;\r\n\r\n\t},\r\n\r\n\tb2: function ( t, p0, p1, p2 ) {\r\n\r\n\t\treturn this.b2p0( t, p0 ) + this.b2p1( t, p1 ) + this.b2p2( t, p2 );\r\n\r\n\t},\r\n\r\n\t// Cubic Bezier Functions\r\n\r\n\tb3p0: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn k * k * k * p;\r\n\r\n\t},\r\n\r\n\tb3p1: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn 3 * k * k * t * p;\r\n\r\n\t},\r\n\r\n\tb3p2: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn 3 * k * t * t * p;\r\n\r\n\t},\r\n\r\n\tb3p3: function ( t, p ) {\r\n\r\n\t\treturn t * t * t * p;\r\n\r\n\t},\r\n\r\n\tb3: function ( t, p0, p1, p2, p3 ) {\r\n\r\n\t\treturn this.b3p0( t, p0 ) + this.b3p1( t, p1 ) + this.b3p2( t, p2 ) +  this.b3p3( t, p3 );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function ( v1, v2 ) {\r\n\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar point = this.v2.clone().sub( this.v1 );\r\n\tpoint.multiplyScalar( t ).add( this.v1 );\r\n\r\n\treturn point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function ( u ) {\r\n\r\n\treturn this.getPoint( u );\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar tangent = this.v2.clone().sub( this.v1 );\r\n\r\n\treturn tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function ( v0, v1, v2 ) {\r\n\r\n\tthis.v0 = v0;\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );\r\n\tvector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );\r\n\r\n\treturn vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.x, this.v1.x, this.v2.x );\r\n\tvector.y = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.y, this.v1.y, this.v2.y );\r\n\r\n\t// returns unit vector\r\n\r\n\treturn vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function ( v0, v1, v2, v3 ) {\r\n\r\n\tthis.v0 = v0;\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\tthis.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar tx, ty;\r\n\r\n\ttx = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\tty = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\r\n\treturn new THREE.Vector2( tx, ty );\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar tx, ty;\r\n\r\n\ttx = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\tty = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\r\n\tvar tangent = new THREE.Vector2( tx, ty );\r\n\ttangent.normalize();\r\n\r\n\treturn tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function ( points /* array of Vector2 */ ) {\r\n\r\n\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar points = this.points;\r\n\tvar point = ( points.length - 1 ) * t;\r\n\r\n\tvar intPoint = Math.floor( point );\r\n\tvar weight = point - intPoint;\r\n\r\n\tvar point0 = points[ intPoint === 0 ? intPoint : intPoint - 1 ];\r\n\tvar point1 = points[ intPoint ];\r\n\tvar point2 = points[ intPoint > points.length - 2 ? points.length - 1 : intPoint + 1 ];\r\n\tvar point3 = points[ intPoint > points.length - 3 ? points.length - 1 : intPoint + 2 ];\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\r\n\treturn vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function ( aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise, aRotation ) {\r\n\r\n\tthis.aX = aX;\r\n\tthis.aY = aY;\r\n\r\n\tthis.xRadius = xRadius;\r\n\tthis.yRadius = yRadius;\r\n\r\n\tthis.aStartAngle = aStartAngle;\r\n\tthis.aEndAngle = aEndAngle;\r\n\r\n\tthis.aClockwise = aClockwise;\r\n\t\r\n\tthis.aRotation = aRotation || 0;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n\tif ( deltaAngle < 0 ) deltaAngle += Math.PI * 2;\r\n\tif ( deltaAngle > Math.PI * 2 ) deltaAngle -= Math.PI * 2;\r\n\r\n\tvar angle;\r\n\r\n\tif ( this.aClockwise === true ) {\r\n\r\n\t\tangle = this.aEndAngle + ( 1 - t ) * ( Math.PI * 2 - deltaAngle );\r\n\r\n\t} else {\r\n\r\n\t\tangle = this.aStartAngle + t * deltaAngle;\r\n\r\n\t}\r\n\t\r\n\tvar x = this.aX + this.xRadius * Math.cos( angle );\r\n\tvar y = this.aY + this.yRadius * Math.sin( angle );\r\n\r\n\tif ( this.aRotation !== 0 ) {\r\n\r\n\t\tvar cos = Math.cos( this.aRotation );\r\n\t\tvar sin = Math.sin( this.aRotation );\r\n\r\n\t\tvar tx = x, ty = y;\r\n\r\n\t\t// Rotate the point about the center of the ellipse.\r\n\t\tx = ( tx - this.aX ) * cos - ( ty - this.aY ) * sin + this.aX;\r\n\t\ty = ( tx - this.aX ) * sin + ( ty - this.aY ) * cos + this.aY;\r\n\r\n\t}\r\n\r\n\treturn new THREE.Vector2( x, y );\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function ( aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tTHREE.EllipseCurve.call( this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise );\r\n\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create( THREE.EllipseCurve.prototype );\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v1, v2 ) {\r\n\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.subVectors( this.v2, this.v1 ); // diff\r\n\t\tvector.multiplyScalar( t );\r\n\t\tvector.add( this.v1 );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v0, v1, v2 ) {\r\n\r\n\t\tthis.v0 = v0;\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );\r\n\t\tvector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );\r\n\t\tvector.z = THREE.Shape.Utils.b2( t, this.v0.z, this.v1.z, this.v2.z );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v0, v1, v2, v3 ) {\r\n\r\n\t\tthis.v0 = v0;\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\t\tthis.v3 = v3;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\t\tvector.y = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\t\tvector.z = THREE.Shape.Utils.b3( t, this.v0.z, this.v1.z, this.v2.z, this.v3.z );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( points /* array of Vector3 */ ) {\r\n\r\n\t\tconsole.warn( 'THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3' );\r\n\t\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar points = this.points;\r\n\t\tvar point = ( points.length - 1 ) * t;\r\n\r\n\t\tvar intPoint = Math.floor( point );\r\n\t\tvar weight = point - intPoint;\r\n\r\n\t\tvar point0 = points[ intPoint == 0 ? intPoint : intPoint - 1 ];\r\n\t\tvar point1 = points[ intPoint ];\r\n\t\tvar point2 = points[ intPoint > points.length - 2 ? points.length - 1 : intPoint + 1 ];\r\n\t\tvar point3 = points[ intPoint > points.length - 3 ? points.length - 1 : intPoint + 2 ];\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\t\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\t\tvector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/CatmullRomCurve3.js\r\n\r\n/**\r\n * @author zz85 https://github.com/zz85\r\n *\r\n * Centripetal CatmullRom Curve - which is useful for avoiding\r\n * cusps and self-intersections in non-uniform catmull rom curves.\r\n * http://www.cemyuksel.com/research/catmullrom_param/catmullrom.pdf\r\n *\r\n * curve.type accepts centripetal(default), chordal and catmullrom\r\n * curve.tension is used for catmullrom which defaults to 0.5\r\n */\r\n\r\nTHREE.CatmullRomCurve3 = ( function() {\r\n\r\n\tvar\r\n\t\ttmp = new THREE.Vector3(),\r\n\t\tpx = new CubicPoly(),\r\n\t\tpy = new CubicPoly(),\r\n\t\tpz = new CubicPoly();\r\n\r\n\t/*\r\n\tBased on an optimized c++ solution in\r\n\t - http://stackoverflow.com/questions/9489736/catmull-rom-curve-with-no-cusps-and-no-self-intersections/\r\n\t - http://ideone.com/NoEbVM\r\n\r\n\tThis CubicPoly class could be used for reusing some variables and calculations,\r\n\tbut for three.js curve use, it could be possible inlined and flatten into a single function call\r\n\twhich can be placed in CurveUtils.\r\n\t*/\r\n\r\n\tfunction CubicPoly() {\r\n\r\n\t}\r\n\r\n\t/*\r\n\t * Compute coefficients for a cubic polynomial\r\n\t *   p(s) = c0 + c1*s + c2*s^2 + c3*s^3\r\n\t * such that\r\n\t *   p(0) = x0, p(1) = x1\r\n\t *  and\r\n\t *   p'(0) = t0, p'(1) = t1.\r\n\t */\r\n\tCubicPoly.prototype.init = function( x0, x1, t0, t1 ) {\r\n\r\n\t\tthis.c0 = x0;\r\n\t\tthis.c1 = t0;\r\n\t\tthis.c2 = - 3 * x0 + 3 * x1 - 2 * t0 - t1;\r\n\t\tthis.c3 = 2 * x0 - 2 * x1 + t0 + t1;\r\n\r\n\t};\r\n\r\n\tCubicPoly.prototype.initNonuniformCatmullRom = function( x0, x1, x2, x3, dt0, dt1, dt2 ) {\r\n\r\n\t\t// compute tangents when parameterized in [t1,t2]\r\n\t\tvar t1 = ( x1 - x0 ) / dt0 - ( x2 - x0 ) / ( dt0 + dt1 ) + ( x2 - x1 ) / dt1;\r\n\t\tvar t2 = ( x2 - x1 ) / dt1 - ( x3 - x1 ) / ( dt1 + dt2 ) + ( x3 - x2 ) / dt2;\r\n\r\n\t\t// rescale tangents for parametrization in [0,1]\r\n\t\tt1 *= dt1;\r\n\t\tt2 *= dt1;\r\n\r\n\t\t// initCubicPoly\r\n\t\tthis.init( x1, x2, t1, t2 );\r\n\r\n\t};\r\n\r\n\t// standard Catmull-Rom spline: interpolate between x1 and x2 with previous/following points x1/x4\r\n\tCubicPoly.prototype.initCatmullRom = function( x0, x1, x2, x3, tension ) {\r\n\r\n\t\tthis.init( x1, x2, tension * ( x2 - x0 ), tension * ( x3 - x1 ) );\r\n\r\n\t};\r\n\r\n\tCubicPoly.prototype.calc = function( t ) {\r\n\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t2 * t;\r\n\t\treturn this.c0 + this.c1 * t + this.c2 * t2 + this.c3 * t3;\r\n\r\n\t};\r\n\r\n\t// Subclass Three.js curve\r\n\treturn THREE.Curve.create(\r\n\r\n\t\tfunction ( p /* array of Vector3 */ ) {\r\n\r\n\t\t\tthis.points = p || [];\r\n\r\n\t\t},\r\n\r\n\t\tfunction ( t ) {\r\n\r\n\t\t\tvar points = this.points,\r\n\t\t\t\tpoint, intPoint, weight, l;\r\n\r\n\t\t\tl = points.length;\r\n\r\n\t\t\tif ( l < 2 ) console.log( 'duh, you need at least 2 points' );\r\n\r\n\t\t\tpoint = ( l - 1 ) * t;\r\n\t\t\tintPoint = Math.floor( point );\r\n\t\t\tweight = point - intPoint;\r\n\r\n\t\t\tif ( weight === 0 && intPoint === l - 1 ) {\r\n\r\n\t\t\t\tintPoint = l - 2;\r\n\t\t\t\tweight = 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar p0, p1, p2, p3;\r\n\r\n\t\t\tif ( intPoint === 0 ) {\r\n\r\n\t\t\t\t// extrapolate first point\r\n\t\t\t\ttmp.subVectors( points[ 0 ], points[ 1 ] ).add( points[ 0 ] );\r\n\t\t\t\tp0 = tmp;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tp0 = points[ intPoint - 1 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tp1 = points[ intPoint ];\r\n\t\t\tp2 = points[ intPoint + 1 ];\r\n\r\n\t\t\tif ( intPoint + 2 < l ) {\r\n\r\n\t\t\t\tp3 = points[ intPoint + 2 ]\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// extrapolate last point\r\n\t\t\t\ttmp.subVectors( points[ l - 1 ], points[ l - 2 ] ).add( points[ l - 2 ] );\r\n\t\t\t\tp3 = tmp;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.type === undefined || this.type === 'centripetal' || this.type === 'chordal' ) {\r\n\r\n\t\t\t\t// init Centripetal / Chordal Catmull-Rom\r\n\t\t\t\tvar pow = this.type === 'chordal' ? 0.5 : 0.25;\r\n\t\t\t\tvar dt0 = Math.pow( p0.distanceToSquared( p1 ), pow );\r\n\t\t\t\tvar dt1 = Math.pow( p1.distanceToSquared( p2 ), pow );\r\n\t\t\t\tvar dt2 = Math.pow( p2.distanceToSquared( p3 ), pow );\r\n\r\n\t\t\t\t// safety check for repeated points\r\n\t\t\t\tif ( dt1 < 1e-4 ) dt1 = 1.0;\r\n\t\t\t\tif ( dt0 < 1e-4 ) dt0 = dt1;\r\n\t\t\t\tif ( dt2 < 1e-4 ) dt2 = dt1;\r\n\r\n\t\t\t\tpx.initNonuniformCatmullRom( p0.x, p1.x, p2.x, p3.x, dt0, dt1, dt2 );\r\n\t\t\t\tpy.initNonuniformCatmullRom( p0.y, p1.y, p2.y, p3.y, dt0, dt1, dt2 );\r\n\t\t\t\tpz.initNonuniformCatmullRom( p0.z, p1.z, p2.z, p3.z, dt0, dt1, dt2 );\r\n\r\n\t\t\t} else if ( this.type === 'catmullrom' ) {\r\n\r\n\t\t\t\tvar tension = this.tension !== undefined ? this.tension : 0.5;\r\n\t\t\t\tpx.initCatmullRom( p0.x, p1.x, p2.x, p3.x, tension );\r\n\t\t\t\tpy.initCatmullRom( p0.y, p1.y, p2.y, p3.y, tension );\r\n\t\t\t\tpz.initCatmullRom( p0.z, p1.z, p2.z, p3.z, tension );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar v = new THREE.Vector3(\r\n\t\t\t\tpx.calc( weight ),\r\n\t\t\t\tpy.calc( weight ),\r\n\t\t\t\tpz.calc( weight )\r\n\t\t\t);\r\n\r\n\t\t\treturn v;\r\n\r\n\t\t}\r\n\r\n\t);\r\n\r\n} )();\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( points /* array of Vector3 */ ) {\r\n\r\n\t\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar points = this.points;\r\n\t\tvar point = ( points.length - 0 ) * t; // This needs to be from 0-length +1\r\n\r\n\t\tvar intPoint = Math.floor( point );\r\n\t\tvar weight = point - intPoint;\r\n\r\n\t\tintPoint += intPoint > 0 ? 0 : ( Math.floor( Math.abs( intPoint ) / points.length ) + 1 ) * points.length;\r\n\r\n\t\tvar point0 = points[ ( intPoint - 1 ) % points.length ];\r\n\t\tvar point1 = points[ ( intPoint     ) % points.length ];\r\n\t\tvar point2 = points[ ( intPoint + 1 ) % points.length ];\r\n\t\tvar point3 = points[ ( intPoint + 2 ) % points.length ];\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\t\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\t\tvector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n\tLINEAR: 0,\r\n\tCATMULLROM: 1,\r\n\tCATMULLROM_FORWARD: 2,\r\n\r\n\t//\r\n\r\n\tadd: function () {\r\n\r\n\t\tconsole.warn( 'THREE.AnimationHandler.add() has been deprecated.' );\r\n\r\n\t},\r\n\tget: function () {\r\n\r\n\t\tconsole.warn( 'THREE.AnimationHandler.get() has been deprecated.' );\r\n\r\n\t},\r\n\tremove: function () {\r\n\r\n\t\tconsole.warn( 'THREE.AnimationHandler.remove() has been deprecated.' );\r\n\r\n\t},\r\n\r\n\t//\r\n\r\n\tanimations: [],\r\n\r\n\tinit: function ( data ) {\r\n\r\n\t\tif ( data.initialized === true ) return data;\r\n\r\n\t\t// loop through all keys\r\n\r\n\t\tfor ( var h = 0; h < data.hierarchy.length; h ++ ) {\r\n\r\n\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t// remove minus times\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].time < 0 ) {\r\n\r\n\t\t\t\t\t data.hierarchy[ h ].keys[ k ].time = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// create quaternions\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].rot !== undefined &&\r\n\t\t\t\t  ! ( data.hierarchy[ h ].keys[ k ].rot instanceof THREE.Quaternion ) ) {\r\n\r\n\t\t\t\t\tvar quat = data.hierarchy[ h ].keys[ k ].rot;\r\n\t\t\t\t\tdata.hierarchy[ h ].keys[ k ].rot = new THREE.Quaternion().fromArray( quat );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// prepare morph target keys\r\n\r\n\t\t\tif ( data.hierarchy[ h ].keys.length && data.hierarchy[ h ].keys[ 0 ].morphTargets !== undefined ) {\r\n\r\n\t\t\t\t// get all used\r\n\r\n\t\t\t\tvar usedMorphTargets = {};\r\n\r\n\t\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t\tfor ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {\r\n\r\n\t\t\t\t\t\tvar morphTargetName = data.hierarchy[ h ].keys[ k ].morphTargets[ m ];\r\n\t\t\t\t\t\tusedMorphTargets[ morphTargetName ] = - 1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata.hierarchy[ h ].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n\t\t\t\t// set all used on all frames\r\n\r\n\t\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t\tvar influences = {};\r\n\r\n\t\t\t\t\tfor ( var morphTargetName in usedMorphTargets ) {\r\n\r\n\t\t\t\t\t\tfor ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].morphTargets[ m ] === morphTargetName ) {\r\n\r\n\t\t\t\t\t\t\t\tinfluences[ morphTargetName ] = data.hierarchy[ h ].keys[ k ].morphTargetsInfluences[ m ];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( m === data.hierarchy[ h ].keys[ k ].morphTargets.length ) {\r\n\r\n\t\t\t\t\t\t\tinfluences[ morphTargetName ] = 0;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdata.hierarchy[ h ].keys[ k ].morphTargetsInfluences = influences;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// remove all keys that are on the same time\r\n\r\n\t\t\tfor ( var k = 1; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].time === data.hierarchy[ h ].keys[ k - 1 ].time ) {\r\n\r\n\t\t\t\t\tdata.hierarchy[ h ].keys.splice( k, 1 );\r\n\t\t\t\t\tk --;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// set index\r\n\r\n\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\tdata.hierarchy[ h ].keys[ k ].index = k;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdata.initialized = true;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tparse: function ( root ) {\r\n\r\n\t\tvar parseRecurseHierarchy = function ( root, hierarchy ) {\r\n\r\n\t\t\thierarchy.push( root );\r\n\r\n\t\t\tfor ( var c = 0; c < root.children.length; c ++ )\r\n\t\t\t\tparseRecurseHierarchy( root.children[ c ], hierarchy );\r\n\r\n\t\t};\r\n\r\n\t\t// setup hierarchy\r\n\r\n\t\tvar hierarchy = [];\r\n\r\n\t\tif ( root instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\tfor ( var b = 0; b < root.skeleton.bones.length; b ++ ) {\r\n\r\n\t\t\t\thierarchy.push( root.skeleton.bones[ b ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tparseRecurseHierarchy( root, hierarchy );\r\n\r\n\t\t}\r\n\r\n\t\treturn hierarchy;\r\n\r\n\t},\r\n\r\n\tplay: function ( animation ) {\r\n\r\n\t\tif ( this.animations.indexOf( animation ) === - 1 ) {\r\n\r\n\t\t\tthis.animations.push( animation );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tstop: function ( animation ) {\r\n\r\n\t\tvar index = this.animations.indexOf( animation );\r\n\r\n\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\tthis.animations.splice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: function ( deltaTimeMS ) {\r\n\r\n\t\tfor ( var i = 0; i < this.animations.length; i ++ ) {\r\n\r\n\t\t\tthis.animations[ i ].resetBlendWeights();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < this.animations.length; i ++ ) {\r\n\r\n\t\t\tthis.animations[ i ].update( deltaTimeMS );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function ( root, data ) {\r\n\r\n\tthis.root = root;\r\n\tthis.data = THREE.AnimationHandler.init( data );\r\n\tthis.hierarchy = THREE.AnimationHandler.parse( root );\r\n\r\n\tthis.currentTime = 0;\r\n\tthis.timeScale = 1;\r\n\r\n\tthis.isPlaying = false;\r\n\tthis.loop = true;\r\n\tthis.weight = 0;\r\n\r\n\tthis.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n\tconstructor: THREE.Animation,\r\n\r\n\tkeyTypes:  [ \"pos\", \"rot\", \"scl\" ],\r\n\r\n\tplay: function ( startTime, weight ) {\r\n\r\n\t\tthis.currentTime = startTime !== undefined ? startTime : 0;\r\n\t\tthis.weight = weight !== undefined ? weight : 1;\r\n\r\n\t\tthis.isPlaying = true;\r\n\r\n\t\tthis.reset();\r\n\r\n\t\tTHREE.AnimationHandler.play( this );\r\n\r\n\t},\r\n\r\n\tstop: function() {\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t\tTHREE.AnimationHandler.stop( this );\r\n\r\n\t},\r\n\r\n\treset: function () {\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\r\n\t\t\tif ( object.animationCache === undefined ) {\r\n\r\n\t\t\t\tobject.animationCache = {\r\n\t\t\t\t\tanimations: {},\r\n\t\t\t\t\tblending: {\r\n\t\t\t\t\t\tpositionWeight: 0.0,\r\n\t\t\t\t\t\tquaternionWeight: 0.0,\r\n\t\t\t\t\t\tscaleWeight: 0.0\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar name = this.data.name;\r\n\t\t\tvar animations = object.animationCache.animations;\r\n\t\t\tvar animationCache = animations[ name ];\r\n\r\n\t\t\tif ( animationCache === undefined ) {\r\n\r\n\t\t\t\tanimationCache = {\r\n\t\t\t\t\tprevKey: { pos: 0, rot: 0, scl: 0 },\r\n\t\t\t\t\tnextKey: { pos: 0, rot: 0, scl: 0 },\r\n\t\t\t\t\toriginalMatrix: object.matrix\r\n\t\t\t\t};\r\n\r\n\t\t\t\tanimations[ name ] = animationCache;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Get keys to match our current time\r\n\r\n\t\t\tfor ( var t = 0; t < 3; t ++ ) {\r\n\r\n\t\t\t\tvar type = this.keyTypes[ t ];\r\n\r\n\t\t\t\tvar prevKey = this.data.hierarchy[ h ].keys[ 0 ];\r\n\t\t\t\tvar nextKey = this.getNextKeyWith( type, h, 1 );\r\n\r\n\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tanimationCache.prevKey[ type ] = prevKey;\r\n\t\t\t\tanimationCache.nextKey[ type ] = nextKey;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tresetBlendWeights: function () {\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\tvar animationCache = object.animationCache;\r\n\r\n\t\t\tif ( animationCache !== undefined ) {\r\n\r\n\t\t\t\tvar blending = animationCache.blending;\r\n\r\n\t\t\t\tblending.positionWeight = 0.0;\r\n\t\t\t\tblending.quaternionWeight = 0.0;\r\n\t\t\t\tblending.scaleWeight = 0.0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: ( function() {\r\n\r\n\t\tvar points = [];\r\n\t\tvar target = new THREE.Vector3();\r\n\t\tvar newVector = new THREE.Vector3();\r\n\t\tvar newQuat = new THREE.Quaternion();\r\n\r\n\t\t// Catmull-Rom spline\r\n\r\n\t\tvar interpolateCatmullRom = function ( points, scale ) {\r\n\r\n\t\t\tvar c = [], v3 = [],\r\n\t\t\tpoint, intPoint, weight, w2, w3,\r\n\t\t\tpa, pb, pc, pd;\r\n\r\n\t\t\tpoint = ( points.length - 1 ) * scale;\r\n\t\t\tintPoint = Math.floor( point );\r\n\t\t\tweight = point - intPoint;\r\n\r\n\t\t\tc[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;\r\n\t\t\tc[ 1 ] = intPoint;\r\n\t\t\tc[ 2 ] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n\t\t\tc[ 3 ] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n\t\t\tpa = points[ c[ 0 ] ];\r\n\t\t\tpb = points[ c[ 1 ] ];\r\n\t\t\tpc = points[ c[ 2 ] ];\r\n\t\t\tpd = points[ c[ 3 ] ];\r\n\r\n\t\t\tw2 = weight * weight;\r\n\t\t\tw3 = weight * w2;\r\n\r\n\t\t\tv3[ 0 ] = interpolate( pa[ 0 ], pb[ 0 ], pc[ 0 ], pd[ 0 ], weight, w2, w3 );\r\n\t\t\tv3[ 1 ] = interpolate( pa[ 1 ], pb[ 1 ], pc[ 1 ], pd[ 1 ], weight, w2, w3 );\r\n\t\t\tv3[ 2 ] = interpolate( pa[ 2 ], pb[ 2 ], pc[ 2 ], pd[ 2 ], weight, w2, w3 );\r\n\r\n\t\t\treturn v3;\r\n\r\n\t\t};\r\n\r\n\t\tvar interpolate = function ( p0, p1, p2, p3, t, t2, t3 ) {\r\n\r\n\t\t\tvar v0 = ( p2 - p0 ) * 0.5,\r\n\t\t\t\tv1 = ( p3 - p1 ) * 0.5;\r\n\r\n\t\t\treturn ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t\t};\r\n\r\n\t\treturn function ( delta ) {\r\n\r\n\t\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\t\tthis.currentTime += delta * this.timeScale;\r\n\r\n\t\t\tif ( this.weight === 0 )\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar duration = this.data.length;\r\n\r\n\t\t\tif ( this.currentTime > duration || this.currentTime < 0 ) {\r\n\r\n\t\t\t\tif ( this.loop ) {\r\n\r\n\t\t\t\t\tthis.currentTime %= duration;\r\n\r\n\t\t\t\t\tif ( this.currentTime < 0 )\r\n\t\t\t\t\t\tthis.currentTime += duration;\r\n\r\n\t\t\t\t\tthis.reset();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.stop();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\t\tvar animationCache = object.animationCache.animations[ this.data.name ];\r\n\t\t\t\tvar blending = object.animationCache.blending;\r\n\r\n\t\t\t\t// loop through pos/rot/scl\r\n\r\n\t\t\t\tfor ( var t = 0; t < 3; t ++ ) {\r\n\r\n\t\t\t\t\t// get keys\r\n\r\n\t\t\t\t\tvar type    = this.keyTypes[ t ];\r\n\t\t\t\t\tvar prevKey = animationCache.prevKey[ type ];\r\n\t\t\t\t\tvar nextKey = animationCache.nextKey[ type ];\r\n\r\n\t\t\t\t\tif ( ( this.timeScale > 0 && nextKey.time <= this.currentTime ) ||\r\n\t\t\t\t\t\t( this.timeScale < 0 && prevKey.time >= this.currentTime ) ) {\r\n\r\n\t\t\t\t\t\tprevKey = this.data.hierarchy[ h ].keys[ 0 ];\r\n\t\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, 1 );\r\n\r\n\t\t\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tanimationCache.prevKey[ type ] = prevKey;\r\n\t\t\t\t\t\tanimationCache.nextKey[ type ] = nextKey;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scale = ( this.currentTime - prevKey.time ) / ( nextKey.time - prevKey.time );\r\n\r\n\t\t\t\t\tvar prevXYZ = prevKey[ type ];\r\n\t\t\t\t\tvar nextXYZ = nextKey[ type ];\r\n\r\n\t\t\t\t\tif ( scale < 0 ) scale = 0;\r\n\t\t\t\t\tif ( scale > 1 ) scale = 1;\r\n\r\n\t\t\t\t\t// interpolate\r\n\r\n\t\t\t\t\tif ( type === \"pos\" ) {\r\n\r\n\t\t\t\t\t\tif ( this.interpolationType === THREE.AnimationHandler.LINEAR ) {\r\n\r\n\t\t\t\t\t\t\tnewVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;\r\n\t\t\t\t\t\t\tnewVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;\r\n\t\t\t\t\t\t\tnewVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;\r\n\r\n\t\t\t\t\t\t\t// blend\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.positionWeight );\r\n\t\t\t\t\t\t\tobject.position.lerp( newVector, proportionalWeight );\r\n\t\t\t\t\t\t\tblending.positionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t} else if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\t\t\t\t\t\t\tthis.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\t\t\t\t\tpoints[ 0 ] = this.getPrevKeyWith( \"pos\", h, prevKey.index - 1 )[ \"pos\" ];\r\n\t\t\t\t\t\t\tpoints[ 1 ] = prevXYZ;\r\n\t\t\t\t\t\t\tpoints[ 2 ] = nextXYZ;\r\n\t\t\t\t\t\t\tpoints[ 3 ] = this.getNextKeyWith( \"pos\", h, nextKey.index + 1 )[ \"pos\" ];\r\n\r\n\t\t\t\t\t\t\tscale = scale * 0.33 + 0.33;\r\n\r\n\t\t\t\t\t\t\tvar currentPoint = interpolateCatmullRom( points, scale );\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.positionWeight );\r\n\t\t\t\t\t\t\tblending.positionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t\t// blend\r\n\r\n\t\t\t\t\t\t\tvar vector = object.position;\r\n\r\n\t\t\t\t\t\t\tvector.x = vector.x + ( currentPoint[ 0 ] - vector.x ) * proportionalWeight;\r\n\t\t\t\t\t\t\tvector.y = vector.y + ( currentPoint[ 1 ] - vector.y ) * proportionalWeight;\r\n\t\t\t\t\t\t\tvector.z = vector.z + ( currentPoint[ 2 ] - vector.z ) * proportionalWeight;\r\n\r\n\t\t\t\t\t\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\t\t\t\t\t\tvar forwardPoint = interpolateCatmullRom( points, scale * 1.01 );\r\n\r\n\t\t\t\t\t\t\t\ttarget.set( forwardPoint[ 0 ], forwardPoint[ 1 ], forwardPoint[ 2 ] );\r\n\t\t\t\t\t\t\t\ttarget.sub( vector );\r\n\t\t\t\t\t\t\t\ttarget.y = 0;\r\n\t\t\t\t\t\t\t\ttarget.normalize();\r\n\r\n\t\t\t\t\t\t\t\tvar angle = Math.atan2( target.x, target.z );\r\n\t\t\t\t\t\t\t\tobject.rotation.set( 0, angle, 0 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( type === \"rot\" ) {\r\n\r\n\t\t\t\t\t\tTHREE.Quaternion.slerp( prevXYZ, nextXYZ, newQuat, scale );\r\n\r\n\t\t\t\t\t\t// Avoid paying the cost of an additional slerp if we don't have to\r\n\t\t\t\t\t\tif ( blending.quaternionWeight === 0 ) {\r\n\r\n\t\t\t\t\t\t\tobject.quaternion.copy( newQuat );\r\n\t\t\t\t\t\t\tblending.quaternionWeight = this.weight;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.quaternionWeight );\r\n\t\t\t\t\t\t\tTHREE.Quaternion.slerp( object.quaternion, newQuat, object.quaternion, proportionalWeight );\r\n\t\t\t\t\t\t\tblending.quaternionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( type === \"scl\" ) {\r\n\r\n\t\t\t\t\t\tnewVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;\r\n\t\t\t\t\t\tnewVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;\r\n\t\t\t\t\t\tnewVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;\r\n\r\n\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.scaleWeight );\r\n\t\t\t\t\t\tobject.scale.lerp( newVector, proportionalWeight );\r\n\t\t\t\t\t\tblending.scaleWeight += this.weight;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t};\r\n\r\n\t} )(),\r\n\r\n\tgetNextKeyWith: function ( type, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\r\n\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\t this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\tkey = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tkey = key % keys.length;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( ; key < keys.length; key ++ ) {\r\n\r\n\t\t\tif ( keys[ key ][ type ] !== undefined ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.data.hierarchy[ h ].keys[ 0 ];\r\n\r\n\t},\r\n\r\n\tgetPrevKeyWith: function ( type, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\r\n\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\tthis.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\tkey = key > 0 ? key : 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tkey = key >= 0 ? key : key + keys.length;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfor ( ; key >= 0; key -- ) {\r\n\r\n\t\t\tif ( keys[ key ][ type ] !== undefined ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.data.hierarchy[ h ].keys[ keys.length - 1 ];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function ( data ) {\r\n\r\n\tthis.root = data.node;\r\n\tthis.data = THREE.AnimationHandler.init( data );\r\n\tthis.hierarchy = THREE.AnimationHandler.parse( this.root );\r\n\tthis.currentTime = 0;\r\n\tthis.timeScale = 0.001;\r\n\tthis.isPlaying = false;\r\n\tthis.isPaused = true;\r\n\tthis.loop = true;\r\n\r\n\t// initialize to first keyframes\r\n\r\n\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys,\r\n\t\t\tsids = this.data.hierarchy[ h ].sids,\r\n\t\t\tobj = this.hierarchy[ h ];\r\n\r\n\t\tif ( keys.length && sids ) {\r\n\r\n\t\t\tfor ( var s = 0; s < sids.length; s ++ ) {\r\n\r\n\t\t\t\tvar sid = sids[ s ],\r\n\t\t\t\t\tnext = this.getNextKeyWith( sid, h, 0 );\r\n\r\n\t\t\t\tif ( next ) {\r\n\r\n\t\t\t\t\tnext.apply( sid );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobj.matrixAutoUpdate = false;\r\n\t\t\tthis.data.hierarchy[ h ].node.updateMatrix();\r\n\t\t\tobj.matrixWorldNeedsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n\tconstructor: THREE.KeyFrameAnimation,\r\n\r\n\tplay: function ( startTime ) {\r\n\r\n\t\tthis.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n\t\tif ( this.isPlaying === false ) {\r\n\r\n\t\t\tthis.isPlaying = true;\r\n\r\n\t\t\t// reset key cache\r\n\r\n\t\t\tvar h, hl = this.hierarchy.length,\r\n\t\t\t\tobject,\r\n\t\t\t\tnode;\r\n\r\n\t\t\tfor ( h = 0; h < hl; h ++ ) {\r\n\r\n\t\t\t\tobject = this.hierarchy[ h ];\r\n\t\t\t\tnode = this.data.hierarchy[ h ];\r\n\r\n\t\t\t\tif ( node.animationCache === undefined ) {\r\n\r\n\t\t\t\t\tnode.animationCache = {};\r\n\t\t\t\t\tnode.animationCache.prevKey = null;\r\n\t\t\t\t\tnode.animationCache.nextKey = null;\r\n\t\t\t\t\tnode.animationCache.originalMatrix = object.matrix;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\r\n\t\t\t\tif ( keys.length ) {\r\n\r\n\t\t\t\t\tnode.animationCache.prevKey = keys[ 0 ];\r\n\t\t\t\t\tnode.animationCache.nextKey = keys[ 1 ];\r\n\r\n\t\t\t\t\tthis.startTime = Math.min( keys[ 0 ].time, this.startTime );\r\n\t\t\t\t\tthis.endTime = Math.max( keys[ keys.length - 1 ].time, this.endTime );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.update( 0 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.isPaused = false;\r\n\r\n\t\tTHREE.AnimationHandler.play( this );\r\n\r\n\t},\r\n\r\n\tstop: function () {\r\n\r\n\t\tthis.isPlaying = false;\r\n\t\tthis.isPaused  = false;\r\n\r\n\t\tTHREE.AnimationHandler.stop( this );\r\n\r\n\t\t// reset JIT matrix and remove cache\r\n\r\n\t\tfor ( var h = 0; h < this.data.hierarchy.length; h ++ ) {\r\n\r\n\t\t\tvar obj = this.hierarchy[ h ];\r\n\t\t\tvar node = this.data.hierarchy[ h ];\r\n\r\n\t\t\tif ( node.animationCache !== undefined ) {\r\n\r\n\t\t\t\tvar original = node.animationCache.originalMatrix;\r\n\r\n\t\t\t\toriginal.copy( obj.matrix );\r\n\t\t\t\tobj.matrix = original;\r\n\r\n\t\t\t\tdelete node.animationCache;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: function ( delta ) {\r\n\r\n\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\tthis.currentTime += delta * this.timeScale;\r\n\r\n\t\t//\r\n\r\n\t\tvar duration = this.data.length;\r\n\r\n\t\tif ( this.loop === true && this.currentTime > duration ) {\r\n\r\n\t\t\tthis.currentTime %= duration;\r\n\r\n\t\t}\r\n\r\n\t\tthis.currentTime = Math.min( this.currentTime, duration );\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\tvar node = this.data.hierarchy[ h ];\r\n\r\n\t\t\tvar keys = node.keys,\r\n\t\t\t\tanimationCache = node.animationCache;\r\n\r\n\r\n\t\t\tif ( keys.length ) {\r\n\r\n\t\t\t\tvar prevKey = animationCache.prevKey;\r\n\t\t\t\tvar nextKey = animationCache.nextKey;\r\n\r\n\t\t\t\tif ( nextKey.time <= this.currentTime ) {\r\n\r\n\t\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\t\tnextKey = keys[ prevKey.index + 1 ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tanimationCache.prevKey = prevKey;\r\n\t\t\t\t\tanimationCache.nextKey = nextKey;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nextKey.time >= this.currentTime ) {\r\n\r\n\t\t\t\t\tprevKey.interpolate( nextKey, this.currentTime );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tprevKey.interpolate( nextKey, nextKey.time );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.data.hierarchy[ h ].node.updateMatrix();\r\n\t\t\t\tobject.matrixWorldNeedsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetNextKeyWith: function ( sid, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\t\tkey = key % keys.length;\r\n\r\n\t\tfor ( ; key < keys.length; key ++ ) {\r\n\r\n\t\t\tif ( keys[ key ].hasTarget( sid ) ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn keys[ 0 ];\r\n\r\n\t},\r\n\r\n\tgetPrevKeyWith: function ( sid, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\t\tkey = key >= 0 ? key : key + keys.length;\r\n\r\n\t\tfor ( ; key >= 0; key -- ) {\r\n\r\n\t\t\tif ( keys[ key ].hasTarget( sid ) ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn keys[ keys.length - 1 ];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function ( mesh ) {\r\n\r\n\tthis.mesh = mesh;\r\n\tthis.frames = mesh.morphTargetInfluences.length;\r\n\tthis.currentTime = 0;\r\n\tthis.duration = 1000;\r\n\tthis.loop = true;\r\n\tthis.lastFrame = 0;\r\n\tthis.currentFrame = 0;\r\n\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n\tconstructor: THREE.MorphAnimation,\r\n\r\n\tplay: function () {\r\n\r\n\t\tthis.isPlaying = true;\r\n\r\n\t},\r\n\r\n\tpause: function () {\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t},\r\n\r\n\tupdate: function ( delta ) {\r\n\r\n\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\tif ( this.loop === true && this.currentTime > this.duration ) {\r\n\r\n\t\t\tthis.currentTime %= this.duration;\r\n\r\n\t\t}\r\n\r\n\t\tthis.currentTime = Math.min( this.currentTime, this.duration );\r\n\r\n\t\tvar frameTime = this.duration / this.frames;\r\n\t\tvar frame = Math.floor( this.currentTime / frameTime );\r\n\r\n\t\tvar influences = this.mesh.morphTargetInfluences;\r\n\r\n\t\tif ( frame !== this.currentFrame ) {\r\n\r\n\t\t\tinfluences[ this.lastFrame ] = 0;\r\n\t\t\tinfluences[ this.currentFrame ] = 1;\r\n\t\t\tinfluences[ frame ] = 0;\r\n\r\n\t\t\tthis.lastFrame = this.currentFrame;\r\n\t\t\tthis.currentFrame = frame;\r\n\r\n\t\t}\r\n\r\n\t\tvar mix = ( this.currentTime % frameTime ) / frameTime;\r\n\r\n\t\tinfluences[ frame ] = mix;\r\n\t\tinfluences[ this.lastFrame ] = 1 - mix;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function ( width, height, depth, widthSegments, heightSegments, depthSegments ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'BoxGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\tdepth: depth,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\tdepthSegments: depthSegments\r\n\t};\r\n\r\n\tthis.widthSegments = widthSegments || 1;\r\n\tthis.heightSegments = heightSegments || 1;\r\n\tthis.depthSegments = depthSegments || 1;\r\n\r\n\tvar scope = this;\r\n\r\n\tvar width_half = width / 2;\r\n\tvar height_half = height / 2;\r\n\tvar depth_half = depth / 2;\r\n\r\n\tbuildPlane( 'z', 'y', - 1, - 1, depth, height, width_half, 0 ); // px\r\n\tbuildPlane( 'z', 'y',   1, - 1, depth, height, - width_half, 1 ); // nx\r\n\tbuildPlane( 'x', 'z',   1,   1, width, depth, height_half, 2 ); // py\r\n\tbuildPlane( 'x', 'z',   1, - 1, width, depth, - height_half, 3 ); // ny\r\n\tbuildPlane( 'x', 'y',   1, - 1, width, height, depth_half, 4 ); // pz\r\n\tbuildPlane( 'x', 'y', - 1, - 1, width, height, - depth_half, 5 ); // nz\r\n\r\n\tfunction buildPlane( u, v, udir, vdir, width, height, depth, materialIndex ) {\r\n\r\n\t\tvar w, ix, iy,\r\n\t\tgridX = scope.widthSegments,\r\n\t\tgridY = scope.heightSegments,\r\n\t\twidth_half = width / 2,\r\n\t\theight_half = height / 2,\r\n\t\toffset = scope.vertices.length;\r\n\r\n\t\tif ( ( u === 'x' && v === 'y' ) || ( u === 'y' && v === 'x' ) ) {\r\n\r\n\t\t\tw = 'z';\r\n\r\n\t\t} else if ( ( u === 'x' && v === 'z' ) || ( u === 'z' && v === 'x' ) ) {\r\n\r\n\t\t\tw = 'y';\r\n\t\t\tgridY = scope.depthSegments;\r\n\r\n\t\t} else if ( ( u === 'z' && v === 'y' ) || ( u === 'y' && v === 'z' ) ) {\r\n\r\n\t\t\tw = 'x';\r\n\t\t\tgridX = scope.depthSegments;\r\n\r\n\t\t}\r\n\r\n\t\tvar gridX1 = gridX + 1,\r\n\t\tgridY1 = gridY + 1,\r\n\t\tsegment_width = width / gridX,\r\n\t\tsegment_height = height / gridY,\r\n\t\tnormal = new THREE.Vector3();\r\n\r\n\t\tnormal[ w ] = depth > 0 ? 1 : - 1;\r\n\r\n\t\tfor ( iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\t\tfor ( ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\t\tvar vector = new THREE.Vector3();\r\n\t\t\t\tvector[ u ] = ( ix * segment_width - width_half ) * udir;\r\n\t\t\t\tvector[ v ] = ( iy * segment_height - height_half ) * vdir;\r\n\t\t\t\tvector[ w ] = depth;\r\n\r\n\t\t\t\tscope.vertices.push( vector );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\t\tfor ( ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\t\tvar a = ix + gridX1 * iy;\r\n\t\t\t\tvar b = ix + gridX1 * ( iy + 1 );\r\n\t\t\t\tvar c = ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\t\tvar d = ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\t\tvar uva = new THREE.Vector2( ix / gridX, 1 - iy / gridY );\r\n\t\t\t\tvar uvb = new THREE.Vector2( ix / gridX, 1 - ( iy + 1 ) / gridY );\r\n\t\t\t\tvar uvc = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - ( iy + 1 ) / gridY );\r\n\t\t\t\tvar uvd = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - iy / gridY );\r\n\r\n\t\t\t\tvar face = new THREE.Face3( a + offset, b + offset, d + offset );\r\n\t\t\t\tface.normal.copy( normal );\r\n\t\t\t\tface.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );\r\n\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\tscope.faces.push( face );\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\t\tface = new THREE.Face3( b + offset, c + offset, d + offset );\r\n\t\t\t\tface.normal.copy( normal );\r\n\t\t\t\tface.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );\r\n\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\tscope.faces.push( face );\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\nTHREE.BoxGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.BoxGeometry(\r\n\t\tthis.parameters.width,\r\n\t\tthis.parameters.height,\r\n\t\tthis.parameters.depth,\r\n\t\tthis.parameters.widthSegments,\r\n\t\tthis.parameters.heightSegments,\r\n\t\tthis.parameters.depthSegments\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\nTHREE.CubeGeometry = THREE.BoxGeometry; // backwards compatibility\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function ( radius, segments, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'CircleGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tsegments: segments,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradius = radius || 50;\r\n\tsegments = segments !== undefined ? Math.max( 3, segments ) : 8;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n\tvar i, uvs = [],\r\n\tcenter = new THREE.Vector3(), centerUV = new THREE.Vector2( 0.5, 0.5 );\r\n\r\n\tthis.vertices.push( center );\r\n\tuvs.push( centerUV );\r\n\r\n\tfor ( i = 0; i <= segments; i ++ ) {\r\n\r\n\t\tvar vertex = new THREE.Vector3();\r\n\t\tvar segment = thetaStart + i / segments * thetaLength;\r\n\r\n\t\tvertex.x = radius * Math.cos( segment );\r\n\t\tvertex.y = radius * Math.sin( segment );\r\n\r\n\t\tthis.vertices.push( vertex );\r\n\t\tuvs.push( new THREE.Vector2( ( vertex.x / radius + 1 ) / 2, ( vertex.y / radius + 1 ) / 2 ) );\r\n\r\n\t}\r\n\r\n\tvar n = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\tfor ( i = 1; i <= segments; i ++ ) {\r\n\r\n\t\tthis.faces.push( new THREE.Face3( i, i + 1, 0, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ i ].clone(), uvs[ i + 1 ].clone(), centerUV.clone() ] );\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\nTHREE.CircleGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.CircleGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.segments,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CircleBufferGeometry.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n */\r\n\r\nTHREE.CircleBufferGeometry = function ( radius, segments, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthis.type = 'CircleBufferGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tsegments: segments,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradius = radius || 50;\r\n\tsegments = segments !== undefined ? Math.max( 3, segments ) : 8;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n\tvar vertices = segments + 2;\r\n\r\n\tvar positions = new Float32Array( vertices * 3 );\r\n\tvar normals = new Float32Array( vertices * 3 );\r\n\tvar uvs = new Float32Array( vertices * 2 );\r\n\r\n\t// center data is already zero, but need to set a few extras\r\n\tnormals[ 3 ] = 1.0;\r\n\tuvs[ 0 ] = 0.5;\r\n\tuvs[ 1 ] = 0.5;\r\n\r\n\tfor ( var s = 0, i = 3, ii = 2 ; s <= segments; s ++, i += 3, ii += 2 ) {\r\n\r\n\t\tvar segment = thetaStart + s / segments * thetaLength;\r\n\r\n\t\tpositions[ i ] = radius * Math.cos( segment );\r\n\t\tpositions[ i + 1 ] = radius * Math.sin( segment );\r\n\r\n\t\tnormals[ i + 2 ] = 1; // normal z\r\n\r\n\t\tuvs[ ii ] = ( positions[ i ] / radius + 1 ) / 2;\r\n\t\tuvs[ ii + 1 ] = ( positions[ i + 1 ] / radius + 1 ) / 2;\r\n\r\n\t}\r\n\r\n\tvar indices = [];\r\n\r\n\tfor ( var i = 1; i <= segments; i ++ ) {\r\n\r\n\t\tindices.push( i );\r\n\t\tindices.push( i + 1 );\r\n\t\tindices.push( 0 );\r\n\r\n\t}\r\n\r\n\tthis.setIndex( new THREE.BufferAttribute( new Uint16Array( indices ), 1 ) );\r\n\tthis.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\r\n\tthis.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );\r\n\tthis.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.CircleBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.CircleBufferGeometry.prototype.constructor = THREE.CircleBufferGeometry;\r\n\r\nTHREE.CircleBufferGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.CircleBufferGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.segments,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function ( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'CylinderGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradiusTop: radiusTop,\r\n\t\tradiusBottom: radiusBottom,\r\n\t\theight: height,\r\n\t\tradialSegments: radialSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\topenEnded: openEnded,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n\tradiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n\theight = height !== undefined ? height : 100;\r\n\r\n\tradialSegments = radialSegments || 8;\r\n\theightSegments = heightSegments || 1;\r\n\r\n\topenEnded = openEnded !== undefined ? openEnded : false;\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n\tvar heightHalf = height / 2;\r\n\r\n\tvar x, y, vertices = [], uvs = [];\r\n\r\n\tfor ( y = 0; y <= heightSegments; y ++ ) {\r\n\r\n\t\tvar verticesRow = [];\r\n\t\tvar uvsRow = [];\r\n\r\n\t\tvar v = y / heightSegments;\r\n\t\tvar radius = v * ( radiusBottom - radiusTop ) + radiusTop;\r\n\r\n\t\tfor ( x = 0; x <= radialSegments; x ++ ) {\r\n\r\n\t\t\tvar u = x / radialSegments;\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvertex.x = radius * Math.sin( u * thetaLength + thetaStart );\r\n\t\t\tvertex.y = - v * height + heightHalf;\r\n\t\t\tvertex.z = radius * Math.cos( u * thetaLength + thetaStart );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t\tverticesRow.push( this.vertices.length - 1 );\r\n\t\t\tuvsRow.push( new THREE.Vector2( u, 1 - v ) );\r\n\r\n\t\t}\r\n\r\n\t\tvertices.push( verticesRow );\r\n\t\tuvs.push( uvsRow );\r\n\r\n\t}\r\n\r\n\tvar tanTheta = ( radiusBottom - radiusTop ) / height;\r\n\tvar na, nb;\r\n\r\n\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\tif ( radiusTop !== 0 ) {\r\n\r\n\t\t\tna = this.vertices[ vertices[ 0 ][ x ] ].clone();\r\n\t\t\tnb = this.vertices[ vertices[ 0 ][ x + 1 ] ].clone();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tna = this.vertices[ vertices[ 1 ][ x ] ].clone();\r\n\t\t\tnb = this.vertices[ vertices[ 1 ][ x + 1 ] ].clone();\r\n\r\n\t\t}\r\n\r\n\t\tna.setY( Math.sqrt( na.x * na.x + na.z * na.z ) * tanTheta ).normalize();\r\n\t\tnb.setY( Math.sqrt( nb.x * nb.x + nb.z * nb.z ) * tanTheta ).normalize();\r\n\r\n\t\tfor ( y = 0; y < heightSegments; y ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ y ][ x ];\r\n\t\t\tvar v2 = vertices[ y + 1 ][ x ];\r\n\t\t\tvar v3 = vertices[ y + 1 ][ x + 1 ];\r\n\t\t\tvar v4 = vertices[ y ][ x + 1 ];\r\n\r\n\t\t\tvar n1 = na.clone();\r\n\t\t\tvar n2 = na.clone();\r\n\t\t\tvar n3 = nb.clone();\r\n\t\t\tvar n4 = nb.clone();\r\n\r\n\t\t\tvar uv1 = uvs[ y ][ x ].clone();\r\n\t\t\tvar uv2 = uvs[ y + 1 ][ x ].clone();\r\n\t\t\tvar uv3 = uvs[ y + 1 ][ x + 1 ].clone();\r\n\t\t\tvar uv4 = uvs[ y ][ x + 1 ].clone();\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v4, [ n1, n2, n4 ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv4 ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v2, v3, v4, [ n2.clone(), n3, n4.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv2.clone(), uv3, uv4.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// top cap\r\n\r\n\tif ( openEnded === false && radiusTop > 0 ) {\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( 0, heightHalf, 0 ) );\r\n\r\n\t\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ 0 ][ x ];\r\n\t\t\tvar v2 = vertices[ 0 ][ x + 1 ];\r\n\t\t\tvar v3 = this.vertices.length - 1;\r\n\r\n\t\t\tvar n1 = new THREE.Vector3( 0, 1, 0 );\r\n\t\t\tvar n2 = new THREE.Vector3( 0, 1, 0 );\r\n\t\t\tvar n3 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\t\tvar uv1 = uvs[ 0 ][ x ].clone();\r\n\t\t\tvar uv2 = uvs[ 0 ][ x + 1 ].clone();\r\n\t\t\tvar uv3 = new THREE.Vector2( uv2.x, 0 );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ], undefined, 1 ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// bottom cap\r\n\r\n\tif ( openEnded === false && radiusBottom > 0 ) {\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( 0, - heightHalf, 0 ) );\r\n\r\n\t\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ heightSegments ][ x + 1 ];\r\n\t\t\tvar v2 = vertices[ heightSegments ][ x ];\r\n\t\t\tvar v3 = this.vertices.length - 1;\r\n\r\n\t\t\tvar n1 = new THREE.Vector3( 0, - 1, 0 );\r\n\t\t\tvar n2 = new THREE.Vector3( 0, - 1, 0 );\r\n\t\t\tvar n3 = new THREE.Vector3( 0, - 1, 0 );\r\n\r\n\t\t\tvar uv1 = uvs[ heightSegments ][ x + 1 ].clone();\r\n\t\t\tvar uv2 = uvs[ heightSegments ][ x ].clone();\r\n\t\t\tvar uv3 = new THREE.Vector2( uv2.x, 1 );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ], undefined, 2 ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\nTHREE.CylinderGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.CylinderGeometry(\r\n\t\tthis.parameters.radiusTop,\r\n\t\tthis.parameters.radiusBottom,\r\n\t\tthis.parameters.height,\r\n\t\tthis.parameters.radialSegments,\r\n\t\tthis.parameters.heightSegments,\r\n\t\tthis.parameters.openEnded,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/EdgesGeometry.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.EdgesGeometry = function ( geometry, thresholdAngle ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthresholdAngle = ( thresholdAngle !== undefined ) ? thresholdAngle : 1;\r\n\r\n\tvar thresholdDot = Math.cos( THREE.Math.degToRad( thresholdAngle ) );\r\n\r\n\tvar edge = [ 0, 0 ], hash = {};\r\n\tvar sortFunction = function ( a, b ) {\r\n\r\n\t\treturn a - b;\r\n\r\n\t};\r\n\r\n\tvar keys = [ 'a', 'b', 'c' ];\r\n\r\n\tvar geometry2;\r\n\r\n\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\tgeometry2 = new THREE.Geometry();\r\n\t\tgeometry2.fromBufferGeometry( geometry );\r\n\r\n\t} else {\r\n\r\n\t\tgeometry2 = geometry.clone();\r\n\r\n\t}\r\n\r\n\tgeometry2.mergeVertices();\r\n\tgeometry2.computeFaceNormals();\r\n\r\n\tvar vertices = geometry2.vertices;\r\n\tvar faces = geometry2.faces;\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tvar face = faces[ i ];\r\n\r\n\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\tedge[ 0 ] = face[ keys[ j ] ];\r\n\t\t\tedge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];\r\n\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\tvar key = edge.toString();\r\n\r\n\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\thash[ key ] = { vert1: edge[ 0 ], vert2: edge[ 1 ], face1: i, face2: undefined };\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\thash[ key ].face2 = i;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar coords = [];\r\n\r\n\tfor ( var key in hash ) {\r\n\r\n\t\tvar h = hash[ key ];\r\n\r\n\t\tif ( h.face2 === undefined || faces[ h.face1 ].normal.dot( faces[ h.face2 ].normal ) <= thresholdDot ) {\r\n\r\n\t\t\tvar vertex = vertices[ h.vert1 ];\r\n\t\t\tcoords.push( vertex.x );\r\n\t\t\tcoords.push( vertex.y );\r\n\t\t\tcoords.push( vertex.z );\r\n\r\n\t\t\tvertex = vertices[ h.vert2 ];\r\n\t\t\tcoords.push( vertex.x );\r\n\t\t\tcoords.push( vertex.y );\r\n\t\t\tcoords.push( vertex.z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.addAttribute( 'position', new THREE.BufferAttribute( new Float32Array( coords ), 3 ) );\r\n\r\n};\r\n\r\nTHREE.EdgesGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.EdgesGeometry.prototype.constructor = THREE.EdgesGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segments of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function ( shapes, options ) {\r\n\r\n\tif ( typeof( shapes ) === \"undefined\" ) {\r\n\r\n\t\tshapes = [];\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ExtrudeGeometry';\r\n\r\n\tshapes = Array.isArray( shapes ) ? shapes : [ shapes ];\r\n\r\n\tthis.addShapeList( shapes, options );\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\t// can't really use automatic vertex normals\r\n\t// as then front and back sides get smoothed too\r\n\t// should do separate smoothing just for sides\r\n\r\n\t//this.computeVertexNormals();\r\n\r\n\t//console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function ( shapes, options ) {\r\n\r\n\tvar sl = shapes.length;\r\n\r\n\tfor ( var s = 0; s < sl; s ++ ) {\r\n\r\n\t\tvar shape = shapes[ s ];\r\n\t\tthis.addShape( shape, options );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function ( shape, options ) {\r\n\r\n\tvar amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n\tvar bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n\tvar bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n\tvar bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n\tvar bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n\tvar curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n\tvar steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n\tvar extrudePath = options.extrudePath;\r\n\tvar extrudePts, extrudeByPath = false;\r\n\r\n\t// Use default WorldUVGenerator if no UV generators are specified.\r\n\tvar uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n\tvar splineTube, binormal, normal, position2;\r\n\tif ( extrudePath ) {\r\n\r\n\t\textrudePts = extrudePath.getSpacedPoints( steps );\r\n\r\n\t\textrudeByPath = true;\r\n\t\tbevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n\t\t// SETUP TNB variables\r\n\r\n\t\t// Reuse TNB from TubeGeomtry for now.\r\n\t\t// TODO1 - have a .isClosed in spline?\r\n\r\n\t\tsplineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames( extrudePath, steps, false );\r\n\r\n\t\t// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n\t\tbinormal = new THREE.Vector3();\r\n\t\tnormal = new THREE.Vector3();\r\n\t\tposition2 = new THREE.Vector3();\r\n\r\n\t}\r\n\r\n\t// Safeguards if bevels are not enabled\r\n\r\n\tif ( ! bevelEnabled ) {\r\n\r\n\t\tbevelSegments = 0;\r\n\t\tbevelThickness = 0;\r\n\t\tbevelSize = 0;\r\n\r\n\t}\r\n\r\n\t// Variables initialization\r\n\r\n\tvar ahole, h, hl; // looping of holes\r\n\tvar scope = this;\r\n\r\n\tvar shapesOffset = this.vertices.length;\r\n\r\n\tvar shapePoints = shape.extractPoints( curveSegments );\r\n\r\n\tvar vertices = shapePoints.shape;\r\n\tvar holes = shapePoints.holes;\r\n\r\n\tvar reverse = ! THREE.Shape.Utils.isClockWise( vertices );\r\n\r\n\tif ( reverse ) {\r\n\r\n\t\tvertices = vertices.reverse();\r\n\r\n\t\t// Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\r\n\t\t\tif ( THREE.Shape.Utils.isClockWise( ahole ) ) {\r\n\r\n\t\t\t\tholes[ h ] = ahole.reverse();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n\t}\r\n\r\n\r\n\tvar faces = THREE.Shape.Utils.triangulateShape ( vertices, holes );\r\n\r\n\t/* Vertices */\r\n\r\n\tvar contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\tahole = holes[ h ];\r\n\r\n\t\tvertices = vertices.concat( ahole );\r\n\r\n\t}\r\n\r\n\r\n\tfunction scalePt2 ( pt, vec, size ) {\r\n\r\n\t\tif ( ! vec ) console.error( \"THREE.ExtrudeGeometry: vec does not exist\" );\r\n\r\n\t\treturn vec.clone().multiplyScalar( size ).add( pt );\r\n\r\n\t}\r\n\r\n\tvar b, bs, t, z,\r\n\t\tvert, vlen = vertices.length,\r\n\t\tface, flen = faces.length;\r\n\r\n\r\n\t// Find directions for point movement\r\n\r\n\r\n\tfunction getBevelVec( inPt, inPrev, inNext ) {\r\n\r\n\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\t// computes for inPt the corresponding point inPt' on a new contour\r\n\t\t//   shifted by 1 unit (length of normalized vector) to the left\r\n\t\t// if we walk along contour clockwise, this new contour is outside the old one\r\n\t\t//\r\n\t\t// inPt' is the intersection of the two lines parallel to the two\r\n\t\t//  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\r\n\t\tvar v_trans_x, v_trans_y, shrink_by = 1;\t\t// resulting translation vector for inPt\r\n\r\n\t\t// good reading for geometry algorithms (here: line-line intersection)\r\n\t\t// http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n\t\tvar v_prev_x = inPt.x - inPrev.x, v_prev_y = inPt.y - inPrev.y;\r\n\t\tvar v_next_x = inNext.x - inPt.x, v_next_y = inNext.y - inPt.y;\r\n\r\n\t\tvar v_prev_lensq = ( v_prev_x * v_prev_x + v_prev_y * v_prev_y );\r\n\r\n\t\t// check for collinear edges\r\n\t\tvar collinear0 = ( v_prev_x * v_next_y - v_prev_y * v_next_x );\r\n\r\n\t\tif ( Math.abs( collinear0 ) > EPSILON ) {\r\n\r\n\t\t\t// not collinear\r\n\r\n\t\t\t// length of vectors for normalizing\r\n\r\n\t\t\tvar v_prev_len = Math.sqrt( v_prev_lensq );\r\n\t\t\tvar v_next_len = Math.sqrt( v_next_x * v_next_x + v_next_y * v_next_y );\r\n\r\n\t\t\t// shift adjacent points by unit vectors to the left\r\n\r\n\t\t\tvar ptPrevShift_x = ( inPrev.x - v_prev_y / v_prev_len );\r\n\t\t\tvar ptPrevShift_y = ( inPrev.y + v_prev_x / v_prev_len );\r\n\r\n\t\t\tvar ptNextShift_x = ( inNext.x - v_next_y / v_next_len );\r\n\t\t\tvar ptNextShift_y = ( inNext.y + v_next_x / v_next_len );\r\n\r\n\t\t\t// scaling factor for v_prev to intersection point\r\n\r\n\t\t\tvar sf = (  ( ptNextShift_x - ptPrevShift_x ) * v_next_y -\r\n\t\t\t\t\t\t( ptNextShift_y - ptPrevShift_y ) * v_next_x    ) /\r\n\t\t\t\t\t  ( v_prev_x * v_next_y - v_prev_y * v_next_x );\r\n\r\n\t\t\t// vector from inPt to intersection point\r\n\r\n\t\t\tv_trans_x = ( ptPrevShift_x + v_prev_x * sf - inPt.x );\r\n\t\t\tv_trans_y = ( ptPrevShift_y + v_prev_y * sf - inPt.y );\r\n\r\n\t\t\t// Don't normalize!, otherwise sharp corners become ugly\r\n\t\t\t//  but prevent crazy spikes\r\n\t\t\tvar v_trans_lensq = ( v_trans_x * v_trans_x + v_trans_y * v_trans_y );\r\n\t\t\tif ( v_trans_lensq <= 2 ) {\r\n\r\n\t\t\t\treturn\tnew THREE.Vector2( v_trans_x, v_trans_y );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tshrink_by = Math.sqrt( v_trans_lensq / 2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// handle special case of collinear edges\r\n\r\n\t\t\tvar direction_eq = false;\t\t// assumes: opposite\r\n\t\t\tif ( v_prev_x > EPSILON ) {\r\n\r\n\t\t\t\tif ( v_next_x > EPSILON ) {\r\n\r\n\t\t\t\t\tdirection_eq = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( v_prev_x < - EPSILON ) {\r\n\r\n\t\t\t\t\tif ( v_next_x < - EPSILON ) {\r\n\r\n\t\t\t\t\t\tdirection_eq = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( Math.sign( v_prev_y ) === Math.sign( v_next_y ) ) {\r\n\r\n\t\t\t\t\t\tdirection_eq = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( direction_eq ) {\r\n\r\n\t\t\t\t// console.log(\"Warning: lines are a straight sequence\");\r\n\t\t\t\tv_trans_x = - v_prev_y;\r\n\t\t\t\tv_trans_y =  v_prev_x;\r\n\t\t\t\tshrink_by = Math.sqrt( v_prev_lensq );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// console.log(\"Warning: lines are a straight spike\");\r\n\t\t\t\tv_trans_x = v_prev_x;\r\n\t\t\t\tv_trans_y = v_prev_y;\r\n\t\t\t\tshrink_by = Math.sqrt( v_prev_lensq / 2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn\tnew THREE.Vector2( v_trans_x / shrink_by, v_trans_y / shrink_by );\r\n\r\n\t}\r\n\r\n\r\n\tvar contourMovements = [];\r\n\r\n\tfor ( var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {\r\n\r\n\t\tif ( j === il ) j = 0;\r\n\t\tif ( k === il ) k = 0;\r\n\r\n\t\t//  (j)---(i)---(k)\r\n\t\t// console.log('i,j,k', i, j , k)\r\n\r\n\t\tcontourMovements[ i ] = getBevelVec( contour[ i ], contour[ j ], contour[ k ] );\r\n\r\n\t}\r\n\r\n\tvar holesMovements = [], oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\tahole = holes[ h ];\r\n\r\n\t\toneHoleMovements = [];\r\n\r\n\t\tfor ( i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {\r\n\r\n\t\t\tif ( j === il ) j = 0;\r\n\t\t\tif ( k === il ) k = 0;\r\n\r\n\t\t\t//  (j)---(i)---(k)\r\n\t\t\toneHoleMovements[ i ] = getBevelVec( ahole[ i ], ahole[ j ], ahole[ k ] );\r\n\r\n\t\t}\r\n\r\n\t\tholesMovements.push( oneHoleMovements );\r\n\t\tverticesMovements = verticesMovements.concat( oneHoleMovements );\r\n\r\n\t}\r\n\r\n\r\n\t// Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n\tfor ( b = 0; b < bevelSegments; b ++ ) {\r\n\r\n\t\t//for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n\t\tt = b / bevelSegments;\r\n\t\tz = bevelThickness * ( 1 - t );\r\n\r\n\t\t//z = bevelThickness * t;\r\n\t\tbs = bevelSize * ( Math.sin ( t * Math.PI / 2 ) ); // curved\r\n\t\t//bs = bevelSize * t; // linear\r\n\r\n\t\t// contract shape\r\n\r\n\t\tfor ( i = 0, il = contour.length; i < il; i ++ ) {\r\n\r\n\t\t\tvert = scalePt2( contour[ i ], contourMovements[ i ], bs );\r\n\r\n\t\t\tv( vert.x, vert.y,  - z );\r\n\r\n\t\t}\r\n\r\n\t\t// expand holes\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\toneHoleMovements = holesMovements[ h ];\r\n\r\n\t\t\tfor ( i = 0, il = ahole.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );\r\n\r\n\t\t\t\tv( vert.x, vert.y,  - z );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tbs = bevelSize;\r\n\r\n\t// Back facing vertices\r\n\r\n\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\tvert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];\r\n\r\n\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\tv( vert.x, vert.y, 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n\t\t\tnormal.copy( splineTube.normals[ 0 ] ).multiplyScalar( vert.x );\r\n\t\t\tbinormal.copy( splineTube.binormals[ 0 ] ).multiplyScalar( vert.y );\r\n\r\n\t\t\tposition2.copy( extrudePts[ 0 ] ).add( normal ).add( binormal );\r\n\r\n\t\t\tv( position2.x, position2.y, position2.z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Add stepped vertices...\r\n\t// Including front facing vertices\r\n\r\n\tvar s;\r\n\r\n\tfor ( s = 1; s <= steps; s ++ ) {\r\n\r\n\t\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\t\tvert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];\r\n\r\n\t\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\t\tv( vert.x, vert.y, amount / steps * s );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n\t\t\t\tnormal.copy( splineTube.normals[ s ] ).multiplyScalar( vert.x );\r\n\t\t\t\tbinormal.copy( splineTube.binormals[ s ] ).multiplyScalar( vert.y );\r\n\r\n\t\t\t\tposition2.copy( extrudePts[ s ] ).add( normal ).add( binormal );\r\n\r\n\t\t\t\tv( position2.x, position2.y, position2.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Add bevel segments planes\r\n\r\n\t//for ( b = 1; b <= bevelSegments; b ++ ) {\r\n\tfor ( b = bevelSegments - 1; b >= 0; b -- ) {\r\n\r\n\t\tt = b / bevelSegments;\r\n\t\tz = bevelThickness * ( 1 - t );\r\n\t\t//bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n\t\tbs = bevelSize * Math.sin ( t * Math.PI / 2 );\r\n\r\n\t\t// contract shape\r\n\r\n\t\tfor ( i = 0, il = contour.length; i < il; i ++ ) {\r\n\r\n\t\t\tvert = scalePt2( contour[ i ], contourMovements[ i ], bs );\r\n\t\t\tv( vert.x, vert.y,  amount + z );\r\n\r\n\t\t}\r\n\r\n\t\t// expand holes\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\toneHoleMovements = holesMovements[ h ];\r\n\r\n\t\t\tfor ( i = 0, il = ahole.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );\r\n\r\n\t\t\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\t\t\tv( vert.x, vert.y,  amount + z );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv( vert.x, vert.y + extrudePts[ steps - 1 ].y, extrudePts[ steps - 1 ].x + z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/* Faces */\r\n\r\n\t// Top and bottom faces\r\n\r\n\tbuildLidFaces();\r\n\r\n\t// Sides faces\r\n\r\n\tbuildSideFaces();\r\n\r\n\r\n\t/////  Internal functions\r\n\r\n\tfunction buildLidFaces() {\r\n\r\n\t\tif ( bevelEnabled ) {\r\n\r\n\t\t\tvar layer = 0; // steps + 1\r\n\t\t\tvar offset = vlen * layer;\r\n\r\n\t\t\t// Bottom faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 2 ] + offset, face[ 1 ] + offset, face[ 0 ] + offset );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlayer = steps + bevelSegments * 2;\r\n\t\t\toffset = vlen * layer;\r\n\r\n\t\t\t// Top faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 0 ] + offset, face[ 1 ] + offset, face[ 2 ] + offset );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Bottom faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 2 ], face[ 1 ], face[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Top faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 0 ] + vlen * steps, face[ 1 ] + vlen * steps, face[ 2 ] + vlen * steps );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Create faces for the z-sides of the shape\r\n\r\n\tfunction buildSideFaces() {\r\n\r\n\t\tvar layeroffset = 0;\r\n\t\tsidewalls( contour, layeroffset );\r\n\t\tlayeroffset += contour.length;\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\tsidewalls( ahole, layeroffset );\r\n\r\n\t\t\t//, true\r\n\t\t\tlayeroffset += ahole.length;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction sidewalls( contour, layeroffset ) {\r\n\r\n\t\tvar j, k;\r\n\t\ti = contour.length;\r\n\r\n\t\twhile ( -- i >= 0 ) {\r\n\r\n\t\t\tj = i;\r\n\t\t\tk = i - 1;\r\n\t\t\tif ( k < 0 ) k = contour.length - 1;\r\n\r\n\t\t\t//console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n\t\t\tvar s = 0, sl = steps  + bevelSegments * 2;\r\n\r\n\t\t\tfor ( s = 0; s < sl; s ++ ) {\r\n\r\n\t\t\t\tvar slen1 = vlen * s;\r\n\t\t\t\tvar slen2 = vlen * ( s + 1 );\r\n\r\n\t\t\t\tvar a = layeroffset + j + slen1,\r\n\t\t\t\t\tb = layeroffset + k + slen1,\r\n\t\t\t\t\tc = layeroffset + k + slen2,\r\n\t\t\t\t\td = layeroffset + j + slen2;\r\n\r\n\t\t\t\tf4( a, b, c, d, contour, s, sl, j, k );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tfunction v( x, y, z ) {\r\n\r\n\t\tscope.vertices.push( new THREE.Vector3( x, y, z ) );\r\n\r\n\t}\r\n\r\n\tfunction f3( a, b, c ) {\r\n\r\n\t\ta += shapesOffset;\r\n\t\tb += shapesOffset;\r\n\t\tc += shapesOffset;\r\n\r\n\t\tscope.faces.push( new THREE.Face3( a, b, c ) );\r\n\r\n\t\tvar uvs = uvgen.generateTopUV( scope, a, b, c );\r\n\r\n\t\tscope.faceVertexUvs[ 0 ].push( uvs );\r\n\r\n\t}\r\n\r\n\tfunction f4( a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2 ) {\r\n\r\n\t\ta += shapesOffset;\r\n\t\tb += shapesOffset;\r\n\t\tc += shapesOffset;\r\n\t\td += shapesOffset;\r\n\r\n\t\tscope.faces.push( new THREE.Face3( a, b, d ) );\r\n\t\tscope.faces.push( new THREE.Face3( b, c, d ) );\r\n\r\n\t\tvar uvs = uvgen.generateSideWallUV( scope, a, b, c, d );\r\n\r\n\t\tscope.faceVertexUvs[ 0 ].push( [ uvs[ 0 ], uvs[ 1 ], uvs[ 3 ] ] );\r\n\t\tscope.faceVertexUvs[ 0 ].push( [ uvs[ 1 ], uvs[ 2 ], uvs[ 3 ] ] );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n\tgenerateTopUV: function ( geometry, indexA, indexB, indexC ) {\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\r\n\t\tvar a = vertices[ indexA ];\r\n\t\tvar b = vertices[ indexB ];\r\n\t\tvar c = vertices[ indexC ];\r\n\r\n\t\treturn [\r\n\t\t\tnew THREE.Vector2( a.x, a.y ),\r\n\t\t\tnew THREE.Vector2( b.x, b.y ),\r\n\t\t\tnew THREE.Vector2( c.x, c.y )\r\n\t\t];\r\n\r\n\t},\r\n\r\n\tgenerateSideWallUV: function ( geometry, indexA, indexB, indexC, indexD ) {\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\r\n\t\tvar a = vertices[ indexA ];\r\n\t\tvar b = vertices[ indexB ];\r\n\t\tvar c = vertices[ indexC ];\r\n\t\tvar d = vertices[ indexD ];\r\n\r\n\t\tif ( Math.abs( a.y - b.y ) < 0.01 ) {\r\n\r\n\t\t\treturn [\r\n\t\t\t\tnew THREE.Vector2( a.x, 1 - a.z ),\r\n\t\t\t\tnew THREE.Vector2( b.x, 1 - b.z ),\r\n\t\t\t\tnew THREE.Vector2( c.x, 1 - c.z ),\r\n\t\t\t\tnew THREE.Vector2( d.x, 1 - d.z )\r\n\t\t\t];\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn [\r\n\t\t\t\tnew THREE.Vector2( a.y, 1 - a.z ),\r\n\t\t\t\tnew THREE.Vector2( b.y, 1 - b.z ),\r\n\t\t\t\tnew THREE.Vector2( c.y, 1 - c.z ),\r\n\t\t\t\tnew THREE.Vector2( d.y, 1 - d.z )\r\n\t\t\t];\r\n\r\n\t\t}\r\n\r\n\t}\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function ( shapes, options ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ShapeGeometry';\r\n\r\n\tif ( Array.isArray( shapes ) === false ) shapes = [ shapes ];\r\n\r\n\tthis.addShapeList( shapes, options );\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function ( shapes, options ) {\r\n\r\n\tfor ( var i = 0, l = shapes.length; i < l; i ++ ) {\r\n\r\n\t\tthis.addShape( shapes[ i ], options );\r\n\r\n\t}\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function ( shape, options ) {\r\n\r\n\tif ( options === undefined ) options = {};\r\n\tvar curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n\tvar material = options.material;\r\n\tvar uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n\t//\r\n\r\n\tvar i, l, hole;\r\n\r\n\tvar shapesOffset = this.vertices.length;\r\n\tvar shapePoints = shape.extractPoints( curveSegments );\r\n\r\n\tvar vertices = shapePoints.shape;\r\n\tvar holes = shapePoints.holes;\r\n\r\n\tvar reverse = ! THREE.Shape.Utils.isClockWise( vertices );\r\n\r\n\tif ( reverse ) {\r\n\r\n\t\tvertices = vertices.reverse();\r\n\r\n\t\t// Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n\t\tfor ( i = 0, l = holes.length; i < l; i ++ ) {\r\n\r\n\t\t\thole = holes[ i ];\r\n\r\n\t\t\tif ( THREE.Shape.Utils.isClockWise( hole ) ) {\r\n\r\n\t\t\t\tholes[ i ] = hole.reverse();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treverse = false;\r\n\r\n\t}\r\n\r\n\tvar faces = THREE.Shape.Utils.triangulateShape( vertices, holes );\r\n\r\n\t// Vertices\r\n\r\n\tfor ( i = 0, l = holes.length; i < l; i ++ ) {\r\n\r\n\t\thole = holes[ i ];\r\n\t\tvertices = vertices.concat( hole );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar vert, vlen = vertices.length;\r\n\tvar face, flen = faces.length;\r\n\r\n\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\tvert = vertices[ i ];\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( vert.x, vert.y, 0 ) );\r\n\r\n\t}\r\n\r\n\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\tface = faces[ i ];\r\n\r\n\t\tvar a = face[ 0 ] + shapesOffset;\r\n\t\tvar b = face[ 1 ] + shapesOffset;\r\n\t\tvar c = face[ 2 ] + shapesOffset;\r\n\r\n\t\tthis.faces.push( new THREE.Face3( a, b, c, null, null, material ) );\r\n\t\tthis.faceVertexUvs[ 0 ].push( uvgen.generateTopUV( this, a, b, c ) );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function ( points, segments, phiStart, phiLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'LatheGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tpoints: points,\r\n\t\tsegments: segments,\r\n\t\tphiStart: phiStart,\r\n\t\tphiLength: phiLength\r\n\t};\r\n\r\n\tsegments = segments || 12;\r\n\tphiStart = phiStart || 0;\r\n\tphiLength = phiLength || 2 * Math.PI;\r\n\r\n\tvar inversePointLength = 1.0 / ( points.length - 1 );\r\n\tvar inverseSegments = 1.0 / segments;\r\n\r\n\tfor ( var i = 0, il = segments; i <= il; i ++ ) {\r\n\r\n\t\tvar phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n\t\tvar c = Math.cos( phi ),\r\n\t\t\ts = Math.sin( phi );\r\n\r\n\t\tfor ( var j = 0, jl = points.length; j < jl; j ++ ) {\r\n\r\n\t\t\tvar pt = points[ j ];\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\r\n\t\t\tvertex.x = c * pt.x - s * pt.y;\r\n\t\t\tvertex.y = s * pt.x + c * pt.y;\r\n\t\t\tvertex.z = pt.z;\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar np = points.length;\r\n\r\n\tfor ( var i = 0, il = segments; i < il; i ++ ) {\r\n\r\n\t\tfor ( var j = 0, jl = points.length - 1; j < jl; j ++ ) {\r\n\r\n\t\t\tvar base = j + np * i;\r\n\t\t\tvar a = base;\r\n\t\t\tvar b = base + np;\r\n\t\t\tvar c = base + 1 + np;\r\n\t\t\tvar d = base + 1;\r\n\r\n\t\t\tvar u0 = i * inverseSegments;\r\n\t\t\tvar v0 = j * inversePointLength;\r\n\t\t\tvar u1 = u0 + inverseSegments;\r\n\t\t\tvar v1 = v0 + inversePointLength;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [\r\n\r\n\t\t\t\tnew THREE.Vector2( u0, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u1, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u0, v1 )\r\n\r\n\t\t\t] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [\r\n\r\n\t\t\t\tnew THREE.Vector2( u1, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u1, v1 ),\r\n\t\t\t\tnew THREE.Vector2( u0, v1 )\r\n\r\n\t\t\t] );\r\n\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.mergeVertices();\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function ( width, height, widthSegments, heightSegments ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'PlaneGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments\r\n\t};\r\n\r\n\tthis.fromBufferGeometry( new THREE.PlaneBufferGeometry( width, height, widthSegments, heightSegments ) );\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\nTHREE.PlaneGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.PlaneGeometry(\r\n\t\tthis.parameters.width,\r\n\t\tthis.parameters.height,\r\n\t\tthis.parameters.widthSegments,\r\n\t\tthis.parameters.heightSegments\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function ( width, height, widthSegments, heightSegments ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthis.type = 'PlaneBufferGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments\r\n\t};\r\n\r\n\tvar width_half = width / 2;\r\n\tvar height_half = height / 2;\r\n\r\n\tvar gridX = Math.floor( widthSegments ) || 1;\r\n\tvar gridY = Math.floor( heightSegments ) || 1;\r\n\r\n\tvar gridX1 = gridX + 1;\r\n\tvar gridY1 = gridY + 1;\r\n\r\n\tvar segment_width = width / gridX;\r\n\tvar segment_height = height / gridY;\r\n\r\n\tvar vertices = new Float32Array( gridX1 * gridY1 * 3 );\r\n\tvar normals = new Float32Array( gridX1 * gridY1 * 3 );\r\n\tvar uvs = new Float32Array( gridX1 * gridY1 * 2 );\r\n\r\n\tvar offset = 0;\r\n\tvar offset2 = 0;\r\n\r\n\tfor ( var iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\tvar y = iy * segment_height - height_half;\r\n\r\n\t\tfor ( var ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\tvar x = ix * segment_width - width_half;\r\n\r\n\t\t\tvertices[ offset ] = x;\r\n\t\t\tvertices[ offset + 1 ] = - y;\r\n\r\n\t\t\tnormals[ offset + 2 ] = 1;\r\n\r\n\t\t\tuvs[ offset2 ] = ix / gridX;\r\n\t\t\tuvs[ offset2 + 1 ] = 1 - ( iy / gridY );\r\n\r\n\t\t\toffset += 3;\r\n\t\t\toffset2 += 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\toffset = 0;\r\n\r\n\tvar indices = new ( ( vertices.length / 3 ) > 65535 ? Uint32Array : Uint16Array )( gridX * gridY * 6 );\r\n\r\n\tfor ( var iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\tfor ( var ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\tvar a = ix + gridX1 * iy;\r\n\t\t\tvar b = ix + gridX1 * ( iy + 1 );\r\n\t\t\tvar c = ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\tvar d = ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\tindices[ offset ] = a;\r\n\t\t\tindices[ offset + 1 ] = b;\r\n\t\t\tindices[ offset + 2 ] = d;\r\n\r\n\t\t\tindices[ offset + 3 ] = b;\r\n\t\t\tindices[ offset + 4 ] = c;\r\n\t\t\tindices[ offset + 5 ] = d;\r\n\r\n\t\t\toffset += 6;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.setIndex( new THREE.BufferAttribute( indices, 1 ) );\r\n\tthis.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tthis.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );\r\n\tthis.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\nTHREE.PlaneBufferGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.PlaneBufferGeometry(\r\n\t\tthis.parameters.width,\r\n\t\tthis.parameters.height,\r\n\t\tthis.parameters.widthSegments,\r\n\t\tthis.parameters.heightSegments\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function ( innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'RingGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tinnerRadius: innerRadius,\r\n\t\touterRadius: outerRadius,\r\n\t\tthetaSegments: thetaSegments,\r\n\t\tphiSegments: phiSegments,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tinnerRadius = innerRadius || 0;\r\n\touterRadius = outerRadius || 50;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n\tthetaSegments = thetaSegments !== undefined ? Math.max( 3, thetaSegments ) : 8;\r\n\tphiSegments = phiSegments !== undefined ? Math.max( 1, phiSegments ) : 8;\r\n\r\n\tvar i, o, uvs = [], radius = innerRadius, radiusStep = ( ( outerRadius - innerRadius ) / phiSegments );\r\n\r\n\tfor ( i = 0; i < phiSegments + 1; i ++ ) {\r\n\r\n\t\t// concentric circles inside ring\r\n\r\n\t\tfor ( o = 0; o < thetaSegments + 1; o ++ ) {\r\n\r\n\t\t\t// number of segments per circle\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvar segment = thetaStart + o / thetaSegments * thetaLength;\r\n\t\t\tvertex.x = radius * Math.cos( segment );\r\n\t\t\tvertex.y = radius * Math.sin( segment );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\t\t\tuvs.push( new THREE.Vector2( ( vertex.x / outerRadius + 1 ) / 2, ( vertex.y / outerRadius + 1 ) / 2 ) );\r\n\r\n\t\t}\r\n\r\n\t\tradius += radiusStep;\r\n\r\n\t}\r\n\r\n\tvar n = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\tfor ( i = 0; i < phiSegments; i ++ ) {\r\n\r\n\t\t// concentric circles inside ring\r\n\r\n\t\tvar thetaSegment = i * ( thetaSegments + 1 );\r\n\r\n\t\tfor ( o = 0; o < thetaSegments ; o ++ ) {\r\n\r\n\t\t\t// number of segments per circle\r\n\r\n\t\t\tvar segment = o + thetaSegment;\r\n\r\n\t\t\tvar v1 = segment;\r\n\t\t\tvar v2 = segment + thetaSegments + 1;\r\n\t\t\tvar v3 = segment + thetaSegments + 2;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ] );\r\n\r\n\t\t\tv1 = segment;\r\n\t\t\tv2 = segment + thetaSegments + 2;\r\n\t\t\tv3 = segment + 1;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\nTHREE.RingGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.RingGeometry(\r\n\t\tthis.parameters.innerRadius,\r\n\t\tthis.parameters.outerRadius,\r\n\t\tthis.parameters.thetaSegments,\r\n\t\tthis.parameters.phiSegments,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function ( radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'SphereGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\tphiStart: phiStart,\r\n\t\tphiLength: phiLength,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tthis.fromBufferGeometry( new THREE.SphereBufferGeometry( radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength ) );\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\nTHREE.SphereGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.SphereGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.widthSegments,\r\n\t\tthis.parameters.heightSegments,\r\n\t\tthis.parameters.phiStart,\r\n\t\tthis.parameters.phiLength,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/SphereBufferGeometry.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * based on THREE.SphereGeometry\r\n */\r\n\r\nTHREE.SphereBufferGeometry = function ( radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthis.type = 'SphereBufferGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\tphiStart: phiStart,\r\n\t\tphiLength: phiLength,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradius = radius || 50;\r\n\r\n\twidthSegments = Math.max( 3, Math.floor( widthSegments ) || 8 );\r\n\theightSegments = Math.max( 2, Math.floor( heightSegments ) || 6 );\r\n\r\n\tphiStart = phiStart !== undefined ? phiStart : 0;\r\n\tphiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n\tvar thetaEnd = thetaStart + thetaLength;\r\n\r\n\tvar vertexCount = ( ( widthSegments + 1 ) * ( heightSegments + 1 ) );\r\n\r\n\tvar positions = new THREE.BufferAttribute( new Float32Array( vertexCount * 3 ), 3 );\r\n\tvar normals = new THREE.BufferAttribute( new Float32Array( vertexCount * 3 ), 3 );\r\n\tvar uvs = new THREE.BufferAttribute( new Float32Array( vertexCount * 2 ), 2 );\r\n\r\n\tvar index = 0, vertices = [], normal = new THREE.Vector3();\r\n\r\n\tfor ( var y = 0; y <= heightSegments; y ++ ) {\r\n\r\n\t\tvar verticesRow = [];\r\n\r\n\t\tvar v = y / heightSegments;\r\n\r\n\t\tfor ( var x = 0; x <= widthSegments; x ++ ) {\r\n\r\n\t\t\tvar u = x / widthSegments;\r\n\r\n\t\t\tvar px = - radius * Math.cos( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );\r\n\t\t\tvar py = radius * Math.cos( thetaStart + v * thetaLength );\r\n\t\t\tvar pz = radius * Math.sin( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );\r\n\r\n\t\t\tnormal.set( px, py, pz ).normalize();\r\n\r\n\t\t\tpositions.setXYZ( index, px, py, pz );\r\n\t\t\tnormals.setXYZ( index, normal.x, normal.y, normal.z );\r\n\t\t\tuvs.setXY( index, u, 1 - v );\r\n\r\n\t\t\tverticesRow.push( index );\r\n\r\n\t\t\tindex ++;\r\n\r\n\t\t}\r\n\r\n\t\tvertices.push( verticesRow );\r\n\r\n\t}\r\n\r\n\tvar indices = [];\r\n\r\n\tfor ( var y = 0; y < heightSegments; y ++ ) {\r\n\r\n\t\tfor ( var x = 0; x < widthSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ y ][ x + 1 ];\r\n\t\t\tvar v2 = vertices[ y ][ x ];\r\n\t\t\tvar v3 = vertices[ y + 1 ][ x ];\r\n\t\t\tvar v4 = vertices[ y + 1 ][ x + 1 ];\r\n\r\n\t\t\tif ( y !== 0 || thetaStart > 0 ) indices.push( v1, v2, v4 );\r\n\t\t\tif ( y !== heightSegments - 1 || thetaEnd < Math.PI ) indices.push( v2, v3, v4 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.setIndex( new THREE.BufferAttribute( new Uint16Array( indices ), 1 ) );\r\n\tthis.addAttribute( 'position', positions );\r\n\tthis.addAttribute( 'normal', normals );\r\n\tthis.addAttribute( 'uv', uvs );\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.SphereBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.SphereBufferGeometry.prototype.constructor = THREE.SphereBufferGeometry;\r\n\r\nTHREE.SphereBufferGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.SphereBufferGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.widthSegments,\r\n\t\tthis.parameters.heightSegments,\r\n\t\tthis.parameters.phiStart,\r\n\t\tthis.parameters.phiLength,\r\n\t\tthis.parameters.thetaStart,\r\n\t\tthis.parameters.thetaLength\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function ( text, parameters ) {\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, parameters );\r\n\r\n\t// translate parameters to ExtrudeGeometry API\r\n\r\n\tparameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n\t// defaults\r\n\r\n\tif ( parameters.bevelThickness === undefined ) parameters.bevelThickness = 10;\r\n\tif ( parameters.bevelSize === undefined ) parameters.bevelSize = 8;\r\n\tif ( parameters.bevelEnabled === undefined ) parameters.bevelEnabled = false;\r\n\r\n\tTHREE.ExtrudeGeometry.call( this, textShapes, parameters );\r\n\r\n\tthis.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create( THREE.ExtrudeGeometry.prototype );\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function ( radius, tube, radialSegments, tubularSegments, arc ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TorusGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\ttube: tube,\r\n\t\tradialSegments: radialSegments,\r\n\t\ttubularSegments: tubularSegments,\r\n\t\tarc: arc\r\n\t};\r\n\r\n\tradius = radius || 100;\r\n\ttube = tube || 40;\r\n\tradialSegments = radialSegments || 8;\r\n\ttubularSegments = tubularSegments || 6;\r\n\tarc = arc || Math.PI * 2;\r\n\r\n\tvar center = new THREE.Vector3(), uvs = [], normals = [];\r\n\r\n\tfor ( var j = 0; j <= radialSegments; j ++ ) {\r\n\r\n\t\tfor ( var i = 0; i <= tubularSegments; i ++ ) {\r\n\r\n\t\t\tvar u = i / tubularSegments * arc;\r\n\t\t\tvar v = j / radialSegments * Math.PI * 2;\r\n\r\n\t\t\tcenter.x = radius * Math.cos( u );\r\n\t\t\tcenter.y = radius * Math.sin( u );\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvertex.x = ( radius + tube * Math.cos( v ) ) * Math.cos( u );\r\n\t\t\tvertex.y = ( radius + tube * Math.cos( v ) ) * Math.sin( u );\r\n\t\t\tvertex.z = tube * Math.sin( v );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t\tuvs.push( new THREE.Vector2( i / tubularSegments, j / radialSegments ) );\r\n\t\t\tnormals.push( vertex.clone().sub( center ).normalize() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var j = 1; j <= radialSegments; j ++ ) {\r\n\r\n\t\tfor ( var i = 1; i <= tubularSegments; i ++ ) {\r\n\r\n\t\t\tvar a = ( tubularSegments + 1 ) * j + i - 1;\r\n\t\t\tvar b = ( tubularSegments + 1 ) * ( j - 1 ) + i - 1;\r\n\t\t\tvar c = ( tubularSegments + 1 ) * ( j - 1 ) + i;\r\n\t\t\tvar d = ( tubularSegments + 1 ) * j + i;\r\n\r\n\t\t\tvar face = new THREE.Face3( a, b, d, [ normals[ a ].clone(), normals[ b ].clone(), normals[ d ].clone() ] );\r\n\t\t\tthis.faces.push( face );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ a ].clone(), uvs[ b ].clone(), uvs[ d ].clone() ] );\r\n\r\n\t\t\tface = new THREE.Face3( b, c, d, [ normals[ b ].clone(), normals[ c ].clone(), normals[ d ].clone() ] );\r\n\t\t\tthis.faces.push( face );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ b ].clone(), uvs[ c ].clone(), uvs[ d ].clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\nTHREE.TorusGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.TorusGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.tube,\r\n\t\tthis.parameters.radialSegments,\r\n\t\tthis.parameters.tubularSegments,\r\n\t\tthis.parameters.arc\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function ( radius, tube, radialSegments, tubularSegments, p, q, heightScale ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TorusKnotGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\ttube: tube,\r\n\t\tradialSegments: radialSegments,\r\n\t\ttubularSegments: tubularSegments,\r\n\t\tp: p,\r\n\t\tq: q,\r\n\t\theightScale: heightScale\r\n\t};\r\n\r\n\tradius = radius || 100;\r\n\ttube = tube || 40;\r\n\tradialSegments = radialSegments || 64;\r\n\ttubularSegments = tubularSegments || 8;\r\n\tp = p || 2;\r\n\tq = q || 3;\r\n\theightScale = heightScale || 1;\r\n\r\n\tvar grid = new Array( radialSegments );\r\n\tvar tang = new THREE.Vector3();\r\n\tvar n = new THREE.Vector3();\r\n\tvar bitan = new THREE.Vector3();\r\n\r\n\tfor ( var i = 0; i < radialSegments; ++ i ) {\r\n\r\n\t\tgrid[ i ] = new Array( tubularSegments );\r\n\t\tvar u = i / radialSegments * 2 * p * Math.PI;\r\n\t\tvar p1 = getPos( u, q, p, radius, heightScale );\r\n\t\tvar p2 = getPos( u + 0.01, q, p, radius, heightScale );\r\n\t\ttang.subVectors( p2, p1 );\r\n\t\tn.addVectors( p2, p1 );\r\n\r\n\t\tbitan.crossVectors( tang, n );\r\n\t\tn.crossVectors( bitan, tang );\r\n\t\tbitan.normalize();\r\n\t\tn.normalize();\r\n\r\n\t\tfor ( var j = 0; j < tubularSegments; ++ j ) {\r\n\r\n\t\t\tvar v = j / tubularSegments * 2 * Math.PI;\r\n\t\t\tvar cx = - tube * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.\r\n\t\t\tvar cy = tube * Math.sin( v );\r\n\r\n\t\t\tvar pos = new THREE.Vector3();\r\n\t\t\tpos.x = p1.x + cx * n.x + cy * bitan.x;\r\n\t\t\tpos.y = p1.y + cx * n.y + cy * bitan.y;\r\n\t\t\tpos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n\t\t\tgrid[ i ][ j ] = this.vertices.push( pos ) - 1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var i = 0; i < radialSegments; ++ i ) {\r\n\r\n\t\tfor ( var j = 0; j < tubularSegments; ++ j ) {\r\n\r\n\t\t\tvar ip = ( i + 1 ) % radialSegments;\r\n\t\t\tvar jp = ( j + 1 ) % tubularSegments;\r\n\r\n\t\t\tvar a = grid[ i ][ j ];\r\n\t\t\tvar b = grid[ ip ][ j ];\r\n\t\t\tvar c = grid[ ip ][ jp ];\r\n\t\t\tvar d = grid[ i ][ jp ];\r\n\r\n\t\t\tvar uva = new THREE.Vector2( i / radialSegments, j / tubularSegments );\r\n\t\t\tvar uvb = new THREE.Vector2( ( i + 1 ) / radialSegments, j / tubularSegments );\r\n\t\t\tvar uvc = new THREE.Vector2( ( i + 1 ) / radialSegments, ( j + 1 ) / tubularSegments );\r\n\t\t\tvar uvd = new THREE.Vector2( i / radialSegments, ( j + 1 ) / tubularSegments );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n\tfunction getPos( u, in_q, in_p, radius, heightScale ) {\r\n\r\n\t\tvar cu = Math.cos( u );\r\n\t\tvar su = Math.sin( u );\r\n\t\tvar quOverP = in_q / in_p * u;\r\n\t\tvar cs = Math.cos( quOverP );\r\n\r\n\t\tvar tx = radius * ( 2 + cs ) * 0.5 * cu;\r\n\t\tvar ty = radius * ( 2 + cs ) * su * 0.5;\r\n\t\tvar tz = heightScale * radius * Math.sin( quOverP ) * 0.5;\r\n\r\n\t\treturn new THREE.Vector3( tx, ty, tz );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\nTHREE.TorusKnotGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.TorusKnotGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.tube,\r\n\t\tthis.parameters.radialSegments,\r\n\t\tthis.parameters.tubularSegments,\r\n\t\tthis.parameters.p,\r\n\t\tthis.parameters.q,\r\n\t\tthis.parameters.heightScale\r\n\t);\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function ( path, segments, radius, radialSegments, closed, taper ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TubeGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tpath: path,\r\n\t\tsegments: segments,\r\n\t\tradius: radius,\r\n\t\tradialSegments: radialSegments,\r\n\t\tclosed: closed\r\n\t};\r\n\r\n\tsegments = segments || 64;\r\n\tradius = radius || 1;\r\n\tradialSegments = radialSegments || 8;\r\n\tclosed = closed || false;\r\n\ttaper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n\tvar grid = [];\r\n\r\n\tvar scope = this,\r\n\r\n\t\ttangent,\r\n\t\tnormal,\r\n\t\tbinormal,\r\n\r\n\t\tnumpoints = segments + 1,\r\n\r\n\t\tu, v, r,\r\n\r\n\t\tcx, cy,\r\n\t\tpos, pos2 = new THREE.Vector3(),\r\n\t\ti, j,\r\n\t\tip, jp,\r\n\t\ta, b, c, d,\r\n\t\tuva, uvb, uvc, uvd;\r\n\r\n\tvar frames = new THREE.TubeGeometry.FrenetFrames( path, segments, closed ),\r\n\t\ttangents = frames.tangents,\r\n\t\tnormals = frames.normals,\r\n\t\tbinormals = frames.binormals;\r\n\r\n\t// proxy internals\r\n\tthis.tangents = tangents;\r\n\tthis.normals = normals;\r\n\tthis.binormals = binormals;\r\n\r\n\tfunction vert( x, y, z ) {\r\n\r\n\t\treturn scope.vertices.push( new THREE.Vector3( x, y, z ) ) - 1;\r\n\r\n\t}\r\n\r\n\t// construct the grid\r\n\r\n\tfor ( i = 0; i < numpoints; i ++ ) {\r\n\r\n\t\tgrid[ i ] = [];\r\n\r\n\t\tu = i / ( numpoints - 1 );\r\n\r\n\t\tpos = path.getPointAt( u );\r\n\r\n\t\ttangent = tangents[ i ];\r\n\t\tnormal = normals[ i ];\r\n\t\tbinormal = binormals[ i ];\r\n\r\n\t\tr = radius * taper( u );\r\n\r\n\t\tfor ( j = 0; j < radialSegments; j ++ ) {\r\n\r\n\t\t\tv = j / radialSegments * 2 * Math.PI;\r\n\r\n\t\t\tcx = - r * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.\r\n\t\t\tcy = r * Math.sin( v );\r\n\r\n\t\t\tpos2.copy( pos );\r\n\t\t\tpos2.x += cx * normal.x + cy * binormal.x;\r\n\t\t\tpos2.y += cx * normal.y + cy * binormal.y;\r\n\t\t\tpos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n\t\t\tgrid[ i ][ j ] = vert( pos2.x, pos2.y, pos2.z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// construct the mesh\r\n\r\n\tfor ( i = 0; i < segments; i ++ ) {\r\n\r\n\t\tfor ( j = 0; j < radialSegments; j ++ ) {\r\n\r\n\t\t\tip = ( closed ) ? ( i + 1 ) % segments : i + 1;\r\n\t\t\tjp = ( j + 1 ) % radialSegments;\r\n\r\n\t\t\ta = grid[ i ][ j ];\t\t// *** NOT NECESSARILY PLANAR ! ***\r\n\t\t\tb = grid[ ip ][ j ];\r\n\t\t\tc = grid[ ip ][ jp ];\r\n\t\t\td = grid[ i ][ jp ];\r\n\r\n\t\t\tuva = new THREE.Vector2( i / segments, j / radialSegments );\r\n\t\t\tuvb = new THREE.Vector2( ( i + 1 ) / segments, j / radialSegments );\r\n\t\t\tuvc = new THREE.Vector2( ( i + 1 ) / segments, ( j + 1 ) / radialSegments );\r\n\t\t\tuvd = new THREE.Vector2( i / segments, ( j + 1 ) / radialSegments );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function ( u ) {\r\n\r\n\treturn 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function ( u ) {\r\n\r\n\treturn Math.sin( Math.PI * u );\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function ( path, segments, closed ) {\r\n\r\n\tvar\tnormal = new THREE.Vector3(),\r\n\r\n\t\ttangents = [],\r\n\t\tnormals = [],\r\n\t\tbinormals = [],\r\n\r\n\t\tvec = new THREE.Vector3(),\r\n\t\tmat = new THREE.Matrix4(),\r\n\r\n\t\tnumpoints = segments + 1,\r\n\t\ttheta,\r\n\t\tepsilon = 0.0001,\r\n\t\tsmallest,\r\n\r\n\t\ttx, ty, tz,\r\n\t\ti, u;\r\n\r\n\r\n\t// expose internals\r\n\tthis.tangents = tangents;\r\n\tthis.normals = normals;\r\n\tthis.binormals = binormals;\r\n\r\n\t// compute the tangent vectors for each segment on the path\r\n\r\n\tfor ( i = 0; i < numpoints; i ++ ) {\r\n\r\n\t\tu = i / ( numpoints - 1 );\r\n\r\n\t\ttangents[ i ] = path.getTangentAt( u );\r\n\t\ttangents[ i ].normalize();\r\n\r\n\t}\r\n\r\n\tinitialNormal3();\r\n\r\n\t/*\r\n\tfunction initialNormal1(lastBinormal) {\r\n\t\t// fixed start binormal. Has dangers of 0 vectors\r\n\t\tnormals[ 0 ] = new THREE.Vector3();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3();\r\n\t\tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n\t\tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\t}\r\n\r\n\tfunction initialNormal2() {\r\n\r\n\t\t// This uses the Frenet-Serret formula for deriving binormal\r\n\t\tvar t2 = path.getTangentAt( epsilon );\r\n\r\n\t\tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n\t\tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n\t}\r\n\t*/\r\n\r\n\tfunction initialNormal3() {\r\n\r\n\t\t// select an initial normal vector perpendicular to the first tangent vector,\r\n\t\t// and in the direction of the smallest tangent xyz component\r\n\r\n\t\tnormals[ 0 ] = new THREE.Vector3();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3();\r\n\t\tsmallest = Number.MAX_VALUE;\r\n\t\ttx = Math.abs( tangents[ 0 ].x );\r\n\t\tty = Math.abs( tangents[ 0 ].y );\r\n\t\ttz = Math.abs( tangents[ 0 ].z );\r\n\r\n\t\tif ( tx <= smallest ) {\r\n\r\n\t\t\tsmallest = tx;\r\n\t\t\tnormal.set( 1, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( ty <= smallest ) {\r\n\r\n\t\t\tsmallest = ty;\r\n\t\t\tnormal.set( 0, 1, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( tz <= smallest ) {\r\n\r\n\t\t\tnormal.set( 0, 0, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvec.crossVectors( tangents[ 0 ], normal ).normalize();\r\n\r\n\t\tnormals[ 0 ].crossVectors( tangents[ 0 ], vec );\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n\t}\r\n\r\n\r\n\t// compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n\tfor ( i = 1; i < numpoints; i ++ ) {\r\n\r\n\t\tnormals[ i ] = normals[ i - 1 ].clone();\r\n\r\n\t\tbinormals[ i ] = binormals[ i - 1 ].clone();\r\n\r\n\t\tvec.crossVectors( tangents[ i - 1 ], tangents[ i ] );\r\n\r\n\t\tif ( vec.length() > epsilon ) {\r\n\r\n\t\t\tvec.normalize();\r\n\r\n\t\t\ttheta = Math.acos( THREE.Math.clamp( tangents[ i - 1 ].dot( tangents[ i ] ), - 1, 1 ) ); // clamp for floating pt errors\r\n\r\n\t\t\tnormals[ i ].applyMatrix4( mat.makeRotationAxis( vec, theta ) );\r\n\r\n\t\t}\r\n\r\n\t\tbinormals[ i ].crossVectors( tangents[ i ], normals[ i ] );\r\n\r\n\t}\r\n\r\n\r\n\t// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n\tif ( closed ) {\r\n\r\n\t\ttheta = Math.acos( THREE.Math.clamp( normals[ 0 ].dot( normals[ numpoints - 1 ] ), - 1, 1 ) );\r\n\t\ttheta /= ( numpoints - 1 );\r\n\r\n\t\tif ( tangents[ 0 ].dot( vec.crossVectors( normals[ 0 ], normals[ numpoints - 1 ] ) ) > 0 ) {\r\n\r\n\t\t\ttheta = - theta;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( i = 1; i < numpoints; i ++ ) {\r\n\r\n\t\t\t// twist a little...\r\n\t\t\tnormals[ i ].applyMatrix4( mat.makeRotationAxis( tangents[ i ], theta * i ) );\r\n\t\t\tbinormals[ i ].crossVectors( tangents[ i ], normals[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.PolyhedronGeometry = function ( vertices, indices, radius, detail ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'PolyhedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tvertices: vertices,\r\n\t\tindices: indices,\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n\tradius = radius || 1;\r\n\tdetail = detail || 0;\r\n\r\n\tvar that = this;\r\n\r\n\tfor ( var i = 0, l = vertices.length; i < l; i += 3 ) {\r\n\r\n\t\tprepare( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );\r\n\r\n\t}\r\n\r\n\tvar p = this.vertices;\r\n\r\n\tvar faces = [];\r\n\r\n\tfor ( var i = 0, j = 0, l = indices.length; i < l; i += 3, j ++ ) {\r\n\r\n\t\tvar v1 = p[ indices[ i ] ];\r\n\t\tvar v2 = p[ indices[ i + 1 ] ];\r\n\t\tvar v3 = p[ indices[ i + 2 ] ];\r\n\r\n\t\tfaces[ j ] = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ], undefined, j );\r\n\r\n\t}\r\n\r\n\tvar centroid = new THREE.Vector3();\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tsubdivide( faces[ i ], detail );\r\n\r\n\t}\r\n\r\n\r\n\t// Handle case when face straddles the seam\r\n\r\n\tfor ( var i = 0, l = this.faceVertexUvs[ 0 ].length; i < l; i ++ ) {\r\n\r\n\t\tvar uvs = this.faceVertexUvs[ 0 ][ i ];\r\n\r\n\t\tvar x0 = uvs[ 0 ].x;\r\n\t\tvar x1 = uvs[ 1 ].x;\r\n\t\tvar x2 = uvs[ 2 ].x;\r\n\r\n\t\tvar max = Math.max( x0, Math.max( x1, x2 ) );\r\n\t\tvar min = Math.min( x0, Math.min( x1, x2 ) );\r\n\r\n\t\tif ( max > 0.9 && min < 0.1 ) {\r\n\r\n\t\t\t// 0.9 is somewhat arbitrary\r\n\r\n\t\t\tif ( x0 < 0.2 ) uvs[ 0 ].x += 1;\r\n\t\t\tif ( x1 < 0.2 ) uvs[ 1 ].x += 1;\r\n\t\t\tif ( x2 < 0.2 ) uvs[ 2 ].x += 1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Apply radius\r\n\r\n\tfor ( var i = 0, l = this.vertices.length; i < l; i ++ ) {\r\n\r\n\t\tthis.vertices[ i ].multiplyScalar( radius );\r\n\r\n\t}\r\n\r\n\r\n\t// Merge vertices\r\n\r\n\tthis.mergeVertices();\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n\r\n\t// Project vector onto sphere's surface\r\n\r\n\tfunction prepare( vector ) {\r\n\r\n\t\tvar vertex = vector.normalize().clone();\r\n\t\tvertex.index = that.vertices.push( vertex ) - 1;\r\n\r\n\t\t// Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n\t\tvar u = azimuth( vector ) / 2 / Math.PI + 0.5;\r\n\t\tvar v = inclination( vector ) / Math.PI + 0.5;\r\n\t\tvertex.uv = new THREE.Vector2( u, 1 - v );\r\n\r\n\t\treturn vertex;\r\n\r\n\t}\r\n\r\n\r\n\t// Approximate a curved face with recursively sub-divided triangles.\r\n\r\n\tfunction make( v1, v2, v3, materialIndex ) {\r\n\r\n\t\tvar face = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ], undefined, materialIndex );\r\n\t\tthat.faces.push( face );\r\n\r\n\t\tcentroid.copy( v1 ).add( v2 ).add( v3 ).divideScalar( 3 );\r\n\r\n\t\tvar azi = azimuth( centroid );\r\n\r\n\t\tthat.faceVertexUvs[ 0 ].push( [\r\n\t\t\tcorrectUV( v1.uv, v1, azi ),\r\n\t\t\tcorrectUV( v2.uv, v2, azi ),\r\n\t\t\tcorrectUV( v3.uv, v3, azi )\r\n\t\t] );\r\n\r\n\t}\r\n\r\n\r\n\t// Analytically subdivide a face to the required detail level.\r\n\r\n\tfunction subdivide( face, detail ) {\r\n\r\n\t\tvar cols = Math.pow( 2, detail );\r\n\t\tvar a = prepare( that.vertices[ face.a ] );\r\n\t\tvar b = prepare( that.vertices[ face.b ] );\r\n\t\tvar c = prepare( that.vertices[ face.c ] );\r\n\t\tvar v = [];\r\n\r\n\t\tvar materialIndex = face.materialIndex;\r\n\r\n\t\t// Construct all of the vertices for this subdivision.\r\n\r\n\t\tfor ( var i = 0 ; i <= cols; i ++ ) {\r\n\r\n\t\t\tv[ i ] = [];\r\n\r\n\t\t\tvar aj = prepare( a.clone().lerp( c, i / cols ) );\r\n\t\t\tvar bj = prepare( b.clone().lerp( c, i / cols ) );\r\n\t\t\tvar rows = cols - i;\r\n\r\n\t\t\tfor ( var j = 0; j <= rows; j ++ ) {\r\n\r\n\t\t\t\tif ( j === 0 && i === cols ) {\r\n\r\n\t\t\t\t\tv[ i ][ j ] = aj;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv[ i ][ j ] = prepare( aj.clone().lerp( bj, j / rows ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Construct all of the faces.\r\n\r\n\t\tfor ( var i = 0; i < cols ; i ++ ) {\r\n\r\n\t\t\tfor ( var j = 0; j < 2 * ( cols - i ) - 1; j ++ ) {\r\n\r\n\t\t\t\tvar k = Math.floor( j / 2 );\r\n\r\n\t\t\t\tif ( j % 2 === 0 ) {\r\n\r\n\t\t\t\t\tmake(\r\n\t\t\t\t\t\tv[ i ][ k + 1 ],\r\n\t\t\t\t\t\tv[ i + 1 ][ k ],\r\n\t\t\t\t\t\tv[ i ][ k ],\r\n\t\t\t\t\t\tmaterialIndex\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmake(\r\n\t\t\t\t\t\tv[ i ][ k + 1 ],\r\n\t\t\t\t\t\tv[ i + 1 ][ k + 1 ],\r\n\t\t\t\t\t\tv[ i + 1 ][ k ],\r\n\t\t\t\t\t\tmaterialIndex\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n\tfunction azimuth( vector ) {\r\n\r\n\t\treturn Math.atan2( vector.z, - vector.x );\r\n\r\n\t}\r\n\r\n\r\n\t// Angle above the XZ plane.\r\n\r\n\tfunction inclination( vector ) {\r\n\r\n\t\treturn Math.atan2( - vector.y, Math.sqrt( ( vector.x * vector.x ) + ( vector.z * vector.z ) ) );\r\n\r\n\t}\r\n\r\n\r\n\t// Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n\tfunction correctUV( uv, vector, azimuth ) {\r\n\r\n\t\tif ( ( azimuth < 0 ) && ( uv.x === 1 ) ) uv = new THREE.Vector2( uv.x - 1, uv.y );\r\n\t\tif ( ( vector.x === 0 ) && ( vector.z === 0 ) ) uv = new THREE.Vector2( azimuth / 2 / Math.PI + 0.5, uv.y );\r\n\t\treturn uv.clone();\r\n\r\n\t}\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\nTHREE.PolyhedronGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.PolyhedronGeometry(\r\n\t\tthis.parameters.vertices,\r\n\t\tthis.parameters.indices,\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.detail\r\n\t);\r\n\r\n\treturn geometry.copy( this );\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype.copy = function ( source ) {\r\n\r\n\tTHREE.Geometry.prototype.copy.call( this, source );\r\n\treturn this;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar t = ( 1 + Math.sqrt( 5 ) ) / 2;\r\n\tvar r = 1 / t;\r\n\r\n\tvar vertices = [\r\n\r\n\t\t// (1, 1, 1)\r\n\t\t- 1, - 1, - 1,    - 1, - 1,  1,\r\n\t\t- 1,  1, - 1,    - 1,  1,  1,\r\n\t\t 1, - 1, - 1,     1, - 1,  1,\r\n\t\t 1,  1, - 1,     1,  1,  1,\r\n\r\n\t\t// (0, 1/, )\r\n\t\t 0, - r, - t,     0, - r,  t,\r\n\t\t 0,  r, - t,     0,  r,  t,\r\n\r\n\t\t// (1/, , 0)\r\n\t\t- r, - t,  0,    - r,  t,  0,\r\n\t\t r, - t,  0,     r,  t,  0,\r\n\r\n\t\t// (, 0, 1/)\r\n\t\t- t,  0, - r,     t,  0, - r,\r\n\t\t- t,  0,  r,     t,  0,  r\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 3, 11,  7,      3,  7, 15,      3, 15, 13,\r\n\t\t 7, 19, 17,      7, 17,  6,      7,  6, 15,\r\n\t\t17,  4,  8,     17,  8, 10,     17, 10,  6,\r\n\t\t 8,  0, 16,      8, 16,  2,      8,  2, 10,\r\n\t\t 0, 12,  1,      0,  1, 18,      0, 18, 16,\r\n\t\t 6, 10,  2,      6,  2, 13,      6, 13, 15,\r\n\t\t 2, 16, 18,      2, 18,  3,      2,  3, 13,\r\n\t\t18,  1,  9,     18,  9, 11,     18, 11,  3,\r\n\t\t 4, 14, 12,      4, 12,  0,      4,  0,  8,\r\n\t\t11,  9,  5,     11,  5, 19,     11, 19,  7,\r\n\t\t19,  5, 14,     19, 14,  4,     19,  4, 17,\r\n\t\t 1, 12, 14,      1, 14,  5,      1,  5,  9\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'DodecahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create( THREE.PolyhedronGeometry.prototype );\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\nTHREE.DodecahedronGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.DodecahedronGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.detail\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar t = ( 1 + Math.sqrt( 5 ) ) / 2;\r\n\r\n\tvar vertices = [\r\n\t\t- 1,  t,  0,    1,  t,  0,   - 1, - t,  0,    1, - t,  0,\r\n\t\t 0, - 1,  t,    0,  1,  t,    0, - 1, - t,    0,  1, - t,\r\n\t\t t,  0, - 1,    t,  0,  1,   - t,  0, - 1,   - t,  0,  1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 0, 11,  5,    0,  5,  1,    0,  1,  7,    0,  7, 10,    0, 10, 11,\r\n\t\t 1,  5,  9,    5, 11,  4,   11, 10,  2,   10,  7,  6,    7,  1,  8,\r\n\t\t 3,  9,  4,    3,  4,  2,    3,  2,  6,    3,  6,  8,    3,  8,  9,\r\n\t\t 4,  9,  5,    2,  4, 11,    6,  2, 10,    8,  6,  7,    9,  8,  1\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'IcosahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create( THREE.PolyhedronGeometry.prototype );\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\nTHREE.IcosahedronGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.IcosahedronGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.detail\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar vertices = [\r\n\t\t1, 0, 0,   - 1, 0, 0,    0, 1, 0,    0, - 1, 0,    0, 0, 1,    0, 0, - 1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t0, 2, 4,    0, 4, 3,    0, 3, 5,    0, 5, 2,    1, 2, 5,    1, 5, 3,    1, 3, 4,    1, 4, 2\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'OctahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create( THREE.PolyhedronGeometry.prototype );\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\nTHREE.OctahedronGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.OctahedronGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.detail\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar vertices = [\r\n\t\t 1,  1,  1,   - 1, - 1,  1,   - 1,  1, - 1,    1, - 1, - 1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 2,  1,  0,    0,  3,  2,    1,  3,  0,    2,  3,  1\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'TetrahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create( THREE.PolyhedronGeometry.prototype );\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\nTHREE.TetrahedronGeometry.prototype.clone = function () {\r\n\r\n\tvar geometry = new THREE.TetrahedronGeometry(\r\n\t\tthis.parameters.radius,\r\n\t\tthis.parameters.detail\r\n\t);\r\n\r\n\tgeometry.copy( this );\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function ( func, slices, stacks ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ParametricGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tfunc: func,\r\n\t\tslices: slices,\r\n\t\tstacks: stacks\r\n\t};\r\n\r\n\tvar verts = this.vertices;\r\n\tvar faces = this.faces;\r\n\tvar uvs = this.faceVertexUvs[ 0 ];\r\n\r\n\tvar i, j, p;\r\n\tvar u, v;\r\n\r\n\tvar sliceCount = slices + 1;\r\n\r\n\tfor ( i = 0; i <= stacks; i ++ ) {\r\n\r\n\t\tv = i / stacks;\r\n\r\n\t\tfor ( j = 0; j <= slices; j ++ ) {\r\n\r\n\t\t\tu = j / slices;\r\n\r\n\t\t\tp = func( u, v );\r\n\t\t\tverts.push( p );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar a, b, c, d;\r\n\tvar uva, uvb, uvc, uvd;\r\n\r\n\tfor ( i = 0; i < stacks; i ++ ) {\r\n\r\n\t\tfor ( j = 0; j < slices; j ++ ) {\r\n\r\n\t\t\ta = i * sliceCount + j;\r\n\t\t\tb = i * sliceCount + j + 1;\r\n\t\t\tc = ( i + 1 ) * sliceCount + j + 1;\r\n\t\t\td = ( i + 1 ) * sliceCount + j;\r\n\r\n\t\t\tuva = new THREE.Vector2( j / slices, i / stacks );\r\n\t\t\tuvb = new THREE.Vector2( ( j + 1 ) / slices, i / stacks );\r\n\t\t\tuvc = new THREE.Vector2( ( j + 1 ) / slices, ( i + 1 ) / stacks );\r\n\t\t\tuvd = new THREE.Vector2( j / slices, ( i + 1 ) / stacks );\r\n\r\n\t\t\tfaces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tuvs.push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tfaces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tuvs.push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// console.log(this);\r\n\r\n\t// magic bullet\r\n\t// var diff = this.mergeVertices();\r\n\t// console.log('removed ', diff, ' vertices by merging');\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/geometries/WireframeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeGeometry = function ( geometry ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tvar edge = [ 0, 0 ], hash = {};\r\n\tvar sortFunction = function ( a, b ) {\r\n\r\n\t\treturn a - b;\r\n\r\n\t};\r\n\r\n\tvar keys = [ 'a', 'b', 'c' ];\r\n\r\n\tif ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\t\tvar faces = geometry.faces;\r\n\t\tvar numEdges = 0;\r\n\r\n\t\t// allocate maximal size\r\n\t\tvar edges = new Uint32Array( 6 * faces.length );\r\n\r\n\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\tedge[ 0 ] = face[ keys[ j ] ];\r\n\t\t\t\tedge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];\r\n\t\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\t\tvar key = edge.toString();\r\n\r\n\t\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\t\tedges[ 2 * numEdges ] = edge[ 0 ];\r\n\t\t\t\t\tedges[ 2 * numEdges + 1 ] = edge[ 1 ];\r\n\t\t\t\t\thash[ key ] = true;\r\n\t\t\t\t\tnumEdges ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\tfor ( var i = 0, l = numEdges; i < l; i ++ ) {\r\n\r\n\t\t\tfor ( var j = 0; j < 2; j ++ ) {\r\n\r\n\t\t\t\tvar vertex = vertices[ edges [ 2 * i + j ] ];\r\n\r\n\t\t\t\tvar index = 6 * i + 3 * j;\r\n\t\t\t\tcoords[ index + 0 ] = vertex.x;\r\n\t\t\t\tcoords[ index + 1 ] = vertex.y;\r\n\t\t\t\tcoords[ index + 2 ] = vertex.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t} else if ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\t// Indexed BufferGeometry\r\n\r\n\t\t\tvar indices = geometry.index.array;\r\n\t\t\tvar vertices = geometry.attributes.position;\r\n\t\t\tvar drawcalls = geometry.drawcalls;\r\n\t\t\tvar numEdges = 0;\r\n\r\n\t\t\tif ( drawcalls.length === 0 ) {\r\n\r\n\t\t\t\tgeometry.addDrawCall( 0, indices.length );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// allocate maximal size\r\n\t\t\tvar edges = new Uint32Array( 2 * indices.length );\r\n\r\n\t\t\tfor ( var o = 0, ol = drawcalls.length; o < ol; ++ o ) {\r\n\r\n\t\t\t\tvar drawcall = drawcalls[ o ];\r\n\r\n\t\t\t\tvar start = drawcall.start;\r\n\t\t\t\tvar count = drawcall.count;\r\n\r\n\t\t\t\tfor ( var i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\t\tedge[ 0 ] = indices[ i + j ];\r\n\t\t\t\t\t\tedge[ 1 ] = indices[ i + ( j + 1 ) % 3 ];\r\n\t\t\t\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\t\t\t\tvar key = edge.toString();\r\n\r\n\t\t\t\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\tedges[ 2 * numEdges ] = edge[ 0 ];\r\n\t\t\t\t\t\t\tedges[ 2 * numEdges + 1 ] = edge[ 1 ];\r\n\t\t\t\t\t\t\thash[ key ] = true;\r\n\t\t\t\t\t\t\tnumEdges ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\t\tfor ( var i = 0, l = numEdges; i < l; i ++ ) {\r\n\r\n\t\t\t\tfor ( var j = 0; j < 2; j ++ ) {\r\n\r\n\t\t\t\t\tvar index = 6 * i + 3 * j;\r\n\t\t\t\t\tvar index2 = edges[ 2 * i + j ];\r\n\r\n\t\t\t\t\tcoords[ index + 0 ] = vertices.getX( index2 );\r\n\t\t\t\t\tcoords[ index + 1 ] = vertices.getY( index2 );\r\n\t\t\t\t\tcoords[ index + 2 ] = vertices.getZ( index2 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// non-indexed BufferGeometry\r\n\r\n\t\t\tvar vertices = geometry.attributes.position.array;\r\n\t\t\tvar numEdges = vertices.length / 3;\r\n\t\t\tvar numTris = numEdges / 3;\r\n\r\n\t\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\t\tfor ( var i = 0, l = numTris; i < l; i ++ ) {\r\n\r\n\t\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\tvar index = 18 * i + 6 * j;\r\n\r\n\t\t\t\t\tvar index1 = 9 * i + 3 * j;\r\n\t\t\t\t\tcoords[ index + 0 ] = vertices[ index1 ];\r\n\t\t\t\t\tcoords[ index + 1 ] = vertices[ index1 + 1 ];\r\n\t\t\t\t\tcoords[ index + 2 ] = vertices[ index1 + 2 ];\r\n\r\n\t\t\t\t\tvar index2 = 9 * i + 3 * ( ( j + 1 ) % 3 );\r\n\t\t\t\t\tcoords[ index + 3 ] = vertices[ index2 ];\r\n\t\t\t\t\tcoords[ index + 4 ] = vertices[ index2 + 1 ];\r\n\t\t\t\t\tcoords[ index + 5 ] = vertices[ index2 + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.WireframeGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.WireframeGeometry.prototype.constructor = THREE.WireframeGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function ( size ) {\r\n\r\n\tsize = size || 1;\r\n\r\n\tvar vertices = new Float32Array( [\r\n\t\t0, 0, 0,  size, 0, 0,\r\n\t\t0, 0, 0,  0, size, 0,\r\n\t\t0, 0, 0,  0, 0, size\r\n\t] );\r\n\r\n\tvar colors = new Float32Array( [\r\n\t\t1, 0, 0,  1, 0.6, 0,\r\n\t\t0, 1, 0,  0.6, 1, 0,\r\n\t\t0, 0, 1,  0, 0.6, 1\r\n\t] );\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tgeometry.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );\r\n\r\n\tTHREE.LineSegments.call( this, geometry, material );\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = ( function () {\r\n\r\n\tvar lineGeometry = new THREE.Geometry();\r\n\tlineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 1, 0 ) );\r\n\r\n\tvar coneGeometry = new THREE.CylinderGeometry( 0, 0.5, 1, 5, 1 );\r\n\tconeGeometry.translate( 0, - 0.5, 0 );\r\n\r\n\treturn function ArrowHelper( dir, origin, length, color, headLength, headWidth ) {\r\n\r\n\t\t// dir is assumed to be normalized\r\n\r\n\t\tTHREE.Object3D.call( this );\r\n\r\n\t\tif ( color === undefined ) color = 0xffff00;\r\n\t\tif ( length === undefined ) length = 1;\r\n\t\tif ( headLength === undefined ) headLength = 0.2 * length;\r\n\t\tif ( headWidth === undefined ) headWidth = 0.2 * headLength;\r\n\r\n\t\tthis.position.copy( origin );\r\n\t\t\r\n\t\tif ( headLength < length ) {\r\n\t\t\tthis.line = new THREE.Line( lineGeometry, new THREE.LineBasicMaterial( { color: color } ) );\r\n\t\t\tthis.line.matrixAutoUpdate = false;\r\n\t\t\tthis.add( this.line );\r\n\t\t}\r\n\r\n\t\tthis.cone = new THREE.Mesh( coneGeometry, new THREE.MeshBasicMaterial( { color: color } ) );\r\n\t\tthis.cone.matrixAutoUpdate = false;\r\n\t\tthis.add( this.cone );\r\n\r\n\t\tthis.setDirection( dir );\r\n\t\tthis.setLength( length, headLength, headWidth );\r\n\r\n\t}\r\n\r\n}() );\r\n\r\nTHREE.ArrowHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = ( function () {\r\n\r\n\tvar axis = new THREE.Vector3();\r\n\tvar radians;\r\n\r\n\treturn function setDirection( dir ) {\r\n\r\n\t\t// dir is assumed to be normalized\r\n\r\n\t\tif ( dir.y > 0.99999 ) {\r\n\r\n\t\t\tthis.quaternion.set( 0, 0, 0, 1 );\r\n\r\n\t\t} else if ( dir.y < - 0.99999 ) {\r\n\r\n\t\t\tthis.quaternion.set( 1, 0, 0, 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\taxis.set( dir.z, 0, - dir.x ).normalize();\r\n\r\n\t\t\tradians = Math.acos( dir.y );\r\n\r\n\t\t\tthis.quaternion.setFromAxisAngle( axis, radians );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function ( length, headLength, headWidth ) {\r\n\r\n\tif ( headLength === undefined ) headLength = 0.2 * length;\r\n\tif ( headWidth === undefined ) headWidth = 0.2 * headLength;\r\n\r\n\tif ( headLength < length ){\r\n\t\tthis.line.scale.set( 1, length - headLength, 1 );\r\n\t\tthis.line.updateMatrix();\r\n\t}\r\n\r\n\tthis.cone.scale.set( headWidth, headLength, headWidth );\r\n\tthis.cone.position.y = length;\r\n\tthis.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function ( color ) {\r\n\r\n\tif ( this.line !== undefined ) this.line.material.color.set( color );\r\n\tthis.cone.material.color.set( color );\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function ( object ) {\r\n\r\n\tvar indices = new Uint16Array( [ 0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7 ] );\r\n\tvar positions = new Float32Array( 8 * 3 );\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.setIndex( new THREE.BufferAttribute( indices, 1 ) );\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\r\n\r\n\tTHREE.LineSegments.call( this, geometry, new THREE.LineBasicMaterial( { color: 0xffff00 } ) );\r\n\r\n\tif ( object !== undefined ) {\r\n\r\n\t\tthis.update( object );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = ( function () {\r\n\r\n\tvar box = new THREE.Box3();\r\n\r\n\treturn function ( object ) {\r\n\r\n\t\tbox.setFromObject( object );\r\n\r\n\t\tif ( box.empty() ) return;\r\n\r\n\t\tvar min = box.min;\r\n\t\tvar max = box.max;\r\n\r\n\t\t/*\r\n\t\t  5____4\r\n\t\t1/___0/|\r\n\t\t| 6__|_7\r\n\t\t2/___3/\r\n\r\n\t\t0: max.x, max.y, max.z\r\n\t\t1: min.x, max.y, max.z\r\n\t\t2: min.x, min.y, max.z\r\n\t\t3: max.x, min.y, max.z\r\n\t\t4: max.x, max.y, min.z\r\n\t\t5: min.x, max.y, min.z\r\n\t\t6: min.x, min.y, min.z\r\n\t\t7: max.x, min.y, min.z\r\n\t\t*/\r\n\r\n\t\tvar position = this.geometry.attributes.position;\r\n\t\tvar array = position.array;\r\n\r\n\t\tarray[  0 ] = max.x; array[  1 ] = max.y; array[  2 ] = max.z;\r\n\t\tarray[  3 ] = min.x; array[  4 ] = max.y; array[  5 ] = max.z;\r\n\t\tarray[  6 ] = min.x; array[  7 ] = min.y; array[  8 ] = max.z;\r\n\t\tarray[  9 ] = max.x; array[ 10 ] = min.y; array[ 11 ] = max.z;\r\n\t\tarray[ 12 ] = max.x; array[ 13 ] = max.y; array[ 14 ] = min.z;\r\n\t\tarray[ 15 ] = min.x; array[ 16 ] = max.y; array[ 17 ] = min.z;\r\n\t\tarray[ 18 ] = min.x; array[ 19 ] = min.y; array[ 20 ] = min.z;\r\n\t\tarray[ 21 ] = max.x; array[ 22 ] = min.y; array[ 23 ] = min.z;\r\n\r\n\t\tposition.needsUpdate = true;\r\n\r\n\t\tthis.geometry.computeBoundingSphere();\r\n\r\n\t}\r\n\r\n} )();\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function ( object, hex ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0x888888;\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.box = new THREE.Box3();\r\n\r\n\tTHREE.Mesh.call( this, new THREE.BoxGeometry( 1, 1, 1 ), new THREE.MeshBasicMaterial( { color: color, wireframe: true } ) );\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function () {\r\n\r\n\tthis.box.setFromObject( this.object );\r\n\r\n\tthis.box.size( this.scale );\r\n\r\n\tthis.box.center( this.position );\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function ( camera ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tvar material = new THREE.LineBasicMaterial( { color: 0xffffff, vertexColors: THREE.FaceColors } );\r\n\r\n\tvar pointMap = {};\r\n\r\n\t// colors\r\n\r\n\tvar hexFrustum = 0xffaa00;\r\n\tvar hexCone = 0xff0000;\r\n\tvar hexUp = 0x00aaff;\r\n\tvar hexTarget = 0xffffff;\r\n\tvar hexCross = 0x333333;\r\n\r\n\t// near\r\n\r\n\taddLine( \"n1\", \"n2\", hexFrustum );\r\n\taddLine( \"n2\", \"n4\", hexFrustum );\r\n\taddLine( \"n4\", \"n3\", hexFrustum );\r\n\taddLine( \"n3\", \"n1\", hexFrustum );\r\n\r\n\t// far\r\n\r\n\taddLine( \"f1\", \"f2\", hexFrustum );\r\n\taddLine( \"f2\", \"f4\", hexFrustum );\r\n\taddLine( \"f4\", \"f3\", hexFrustum );\r\n\taddLine( \"f3\", \"f1\", hexFrustum );\r\n\r\n\t// sides\r\n\r\n\taddLine( \"n1\", \"f1\", hexFrustum );\r\n\taddLine( \"n2\", \"f2\", hexFrustum );\r\n\taddLine( \"n3\", \"f3\", hexFrustum );\r\n\taddLine( \"n4\", \"f4\", hexFrustum );\r\n\r\n\t// cone\r\n\r\n\taddLine( \"p\", \"n1\", hexCone );\r\n\taddLine( \"p\", \"n2\", hexCone );\r\n\taddLine( \"p\", \"n3\", hexCone );\r\n\taddLine( \"p\", \"n4\", hexCone );\r\n\r\n\t// up\r\n\r\n\taddLine( \"u1\", \"u2\", hexUp );\r\n\taddLine( \"u2\", \"u3\", hexUp );\r\n\taddLine( \"u3\", \"u1\", hexUp );\r\n\r\n\t// target\r\n\r\n\taddLine( \"c\", \"t\", hexTarget );\r\n\taddLine( \"p\", \"c\", hexCross );\r\n\r\n\t// cross\r\n\r\n\taddLine( \"cn1\", \"cn2\", hexCross );\r\n\taddLine( \"cn3\", \"cn4\", hexCross );\r\n\r\n\taddLine( \"cf1\", \"cf2\", hexCross );\r\n\taddLine( \"cf3\", \"cf4\", hexCross );\r\n\r\n\tfunction addLine( a, b, hex ) {\r\n\r\n\t\taddPoint( a, hex );\r\n\t\taddPoint( b, hex );\r\n\r\n\t}\r\n\r\n\tfunction addPoint( id, hex ) {\r\n\r\n\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\tgeometry.colors.push( new THREE.Color( hex ) );\r\n\r\n\t\tif ( pointMap[ id ] === undefined ) {\r\n\r\n\t\t\tpointMap[ id ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tpointMap[ id ].push( geometry.vertices.length - 1 );\r\n\r\n\t}\r\n\r\n\tTHREE.LineSegments.call( this, geometry, material );\r\n\r\n\tthis.camera = camera;\r\n\tthis.matrix = camera.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.pointMap = pointMap;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function () {\r\n\r\n\tvar geometry, pointMap;\r\n\r\n\tvar vector = new THREE.Vector3();\r\n\tvar camera = new THREE.Camera();\r\n\r\n\tvar setPoint = function ( point, x, y, z ) {\r\n\r\n\t\tvector.set( x, y, z ).unproject( camera );\r\n\r\n\t\tvar points = pointMap[ point ];\r\n\r\n\t\tif ( points !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgeometry.vertices[ points[ i ] ].copy( vector );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn function () {\r\n\r\n\t\tgeometry = this.geometry;\r\n\t\tpointMap = this.pointMap;\r\n\r\n\t\tvar w = 1, h = 1;\r\n\r\n\t\t// we need just camera projection matrix\r\n\t\t// world matrix must be identity\r\n\r\n\t\tcamera.projectionMatrix.copy( this.camera.projectionMatrix );\r\n\r\n\t\t// center / target\r\n\r\n\t\tsetPoint( \"c\", 0, 0, - 1 );\r\n\t\tsetPoint( \"t\", 0, 0,  1 );\r\n\r\n\t\t// near\r\n\r\n\t\tsetPoint( \"n1\", - w, - h, - 1 );\r\n\t\tsetPoint( \"n2\",   w, - h, - 1 );\r\n\t\tsetPoint( \"n3\", - w,   h, - 1 );\r\n\t\tsetPoint( \"n4\",   w,   h, - 1 );\r\n\r\n\t\t// far\r\n\r\n\t\tsetPoint( \"f1\", - w, - h, 1 );\r\n\t\tsetPoint( \"f2\",   w, - h, 1 );\r\n\t\tsetPoint( \"f3\", - w,   h, 1 );\r\n\t\tsetPoint( \"f4\",   w,   h, 1 );\r\n\r\n\t\t// up\r\n\r\n\t\tsetPoint( \"u1\",   w * 0.7, h * 1.1, - 1 );\r\n\t\tsetPoint( \"u2\", - w * 0.7, h * 1.1, - 1 );\r\n\t\tsetPoint( \"u3\",         0, h * 2,   - 1 );\r\n\r\n\t\t// cross\r\n\r\n\t\tsetPoint( \"cf1\", - w,   0, 1 );\r\n\t\tsetPoint( \"cf2\",   w,   0, 1 );\r\n\t\tsetPoint( \"cf3\",   0, - h, 1 );\r\n\t\tsetPoint( \"cf4\",   0,   h, 1 );\r\n\r\n\t\tsetPoint( \"cn1\", - w,   0, - 1 );\r\n\t\tsetPoint( \"cn2\",   w,   0, - 1 );\r\n\t\tsetPoint( \"cn3\",   0, - h, - 1 );\r\n\t\tsetPoint( \"cn4\",   0,   h, - 1 );\r\n\r\n\t\tgeometry.verticesNeedUpdate = true;\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function ( light, size ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tsize = size || 1;\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tgeometry.vertices.push(\r\n\t\tnew THREE.Vector3( - size,   size, 0 ),\r\n\t\tnew THREE.Vector3(   size,   size, 0 ),\r\n\t\tnew THREE.Vector3(   size, - size, 0 ),\r\n\t\tnew THREE.Vector3( - size, - size, 0 ),\r\n\t\tnew THREE.Vector3( - size,   size, 0 )\r\n\t);\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tthis.lightPlane = new THREE.Line( geometry, material );\r\n\tthis.add( this.lightPlane );\r\n\r\n\tgeometry = new THREE.Geometry();\r\n\tgeometry.vertices.push(\r\n\t\tnew THREE.Vector3(),\r\n\t\tnew THREE.Vector3()\r\n\t);\r\n\r\n\tmaterial = new THREE.LineBasicMaterial( { fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tthis.targetLine = new THREE.Line( geometry, material );\r\n\tthis.add( this.targetLine );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.lightPlane.geometry.dispose();\r\n\tthis.lightPlane.material.dispose();\r\n\tthis.targetLine.geometry.dispose();\r\n\tthis.targetLine.material.dispose();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\tvar v3 = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tv1.setFromMatrixPosition( this.light.matrixWorld );\r\n\t\tv2.setFromMatrixPosition( this.light.target.matrixWorld );\r\n\t\tv3.subVectors( v2, v1 );\r\n\r\n\t\tthis.lightPlane.lookAt( v3 );\r\n\t\tthis.lightPlane.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t\tthis.targetLine.geometry.vertices[ 1 ].copy( v3 );\r\n\t\tthis.targetLine.geometry.verticesNeedUpdate = true;\r\n\t\tthis.targetLine.material.color.copy( this.lightPlane.material.color );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimum angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function ( object, hex, thresholdAngle ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffffff;\r\n\r\n\tTHREE.LineSegments.call( this, new THREE.EdgesGeometry( object.geometry, thresholdAngle ), new THREE.LineBasicMaterial( { color: color } ) );\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.FaceNormalsHelper = function ( object, size, hex, linewidth ) {\r\n\r\n\t// FaceNormalsHelper only supports THREE.Geometry\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.size = ( size !== undefined ) ? size : 1;\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffff00;\r\n\r\n\tvar width = ( linewidth !== undefined ) ? linewidth : 1;\r\n\r\n\t//\r\n\r\n\tvar nNormals = 0;\r\n\r\n\tvar objGeometry = this.object.geometry;\r\n\r\n\tif ( objGeometry instanceof THREE.Geometry ) {\r\n\r\n\t\tnNormals = objGeometry.faces.length;\r\n\r\n\t} else {\r\n\r\n\t\tconsole.warn( 'THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.' );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\tvar positions = new THREE.Float32Attribute( nNormals * 2 * 3, 3 );\r\n\r\n\tgeometry.addAttribute( 'position', positions );\r\n\r\n\tTHREE.LineSegments.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ) );\r\n\r\n\t//\r\n\r\n\tthis.matrixAutoUpdate = false;\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = ( function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\tvar normalMatrix = new THREE.Matrix3();\r\n\r\n\treturn function update() {\r\n\r\n\t\tthis.object.updateMatrixWorld( true );\r\n\r\n\t\tnormalMatrix.getNormalMatrix( this.object.matrixWorld );\r\n\r\n\t\tvar matrixWorld = this.object.matrixWorld;\r\n\r\n\t\tvar position = this.geometry.attributes.position;\r\n\r\n\t\t//\r\n\r\n\t\tvar objGeometry = this.object.geometry;\r\n\r\n\t\tvar vertices = objGeometry.vertices;\r\n\r\n\t\tvar faces = objGeometry.faces;\r\n\r\n\t\tvar idx = 0;\r\n\r\n\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tvar normal = face.normal;\r\n\r\n\t\t\tv1.copy( vertices[ face.a ] )\r\n\t\t\t\t.add( vertices[ face.b ] )\r\n\t\t\t\t.add( vertices[ face.c ] )\r\n\t\t\t\t.divideScalar( 3 )\r\n\t\t\t\t.applyMatrix4( matrixWorld );\r\n\r\n\t\t\tv2.copy( normal ).applyMatrix3( normalMatrix ).normalize().multiplyScalar( this.size ).add( v1 );\r\n\r\n\t\t\tposition.setXYZ( idx, v1.x, v1.y, v1.z );\r\n\r\n\t\t\tidx = idx + 1;\r\n\r\n\t\t\tposition.setXYZ( idx, v2.x, v2.y, v2.z );\r\n\r\n\t\t\tidx = idx + 1;\r\n\r\n\t\t}\r\n\r\n\t\tposition.needsUpdate = true;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}() );\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function ( size, step ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );\r\n\r\n\tthis.color1 = new THREE.Color( 0x444444 );\r\n\tthis.color2 = new THREE.Color( 0x888888 );\r\n\r\n\tfor ( var i = - size; i <= size; i += step ) {\r\n\r\n\t\tgeometry.vertices.push(\r\n\t\t\tnew THREE.Vector3( - size, 0, i ), new THREE.Vector3( size, 0, i ),\r\n\t\t\tnew THREE.Vector3( i, 0, - size ), new THREE.Vector3( i, 0, size )\r\n\t\t);\r\n\r\n\t\tvar color = i === 0 ? this.color1 : this.color2;\r\n\r\n\t\tgeometry.colors.push( color, color, color, color );\r\n\r\n\t}\r\n\r\n\tTHREE.LineSegments.call( this, geometry, material );\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function( colorCenterLine, colorGrid ) {\r\n\r\n\tthis.color1.set( colorCenterLine );\r\n\tthis.color2.set( colorGrid );\r\n\r\n\tthis.geometry.colorsNeedUpdate = true;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function ( light, sphereSize ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.colors = [ new THREE.Color(), new THREE.Color() ];\r\n\r\n\tvar geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );\r\n\tgeometry.rotateX( - Math.PI / 2 );\r\n\r\n\tfor ( var i = 0, il = 8; i < il; i ++ ) {\r\n\r\n\t\tgeometry.faces[ i ].color = this.colors[ i < 4 ? 0 : 1 ];\r\n\r\n\t}\r\n\r\n\tvar material = new THREE.MeshBasicMaterial( { vertexColors: THREE.FaceColors, wireframe: true } );\r\n\r\n\tthis.lightSphere = new THREE.Mesh( geometry, material );\r\n\tthis.add( this.lightSphere );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.lightSphere.geometry.dispose();\r\n\tthis.lightSphere.material.dispose();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function () {\r\n\r\n\tvar vector = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tthis.colors[ 0 ].copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\t\tthis.colors[ 1 ].copy( this.light.groundColor ).multiplyScalar( this.light.intensity );\r\n\r\n\t\tthis.lightSphere.lookAt( vector.setFromMatrixPosition( this.light.matrixWorld ).negate() );\r\n\t\tthis.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n\t}\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function ( light, sphereSize ) {\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tvar geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );\r\n\tvar material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.matrix = this.light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\t/*\r\n\tvar distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n\tvar distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n\tthis.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n\tthis.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n\tvar d = light.distance;\r\n\r\n\tif ( d === 0.0 ) {\r\n\r\n\t\tthis.lightDistance.visible = false;\r\n\r\n\t} else {\r\n\r\n\t\tthis.lightDistance.scale.set( d, d, d );\r\n\r\n\t}\r\n\r\n\tthis.add( this.lightDistance );\r\n\t*/\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.geometry.dispose();\r\n\tthis.material.dispose();\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function () {\r\n\r\n\tthis.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t/*\r\n\tvar d = this.light.distance;\r\n\r\n\tif ( d === 0.0 ) {\r\n\r\n\t\tthis.lightDistance.visible = false;\r\n\r\n\t} else {\r\n\r\n\t\tthis.lightDistance.visible = true;\r\n\t\tthis.lightDistance.scale.set( d, d, d );\r\n\r\n\t}\r\n\t*/\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function ( object ) {\r\n\r\n\tthis.bones = this.getBoneList( object );\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tfor ( var i = 0; i < this.bones.length; i ++ ) {\r\n\r\n\t\tvar bone = this.bones[ i ];\r\n\r\n\t\tif ( bone.parent instanceof THREE.Bone ) {\r\n\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\t\tgeometry.colors.push( new THREE.Color( 0, 0, 1 ) );\r\n\t\t\tgeometry.colors.push( new THREE.Color( 0, 1, 0 ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.dynamic = true;\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors, depthTest: false, depthWrite: false, transparent: true } );\r\n\r\n\tTHREE.LineSegments.call( this, geometry, material );\r\n\r\n\tthis.root = object;\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function( object ) {\r\n\r\n\tvar boneList = [];\r\n\r\n\tif ( object instanceof THREE.Bone ) {\r\n\r\n\t\tboneList.push( object );\r\n\r\n\t}\r\n\r\n\tfor ( var i = 0; i < object.children.length; i ++ ) {\r\n\r\n\t\tboneList.push.apply( boneList, this.getBoneList( object.children[ i ] ) );\r\n\r\n\t}\r\n\r\n\treturn boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function () {\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tvar matrixWorldInv = new THREE.Matrix4().getInverse( this.root.matrixWorld );\r\n\r\n\tvar boneMatrix = new THREE.Matrix4();\r\n\r\n\tvar j = 0;\r\n\r\n\tfor ( var i = 0; i < this.bones.length; i ++ ) {\r\n\r\n\t\tvar bone = this.bones[ i ];\r\n\r\n\t\tif ( bone.parent instanceof THREE.Bone ) {\r\n\r\n\t\t\tboneMatrix.multiplyMatrices( matrixWorldInv, bone.matrixWorld );\r\n\t\t\tgeometry.vertices[ j ].setFromMatrixPosition( boneMatrix );\r\n\r\n\t\t\tboneMatrix.multiplyMatrices( matrixWorldInv, bone.parent.matrixWorld );\r\n\t\t\tgeometry.vertices[ j + 1 ].setFromMatrixPosition( boneMatrix );\r\n\r\n\t\t\tj += 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.verticesNeedUpdate = true;\r\n\r\n\tgeometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.SpotLightHelper = function ( light ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tvar geometry = new THREE.CylinderGeometry( 0, 1, 1, 8, 1, true );\r\n\r\n\tgeometry.translate( 0, - 0.5, 0 );\r\n\tgeometry.rotateX( - Math.PI / 2 );\r\n\r\n\tvar material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );\r\n\r\n\tthis.cone = new THREE.Mesh( geometry, material );\r\n\tthis.add( this.cone );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.cone.geometry.dispose();\r\n\tthis.cone.material.dispose();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function () {\r\n\r\n\tvar vector = new THREE.Vector3();\r\n\tvar vector2 = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tvar coneLength = this.light.distance ? this.light.distance : 10000;\r\n\t\tvar coneWidth = coneLength * Math.tan( this.light.angle );\r\n\r\n\t\tthis.cone.scale.set( coneWidth, coneWidth, coneLength );\r\n\r\n\t\tvector.setFromMatrixPosition( this.light.matrixWorld );\r\n\t\tvector2.setFromMatrixPosition( this.light.target.matrixWorld );\r\n\r\n\t\tthis.cone.lookAt( vector2.sub( vector ) );\r\n\r\n\t\tthis.cone.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.VertexNormalsHelper = function ( object, size, hex, linewidth ) {\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.size = ( size !== undefined ) ? size : 1;\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xff0000;\r\n\r\n\tvar width = ( linewidth !== undefined ) ? linewidth : 1;\r\n\r\n\t//\r\n\r\n\tvar nNormals = 0;\r\n\r\n\tvar objGeometry = this.object.geometry;\r\n\r\n\tif ( objGeometry instanceof THREE.Geometry ) {\r\n\r\n\t\tnNormals = objGeometry.faces.length * 3;\r\n\r\n\t} else if ( objGeometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\tnNormals = objGeometry.attributes.normal.count\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\tvar positions = new THREE.Float32Attribute( nNormals * 2 * 3, 3 );\r\n\r\n\tgeometry.addAttribute( 'position', positions );\r\n\r\n\tTHREE.LineSegments.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ) );\r\n\r\n\t//\r\n\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = ( function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\tvar normalMatrix = new THREE.Matrix3();\r\n\r\n\treturn function update() {\r\n\r\n\t\tvar keys = [ 'a', 'b', 'c' ];\r\n\r\n\t\tthis.object.updateMatrixWorld( true );\r\n\r\n\t\tnormalMatrix.getNormalMatrix( this.object.matrixWorld );\r\n\r\n\t\tvar matrixWorld = this.object.matrixWorld;\r\n\r\n\t\tvar position = this.geometry.attributes.position;\r\n\r\n\t\t//\r\n\r\n\t\tvar objGeometry = this.object.geometry;\r\n\r\n\t\tif ( objGeometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tvar vertices = objGeometry.vertices;\r\n\r\n\t\t\tvar faces = objGeometry.faces;\r\n\r\n\t\t\tvar idx = 0;\r\n\r\n\t\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\t\tfor ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar vertex = vertices[ face[ keys[ j ] ] ];\r\n\r\n\t\t\t\t\tvar normal = face.vertexNormals[ j ];\r\n\r\n\t\t\t\t\tv1.copy( vertex ).applyMatrix4( matrixWorld );\r\n\r\n\t\t\t\t\tv2.copy( normal ).applyMatrix3( normalMatrix ).normalize().multiplyScalar( this.size ).add( v1 );\r\n\r\n\t\t\t\t\tposition.setXYZ( idx, v1.x, v1.y, v1.z );\r\n\r\n\t\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t\t\tposition.setXYZ( idx, v2.x, v2.y, v2.z );\r\n\r\n\t\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( objGeometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar objPos = objGeometry.attributes.position;\r\n\r\n\t\t\tvar objNorm = objGeometry.attributes.normal;\r\n\r\n\t\t\tvar idx = 0;\r\n\r\n\t\t\t// for simplicity, ignore index and drawcalls, and render every normal\r\n\r\n\t\t\tfor ( var j = 0, jl = objPos.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\tv1.set( objPos.getX( j ), objPos.getY( j ), objPos.getZ( j ) ).applyMatrix4( matrixWorld );\r\n\r\n\t\t\t\tv2.set( objNorm.getX( j ), objNorm.getY( j ), objNorm.getZ( j ) );\r\n\r\n\t\t\t\tv2.applyMatrix3( normalMatrix ).normalize().multiplyScalar( this.size ).add( v1 );\r\n\r\n\t\t\t\tposition.setXYZ( idx, v1.x, v1.y, v1.z );\r\n\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t\tposition.setXYZ( idx, v2.x, v2.y, v2.z );\r\n\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tposition.needsUpdate = true;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}() );\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function ( object, hex ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffffff;\r\n\r\n\tTHREE.LineSegments.call( this, new THREE.WireframeGeometry( object.geometry ), new THREE.LineBasicMaterial( { color: color } ) );\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create( THREE.LineSegments.prototype );\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.render = function ( renderCallback ) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function( geometry, material ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.animationsMap = {};\r\n\tthis.animationsList = [];\r\n\r\n\t// prepare default animation\r\n\t// (all frames played together in 1 second)\r\n\r\n\tvar numFrames = this.geometry.morphTargets.length;\r\n\r\n\tvar name = \"__default\";\r\n\r\n\tvar startFrame = 0;\r\n\tvar endFrame = numFrames - 1;\r\n\r\n\tvar fps = numFrames / 1;\r\n\r\n\tthis.createAnimation( name, startFrame, endFrame, fps );\r\n\tthis.setAnimationWeight( name, 1 );\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function ( name, start, end, fps ) {\r\n\r\n\tvar animation = {\r\n\r\n\t\tstart: start,\r\n\t\tend: end,\r\n\r\n\t\tlength: end - start + 1,\r\n\r\n\t\tfps: fps,\r\n\t\tduration: ( end - start ) / fps,\r\n\r\n\t\tlastFrame: 0,\r\n\t\tcurrentFrame: 0,\r\n\r\n\t\tactive: false,\r\n\r\n\t\ttime: 0,\r\n\t\tdirection: 1,\r\n\t\tweight: 1,\r\n\r\n\t\tdirectionBackwards: false,\r\n\t\tmirroredLoop: false\r\n\r\n\t};\r\n\r\n\tthis.animationsMap[ name ] = animation;\r\n\tthis.animationsList.push( animation );\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function ( fps ) {\r\n\r\n\tvar pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n\tvar firstAnimation, frameRanges = {};\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tfor ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\tvar morph = geometry.morphTargets[ i ];\r\n\t\tvar chunks = morph.name.match( pattern );\r\n\r\n\t\tif ( chunks && chunks.length > 1 ) {\r\n\r\n\t\t\tvar name = chunks[ 1 ];\r\n\r\n\t\t\tif ( ! frameRanges[ name ] ) frameRanges[ name ] = { start: Infinity, end: - Infinity };\r\n\r\n\t\t\tvar range = frameRanges[ name ];\r\n\r\n\t\t\tif ( i < range.start ) range.start = i;\r\n\t\t\tif ( i > range.end ) range.end = i;\r\n\r\n\t\t\tif ( ! firstAnimation ) firstAnimation = name;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var name in frameRanges ) {\r\n\r\n\t\tvar range = frameRanges[ name ];\r\n\t\tthis.createAnimation( name, range.start, range.end, fps );\r\n\r\n\t}\r\n\r\n\tthis.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.direction = 1;\r\n\t\tanimation.directionBackwards = false;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.direction = - 1;\r\n\t\tanimation.directionBackwards = true;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function ( name, fps ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.fps = fps;\r\n\t\tanimation.duration = ( animation.end - animation.start ) / animation.fps;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function ( name, duration ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.duration = duration;\r\n\t\tanimation.fps = ( animation.end - animation.start ) / animation.duration;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function ( name, weight ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.weight = weight;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function ( name, time ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.time = time;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function ( name ) {\r\n\r\n\tvar time = 0;\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\ttime = animation.time;\r\n\r\n\t}\r\n\r\n\treturn time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function ( name ) {\r\n\r\n\tvar duration = - 1;\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tduration = animation.duration;\r\n\r\n\t}\r\n\r\n\treturn duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.time = 0;\r\n\t\tanimation.active = true;\r\n\r\n\t} else {\r\n\r\n\t\tconsole.warn( \"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\" );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.active = false;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function ( delta ) {\r\n\r\n\tfor ( var i = 0, il = this.animationsList.length; i < il; i ++ ) {\r\n\r\n\t\tvar animation = this.animationsList[ i ];\r\n\r\n\t\tif ( ! animation.active ) continue;\r\n\r\n\t\tvar frameTime = animation.duration / animation.length;\r\n\r\n\t\tanimation.time += animation.direction * delta;\r\n\r\n\t\tif ( animation.mirroredLoop ) {\r\n\r\n\t\t\tif ( animation.time > animation.duration || animation.time < 0 ) {\r\n\r\n\t\t\t\tanimation.direction *= - 1;\r\n\r\n\t\t\t\tif ( animation.time > animation.duration ) {\r\n\r\n\t\t\t\t\tanimation.time = animation.duration;\r\n\t\t\t\t\tanimation.directionBackwards = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( animation.time < 0 ) {\r\n\r\n\t\t\t\t\tanimation.time = 0;\r\n\t\t\t\t\tanimation.directionBackwards = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tanimation.time = animation.time % animation.duration;\r\n\r\n\t\t\tif ( animation.time < 0 ) animation.time += animation.duration;\r\n\r\n\t\t}\r\n\r\n\t\tvar keyframe = animation.start + THREE.Math.clamp( Math.floor( animation.time / frameTime ), 0, animation.length - 1 );\r\n\t\tvar weight = animation.weight;\r\n\r\n\t\tif ( keyframe !== animation.currentFrame ) {\r\n\r\n\t\t\tthis.morphTargetInfluences[ animation.lastFrame ] = 0;\r\n\t\t\tthis.morphTargetInfluences[ animation.currentFrame ] = 1 * weight;\r\n\r\n\t\t\tthis.morphTargetInfluences[ keyframe ] = 0;\r\n\r\n\t\t\tanimation.lastFrame = animation.currentFrame;\r\n\t\t\tanimation.currentFrame = keyframe;\r\n\r\n\t\t}\r\n\r\n\t\tvar mix = ( animation.time % frameTime ) / frameTime;\r\n\r\n\t\tif ( animation.directionBackwards ) mix = 1 - mix;\r\n\r\n\t\tif ( animation.currentFrame !== animation.lastFrame ) {\r\n\r\n\t\t\tthis.morphTargetInfluences[ animation.currentFrame ] = mix * weight;\r\n\t\t\tthis.morphTargetInfluences[ animation.lastFrame ] = ( 1 - mix ) * weight;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.morphTargetInfluences[ animation.currentFrame ] = weight;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n} else {\r\n  this['THREE'] = THREE;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}