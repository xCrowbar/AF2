{"ast":null,"code":"/* eslint-disable no-underscore-dangle */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport { ViewController, createDuplicateIframeWarning, createURL, createModalNotReadyError } from '@magic-sdk/provider';\n/**\n * Magic `<iframe>` overlay styles. These base styles enable `<iframe>` UI\n * to render above all other DOM content.\n */\n\nvar overlayStyles = {\n  display: 'none',\n  position: 'fixed',\n  top: '0',\n  right: '0',\n  width: '100%',\n  height: '100%',\n  borderRadius: '0',\n  border: 'none',\n  zIndex: '2147483647'\n};\n/**\n * Apply iframe styles to the given element.\n * @param elem - An element to apply styles using CSSOM.\n */\n\nfunction applyOverlayStyles(elem) {\n  var e_1, _a;\n\n  try {\n    for (var _b = __values(Object.entries(overlayStyles)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var _d = __read(_c.value, 2),\n          cssProperty = _d[0],\n          value = _d[1];\n      /* eslint-disable-next-line no-param-reassign */\n\n\n      elem.style[cssProperty] = value;\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n}\n/**\n * Checks if the given query params are associated with an active `<iframe>`\n * instance.\n *\n * @param encodedQueryParams - The unique, encoded query parameters to check for\n * duplicates against.\n */\n\n\nfunction checkForSameSrcInstances(encodedQueryParams) {\n  var iframes = [].slice.call(document.querySelectorAll('.magic-iframe'));\n  return Boolean(iframes.find(function (iframe) {\n    return iframe.src.includes(encodedQueryParams);\n  }));\n}\n/**\n * View controller for the Magic `<iframe>` overlay.\n */\n\n\nvar IframeController =\n/** @class */\nfunction (_super) {\n  __extends(IframeController, _super);\n\n  function IframeController() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  IframeController.prototype.init = function () {\n    this.iframe = this.createIframe();\n  };\n\n  IframeController.prototype.createIframe = function () {\n    var _this = this;\n\n    return new Promise(function (resolve) {\n      var onload = function () {\n        if (!checkForSameSrcInstances(encodeURIComponent(_this.encodedQueryParams))) {\n          var iframe = document.createElement('iframe');\n          iframe.classList.add('magic-iframe');\n          iframe.dataset.magicIframeLabel = createURL(_this.endpoint).host;\n          iframe.src = createURL(\"/send?params=\" + encodeURIComponent(_this.encodedQueryParams), _this.endpoint).href;\n          applyOverlayStyles(iframe);\n          document.body.appendChild(iframe);\n          resolve(iframe);\n        } else {\n          createDuplicateIframeWarning().log();\n        }\n      }; // Check DOM state and load...\n\n\n      if (['loaded', 'interactive', 'complete'].includes(document.readyState)) {\n        onload();\n      } else {\n        // ...or check load events to load\n        window.addEventListener('load', onload, false);\n      }\n    });\n  };\n\n  IframeController.prototype.showOverlay = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var overlayResolved;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            overlayResolved = _a.sent();\n            overlayResolved.style.display = 'block';\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  IframeController.prototype.hideOverlay = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var overlayResolved;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            overlayResolved = _a.sent();\n            overlayResolved.style.display = 'none';\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  IframeController.prototype.postMessage = function (data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var iframe;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            iframe = _a.sent();\n\n            if (iframe && iframe.contentWindow) {\n              iframe.contentWindow.postMessage(data, this.endpoint);\n            } else {\n              throw createModalNotReadyError();\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return IframeController;\n}(ViewController);\n\nexport { IframeController };","map":{"version":3,"mappings":"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","names":["ViewController","createDuplicateIframeWarning","createURL","createModalNotReadyError","overlayStyles","display","position","top","right","width","height","borderRadius","border","zIndex","applyOverlayStyles","elem","entries","_c","cssProperty","value","style","checkForSameSrcInstances","encodedQueryParams","iframes","slice","call","document","querySelectorAll","Boolean","find","iframe","src","includes","__extends","IframeController","createIframe","Promise","resolve","onload","encodeURIComponent","_this","createElement","classList","add","dataset","magicIframeLabel","endpoint","host","href","body","appendChild","log","readyState","window","addEventListener","overlayResolved","_a","data","contentWindow","postMessage"],"sourceRoot":"","sources":["../../src/iframe-controller.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}