{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _Three = require('./Three');\n\nvar _Three2 = _interopRequireDefault(_Three);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar OrbitControls = require('three-orbit-controls')(_Three2.default);\n\nvar DIRECTIONAL_LIGHT = 'directionalLight';\n\nvar Paint = function () {\n  function Paint() {\n    _classCallCheck(this, Paint);\n\n    this.loader = new _Three2.default.STLLoader();\n    this.scene = new _Three2.default.Scene();\n    this.renderer = new _Three2.default.WebGLRenderer({\n      antialias: true\n    });\n    this.reqNumber = 0;\n  }\n\n  _createClass(Paint, [{\n    key: 'init',\n    value: function init(context) {\n      this.component = context;\n      this.width = context.props.width;\n      this.height = context.props.height;\n      this.modelColor = context.props.modelColor;\n      this.backgroundColor = context.props.backgroundColor;\n      this.orbitControls = context.props.orbitControls;\n      this.rotate = context.props.rotate;\n      this.cameraX = context.props.cameraX;\n      this.cameraY = context.props.cameraY;\n      this.cameraZ = context.props.cameraZ;\n      this.rotationSpeeds = context.props.rotationSpeeds;\n      this.lights = context.props.lights;\n      this.lightColor = context.props.lightColor;\n      this.model = context.props.model;\n\n      if (this.mesh !== undefined) {\n        this.scene.remove(this.mesh);\n        this.mesh.geometry.dispose();\n        this.mesh.material.dispose();\n        this.scene.remove(this.grid);\n      }\n\n      var directionalLightObj = this.scene.getObjectByName(DIRECTIONAL_LIGHT);\n\n      if (directionalLightObj) {\n        this.scene.remove(directionalLightObj);\n      }\n\n      if (this.animationRequestId) {\n        cancelAnimationFrame(this.animationRequestId);\n      } //Detector.addGetWebGLMessage();\n\n\n      this.distance = 10000; // lights processing\n\n      var hasMultipleLights = this.lights.reduce(function (acc, item) {\n        return acc && Array.isArray(item);\n      }, true);\n\n      if (hasMultipleLights) {\n        this.lights.forEach(this.addLight.bind(this));\n      } else {\n        this.addLight(this.lights);\n      }\n\n      this.reqNumber += 1;\n      this.addSTLToScene(this.reqNumber);\n    }\n  }, {\n    key: 'addLight',\n    value: function addLight(lights) {\n      var _directionalLight$pos;\n\n      var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var directionalLight = new _Three2.default.DirectionalLight(this.lightColor);\n\n      (_directionalLight$pos = directionalLight.position).set.apply(_directionalLight$pos, _toConsumableArray(lights));\n\n      directionalLight.name = DIRECTIONAL_LIGHT + index;\n      directionalLight.position.normalize();\n      this.scene.add(directionalLight);\n    }\n  }, {\n    key: 'loadSTLFromUrl',\n    value: function loadSTLFromUrl(url, reqId) {\n      var _this = this;\n\n      return new Promise(function (resolve) {\n        _this.loader.crossOrigin = '';\n\n        _this.loader.loadFromUrl(url, function (geometry) {\n          if (_this.reqNumber !== reqId) {\n            return;\n          }\n\n          resolve(geometry);\n        });\n      });\n    }\n  }, {\n    key: 'loadFromFile',\n    value: function loadFromFile(file) {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        _this2.loader.loadFromFile(file, function (geometry) {\n          resolve(geometry);\n        });\n      });\n    }\n  }, {\n    key: 'addSTLToScene',\n    value: function addSTLToScene(reqId) {\n      var _this3 = this;\n\n      var loadPromise = void 0;\n\n      if (typeof this.model === 'string') {\n        loadPromise = this.loadSTLFromUrl(this.model, reqId);\n      } else if (this.model instanceof ArrayBuffer) {\n        loadPromise = this.loadFromFile(this.model);\n      } else {\n        return Promise.resolve(null);\n      }\n\n      return loadPromise.then(function (geometry) {\n        // Calculate mesh noramls for MeshLambertMaterial.\n        geometry.computeFaceNormals();\n        geometry.computeVertexNormals(); // Center the object\n\n        geometry.center();\n        var material = new _Three2.default.MeshLambertMaterial({\n          overdraw: true,\n          color: _this3.modelColor\n        });\n\n        if (geometry.hasColors) {\n          material = new _Three2.default.MeshPhongMaterial({\n            opacity: geometry.alpha,\n            vertexColors: _Three2.default.VertexColors\n          });\n        }\n\n        _this3.mesh = new _Three2.default.Mesh(geometry, material); // Set the object's dimensions\n\n        geometry.computeBoundingBox();\n        _this3.xDims = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n        _this3.yDims = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n        _this3.zDims = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n        if (_this3.rotate) {\n          _this3.mesh.rotation.x = _this3.rotationSpeeds[0];\n          _this3.mesh.rotation.y = _this3.rotationSpeeds[1];\n          _this3.mesh.rotation.z = _this3.rotationSpeeds[2];\n        }\n\n        _this3.scene.add(_this3.mesh);\n\n        _this3.addCamera();\n\n        _this3.addInteractionControls();\n\n        _this3.addToReactComponent(); // Start the animation\n\n\n        _this3.animate();\n      });\n    }\n  }, {\n    key: 'addCamera',\n    value: function addCamera() {\n      // Add the camera\n      this.camera = new _Three2.default.PerspectiveCamera(30, this.width / this.height, 1, this.distance);\n\n      if (this.cameraZ === null) {\n        this.cameraZ = Math.max(this.xDims * 3, this.yDims * 3, this.zDims * 3);\n      }\n\n      this.camera.position.set(this.cameraX, this.cameraY, this.cameraZ);\n      this.scene.add(this.camera);\n      this.camera.lookAt(this.mesh);\n      this.renderer.set;\n      this.renderer.setSize(this.width, this.height);\n      this.renderer.setClearColor(this.backgroundColor, 1);\n    }\n  }, {\n    key: 'addInteractionControls',\n    value: function addInteractionControls() {\n      // Add controls for mouse interaction\n      if (this.orbitControls) {\n        this.controls = new OrbitControls(this.camera, _reactDom2.default.findDOMNode(this.component));\n        this.controls.enableKeys = false;\n        this.controls.addEventListener('change', this.orbitRender.bind(this));\n      }\n    }\n  }, {\n    key: 'addToReactComponent',\n    value: function addToReactComponent() {\n      // Add to the React Component\n      _reactDom2.default.findDOMNode(this.component).replaceChild(this.renderer.domElement, _reactDom2.default.findDOMNode(this.component).firstChild);\n    }\n    /**\n     * Animate the scene\n     * @returns {void}\n     */\n\n  }, {\n    key: 'animate',\n    value: function animate() {\n      // note: three.js includes requestAnimationFrame shim\n      if (this.rotate) {\n        this.animationRequestId = requestAnimationFrame(this.animate.bind(this));\n      }\n\n      if (this.orbitControls) {\n        this.controls.update();\n      }\n\n      this.render();\n    }\n    /**\n     * Render the scene after turning off the rotation\n     * @returns {void}\n     */\n\n  }, {\n    key: 'orbitRender',\n    value: function orbitRender() {\n      if (this.rotate) {\n        this.rotate = false;\n      }\n\n      this.render();\n    }\n    /**\n     * Deallocate Mesh, renderer context.\n     * @returns {void}\n     */\n\n  }, {\n    key: 'clean',\n    value: function clean() {\n      if (this.mesh !== undefined) {\n        this.mesh.geometry.dispose();\n        this.mesh.material.dispose();\n        this.scene.remove(this.mesh);\n        delete this.mesh;\n      }\n\n      var directionalLightObj = this.scene.getObjectByName(DIRECTIONAL_LIGHT);\n\n      if (directionalLightObj) {\n        this.scene.remove(directionalLightObj);\n      }\n\n      if (this.animationRequestId) {\n        cancelAnimationFrame(this.animationRequestId);\n      }\n\n      this.renderer.dispose();\n      this.renderer.forceContextLoss();\n    }\n    /**\n     * Render the scene\n     * @returns {void}\n     */\n\n  }, {\n    key: 'render',\n    value: function render() {\n      if (this.mesh && this.rotate) {\n        this.mesh.rotation.x += this.rotationSpeeds[0];\n        this.mesh.rotation.y += this.rotationSpeeds[1];\n        this.mesh.rotation.z += this.rotationSpeeds[2];\n      }\n\n      this.renderer.render(this.scene, this.camera);\n    }\n  }]);\n\n  return Paint;\n}();\n\nexports.default = Paint;\nmodule.exports = exports['default'];","map":{"version":3,"sources":["/home/mike/Scrivania/provaFrontEnd/af2_front_end_test/node_modules/stl-viewer/dist/Paint.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_Three","require","_Three2","_interopRequireDefault","_reactDom","_reactDom2","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","arr2","from","_classCallCheck","instance","TypeError","OrbitControls","DIRECTIONAL_LIGHT","Paint","loader","STLLoader","scene","Scene","renderer","WebGLRenderer","antialias","reqNumber","init","context","component","width","height","modelColor","backgroundColor","orbitControls","rotate","cameraX","cameraY","cameraZ","rotationSpeeds","lights","lightColor","model","mesh","undefined","remove","geometry","dispose","material","grid","directionalLightObj","getObjectByName","animationRequestId","cancelAnimationFrame","distance","hasMultipleLights","reduce","acc","item","forEach","addLight","bind","addSTLToScene","_directionalLight$pos","index","arguments","directionalLight","DirectionalLight","position","set","apply","name","normalize","add","loadSTLFromUrl","url","reqId","_this","Promise","resolve","crossOrigin","loadFromUrl","loadFromFile","file","_this2","_this3","loadPromise","ArrayBuffer","then","computeFaceNormals","computeVertexNormals","center","MeshLambertMaterial","overdraw","color","hasColors","MeshPhongMaterial","opacity","alpha","vertexColors","VertexColors","Mesh","computeBoundingBox","xDims","boundingBox","max","x","min","yDims","y","zDims","z","rotation","addCamera","addInteractionControls","addToReactComponent","animate","camera","PerspectiveCamera","Math","lookAt","setSize","setClearColor","controls","findDOMNode","enableKeys","addEventListener","orbitRender","replaceChild","domElement","firstChild","requestAnimationFrame","update","render","clean","forceContextLoss","module"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Three = require('./Three');\n\nvar _Three2 = _interopRequireDefault(_Three);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar OrbitControls = require('three-orbit-controls')(_Three2.default);\n\nvar DIRECTIONAL_LIGHT = 'directionalLight';\n\nvar Paint = function () {\n  function Paint() {\n    _classCallCheck(this, Paint);\n\n    this.loader = new _Three2.default.STLLoader();\n    this.scene = new _Three2.default.Scene();\n    this.renderer = new _Three2.default.WebGLRenderer({\n      antialias: true\n    });\n    this.reqNumber = 0;\n  }\n\n  _createClass(Paint, [{\n    key: 'init',\n    value: function init(context) {\n      this.component = context;\n      this.width = context.props.width;\n      this.height = context.props.height;\n      this.modelColor = context.props.modelColor;\n      this.backgroundColor = context.props.backgroundColor;\n      this.orbitControls = context.props.orbitControls;\n      this.rotate = context.props.rotate;\n      this.cameraX = context.props.cameraX;\n      this.cameraY = context.props.cameraY;\n      this.cameraZ = context.props.cameraZ;\n      this.rotationSpeeds = context.props.rotationSpeeds;\n      this.lights = context.props.lights;\n      this.lightColor = context.props.lightColor;\n      this.model = context.props.model;\n\n      if (this.mesh !== undefined) {\n        this.scene.remove(this.mesh);\n        this.mesh.geometry.dispose();\n        this.mesh.material.dispose();\n        this.scene.remove(this.grid);\n      }\n      var directionalLightObj = this.scene.getObjectByName(DIRECTIONAL_LIGHT);\n      if (directionalLightObj) {\n        this.scene.remove(directionalLightObj);\n      }\n\n      if (this.animationRequestId) {\n        cancelAnimationFrame(this.animationRequestId);\n      }\n\n      //Detector.addGetWebGLMessage();\n      this.distance = 10000;\n\n      // lights processing\n      var hasMultipleLights = this.lights.reduce(function (acc, item) {\n        return acc && Array.isArray(item);\n      }, true);\n      if (hasMultipleLights) {\n        this.lights.forEach(this.addLight.bind(this));\n      } else {\n        this.addLight(this.lights);\n      }\n\n      this.reqNumber += 1;\n      this.addSTLToScene(this.reqNumber);\n    }\n  }, {\n    key: 'addLight',\n    value: function addLight(lights) {\n      var _directionalLight$pos;\n\n      var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n      var directionalLight = new _Three2.default.DirectionalLight(this.lightColor);\n      (_directionalLight$pos = directionalLight.position).set.apply(_directionalLight$pos, _toConsumableArray(lights));\n      directionalLight.name = DIRECTIONAL_LIGHT + index;\n      directionalLight.position.normalize();\n      this.scene.add(directionalLight);\n    }\n  }, {\n    key: 'loadSTLFromUrl',\n    value: function loadSTLFromUrl(url, reqId) {\n      var _this = this;\n\n      return new Promise(function (resolve) {\n        _this.loader.crossOrigin = '';\n        _this.loader.loadFromUrl(url, function (geometry) {\n          if (_this.reqNumber !== reqId) {\n            return;\n          }\n          resolve(geometry);\n        });\n      });\n    }\n  }, {\n    key: 'loadFromFile',\n    value: function loadFromFile(file) {\n      var _this2 = this;\n\n      return new Promise(function (resolve) {\n        _this2.loader.loadFromFile(file, function (geometry) {\n          resolve(geometry);\n        });\n      });\n    }\n  }, {\n    key: 'addSTLToScene',\n    value: function addSTLToScene(reqId) {\n      var _this3 = this;\n\n      var loadPromise = void 0;\n      if (typeof this.model === 'string') {\n        loadPromise = this.loadSTLFromUrl(this.model, reqId);\n      } else if (this.model instanceof ArrayBuffer) {\n        loadPromise = this.loadFromFile(this.model);\n      } else {\n        return Promise.resolve(null);\n      }\n      return loadPromise.then(function (geometry) {\n        // Calculate mesh noramls for MeshLambertMaterial.\n        geometry.computeFaceNormals();\n        geometry.computeVertexNormals();\n\n        // Center the object\n        geometry.center();\n\n        var material = new _Three2.default.MeshLambertMaterial({\n          overdraw: true,\n          color: _this3.modelColor\n        });\n\n        if (geometry.hasColors) {\n          material = new _Three2.default.MeshPhongMaterial({\n            opacity: geometry.alpha,\n            vertexColors: _Three2.default.VertexColors\n          });\n        }\n\n        _this3.mesh = new _Three2.default.Mesh(geometry, material);\n        // Set the object's dimensions\n        geometry.computeBoundingBox();\n        _this3.xDims = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n        _this3.yDims = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n        _this3.zDims = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n        if (_this3.rotate) {\n          _this3.mesh.rotation.x = _this3.rotationSpeeds[0];\n          _this3.mesh.rotation.y = _this3.rotationSpeeds[1];\n          _this3.mesh.rotation.z = _this3.rotationSpeeds[2];\n        }\n\n        _this3.scene.add(_this3.mesh);\n\n        _this3.addCamera();\n        _this3.addInteractionControls();\n        _this3.addToReactComponent();\n\n        // Start the animation\n        _this3.animate();\n      });\n    }\n  }, {\n    key: 'addCamera',\n    value: function addCamera() {\n      // Add the camera\n      this.camera = new _Three2.default.PerspectiveCamera(30, this.width / this.height, 1, this.distance);\n\n      if (this.cameraZ === null) {\n        this.cameraZ = Math.max(this.xDims * 3, this.yDims * 3, this.zDims * 3);\n      }\n\n      this.camera.position.set(this.cameraX, this.cameraY, this.cameraZ);\n\n      this.scene.add(this.camera);\n\n      this.camera.lookAt(this.mesh);\n\n      this.renderer.set;\n      this.renderer.setSize(this.width, this.height);\n      this.renderer.setClearColor(this.backgroundColor, 1);\n    }\n  }, {\n    key: 'addInteractionControls',\n    value: function addInteractionControls() {\n      // Add controls for mouse interaction\n      if (this.orbitControls) {\n        this.controls = new OrbitControls(this.camera, _reactDom2.default.findDOMNode(this.component));\n        this.controls.enableKeys = false;\n        this.controls.addEventListener('change', this.orbitRender.bind(this));\n      }\n    }\n  }, {\n    key: 'addToReactComponent',\n    value: function addToReactComponent() {\n      // Add to the React Component\n      _reactDom2.default.findDOMNode(this.component).replaceChild(this.renderer.domElement, _reactDom2.default.findDOMNode(this.component).firstChild);\n    }\n\n    /**\n     * Animate the scene\n     * @returns {void}\n     */\n\n  }, {\n    key: 'animate',\n    value: function animate() {\n      // note: three.js includes requestAnimationFrame shim\n      if (this.rotate) {\n        this.animationRequestId = requestAnimationFrame(this.animate.bind(this));\n      }\n\n      if (this.orbitControls) {\n        this.controls.update();\n      }\n      this.render();\n    }\n\n    /**\n     * Render the scene after turning off the rotation\n     * @returns {void}\n     */\n\n  }, {\n    key: 'orbitRender',\n    value: function orbitRender() {\n      if (this.rotate) {\n        this.rotate = false;\n      }\n\n      this.render();\n    }\n\n    /**\n     * Deallocate Mesh, renderer context.\n     * @returns {void}\n     */\n\n  }, {\n    key: 'clean',\n    value: function clean() {\n      if (this.mesh !== undefined) {\n        this.mesh.geometry.dispose();\n        this.mesh.material.dispose();\n        this.scene.remove(this.mesh);\n        delete this.mesh;\n      }\n      var directionalLightObj = this.scene.getObjectByName(DIRECTIONAL_LIGHT);\n      if (directionalLightObj) {\n        this.scene.remove(directionalLightObj);\n      }\n\n      if (this.animationRequestId) {\n        cancelAnimationFrame(this.animationRequestId);\n      }\n      this.renderer.dispose();\n      this.renderer.forceContextLoss();\n    }\n\n    /**\n     * Render the scene\n     * @returns {void}\n     */\n\n  }, {\n    key: 'render',\n    value: function render() {\n      if (this.mesh && this.rotate) {\n        this.mesh.rotation.x += this.rotationSpeeds[0];\n        this.mesh.rotation.y += this.rotationSpeeds[1];\n        this.mesh.rotation.z += this.rotationSpeeds[2];\n      }\n\n      this.renderer.render(this.scene, this.camera);\n    }\n  }]);\n\n  return Paint;\n}();\n\nexports.default = Paint;\nmodule.exports = exports['default'];"]},"metadata":{},"sourceType":"script"}